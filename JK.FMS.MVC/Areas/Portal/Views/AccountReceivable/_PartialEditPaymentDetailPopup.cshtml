@model JKViewModels.AccountReceivable.PaymentDetailsPopupModel

@section styles{
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css")" rel="stylesheet" type="text/css" />
    <style type="text/css">
        tr > td {
            font-size: 12px !important;
            padding: 4px !important;
        }

        /*tr > th {
            font-size: 11px !important;
            text-transform: uppercase;
        }*/

        .row {
            margin: 0;
            padding: 5px 0;
        }

        .opendiv {
            padding: 4px;
            background-color: gold;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .closeddiv {
            padding: 4px;
            background-color: limegreen;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overpaiddiv {
            padding: 4px;
            background-color: deepskyblue;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overduediv {
            padding: 4px;
            background-color: orangered;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .btn {
            padding: 3px 12px;
            font-size: 12px;
        }

        #ui-datepicker-div {
            z-index: 99999 !important;
        }
    </style>
}

<div class="modal fade custom-model custom-form-design" id="ModalEDITPaymentDetailsPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:1100px">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    Edit Payment Detail
                </h4>
            </div>
            <div class="modal-body" style="padding: 0px 15px 15px 20px;">

                <form id="frmeditpaymentdetailspopup">
                    <input type="hidden" id="oinv_changeAmount" name="oinv_changeAmount" value="0">
                    <input type="hidden" id="oinv_changeApplyAmount" name="oinv_changeApplyAmount" value="0">
                    <input type="hidden" id="oinv_changeBalanceAmount" name="oinv_changeBalanceAmount" value="0">

                    <input type="hidden" id="oinv_changeInvoiceData" name="oinv_changeInvoiceData" value="0">


                    <input type="hidden" id="invoiceId" name="invoiceId" value="">
                    <input type="hidden" id="hdnPaymentId" name="hdnPaymentId" value="@Model.PaymentId">
                    <input type="hidden" id="numLineItems" value="">




                    <div class="row">
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Payment Date:</b></div>
                        <div class="col-md-2">
                            <div class="input-group" data-date-format="mm/dd/yyyy">
                                <input type="text" name="txtPaymentDate" value="@Convert.ToDateTime(Model.PaymentDate).ToString("MM/dd/yyyy")" class="form-control input-sm date-picker AddPeriodvalidation" style="margin-top: 0px;" id="txtPaymentDate" />
                                <span class="input-group-btn">
                                    <button class="btn default" type="button">
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Payment Type:</b></div>
                        <div class="col-md-2">
                            @Html.DropDownList("slPaymentType", (SelectList)ViewBag.PaymentMethodList, new { @class = "form-control input-sm", @id = "slPaymentType" })
                        </div>
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Amount:</b></div>
                        <div class="col-md-2 form-inline ">
                            <input class="form-control input-sm credit-field creditfieldcurrency" id="txtAmount" name="oldBalance" style="text-align: right;width: 150px !important;" type="text" value="@string.Format("{0:C}", Model.PaymentAmount)" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Check/Ref.:</b></div>
                        <div class="col-md-2">
                            <input class="form-control input-sm col-md-1" id="txtPaymentNo" name="txtPaymentNo" required="required" style="text-align: right;width:50% !important;" type="text" value="@Model.PaymentNo">
                        </div>
                        <div class="col-md-2 text-right" style="padding-top: 3px;"></div>
                        <div class="col-md-2">
                        </div>
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Credit:</b></div>
                        <div class="col-md-2 form-inline ">
                            <input class="form-control input-sm credit-field creditfieldcurrency" readonly id="creditAmt" name="creditAmt" style="text-align: right;width: 150px !important;" type="text" value="@string.Format("{0:C}", Model.PaymentAmount)">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Note:</b></div>
                        <div class="col-md-6">
                            <input class="form-control input-sm" id="txtNote" name="creditDesc" required="required" type="text" value="@Model.Note">
                        </div>
                        <div class="col-md-2 text-right" style="padding-top: 3px;"><b>Balance:</b></div>
                        <div class="col-md-2 form-inline ">
                            <input class="form-control input-sm credit-field creditfieldcurrency" readonly id="newBalance" name="newBalance" style="text-align: right;width: 150px !important" type="text" value="0">
                        </div>
                    </div>

                    <hr style="margin-top: 6px;margin-bottom: 6px;">

                    <div class="row" id="divResultDetail">
                        <div class="col-md-12">
                            <table class="table table-bordered table-responsive borderClass" width="100%">
                                <thead>
                                    <tr style="border:2px solid #b3a9a9;">
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Type</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Date</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Customer No</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Customer Name</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Check/Invoice No.</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Description</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Trx Amount</th>
                                        <th style="text-align:center;border:2px solid #b3a9a9;">Balance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.PaymentDetailType)
                                    {
                                        <tr style="border:2px solid #b3a9a9;">
                                            <td style="text-align:center;border:2px solid #b3a9a9;">@item.Type </td>
                                            <td style="text-align:center;border:2px solid #b3a9a9;"> @Convert.ToDateTime(item.Date).ToString("MM/dd/yyyy")  </td>
                                            <td style="text-align:center;border:2px solid #b3a9a9;"> @item.CustomerNo</td>
                                            <td style="text-align:left;border:2px solid #b3a9a9;"> @item.CustomerName</td>
                                            <td style="text-align:center;border:2px solid #b3a9a9;"> @item.TransactionNumber</td>
                                            <td style="text-align:left;border:2px solid #b3a9a9;">@item.Description </td>
                                            @if (item.Type == "Payment")
                                            {
                                                <td style="text-align:right;color:red;border:2px solid #b3a9a9;">(@string.Format("{0:c}", item.Amount))</td>
                                                <td style="text-align:right;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.BalanceAmount)</td>
                                            }
                                            else
                                            {
                                                <td style="text-align:right;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.Amount)</td>

                                                if (item.BalanceAmount < 0)
                                                {
                                                    <td style="text-align:right;color:red;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.BalanceAmount)</td>
                                                }
                                                else
                                                {
                                                    <td style="text-align:right;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.BalanceAmount)</td>
                                                }
                                            }

                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row" id="divResultDetailButton">
                        <div class="col-md-12">
                            <input type="button" class="btn btn-primary" value="Change Invoices" id="btnChangeInvoices" onclick="btnShowChangeInvoices_OnClick()" />
                        </div>
                    </div>
                    <div class="row" id="divResultSelected" style="display:none;">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover order-column" id="InvoiceListSelectedMain">
                                    <thead>
                                        <tr>
                                            <th class="tblInvoice_chk" style="text-align:center; width: 30px">
                                                <input type="checkbox" id="chkAll" name="chkAll" />
                                            </th>
                                            <th class="tblInvoice_invoiceNo" style="width:75px;text-align:center;">
                                                Invoice No
                                            </th>
                                            <th class="tblInvoice_invoiceDate" style="width:80px;text-align:center;">
                                                Invoice Date
                                            </th>
                                            <th class="tblInvoice_customerNo" style="width:80px;text-align:center;">
                                                Customer No.
                                            </th>
                                            <th class="tblInvoice_customerName" style="width:190px;text-align:center;">
                                                Customer Name
                                            </th>
                                            <th class="tblInvoice_invoiceDesc" style="width:240px;text-align:center;">
                                                Invoice Description
                                            </th>
                                            <th class="tblInvoice_invoiceAmt" style="text-align:center;width:90px;">
                                                Inv. Amount
                                            </th>
                                            <th class="tblInvoice_payment" style="text-align:center;width:90px;">
                                                Payment Apply
                                            </th>
                                            <th class="tblInvoice_balance" style="text-align:center;width:90px;">
                                                Balance
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.PaymentDetailType.Where(k => k.Type == "Invoice").ToList())
                                        {
                                            <tr style="border:2px solid #b3a9a9;" id="@("ftr_"+item.InvoiceId)">
                                                <td>



                                                    <input type="hidden" id="@("oinv_CustomerId_"+item.InvoiceId)" name="@("oinv_CustomerId_"+item.InvoiceId)" value="@item.CustomerId" />
                                                    <input type="hidden" id="@("oinv_InvoiceId_"+item.InvoiceId)" name="@("oinv_InvoiceId_"+item.InvoiceId)" value="@item.InvoiceId" />
                                                    <input type="hidden" id="@("oinv_ApplyAmount_"+item.InvoiceId)" name="@("oinv_ApplyAmount_"+item.InvoiceId)" value="@item.Amount" />
                                                    <input type="hidden" id="@("oinv_OApplyAmount_"+item.InvoiceId)" name="@("oinv_OApplyAmount_"+item.InvoiceId)" value="@(item.BalanceAmount>0?0:item.BalanceAmount)" />
                                                    <input rel="oinv_mgglchk" type="checkbox" id="@("oinv_"+item.InvoiceId +"_chk")" value="@item.InvoiceId" name="@("oinv_"+item.InvoiceId +"_chk")" class="payment-checkbox" />
                                                </td>
                                                <td>@item.TransactionNumber</td>
                                                <td> @Convert.ToDateTime(item.Date).ToString("MM/dd/yyyy")  </td>
                                                <td> @item.CustomerNo</td>
                                                <td style="text-align:left;border:2px solid #b3a9a9;">@item.CustomerName</td>
                                                <td style="text-align:left;border:2px solid #b3a9a9;">@item.Description </td>
                                                <td style="text-align:right;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.Amount)</td>
                                                <td style="text-align:right;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.Amount)</td>
                                                @if (item.BalanceAmount < 0)
                                                {
                                                    <td style="text-align:right;color:red;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.BalanceAmount)</td>
                                                }
                                                else
                                                {
                                                    <td style="text-align:right;border:2px solid #b3a9a9;">@string.Format("{0:c}", item.BalanceAmount)</td>
                                                }

                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="divResultDetailButtonApply" style="display:none;">
                        <div class="col-md-12">
                            <input type="button" class="btn btn-primary" value="Change Invoices" id="btnChangeInvoices" onclick="btnChangeInvoices_OnClick()" />
                        </div>
                    </div>

                    <div id="divChangeInvoice" style="display:none;">

                        <div class="row" id="divInvoiceListSelected">
                            <div class="col-md-12">
                                <h3 style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                                    Selected Invoices
                                </h3>
                            </div>
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover order-column" id="invoiceListSelected">
                                        <thead>
                                            <tr>
                                                <th class="tblInvoice_chk" style="text-align:center; width: 30px"></th>
                                                <th class="tblInvoice_customerNo" style="width:70px;text-align:center;">
                                                    Customer No.
                                                </th>
                                                <th class="tblInvoice_customerName" style="width:180px;text-align:center;">
                                                    Customer Name
                                                </th>
                                                <th class="tblInvoice_invoiceNo" style="width:80px;text-align:center;">
                                                    Invoice No
                                                </th>
                                                <th class="tblInvoice_invoiceDate" style="width:80px;text-align:center;">
                                                    Invoice Date
                                                </th>
                                                <th class="tblInvoice_invoiceDesc" style="width:220px;text-align:center;">
                                                    Invoice Description
                                                </th>
                                                <th class="tblInvoice_invoiceAmt" style="text-align:center;width:90px;">
                                                    Inv. Amount
                                                </th>
                                                <th class="tblInvoice_invoiceAmt" style="text-align:center;width:90px;">
                                                    Current Balance
                                                </th>
                                                <th class="tblInvoice_payment" style="text-align:center;width:90px;">
                                                    Payment Apply
                                                </th>
                                                <th class="tblInvoice_balance" style="text-align:center;width:90px;">
                                                    New Balance
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <input type="button" class="btn btn-primary" value="Apply" id="btnApplyInvoices" onclick="btnApplyInvoices_OnClick()" />
                            </div>
                        </div>

                        <!-- Detail Section -->
                        <div class="row" style="background-color: #4b85cc;color: #fff;padding-top:8px;padding-bottom:8px">
                            <div class="col-md-12">
                                <div class="col-md-3">
                                    <div class="input-icon">
                                        <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                                        <input type="text" placeholder="Search..." class="form-control input-sm typeahead" value="" autocomplete="off" id="input_SearchMP" />
                                    </div>
                                    <div id="container">
                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <label class="mt-checkbox" style="margin-bottom: 0px;">
                                        <input type="checkbox" id="chkIsOpen" class="search-field" checked>Open
                                        <span></span>
                                    </label>
                                </div>
                                <div class="col-md-1">
                                    <label class="mt-checkbox" style="margin-bottom: 0px;">
                                        <input type="checkbox" id="chkIsClose" class="search-field" checked>Close
                                        <span></span>
                                    </label>
                                </div>
                                <div class="col-md-1">
                                    <label class="mt-checkbox" style="margin-bottom: 0px;">
                                        <input type="checkbox" id="chkIsConsolidated" class="search-field">Consolidated
                                        <span></span>
                                    </label>
                                </div>
                                <div class="col-md-5 pull-right no-padding" style="text-align:center;">
                                    <div class="col-md-6 no-padding" style="margin-left:30px;">
                                        <select id="select_dateRangeMP" class="form-control input-sm">
                                            <option value="1">This Week</option>
                                            <option value="2">This Week-to-date</option>
                                            <option value="3">This Month</option>
                                            <option value="4">This Month-to-date</option>
                                            <option value="5">This Quarter</option>
                                            <option value="6">This Quarter-to-date</option>
                                            <option value="7">This Fiscal Year</option>
                                            <option value="8">This Fiscal Year-to-date</option>
                                            <option value="9">Today</option>
                                            <option value="10">Yesterday</option>
                                            <option value="11">Last Week</option>
                                            <option value="12">Last Month</option>
                                            <option value="13">Last Quarter</option>
                                            <option value="14">Last Year</option>
                                            <option value="15">Custom Date</option>
                                            <option value="16">Period</option>
                                            <option value="17" selected="selected">Last 90 Days</option>
                                        </select>
                                    </div>
                                    <div class="col-md-5 divspandate no-padding" style="margin-top: 7px; margin-left: 0px; display: block; float: right;">
                                        <span id="spnStartDate"></span> - <span id="spnEndtDate"></span>
                                    </div>
                                    <div class="col-md-3 no-padding" style="margin-left: 3px; width: 80px; display: none;" id="divSD">
                                        <input type="text" name="txtStartDate" id="txtStartDate" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                    </div>
                                    <div class="col-md-3 no-padding" style="margin-left: 3px; width: 80px; display: none;" id="divED">
                                        <input type="text" name="txtEndtDate" id="txtEndtDate" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                    </div>
                                    <div class="col-md-3 no-padding" style="margin-left: 3px; width: 100px; display: none;" id="divmonth">
                                        <select id="lbmonthlist" class="form-control input-sm">
                                            <option value="">Month</option>
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option>
                                            <option value="7">July</option>
                                            <option value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 no-padding" style="margin-left: 3px; width: 100px; display: none;" id="divyear">
                                        <select class="form-control input-sm" id="lbyearlist" style="padding-left: 2px;">
                                            <option value="">Year</option>
                                            <option value="2018">2018</option>
                                            <option value="2017">2017</option>
                                            <option value="2016">2016</option>
                                            <option value="2015">2015</option>
                                            <option value="2014">2014</option>
                                            <option value="2013">2013</option>
                                            <option value="2012">2012</option>
                                            <option value="2011">2011</option>
                                            <option value="2010">2010</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="row" id="divtblviewdetail_invoicelist">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover order-column" id="invoiceList1">
                                        <thead>
                                            <tr>
                                                <th class="tblInvoice_chk" style="text-align:center; width: 30px">
                                                </th>
                                                <th class="tblInvoice_customerNo" style="width:70px;text-align:center;">
                                                    Customer No.
                                                </th>
                                                <th class="tblInvoice_customerName" style="width:180px;text-align:center;">
                                                    Customer Name
                                                </th>
                                                <th class="tblInvoice_invoiceNo" style="width:80px;text-align:center;">
                                                    Invoice No
                                                </th>
                                                <th class="tblInvoice_invoiceDate" style="width:80px;text-align:center;">
                                                    Invoice Date
                                                </th>
                                                <th class="tblInvoice_invoiceDesc" style="width:220px;text-align:center;">
                                                    Invoice Description
                                                </th>
                                                <th class="tblInvoice_invoiceAmt" style="text-align:center;width:60px;">
                                                    Inv. Amount
                                                </th>
                                                <th class="tblInvoice_invoiceAmt" style="text-align:center;width:60px;">
                                                    Current Balance
                                                </th>
                                                @*<th class="tblInvoice_payment" style="text-align:center;width:60px;">
                                                        Payment Apply
                                                    </th>
                                                    <th class="tblInvoice_balance" style="text-align:center;width:60px;">
                                                        New Balance
                                                    </th>*@
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>



                    @*<div class="row">
                            <div class="col-md-12">
                                <input type="button" class="btn btn-primary" value="Change Invoices" id="btnChangeInvoices" onclick="btnChangeInvoices_OnClick()" />
                            </div>
                        </div>*@



                    <div class="form-group">
                        @*<div class="row">
                                <div class="col-md-1 text-right" style="width: 10%;"><b>Customer No:</b></div>
                                <div class="col-md-1">@Model.CustomerNo</div>
                                <div class="col-md-1 text-right" style="margin-left: -18px;"><b></b></div>
                                <div class="col-md-2"><label for="lblCustomerName" id="lblCustomerName">@Model.CustomerName</label> </div>
                                <div class="col-md-2 text-right"><b>Payment Date:</b></div>
                                <div class="col-md-2">
                                    <div class="input-group" data-date-format="mm/dd/yyyy">
                                        <input type="text" name="txtPaymentDate" value="@Convert.ToDateTime(Model.PaymentDate).ToString("MM/dd/yyyy")" class="form-control input-sm date-picker AddPeriodvalidation" style="margin-top: 0px;" id="txtPaymentDate" />
                                        <span class="input-group-btn">
                                            <button class="btn default" type="button">
                                                <i class="fa fa-calendar"></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-1 text-right" style="padding-top: 6px;"><b></b></div>
                                <div class="col-md-2 form-inline"><span style="padding-top: 6px;"></span></div>
                            </div>
                                            <div class="row">
                                <div class="col-md-1 text-right" style="width:111px;"><b>Customer Name:</b></div>
                                <div class="col-md-3">@Model.CustomerName</div>


                            </div>
                            <div class="row">
                                <div class="col-md-1 text-right"><b>Check/Ref.:</b></div>
                                <div class="col-md-3">

                                </div>
                                <div class="col-md-3 text-right"><b>Customer credit balance: </b></div>
                                <div class="col-md-1">
                                    <input class="form-control input-sm credit-field creditfieldcurrency" id="requestCreditAmt" name="requestCreditAmt" required="required" style="text-align: right;" type="text" value="">

                                </div>
                                <div class="col-md-2 text-right" style="padding-top: 6px;"><b>Credit:</b></div>
                                <div class="col-md-2 form-inline"><span style="padding-top: 6px;"></span></div>
                            </div>*@



                    </div>





                    <!-- Action buttons -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-8"></div>
                            <div class="col-md-2 control-label">
                                @*<button type="button" class="btn btn-primary submit-button" id="" name="">Save &amp; Close</button>*@
                            </div>
                            <div class="col-md-2 control-label">
                                <button type="button" class="btn btn-primary submit-button" id="btnUpdate" name="">Update</button>

                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<script type="text/javascript">

    $("#txtPaymentDate").datepicker();
    jQuery(document).ready(function () {
        // $("#paymentDate").datepicker();

        applyMaskCurrency('txtAmount');
        applyMaskCurrency('creditAmt');
        applyMaskCurrency('newBalance');


        $("#frmeditpaymentdetailspopup").submit(function (event) {
            $.blockUI();
            var sURL = '@Url.Action("UpdatePaymentDetailPopup", "AccountReceivable", new { area = "Portal" })';
            //$.blockUI();
            var dataString;
            event.preventDefault();
            event.stopImmediatePropagation();
            dataString = new FormData($("#frmeditpaymentdetailspopup").get(0));
            contentType = false;
            processData = false;
            $.ajax({
                url: sURL,
                data: dataString,
                dataType: "json",
                contentType: contentType,
                processData: processData,
                type: "POST",
                error: function (xhr, status, error) {
                    console.log(error);
                    $.unblockUI();
                    //do something about the error
                },
                success: function (response) {
                    $("#ModalEDITPaymentDetailsPopup").modal('hide');
                    $("#modal_paymentdetail").modal('hide');
                    pandingpaymentListrefreshTable();
                    btnOpenPaymentDetail(response.PaymentTempId);
                    $.unblockUI();
                }
            });

            //return false;// if it's a link to prevent post
            event.preventDefault();
        });

        
        $("#btnUpdate").click(function () {
            if (!validFormvalues()) {
                swal('Please apply amount total amount.')
            } else {                
                var id = $('#hdnPaymentId').val();
                var PaymentDate = $('#txtPaymentDate').val();
                var PaymentType = $('#slPaymentType').val();
                var PaymentNo = $('#txtPaymentNo').val();
                var Amount = $('#txtAmount').val().replace("$", "").replace(".00", "");
                var Note = $('#txtNote').val();
                $("#frmeditpaymentdetailspopup").submit();
            }
        });
    });


    function validFormvalues() {
        debugger;
        var retVal = true;

        //txtAmount
        //creditAmt
        //newBalance
        var _applyAmount = 0.00;
        var _invId = 0;
        var sList = "";
        var _paymentAMT = 0.00;

        if ($('#oinv_changeInvoiceData').val() == 0) {

            if ($('#txtAmount').val() != $('#creditAmt').val()) {
                retVal = false;
            }
        } else {
                       
            $('input[rel=oinv_mgglchk]').each(function () {
                _invId = $(this).val();
                _applyAmount = _applyAmount + parseFloat(parseFloat($('#oinv_ApplyAmount_' + _invId).val().toString(), 10).toFixed(2)) + parseFloat(parseFloat($('#oinv_OApplyAmount_' + _invId).val().toString(), 10).toFixed(2));
            });

            _paymentAMT = parseFloat($('#txtAmount').val().replace("$", "").replace(",", "").replace(" ", ""));
            $('#creditAmt').val(_applyAmount);
            $('#newBalance').val(_paymentAMT - _applyAmount);

            if ((_paymentAMT - _applyAmount) != 0)
                retVal = false;

        }

       
        

        return retVal;
    }


    var invoiceList;

    function getSearchURL() {

        var OC_Value = "4,7";

        var _regionId = $("#regionlist").val();
        var sURL = '@Url.Action("InvoicesSearchForManualPayment", "AccountReceivable", new { area = "Portal" })?rgId=2&st=@Model.CustomerNo&sb=2&OCValue=' + OC_Value

        return sURL;
    }

    function InitTable() {
        var url = getSearchURL();

        $.blockUI();//$.blockUI({ message: $('#throbberBlock'), theme: true, baseZ: 12000 });

        invoiceList.ajax.url(url).load(function () {
            $('.payment-field').each(function () {
                applyMaskCurrency('#' + this.id);
                $("#divResult").show();
            });
            $.unblockUI();
        });
    }

    invoiceList = $('#InvoiceList').DataTable({
        //"bProcessing": true,
        "bServerSide": false,
        "bPaginate": false,
        "dom": '<"top">rt<"bottom"lp><"clear">'
        //"dom": "<'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'<'table-group-actions pull-right'>>r><'table-responsive't><'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'>>", // datatable layout
                ,
        columnDefs: [
            {
                targets: "tblInvoice_chk",
                data: "",
                className: "dt-center",
                render: function (data, type, row, meta) {
                    var s = '<input type="hidden" id="inv' + row.InvoiceId + '_customerId" value="' + row.CustomerId + '" />';
                    s += '<input rel="mgglchk" type="checkbox" id="inv' + row.InvoiceId + '_chk" name="inv' + row.InvoiceId + '_chk" class="payment-checkbox" />';
                    return s;
                }
            },
            {
                targets: "tblInvoice_invoiceNo",
                data: "InvoiceNo",
                className: "dt-center",
                render: function (data, type, row, meta) {
                    var s = '<input type="hidden" id="inv' + row.InvoiceId + '_invoiceNo" value="' + data + '" />';
                    s += '<input type="hidden" id="inv' + row.InvoiceId + '_hasMultipleItems" value="' + row.HasMultipleLineItems + '" />';
                    s += '<a onclick="btnOpenInvoiceDetailModel(' + row.InvoiceId + ')">' + data + '</a>';
                    return s;
                }
            },
            {
                targets: "tblInvoice_invoiceDate",
                data: "InvoiceDate",
                className: "dt-center",
                type: "date",
                render: function (data, type, row, meta) {
                    return moment(new Date(parseInt(data.substr(6)))).format("MM/DD/YYYY");
                }
            },
            { targets: "tblInvoice_customerNo", data: "CustomerNo" },
            { targets: "tblInvoice_customerName", data: "CustomerName" },
            { targets: "tblInvoice_invoiceDesc", data: "Description" },
            {
                targets: "tblInvoice_invoiceAmt",
                data: "Balance",
                sClass: "clsAmounttd",
                render: function (data, type, row, meta) {
                    return '<input type="text" id="inv' + row.InvoiceId + '_amount" value="' + parseFloat(data).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '" class="amount-format form-control input-sm payment-field Amttext" readonly="readonly" />';
                }
            },
            {
                targets: "tblInvoice_payment",
                data: "",
                sClass: "clsAmounttd",
                render: function (data, type, row, meta) {
                    return '<input type="text" id="inv' + row.InvoiceId + '_totalPayment" name="inv' + row.InvoiceId + '_totalPayment" class="amount-format form-control input-sm payment-field payment-apply-field Amttext" />';
                }
            },
            {
                targets: "tblInvoice_balance",
                data: "Balance",
                sClass: "clsAmounttd",
                render: function (data, type, row, meta) {
                    return ' <input type="text" id="inv' + row.InvoiceId + '_balance" name="inv' + row.InvoiceId + '_balance" value="' + parseFloat(data).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '" class="amount-format form-control input-sm payment-field Amttext" readonly="readonly" />';
                }
            },
        ]
                , initComplete: function (settings, json) {
                    $('.payment-field').each(function () {
                        applyMaskCurrency('#' + this.id);
                    });
                }
    });


    //InitTable();


    function applyMaskCurrency(id) {
        $(id).inputmask("currency", {
            alias: 'currency',
            prefix: '$ ',
            digits: 2,
            autoUnmask: true,
            removeMaskOnSubmit: true,
            unmaskAsNumber: true,
            allowPlus: false,
            allowMinus: true,
            autoGroup: true,
            positionCaretOnTab: false,
            positionCaretOnClick: "select",
            groupSeparator: ",",
        });
    }

    function ChangeInvoiceSelection(item) {
        debugger
        var InvId = $(item).val();
        var _CheckTotalAmount = parseFloat($('#oinv_changeAmount').val().toString(), 10);
        var _CheckApplyAmount = parseFloat($('#oinv_changeApplyAmount').val().toString(), 10);
        var _CheckBalanceAmount = parseFloat($('#oinv_changeBalanceAmount').val().toString(), 10);






        var _InvAmount = parseFloat((($('#hdf_invInvoiceAmt' + InvId).val() == undefined) ? $('#shdnIInvoiceAmount_' + InvId).val().toString() : $('#hdf_invInvoiceAmt' + InvId).val().toString()).toString(), 10);
        var _InvApplyAmount = 0.00; //parseFloat($('#txtIApplyAmount_'+InvId).val().toString(), 10);



        var _InvBalanceAmount = parseFloat((($('#hdf_invInvoiceBalanceAmt' + InvId).val() == undefined) ? $('#shfINVbalanceAmount_' + InvId).val().toString() : $('#hdf_invInvoiceBalanceAmt' + InvId).val().toString()).toString(), 10);



        if ($(item).is(':checked')) {
            debugger;
            errLBDetailSelectedCount++;
            if (_CheckBalanceAmount <= 0) {

                $(item).prop('checked', false);
                errLBDetailSelectedCount--;
                swal("No more credit available");
                return;
            }




            var _txtIApplyAmount = 0.0;
            var _txtIBalanceAmount = 0.0;
            if (_CheckBalanceAmount > _InvBalanceAmount) {
                _txtIApplyAmount = _InvBalanceAmount;
                _txtIBalanceAmount = _InvBalanceAmount - _txtIApplyAmount;
            }
            else {
                _txtIApplyAmount = _CheckBalanceAmount;
                _txtIBalanceAmount = _InvBalanceAmount - _CheckBalanceAmount;
            }



            $('#oinv_changeApplyAmount').val((_CheckApplyAmount + parseFloat(_txtIApplyAmount.toString(), 10)).toFixed(2));
            $('#oinv_changeBalanceAmount').val((_CheckBalanceAmount - parseFloat(_txtIApplyAmount.toString(), 10)).toFixed(2));

            var hdf_invCustomerId = $('#hdf_invCustomerId' + InvId).val();
            var hdf_invCustomerNo = $('#hdf_invCustomerNo' + InvId).val();
            var hdf_invCustomerName = $('#hdf_invCustomerName' + InvId).val();
            var hdf_invInvoiceNo = $('#hdf_invInvoiceNo' + InvId).val();
            var hdf_invInvoiceDate = $('#hdf_invInvoiceDate' + InvId).val();
            var hdf_invInvoiceDesc = $('#hdf_invInvoiceDesc' + InvId).val();
            var hdf_invInvoiceAmt = $('#hdf_invInvoiceAmt' + InvId).val();
            var hdf_invInvoiceBalanceAmt = $('#hdf_invInvoiceBalanceAmt' + InvId).val();

            var tempTxtIApplyAmount = _txtIApplyAmount;//$('#txtIApplyAmount_' + InvId).val();
            var tempTxtIBalanceAmount = _txtIBalanceAmount;//$('#txtIBalanceAmount_' + InvId).val();
            var temphfTIOverflowAmount = $('#hfTIOverflowAmount_' + InvId).val();

            var trInvoicelist = "";
            trInvoicelist += '<tr id="sir_' + InvId + '">'
            trInvoicelist += '<td style="text-align:center;">';
            trInvoicelist += '<input rel="smgglchk" type="checkbox" name="name"  class="chk" value="' + InvId + '" checked  onchange="ChangeInvoiceSelection(this)"/>';


            trInvoicelist += '<input type="hidden" id="sitp_InvoiceId_' + InvId + '" value="' + InvId + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceNo_' + InvId + '" value="' + hdf_invInvoiceNo + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceDate_' + InvId + '" value="' + hdf_invInvoiceDate + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_CustomerId_' + InvId + '" value="' + hdf_invCustomerId + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_CustomerNo_' + InvId + '" value="' + hdf_invCustomerNo + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_CustomerName_' + InvId + '" value="' + hdf_invCustomerName + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceDescription_' + InvId + '" value="' + hdf_invInvoiceDesc + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceAmount_' + InvId + '" value="' + parseFloat(hdf_invInvoiceBalanceAmt, 10).toFixed(2).toString() + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceApplyAmount_' + InvId + '" value="' + parseFloat(tempTxtIApplyAmount, 10).toFixed(2) + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceBalanceAmount_' + InvId + '" value="' + parseFloat(tempTxtIApplyAmount, 10).toFixed(2) + '" />';
            trInvoicelist += '<input type="hidden" id="sitp_InvoiceOverflowAmount_' + InvId + '" value="' + temphfTIOverflowAmount + '" />';

            trInvoicelist += '</td>';
            trInvoicelist += '<td style="text-align:center;width:50px;">' + hdf_invCustomerNo + '</td>';
            trInvoicelist += '<td style="text-align:left;">' + hdf_invCustomerName + '</td>';
            trInvoicelist += '<td style="text-align:center;"><a href="javascript:void(0);" onclick="btnOpenInvoiceDetail(' + InvId + ')">' + hdf_invInvoiceNo + '</a></td>';
            trInvoicelist += '<td style="text-align:center;">' + hdf_invInvoiceDate + '</td>';
            trInvoicelist += '<td style="text-align:left;">' + hdf_invInvoiceDesc + '</td>';
            trInvoicelist += '<td style="text-align:right;"><input type="hidden" rel="shdnIInvoiceAmount" id="shdnIInvoiceAmount_' + InvId + '" value="' + parseFloat(hdf_invInvoiceBalanceAmt, 10).toFixed(2).toString() + '" />$ ' + parseFloat(hdf_invInvoiceAmt, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</td>';
            trInvoicelist += '<td style="text-align:right;"><input type="hidden" rel="shfINVbalanceAmount" id="shfINVbalanceAmount_' + InvId + '" value="' + parseFloat(hdf_invInvoiceBalanceAmt, 10).toFixed(2).toString() + '" />$ <span rel="sspnIInvoiceAmount">' + parseFloat(hdf_invInvoiceBalanceAmt, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</span></td>';
            trInvoicelist += '<td style="text-align:right;"><input type="hidden" rel="soTIApplyAmount" name="sotxtIApplyAmount_' + InvId + '" id="sotxtIApplyAmount_' + InvId + '" value="' + parseFloat(tempTxtIApplyAmount, 10).toFixed(2) + '" />'
            trInvoicelist += '<input type="text" rel="sTIApplyAmount" onchange="ChangeInvoiceSelectedAmount(' + InvId + ')" name="stxtIApplyAmount_' + InvId + '" id="stxtIApplyAmount_' + InvId + '" value="' + parseFloat(tempTxtIApplyAmount, 10).toFixed(2) + '" /></td>';
            trInvoicelist += '<td style="text-align:right;"><input type="text" readonly rel="sTIBalanceAmount" name="stxtIBalanceAmount_' + InvId + '" id="stxtIBalanceAmount_' + InvId + '" value="' + parseFloat(tempTxtIBalanceAmount, 10).toFixed(2) + '" />';
            trInvoicelist += '<input type="hidden" rel="TIOverflowAmount" name="shfTIOverflowAmount_' + InvId + '" id="shfTIOverflowAmount_' + InvId + '" value="' + temphfTIOverflowAmount + '" /></td></tr>';
            $('#invoiceListSelected tbody').append(trInvoicelist);

            applyMaskCurrency('#stxtIApplyAmount_' + InvId)
            applyMaskCurrency('#stxtIBalanceAmount_' + InvId)
            $('#divInvoiceListSelected').show();


        }
        else {
            errLBDetailSelectedCount--;

            $('#txtIBalanceAmount_' + InvId).val(_InvAmount.toFixed(2))
            $('#oinv_changeApplyAmount').val((_CheckApplyAmount - parseFloat($('#stxtIApplyAmount_' + InvId).val().toString(), 10)).toFixed(2));
            $('#oinv_changeBalanceAmount').val((_CheckBalanceAmount + parseFloat($('#stxtIApplyAmount_' + InvId).val().toString(), 10)).toFixed(2));
            //$('#txtIApplyAmount_' + InvId).val(0);


            $('#sir_' + InvId).remove();

            if ($('#invoiceListSelected tbody').html() == '')
                $('#divInvoiceListSelected').hide();

            //$('#chkinvmgglchk' + InvId).prop('checked', false);

            var table = $("#invoiceList1").DataTable();
            // Get all rows with search applied
            var rows = table.rows().nodes();
            $('#chkinvmgglchk' + InvId, rows).prop('checked', false);

        }

    }

    var _idInvoiceList = 0;
    var _chknoInvoiceList = 0;

    //functions
    function _bindInvoiceListLB() {
        refreshTable(_idInvoiceList, _chknoInvoiceList);
    }

    $('#chkIsOpen').click(function () {
        refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#chkIsClose').click(function () {
        refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#chkIsConsolidated').click(function () {
        refreshTable(_idInvoiceList, _chknoInvoiceList);
    });

    $('#select_dateRangeMP').change(function () {
        console.log(2)
        applyDurationFilterMP(parseInt($(this).val()));
        if (parseInt($(this).val()) != 15 && parseInt($(this).val()) != 16)
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#txtStartDate').change(function () {

        $('#spnStartDate').html($(this).val());
        if ($('#txtStartDate').val() != '' && $('#txtEndtDate').val() != '')
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#txtEndtDate').change(function () {

        $('#spnEndtDate').html($(this).val());
        if ($('#txtStartDate').val() != '' && $('#txtEndtDate').val() != '')
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#lbmonthlist').change(function () {
        $('#spnStartDate').html('');
        if ($('#lbmonthlist').val() != '' && $('#lbyearlist').val() != '')
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#lbyearlist').change(function () {
        $('#spnEndtDate').html('');
        if ($('#lbmonthlist').val() != '' && $('#lbyearlist').val() != '')
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });

    $('#monthlist').change(function () {
        $('#dtpfrom').val('');
        $('#dtpTo').val('');
        if ($('#monthlist').val() != '' && $('#yearlist').val() != '')
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });
    $('#yearlist').change(function () {
        $('#dtpfrom').val('');
        $('#dtpTo').val('');
        if ($('#monthlist').val() != '' && $('#yearlist').val() != '')
            refreshTable(_idInvoiceList, _chknoInvoiceList);
    });

    function applyDurationFilterMP(v) {
        $('#spnStartDate').html('');
        $('#spnEndtDate').html('');
        $('.divspandate').show();
        $('#divSD').hide();
        $('#divED').hide();
        $('#divmonth').hide();
        $('#divyear').hide();
        $('#spnStartDate').html('');
        $('#spnEndtDate').html('');
        $('#lbmonthlist').val('');
        $('#lbyearlist').val('');
        switch (v) {
            case 1:
                firstDay = moment().startOf('isoWeek').toString();
                lastDay = moment().endOf('isoWeek').toString();
                break;
            case 2:
                //code block
                firstDay = moment().startOf('isoWeek').toString();
                lastDay = new Date().toString();
                break;
            case 3:
                firstDay = moment().subtract(0, 'month').startOf('month').toString();
                lastDay = moment().subtract(0, 'month').endOf('month').toString();
                break;
            case 4:
                //code block
                firstDay = moment().subtract(0, 'month').startOf('month').toString();
                lastDay = new Date().toString();
                break;
            case 5:
                //code block
                firstDay = moment().startOf('quarter').toString();
                lastDay = moment().endOf('quarter').toString();
                break;
            case 6:
                //code block
                firstDay = moment().startOf('quarter').toString();
                lastDay = new Date().toString();
                break;
            case 7:
                //code block
                firstDay = moment().startOf('year').toString();;
                lastDay = moment().endOf('year').toString();
                break;
            case 8:
                //code block
                firstDay = moment().startOf('year').toString();
                lastDay = new Date().toString();
                break;
            case 9:
                //code block
                firstDay = moment().toString();
                lastDay = moment().toString();
                break;
            case 10:
                //code block
                firstDay = moment().add(-1, 'days').toString();
                lastDay = moment().add(-1, 'days').toString();
                break;
            case 11:
                //code block
                firstDay = moment().subtract(1, 'week').startOf('week').toString();
                lastDay = moment().subtract(1, 'week').endOf('week').toString();
                break;
            case 12:
                //code block
                firstDay = moment().subtract(1, 'month').startOf('month').toString();
                lastDay = moment().subtract(1, 'month').endOf('month').toString();
                break;
            case 13:
                //code block
                firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                break;
            case 14:
                //code block
                firstDay = moment().subtract(1, 'year').startOf('year').toString();
                lastDay = moment().subtract(1, 'year').endOf('year').toString();
                break;
            case 15:
                //code block
                $('.divspandate').hide();
                $('#divSD').show();
                $('#divED').show();
                $('#txtStartDate').val('');
                $('#txtEndtDate').val('')
                break;
            case 16:
                $('.divspandate').hide();
                $('#divSD').hide();
                $('#divED').hide();
                $('#divmonth').show();
                $('#divyear').show();
                break
            case 17:
                //code block
                firstDay = moment().subtract(90, 'days').startOf('days').toString()
                lastDay = new Date().toString();
                break;
            default:
            //code block
        }
        $('#spnStartDate').html(moment(firstDay).format('L'));
        $('#spnEndtDate').html(moment(lastDay).format('L'));
    }

    function getSearchURL(_regionId) {
        debugger;
        var _searchtextVal = $('#input_SearchMP').val();
            var _consolidated = "false";
            var OC_Value = "";
            if ($('#chkIsOpen').is(":checked")) {
                OC_Value = "4,7";
            }
            if ($('#chkIsClose').is(":checked")) {
                if (OC_Value == "4,7")
                    OC_Value = OC_Value + ",6";
                else
                    OC_Value = "6";
            }

            if ($('#chkIsConsolidated').is(":checked")) {
                _consolidated = 'true';
            }

            //var _regionId = $("#regionlist").val();
            //var date = $('#dtpfrom').val() + '-' + $('#dtpto').val();
            var date = $('#spnStartDate').html() + '-' + $('#spnEndtDate').html();

            //$('#spnStartDate').html(moment(firstDay).format('L'));
            //$('#spnEndtDate').html(moment(lastDay).format('L'));
            var _monthVal = $('#lbmonthlist').val();
            var _yearVal = $('#lbyearlist').val();
            var _incClosed = "false";


            var sURL = '@Url.Action("OpenInvoiceListdataNew", "AccountReceivable", new { area = "Portal" })?rgId=' + _regionId + '&date=' + date + '&st=' + _searchtextVal + '&sb=' + 1 + '&closed=' + _incClosed + '&consolidated=' + _consolidated + '&OCValue=' + OC_Value + '&month=' + _monthVal + '&year=' + _yearVal;

            return sURL;
        }
    function refreshTable(id, chkno, firstTime) {

        var sURL = getSearchURL(@Model.RegionId);
        console.log(1)
        $.ajax(
            {
                type: "GET", //HTTP POST Method
                url: sURL, // Controller/View
                //data: { 'accid': id, 'issubacct': issub },
                success: function (res) {
                    if (firstTime != 1)
                        $('#invoiceList1').DataTable().destroy();


                    GlobalInvoiceData = res.aadata;
                    var trInvoicelist = "";
                    var trInvoicelistIsOpen = 0;
                    var trInvoicelistIsClosed = 0;
                    var trInvoicelistIsOverPaid = 0;
                    var trInvoicelistIsOverDue = 0;
                    var TotalInvoiceAmount = 0;
                    var TotalInvoiceBalance = 0;
                    var tblinvoiceList = $('#invoiceList1 tbody');
                    tblinvoiceList.html("");
                    InvoicelistH = res.aadata;

                    $.each(res.aadata, function (index, item) {
                        trInvoicelist = "";
                        trInvoicelist += '<tr id="ir_' + item.InvoiceId + '">'
                        trInvoicelist += '<td style="text-align:center;">';
                        trInvoicelist += '<input type="hidden" id="hdf_invCustomerId' + item.InvoiceId + '" value="' + item.CustomerId + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invCustomerNo' + item.InvoiceId + '" value="' + item.CustomerNo + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invCustomerName' + item.InvoiceId + '" value="' + item.CustomerName + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invInvoiceNo' + item.InvoiceId + '" value="' + item.InvoiceNo + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invInvoiceDate' + item.InvoiceId + '" value="' + moment(new Date(parseInt(item.InvoiceDate.substr(6)))).format("MM/DD/YYYY") + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invInvoiceDesc' + item.InvoiceId + '" value="' + item.Description + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invInvoiceAmt' + item.InvoiceId + '" value="' + item.Amount + '" />';
                        trInvoicelist += '<input type="hidden" id="hdf_invInvoiceBalanceAmt' + item.InvoiceId + '" value="' + item.Balance + '" />';

                        trInvoicelist += '<input rel="mgglchk" id="chkinvmgglchk' + item.InvoiceId + '" type="checkbox" name="name" onchange="ChangeInvoiceSelection(this)"  class="chk" value="' + item.InvoiceId + '"  /></td>';
                        trInvoicelist += '<td style="text-align:center;width:50px;">' + item.CustomerNo + '</td>';
                        trInvoicelist += '<td style="text-align:left;">' + item.CustomerName + '</td>';
                        trInvoicelist += '<td style="text-align:center;"><a href="javascript:void(0);" onclick="btnOpenInvoiceDetail(' + item.InvoiceId + ')">' + item.InvoiceNo + '</a></td>';
                        trInvoicelist += '<td style="text-align:center;">' + moment(new Date(parseInt(item.InvoiceDate.substr(6)))).format("MM/DD/YYYY") + '</td>';
                        trInvoicelist += '<td style="text-align:left;">' + item.Description + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$ ' + parseFloat(item.Amount, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$ ' + parseFloat(item.Balance, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' <input type="hidden" rel="TIOverflowAmount" name="hfTIOverflowAmount_' + item.InvoiceId + '" id="hfTIOverflowAmount_' + item.InvoiceId + '" value="0" /></td>';
                        //trInvoicelist += '<input type="hidden" readonly rel="TIApplyAmount" name="txtIApplyAmount_' + item.InvoiceId + '" id="txtIApplyAmount_' + item.InvoiceId + '" value="0.00" />';
                        //trInvoicelist += '<input type="hidden" readonly rel="TIBalanceAmount" name="txtIBalanceAmount_' + item.InvoiceId + '" id="txtIBalanceAmount_' + item.InvoiceId + '" value="' + parseFloat(item.Balance, 10).toFixed(2) + '" />';
                        //trInvoicelist += '<input type="hidden" rel="TIOverflowAmount" name="hfTIOverflowAmount_' + item.InvoiceId + '" id="hfTIOverflowAmount_' + item.InvoiceId + '" value="0" />';
                        //trInvoicelist += '<td style="text-align:right;"><input type="hidden" rel="hdnIInvoiceAmount" id="hfINVbalanceAmount_' + item.InvoiceId + '" value="' + parseFloat(item.Balance, 10).toFixed(2).toString() + '" />$ <span rel="spnIInvoiceAmount">' + parseFloat(item.Balance, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '</span></td>';
                        //trInvoicelist += '<td style="text-align:right;"><input type="text" readonly rel="TIApplyAmount" onchange="chkChangeinvAMT(' + item.InvoiceId + ')" name="txtIApplyAmount_' + item.InvoiceId + '" id="txtIApplyAmount_' + item.InvoiceId + '" value="0.00" /></td>';
                        //trInvoicelist += '<td style="text-align:right;"><input type="text" readonly rel="TIBalanceAmount" name="txtIBalanceAmount_' + item.InvoiceId + '" id="txtIBalanceAmount_' + item.InvoiceId + '" value="' + parseFloat(item.Balance, 10).toFixed(2) + '" />';
                        //trInvoicelist += '<input type="hidden" rel="TIOverflowAmount" name="hfTIOverflowAmount_' + item.InvoiceId + '" id="hfTIOverflowAmount_' + item.InvoiceId + '" value="0" /></td>';
                        trInvoicelist += '</tr>';
                        tblinvoiceList.append(trInvoicelist);

                        applyMaskCurrency('#txtIApplyAmount_' + item.InvoiceId)
                        applyMaskCurrency('#txtIBalanceAmount_' + item.InvoiceId)
                    });


                    var oTable = $('#invoiceList1').DataTable({
                        "paging": true,
                        "ordering": true,
                        "info": true,
                        "bProcessing": true,
                        "pageLength": 10,
                        "dom": "<'headerbox list'><'table-responsive't><'bottom'ip><'clear'>"

                    });


                    isShowInvoicelist = true;
                    //if (errCustomerName != '' && errCustomerName != undefined) {
                    //    $('#invoiceList1').DataTable().search(errCustomerName).draw();
                    //}

                    txtEApplyAmount = 0;
                    txtEBalanceAmount = 0;
                    txtELockboxAmount = 0;
                    $.unblockUI();


                    $("#divrightckbox").html('<a href="javascript:void(0);"  class="btn btn-primary pull-right" onclick="btnApply_SelectedInvoice(' + id + ',\'' + chkno + '\')" style="margin-right:10px;">Apply</a>');

                    $("#input_SearchMP").keyup(function () {
                        var table = $("#invoiceList1").DataTable();
                        table.search($(this).val()).draw();
                    });



                },
                error: function (err) {
                    alert('failure');
                    $.unblockUI();
                },
            });
    }
    function btnShowChangeInvoices_OnClick() {
        $('#divResultDetail').hide();
        $('#divResultDetailButton').hide();
        $('#divResultSelected').show();
        $('#divResultDetailButtonApply').show();
    }

    function btnApplyInvoices_OnClick() {
       // $('#divChangeInvoice').hide();

        $('#invoiceListSelected input[rel="smgglchk"]').each(function () {
            debugger;
            if ($(this).is(':checked')) {

                $('#oinv_changeInvoiceData').val(1)


                var _invId = $(this).val();
                $('#sitp_InvoiceOverflowAmount_' + _invId).val()
                $('#sitp_InvoiceApplyAmount_' + _invId).val()
                var _invNewBal = parseFloat($('#sitp_InvoiceAmount_' + _invId).val()) - parseFloat($('#stxtIApplyAmount_' + _invId).val());
                $('#stxtIBalanceAmount_' + _invId).val(_invNewBal.toFixed(2))
                var _invOverBal = _invNewBal < 0 ? _invNewBal:0
                var _newInsertStr = '';
                _newInsertStr = _newInsertStr + '<tr style="border:2px solid #b3a9a9;" id="ftr_' + _invId + '">'
                _newInsertStr = _newInsertStr + '<td>'
                _newInsertStr = _newInsertStr + '<input type="hidden" id="oinv_CustomerId_' + _invId + '" name="oinv_CustomerId_' + _invId + '" value="' + $('#sitp_CustomerId_' + _invId).val() + '" />'
                _newInsertStr = _newInsertStr + '<input type="hidden" id="oinv_InvoiceId_' + _invId + '" name="oinv_InvoiceId_' + _invId + '" value="' + _invId + '" />'
                _newInsertStr = _newInsertStr + '<input type="hidden" id="oinv_ApplyAmount_' + _invId + '" name="oinv_ApplyAmount_' + _invId + '" value="' + $('#stxtIApplyAmount_' + _invId).val() + '" />'
                _newInsertStr = _newInsertStr + '<input type="hidden" id="oinv_OApplyAmount_' + _invId + '" name="oinv_OApplyAmount_' + _invId + '" value="' + _invOverBal.toFixed(2) + '" />'
                _newInsertStr = _newInsertStr + '<input rel="oinv_mgglchk" type="checkbox" id="oinv_' + _invId + '_chk" value="' + _invId + '" name="oinv_' + _invId + '_chk" class="payment-checkbox" />'
                _newInsertStr = _newInsertStr + '</td>'
                _newInsertStr = _newInsertStr + '<td>' + $('#sitp_InvoiceNo_' + _invId).val() + '</td>'
                _newInsertStr = _newInsertStr + '<td>' + $('#sitp_InvoiceDate_' + _invId).val() + '</td>'
                _newInsertStr = _newInsertStr + '<td>' + $('#sitp_CustomerNo_' + _invId).val() + '</td>'
                _newInsertStr = _newInsertStr + '<td style="text-align:left;border:2px solid #b3a9a9;">' + $('#sitp_CustomerName_' + _invId).val() + '</td>'
                _newInsertStr = _newInsertStr + '<td style="text-align:left;border:2px solid #b3a9a9;">' + $('#sitp_InvoiceDescription_' + _invId).val() + '</td>'
                _newInsertStr = _newInsertStr + '<td style="text-align:right;border:2px solid #b3a9a9;">' + '$' + parseFloat($('#sitp_InvoiceAmount_' + _invId).val(), 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>'
                _newInsertStr = _newInsertStr + '<td style="text-align:right;border:2px solid #b3a9a9;">' + '$' + parseFloat($('#stxtIApplyAmount_' + _invId).val(), 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>'
                _newInsertStr = _newInsertStr + '<td style="text-align:right;;border:2px solid #b3a9a9;">' + '$' + parseFloat($('#stxtIBalanceAmount_' + _invId).val(), 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>'
                _newInsertStr = _newInsertStr + '</tr>'





                $('#InvoiceListSelectedMain>tbody').append(_newInsertStr);


            }

        });

        $('#InvoiceListSelectedMain input[rel="oinv_mgglchk"]').each(function () {
            debugger;
            if ($(this).is(':checked')) {

                var _invId = $(this).val();
                $('#ftr_' + _invId).remove()
            }
        });


        $('#invoiceListSelected tbody').html('');
        $('#divChangeInvoice').hide();

    }

    function btnChangeInvoices_OnClick() {
        var _applyAmount = 0;
        var _invId = 0;
        var sList = "";
        $('input[rel=oinv_mgglchk]').each(function () {

            if (this.checked) {
                _invId = $(this).val();
                console.log(_invId);
                _applyAmount = _applyAmount + parseFloat(parseFloat($('#oinv_ApplyAmount_' + _invId).val().toString(), 10).toFixed(2)) + parseFloat(parseFloat($('#oinv_OApplyAmount_' + _invId).val().toString(), 10).toFixed(2));
                console.log(_applyAmount);
            }
        });

        $('#oinv_changeAmount').val(_applyAmount);
        $('#oinv_changeApplyAmount').val(0);
        $('#oinv_changeBalanceAmount').val(_applyAmount);
        $('#divChangeInvoice').show();
        //oinv_mgglchk

        refreshTable(0, 0, 0);
    }



    //function btnChangeInvoices_OnClick() {
    //    var _applyAmount = 0;
    //    var _invId = 0;
    //    var sList = "";
    //    $('input[rel=oinv_mgglchk]').each(function () {

    //        if (this.checked) {
    //            _invId = $(this).val();
    //            console.log(_invId);
    //            _applyAmount = _applyAmount + parseFloat(parseFloat($('#oinv_ApplyAmount_' + _invId).val().toString(), 10).toFixed(2)) + parseFloat(parseFloat($('#oinv_OApplyAmount_' + _invId).val().toString(), 10).toFixed(2));
    //            //oinv_CustomerId_"+item.InvoiceId
    //            //oinv_InvoiceId_"+item.InvoiceId
    //            //oinv_ApplyAmount_"+item.InvoiceId


    //            console.log(_applyAmount);
    //        }


    //    });

    //    $('#oinv_changeAmount').val(_applyAmount);
    //    $('#oinv_changeApplyAmount').val(0);
    //    $('#oinv_changeBalanceAmount').val(_applyAmount);
    //    $('#divChangeInvoice').show();
    //    //oinv_mgglchk

    //    refreshTable(0, 0, 0);
    //}

    var errLBDetailSelectedCount = 0


</script>