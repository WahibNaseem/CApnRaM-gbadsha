@model JKViewModels.AccountReceivable.LockboxImportViewModel

@{
    ViewBag.Title = "Lockbox Import";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <style type="text/css">
        .lbl-p5 {
            padding: 3px;
        }

            .lbl-p5.red {
                color: red;
            }

            .lbl-p5.green {
                color: lightgreen;
            }

        tr > td {
            font-size: 12px !important;
            padding: 4px !important;
        }

        /*tr > th {
            font-size: 11px !important;
            text-transform: uppercase;
        }*/

        .row {
            margin: 0;
            padding: 5px 0;
        }

        .opendiv {
            padding: 4px;
            background-color: gold;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .closeddiv {
            padding: 4px;
            background-color: limegreen;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overpaiddiv {
            padding: 4px;
            background-color: deepskyblue;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overduediv {
            padding: 4px;
            background-color: orangered;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .btn {
            padding: 3px 12px;
            font-size: 12px;
        }
    </style>

}

<style type="text/css" media="print">
    @@page {
        size: landscape;
    }
</style>
<div class="custom-form portlet light" style="max-width:600px;margin: 0px auto;padding:0;min-height: 100px;">
    <div class="headerbox">
        <div class="row">
            &nbsp;
        </div>
    </div>
    <div class="portlet-body form">
        <div id="uploadfileForm" class="form-horizontal">

            @Html.AntiForgeryToken()
            <div class="form-body">
                <div class="row">
                    <div class="form-group">
                        @Html.LabelFor(model => model.checkDate, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-4">
                            @Html.EditorFor(model => model.checkDate, new { htmlAttributes = new { @class = "form-control input-sm date-picker", @id = "txtcheckDate" } })
                            @Html.ValidationMessageFor(model => model.checkDate, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-8">
                            <input type="file" id="lbFile" name="filename" />
                            @Html.ValidationMessageFor(model => model.filename, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-primary button-next pull-right" id="btnUploadSubmit" style="margin-right:0px;">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="portlet-body form" id="divDetailUploadresult" style="display:none;">
        @using (Html.BeginForm("LockboxImport", "AccountReceivable", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-horizontal", enctype = "multipart/form-data", @id = "LockboxImportFrom" }))
        {
            @Html.AntiForgeryToken()
            <input type="hidden" id="lockboxedi_id" name="lockboxedi_id" value="" />
            <input type="hidden" id="checkDate2" name="checkDate" value="" />
            <div class="form-body" style="border-top: 1px solid #e7ecf1;">
                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-6">Region</label>
                        <div class="col-md-4">
                            <label class="control-label" id="lblLockboxRegion"></label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-6">Lockbox Number</label>
                        <div class="col-md-4">
                            <label class="control-label" id="lblLockboxNumber"></label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-6">No. of Invoice</label>
                        <div class="col-md-4">
                            <label class="control-label" id="lblNumberofInvoice"></label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-6">Total Payment Amount</label>
                        <div class="col-md-4">
                            <label class="control-label" id="lblTotalPaymentAmount"></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-6">
                            <button type="button" class="btn btn-primary button-next" style="margin-right:0px;" id="btnViewLockboxDetail">View LockBox Detail</button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-primary button-next pull-right" id="btnContinue" style="margin-right:0px;">Continue</button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<div class="modal fade custom-model custom-form-design" id="modal_lockboxview_detail" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:1000px">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    LockBox View Detail
                </h4>
            </div>
            <div class="modal-body" style="padding: 0px 15px 15px 15px;">
                <div class="row">
                    <div class="col-md-2">Date Transmit:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVDateTransmit" /></div>
                    <div class="col-md-2">Region Bank:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVRegionBank" /></div>
                    <div class="col-md-2">Total Lockbox Amount:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVTotalLockboxAmount" /></div>
                </div>
                <div class="row">
                    <div class="col-md-2">Region Name:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVRegionName" /></div>
                    <div class="col-md-2">Region Bank Account:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVRegionBankAccount" /></div>
                    <div class="col-md-2">Total number of Check:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVTotalnumberofCheck" /></div>
                </div>
                <div class="row">
                    <div class="col-md-2">LockBox ID:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVLockBoxID" /></div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2">Total number of Invoice:</div>
                    <div class="col-md-2"><input type="text" readonly class="form-control input-sm" value="" id="txtVTotalnumberofInvoice" /></div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <table class="table table-striped table-bordered table-hover order-column table-responsive" id="tblviewdetail" width="100%">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Bank Name</th>
                                    <th style="text-align:center">Bank Account</th>
                                    <th style="text-align:center">Check No.</th>
                                    <th style="text-align:center">Check Amount</th>
                                    <th style="text-align:center">Customer No.</th>
                                    <th style="text-align:center">Customer Name</th>
                                    <th style="text-align:center"># of item</th>
                                    <th style="text-align:center">Invoice No.</th>
                                    <th style="text-align:center">Payment Amount</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <a href="javascript:void(0);" class="btn btn-primary pull-right" data-dismiss="modal" style="margin-right:10px;">Close</a>
                <div class="clearfix"></div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
</div>




<div class="modal fade custom-model custom-form-design" id="modal_lockboxview_detailPaid" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:1000px">
        <div class="modal-content" style="border-radius: 8px;" id="modal_lockboxview_detailPaidInner">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    LockBox View Detail
                </h4>
            </div>
            <div class="modal-body" style="padding: 0px 15px 15px 15px;">
                <div class="row">
                    <div class="col-md-2">Date Transmit:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVDateTransmit"></span></div>
                    <div class="col-md-2">Region Bank:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVRegionBank"></span></div>
                    <div class="col-md-2">Total Lockbox Amount:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVTotalLockboxAmount"></span></div>
                </div>
                <div class="row">
                    <div class="col-md-2">Region Name:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVRegionName"></span></div>
                    <div class="col-md-2">Region Bank Account:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVRegionBankAccount"></span></div>
                    <div class="col-md-2">Total number of Check:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVTotalnumberofCheck"></span></div>
                </div>
                <div class="row">
                    <div class="col-md-2">LockBox ID:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVLockBoxID"></span></div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2"></div>
                    <div class="col-md-2">Total number of Invoice:</div>
                    <div class="col-md-2"><span class="form-control input-sm" id="txtDVTotalnumberofInvoice"></span></div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <table class="table table-striped table-bordered table-hover order-column table-responsive" id="tblviewdetailPaid" width="100%">
                            <thead>
                                <tr>
                                    <th style="text-align:center;width:100px;">Check No.</th>
                                    <th style="text-align:center;width:100px;">Check Amount</th>
                                    <th style="text-align:center;width:100px;">Customer No.</th>
                                    <th style="text-align:center">Customer Name</th>
                                    <th style="text-align:center;width:100px;">Invoice No.</th>
                                    <th style="text-align:center;width:115px;">Apply Amount</th>
                                    <th style="text-align:center;width:100px;">Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <a href="javascript:void(0);" class="btn btn-primary pull-left" id="btnPrintLockbox" style="margin-left:10px;">Print</a>
                <a href="javascript:void(0);" class="btn btn-primary pull-right" data-dismiss="modal" style="margin-right:10px;">Close</a>
                <div class="clearfix"></div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
</div>

@section scripts{
    <script>
        var _LockboxProcessedData = [];
        jQuery(document).ready(function () {
            $('.date-picker').datepicker("setDate", new Date());
            $('.date-picker').attr("placeholder", "mm/dd/yyyy");
                            });

        $("#lbFile").change(function () {
                                var fileExtension = ['txt', 'TXT'];
                                if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
                $("#lbFile").val('');
                                    alert("Only formats are allowed : " + fileExtension.join(', '));
                                }
                            });


        $("#btnPrintLockbox").click(function () {

            // window.print();
            $('#_FAHR__btnPrint').hide();
            $('#_FAHR__btnExport').hide();
                                var contents = $("#modal_lockboxview_detailPaid").html();
                                var frame1 = $('<iframe />');
                                frame1[0].name = "_FranchiseeAccountHistoryReportPrintframe1";
                                frame1.css({ "position": "absolute", "top": "-1000000px" });
            $("body").append(frame1);
                                var frameDoc = frame1[0].contentWindow ? frame1[0].contentWindow : frame1[0].contentDocument.document ? frame1[0].contentDocument.document : frame1[0].contentDocument;
                                frameDoc.document.open();
                                //Create a new HTML document.
                                frameDoc.document.write('<html><head><title></title>');
                                frameDoc.document.write('</head><body>');
                                //Append the external CSS file.
                                frameDoc.document.write('<link href="/fonts/FaceFontcss.css" rel="stylesheet" />');
                                frameDoc.document.write('<link href="/Content/admin/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />');
                                frameDoc.document.write('<link href="/Content/admin/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />');
                                frameDoc.document.write('<link href="/Content/admin/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />');
                                frameDoc.document.write('<link href="/Content/admin/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />');
                                frameDoc.document.write('<link href="/Content/admin/assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />');
                                frameDoc.document.write('<link href="/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />');
                                //Append the DIV contents.
                                frameDoc.document.write(contents);
                                frameDoc.document.write('</body></html>');
                                frameDoc.document.close();
                                console.log(window.frames["_FranchiseeAccountHistoryReportPrintframe1"])
            setTimeout(function () {

                                    window.frames["_FranchiseeAccountHistoryReportPrintframe1"].focus();
                                    window.frames["_FranchiseeAccountHistoryReportPrintframe1"].print();
                                    frame1.remove();
                $('#_FAHR__btnPrint').show();
                $('#_FAHR__btnExport').show();
                                }, 500);
                            });


        $('#btnContinue').click(function (e) {
                                if(_LockboxProcessed)
                                {
                                    swal({
                                        title: "",
                    text: "System detected the Lockbox file already processed and all payment completed.",
                    type: "info",
                    showCancelButton: true,
                    closeOnConfirm: true,
                    showLoaderOnConfirm: false,
                    confirmButtonText: 'View payment',
                    cancelButtonText: "Close"
                                    }, function (isConfirm) {
                                        if (isConfirm) {
                                            ViewLockboxDetail(_LockboxProcessedData);
                                        } else {
                                            window.location.href = '@Url.Action("PaymentList", "AccountReceivable", new { area = "portal" })';
                                        }
                                    });
                                }
                                else
                                {
                $('#LockboxImportFrom').submit();
                                }

                            });


        $('#btnViewLockboxDetail').click(function (e) {
            @*var sURL = '@Url.Action("LockboxDetailData", "AccountReceivable", new { area = "Portal" })?id=' + $("#lockboxedi_id").val()
            $.ajax(
            {
                type: "GET", //HTTP POST Method
                url: sURL, // Controller/View
                success: function (res) {*@
                    var res = _LockboxProcessedData;
                    var trInvoicelist = "";
                    var tblviewdetail = $('#tblviewdetail tbody');
                    tblviewdetail.html("");
                    var isFirst = true;
                    var chkCount = "";
                    var invCount = "";

                    _LockboxProcessedData.forEach(function (item) {

                        if (isFirst) {
                            $('#txtVDateTransmit').val(item.YYMMDD.substring(2, 4) + '/' + item.YYMMDD.substring(4, 6) + '/' + item.YYMMDD.substring(0, 2));
                            $('#txtVRegionBank').val(item.RegionBank);
                            $('#txtVTotalLockboxAmount').val(item.TotalDollars);
                            $('#txtVRegionName').val(item.RegionName);
                            $('#txtVRegionBankAccount').val(item.Destination);
                            $('#txtVLockBoxID').val(item.LockboxNumber);
                            applyMaskCurrency('#txtVTotalLockboxAmount');
                            isFirst = false;
                        }
                        trInvoicelist = "";
                        trInvoicelist += '<tr><td>' + (item.BankName != null ? item.BankName : '') + '</td>'
                        trInvoicelist += '<td style="text-align:center">' + (item.AccountNumber != null ? item.AccountNumber : '') + '</td>'
                        trInvoicelist += '<td style="text-align:center">' + (item.CheckNumber != null ? item.CheckNumber : '') + '</td>'
                        trInvoicelist += '<td style="text-align:right">$ ' + (item.DollarAmount != null ? parseFloat(item.DollarAmount, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : '$ 0.00') + '</td>'
                        trInvoicelist += '<td style="text-align:center">' + (item.CustomerNo != null ? item.CustomerNo : '') + '</td>'
                        trInvoicelist += '<td>' + (item.CustomerName != null ? item.CustomerName : '') + '</td>'
                        trInvoicelist += '<td style="text-align:center">' + (item.ItemNumber != null ? item.ItemNumber : '') + '</td>'
                        trInvoicelist += '<td style="text-align:center">' + (item.InvoiceNo != null ? item.InvoiceNo : '') + '</td>'
                        trInvoicelist += '<td style="text-align:right">$ ' + (item.ApplyAmount != null ? parseFloat(item.ApplyAmount, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : '') + '</td></tr>'
                        tblviewdetail.append(trInvoicelist);


                    });
                    var dupes = {};
                    $.each(_LockboxProcessedData, function (i, el) {
                        if (!dupes[el.CheckNumber]) {
                            dupes[el.CheckNumber] = true;
                            chkCount++;
                        }

                        invCount++;
                        //if (!dupes[el.InvoiceNo]) {
                        //    dupes[el.InvoiceNo] = true;
                        //    invCount++;
                        //}
                    });

                    $('#txtVTotalnumberofCheck').val(chkCount);
                    $('#txtVTotalnumberofInvoice').val(invCount);
                    $("#modal_lockboxview_detail").modal({ backdrop: 'static' });
            //    },
            //    error: function (err) {
            //        //alert('failure');
            //    },
            //});
        });
        function ViewLockboxDetail(_lockboxRawData) {


            var trInvoicelist = "";
            var tblviewdetail = $('#tblviewdetailPaid tbody');
            tblviewdetail.html("");
            var isFirst = true;
            var chkCount = "";
            var invCount = "";

            _lockboxRawData.forEach(function (item) {

                if (isFirst) {
                    $('#txtDVDateTransmit').html(item.YYMMDD.substring(2, 4) + '/' + item.YYMMDD.substring(4, 6) + '/' + item.YYMMDD.substring(0, 2));
                    $('#txtDVRegionBank').html(item.RegionBank);
                    $('#txtDVTotalLockboxAmount').html(item.TotalDollars);
                    $('#txtDVRegionName').html(item.RegionName);
                    $('#txtDVRegionBankAccount').html(item.Destination);
                    $('#txtDVLockBoxID').html(item.LockboxNumber);
                    applyMaskCurrency('#txtDVTotalLockboxAmount');
                    isFirst = false;
                }
                trInvoicelist = "";
                trInvoicelist += '<tr><td style="text-align:center">' + (item.CheckNumber != null ? item.CheckNumber : '') + '</td>'
                trInvoicelist += '<td style="text-align:right">$ ' + (item.DollarAmount != null ? parseFloat(item.DollarAmount, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : '$ 0.00') + '</td>'
                trInvoicelist += '<td style="text-align:center">' + (item.CustomerNo != null ? item.CustomerNo : '') + '</td>'
                trInvoicelist += '<td>' + (item.CustomerName != null ? item.CustomerName : '') + '</td>'
                trInvoicelist += '<td style="text-align:center">' + (item.InvoiceNo != null ? item.InvoiceNo : '') + '</td>'
                trInvoicelist += '<td style="text-align:right">$ ' + (item.ApplyAmount != null ? parseFloat(item.ApplyAmount, 10).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : '') + '</td>'
                trInvoicelist += '<td style="text-align:center">Paid</tr>'
                tblviewdetail.append(trInvoicelist);


            });
            var dupes = {};
            $.each(_lockboxRawData, function (i, el) {
                if (!dupes[el.CheckNumber]) {
                    dupes[el.CheckNumber] = true;
                    chkCount++;
                }
                invCount++;
            });
            $('#txtDVTotalnumberofCheck').html(chkCount);
            $('#txtDVTotalnumberofInvoice').html(invCount);

            $("#modal_lockboxview_detailPaid").modal({ backdrop: 'static' });

        };
        var _LockboxProcessed = false;
        
        $('#btnUploadSubmit').click(function (e) {
            var sURL = '@Url.Action("LockboxUpload", "AccountReceivable", new { area = "Portal" })'
            // Checking whether FormData is available in browser
            if (window.FormData !== undefined) {
                $.blockUI();

                var fileUpload = $("#lbFile").get(0);
                var files = fileUpload.files;
                // Create FormData object
                var fileData = new FormData();
                // Looping over all files and add it to FormData object
                for (var i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                }
                $('#checkDate2').val($('#txtcheckDate').val())
                // Adding one more key to FormData object
                fileData.append('username', 'Manas');
                fileData.append('checkdate', $('#checkDate2').val());
                $.ajax({
                    url: sURL,
                    type: "POST",
                    contentType: false, // Not to set any content header
                    processData: false, // Not to process data
                    data: fileData,
                    success: function (result) {



                        if (result.LockboxId==-1) {
                            swal({ title: "", text: "No payment found in this lock box.", type: "info" });
                            return;
                        }


                        console.log(result)
                        _LockboxProcessedData = result.LockboxData;
                        $("#lockboxedi_id").val(result.LockboxId);
                        if (result.LockboxProcessed)
                        {
                            if (result.LockboxProcessed) {
                                _LockboxProcessed = true;
                                swal({
                                    title: "",
                                    text: "System detected the Lockbox file already processed and all payment completed.",
                                    type: "info",
                                    showCancelButton: true,
                                    closeOnConfirm: true,
                                    showLoaderOnConfirm: false,
                                    confirmButtonText: 'View payment',
                                    cancelButtonText: "Close"
                                }, function (isConfirm) {
                                    if (isConfirm) {
                                        ViewLockboxDetail(result.LockboxData);
                                    } else {
                                        window.location.href = '@Url.Action("PaymentList", "AccountReceivable", new { area = "portal" })';
                                    }
                                });
                            }

                        } else if (result.AlreadyExist == 1) {
                            var _filename = result.Lockbox.LockboxFileName.split("\\")[result.Lockbox.LockboxFileName.split("\\").length - 1]
                            swal({
                                title: _filename,
                                text: "The system found Lockbox file for '" + _filename + "' region has been imported '" + moment(new Date(parseInt(result.Lockbox.UploadedOn.substr(6)))).format("MM/DD/YYYY") + "'  but not process, do you want to use this data to process payment?",
                                type: "info",
                                showCancelButton: true,
                                closeOnConfirm: false,
                                showLoaderOnConfirm: true,
                                confirmButtonText: 'No',
                                cancelButtonText: "Yes"
                            }, function () {
                                $.ajax({

                                    url: '@Url.Action("LockboxUploadByPath", "AccountReceivable", new { area = "Portal" })?_path=' + result.filePath + '&_chDate=' + $('#txtcheckDate').val(),
                                    type: "POST",
                                    contentType: false, // Not to set any content header
                                    processData: false, // Not to process data

                                    success: function (result1) {
                                        $("#lockboxedi_id").val(result1.LockboxId);
                                        _LockboxProcessedData = result1.LockboxData;
                                        var trInvoicelist = "";
                                        var tblviewdetail = $('#tblviewdetail tbody');
                                        tblviewdetail.html("");
                                        var isFirst = true;
                                        var chkCount = "";
                                        var invCount = "";
                                        var invAmount = 0;

                                        $("#lockboxedi_id").val(result1.LockboxId);
                                        result1.LockboxData.forEach(function (item) {

                                            if (isFirst) {
                                                $("#lblLockboxNumber").html(item.LockboxNumber);
                                                $("#lblLockboxRegion").html(item.RegionName);
                                                $("#lblTotalPaymentAmount").html('$ ' + parseFloat(item.TotalDollars).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));


                                                isFirst = false;
                                            }

                                        });
                                        var dupes = {};
                                        $.each(result1.LockboxData, function (i, el) {
                                            if (!dupes[el.CheckNumber]) {
                                                dupes[el.CheckNumber] = true;
                                                chkCount++;
                                            }
                                            invCount++;
                                        });
                                        $("#lblNumberofInvoice").html(invCount);

                                        $("#divDetailUploadresult").show();
                                        $("#btnUploadSubmit").prop("disabled", "disabled");
                                        $("#lbFile").prop("disabled", "disabled");
                                        $("#checkDate2").val($("#txtcheckDate").val());
                                    },
                                    error: function () {
                                        alert('error');
                                    }
                                }).done(function (data) {
                                        swal("Sucess!", "Your order was successfully canceled!", "success");                                        
                                }).error(function (data) {
                                        swal("Oops", "We couldn't connect to the server!", "error");
                                });
                            });

                        }



                        var trInvoicelist = "";
                        var tblviewdetail = $('#tblviewdetail tbody');
                        tblviewdetail.html("");
                        var isFirst = true;
                        var chkCount = "";
                        var invCount = "";
                        var invAmount = 0;

                        _LockboxProcessedData.forEach(function (item) {

                            if (isFirst) {
                                $("#lblLockboxNumber").html(item.LockboxNumber);
                                $("#lblLockboxRegion").html(item.RegionName);
                                $("#lblTotalPaymentAmount").html('$ ' + parseFloat(item.TotalDollars).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                $("#lockboxedi_id").val(result.LockboxId);


                                isFirst = false;
                            }

                        });
                        var dupes = {};
                        $.each(_LockboxProcessedData, function (i, el) {
                            if (!dupes[el.CheckNumber]) {
                                dupes[el.CheckNumber] = true;
                                chkCount++;
                            }
                            invCount++;
                            //if (!dupes[el.InvoiceNo]) {
                            //    dupes[el.InvoiceNo] = true;
                            //    invCount++;
                            //}
                        });
                        $("#lblNumberofInvoice").html(invCount);


                        $("#divDetailUploadresult").show();
                        $("#btnUploadSubmit").prop("disabled", "disabled");
                        $("#lbFile").prop("disabled", "disabled");
                        $("#checkDate2").val($("#txtcheckDate").val());

                         //$("#lblLockboxNumber").html(res[0]);
                         //$("#lblNumberofInvoice").html(res[1]);
                         //$("#lblTotalPaymentAmount").html('$ ' + parseFloat(res[2]).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                         //$("#lockboxedi_id").val(res[3]);
                         //$("#divDetailUploadresult").show();
                         //$("#btnUploadSubmit").prop("disabled", "disabled");
                         //$("#lbFile").prop("disabled", "disabled");
                         //$("#checkDate2").val($("#checkDate").val());


                        //if (result.LockboxData != undefined && result.LockboxData != "" && result.LockboxData != null) {


                            @*var sURL1 = '@Url.Action("LockboxDetailData", "AccountReceivable", new { area = "Portal" })?id=' + result.LockboxData.LockboxEDIId
                            $.ajax(
                            {
                                type: "GET", //HTTP POST Method
                                url: sURL1, // Controller/View
                                success: function (res) {*@


                                    //if (result.LockboxProcessed) {
                                    //    _LockboxProcessed = true;
                                    //    swal({
                                    //        title: "",
                                    //        text: "All Payment process completed?",
                                    //        type: "info",
                                    //        showCancelButton: true,
                                    //        closeOnConfirm: true,
                                    //        showLoaderOnConfirm: false,
                                    //        confirmButtonText: 'View payment',
                                    //        cancelButtonText: "Close"
                                    //    }, function (isConfirm) {
                                    //        if (isConfirm) {
                                    //            ViewLockboxDetail(result.LockboxData);
                                    //        } else {
                                    //            swal("Cancelled", "Your imaginary file is safe :)", "error");
                                    //        }
                                    //    });
                                    //}











                                    @*if (!_LockboxProcessed) {
                                        swal({
                                            title: _filename,
                                            text: "The system found Lockbox file for '" + _filename + "' region has been imported '" + moment(new Date(parseInt(result.LockboxData.UploadedOn.substr(6)))).format("MM/DD/YYYY") + "'  but not process, do you want to use this data to process payment?",
                                            type: "info",
                                            showCancelButton: true,
                                            closeOnConfirm: false,
                                            showLoaderOnConfirm: true,
                                            confirmButtonText: 'No',
                                            cancelButtonText: "Yes"
                                        }, function () {
                                            $.ajax({

                                                url: '@Url.Action("LockboxUploadByPath", "AccountReceivable", new { area = "Portal" })?_path=' + result.filePath,
                                                type: "POST",
                                                contentType: false, // Not to set any content header
                                                processData: false, // Not to process data

                                                success: function (result1) {
                                                    var res = result1.split("|");
                                                    if (res.length > 0) {
                                                        $("#lblLockboxNumber").html(res[0]);
                                                        $("#lblNumberofInvoice").html(res[1]);
                                                        $("#lblTotalPaymentAmount").html('$ ' + parseFloat(res[2]).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                                                        $("#lockboxedi_id").val(res[3]);
                                                        $("#divDetailUploadresult").show();
                                                        $("#btnUploadSubmit").prop("disabled", "disabled");
                                                        $("#lbFile").prop("disabled", "disabled");
                                                        $("#checkDate2").val($("#checkDate").val());
                                                        setTimeout(function () {
                                                            swal("Good job!", "", "success")
                                                        }, 2000);
                                                    }
                                                    else {
                                                        alert(result1);
                                                    }
                                                },
                                                error: function () {
                                                    alert('error');
                                                }
                                            });
                                        });
                                    }*@
                            //    },
                            //    error: function (err) {
                            //        //alert('failure');
                            //    },
                            //});






                        //else {

                        //    var res = result.split("|");
                        //    if (res.length > 0) {


                        //        $("#lblLockboxNumber").html(res[0]);
                        //        $("#lblNumberofInvoice").html(res[1]);
                        //        $("#lblTotalPaymentAmount").html('$ ' + parseFloat(res[2]).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
                        //        $("#lockboxedi_id").val(res[3]);
                        //        $("#divDetailUploadresult").show();
                        //        $("#btnUploadSubmit").prop("disabled", "disabled");
                        //        $("#lbFile").prop("disabled", "disabled");
                        //        $("#checkDate2").val($("#checkDate").val());

                        //    }
                        //    else {
                        //        alert(result);
                        //    }
                        //}
                        $.unblockUI();
                    },
                    error: function (err) {
                        $.unblockUI();
                        alert(err.statusText);
                    }
                });
            } else {
                alert("FormData is not supported.");
            }
        });

        $('#btnGoSummary').click(function () {
            var sURL = '@Url.Action("Maintenance", "Franchise", new { area = "Portal" })'
            $.ajax({
                type: "POST",
                url: sURL,
                data: $("#form_wizard_1").serialize(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, status) {
                    alert(data);
                },
                error: function () {
                    alert('error');
                }
            });
        });

        function applyMaskCurrency(id) {
            $(id).inputmask("currency", {
                alias: 'currency',
                prefix: '$ ',
                digits: 2,
                autoUnmask: true,
                removeMaskOnSubmit: true,
                unmaskAsNumber: true,
                allowPlus: false,
                allowMinus: true,
                autoGroup: true,
                groupSeparator: ",",
            });
        }

    </script>
}
