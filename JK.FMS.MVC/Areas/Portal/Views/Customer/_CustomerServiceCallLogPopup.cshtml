@model JKViewModels.Customer.ServiceCallLogModel
@{
    JKViewModels.Customer.FullCustomerViewModel CustModel = new JKViewModels.Customer.FullCustomerViewModel();
    if (ViewBag.CustomerDetail != null)
    {
        CustModel = (JKViewModels.Customer.FullCustomerViewModel)ViewBag.CustomerDetail;
    }
}
<link href="~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
<style>
    #frmServiceCallLog 
    {
        margin-bottom:-22px !important;
    }

</style>
<div class="modal-content" style="border-radius: 8px;">
    <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
        <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
            CUSTOMER SERVICE CALL LOG
        </h4>
    </div>
    <input type="hidden" id="hdnFranchiseeId" value="@ViewBag.DistributionFranchiseeId" />
    <input type="hidden" id="hdnCustId" value="@(ViewBag.CustomerId != null ? ViewBag.CustomerId : 0)" />
    <input type="hidden" id="hdnCustomerId" value="@(ViewBag.CustomerId != null ? ViewBag.CustomerId : 0)" />

    <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -33px;">
        <div class="form-body" style="padding-top: 0px;">
             @using (Html.BeginForm("ServiceCallLogPop", "Customer", FormMethod.Post, new { @id = "frmServiceCallLog", @role = "form" }))
             {
                @*@Html.HiddenFor(x => x.ClassId)
                    @Html.HiddenFor(x => x.TypeListId, new { @Value = "1" })
                    @Html.HiddenFor(x => x.RegionId)*@
                        <input type="hidden" name="ClassId" id="ClassId" value="@ViewBag.CustomerId" />
                        <input type="hidden" name="TypeListId" id="TypeListId" value="1" />
                        <input type="hidden" name="RegionId" id="RegionId" value="@ViewBag.RegionId" />
                        @*<input type="hidden" name="hdnCallFrompop" id="hdnCallFrompop" value="@ViewBag.CallFrom" />*@
                  
                        <div class="form-group" style="margin-bottom:0px;margin-top:0px;">
                            <div class="row" style="padding:0px;">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="padding-top: 0px;text-align:right;">
                                        <span><b>Customer No</b><span style="color:#000000;">&nbsp;:</span></span>
                                    </div>
                                    <div class="col-md-2">
                                        @*<span><b>@ViewBag.CustomerDetail.CustomerNo</b></span>*@
                                        <span><b><label id="CustomerNos">@(CustModel.CustomerViewModel != null ? CustModel.CustomerViewModel.CustomerNo : string.Empty)</label></b></span>
                                    </div>
                                    <div class="col-md-2">
                                    </div>
                                    <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;text-align:right;">
                                        <span><b>Contact</b><span style="color:#000000;">&nbsp;:</span></span>
                                    </div>
                                    <div class="col-md-3">
                                        <span><b><label id="ContactNames">@(CustModel.MainContact != null ? CustModel.MainContact.Name : string.Empty) </label></b></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="padding:0px;">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="padding-top: 0px;text-align:right;padding-right:5px;padding-left:5px;">
                                        <span><b>Customer Name</b><span style="color:#000000;">&nbsp;:</span></span>
                                    </div>
                                    <div class="col-md-4">
                                        <span><b><label id="CustomerNames">@(CustModel.CustomerViewModel != null ? CustModel.CustomerViewModel.Name : string.Empty)</label></b></span>
                                    </div>
                                    <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;text-align:right;">
                                        <span><b>Phone No</b><span style="color:#000000;">&nbsp;:</span></span>
                                    </div>
                                    <div class="col-md-3">
                                        <span><b><label id="Phones">@((CustModel.MainPhone != null && CustModel.MainPhone.Phone1 != null && CustModel.MainPhone.Phone1 != "") ? string.Format("{0:(###) ###-####}", Convert.ToDecimal(CustModel.MainPhone.Phone1.Trim().Replace(" ", "").Replace("-", "").Replace(")", "").Replace("(", ""))) : string.Empty) </label></b></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:0px;margin-top:-18px;">
                            <div class="row">
                                <div class="col-md-12" style="margin-top:-14px;">
                                    <div class="col-md-6">
                                        <div class="control-label" style="text-align:right;padding-right:65px;">
                                            <label class="mt-radio" style="margin-bottom: 13px;">
                                                <input class="i-checks" checked="checked" id="chkCallLog" name="chkCallLogType" type="radio" onclick="OnclickEventchkCallLog()">
                                                <span></span>
                                                Call Log
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="control-label" style="text-align:left;">
                                            <label class="mt-radio" style="margin-bottom: 13px;">
                                                <input class="i-checks" id="chkInternalOfficeNotes" name="chkCallLogType" type="radio" onclick="OnclickEventchkInternalOfficeNotes()">
                                                <span></span>
                                                Internal Office Notes
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" name="hdnActiveType" id="hdnActiveType" value="1" />

                        <div class="form-group clscalllogtype" >
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Initiated By<span style="color:#000000;"> &nbsp;:<span class="required">*</span></span>
                                    </div>
                                    <div class="col-md-4">
                                        @Html.DropDownListFor(x => x.InitiatedBy, new SelectList(ViewBag.InitiatedBy, "Value", "Key"), new { @class = "form-control input-sm", required = "required" })
                                    </div>
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Type<span style="color:#000000;">&nbsp;:<span class="required">*</span></span>
                                    </div>
                                    <div class="col-md-4">
                                        @Html.DropDownListFor(x => x.ServiceLogTypeListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallLogTypeList, new { @class = "form-control input-sm", required = "required" })
                                        @*<select class="input-sm form-control">
                                                <option>Claim / Incident</option>
                                            </select>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clscalllogtype">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Spoke With<span style="color:#000000;">&nbsp;:<span class="required">*</span></span>
                                    </div>
                                    <div class="col-md-4">
                                        @*<input type="text" class="input-sm form-control" />*@
                                        @Html.TextBoxFor(x => x.SpokeWith, new { @class = "input-sm form-control" })
                                    </div>
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Area<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-4">
                                        @Html.DropDownListFor(x => x.ServiceLogAreaListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallAreaList, new { @class = "form-control input-sm", required = "required" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clscalllogtype">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Action<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-10">
                                        @Html.TextBoxFor(x => x.Action, new { @class = "input-sm form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clscalllogtype">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Comments<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-10">
                                        @Html.TextAreaFor(x => x.Comments, new { @class = "input-sm form-control", @rows = "3", @style = "min-width: 638px;" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clscalllogtype">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Status<span style="color:#000000;">&nbsp;:<span class="required">*</span></span>
                                    </div>
                                    <div class="col-md-4">
                                        @*@Html.DropDownListFor(, ViewBag.StatusResultList, new { @class = "form-control input-sm", required = "required", @id = "StatusResultListId", @name = "StatusResultListId" })*@
                                        @Html.DropDownListFor(x => x.StatusResultListId, (IEnumerable<SelectListItem>)ViewBag.StatusResultList, new { @class = "form-control input-sm", required = "required" })
                                    </div>
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        @*Call Back<span style="color:#000000;">&nbsp;:</span>*@
                                        Call Back &nbsp;
                                        <label class="mt-checkbox" style="margin-bottom: 13px;">
                                            <input class="i-checks" data-val="true" data-val-required="field is required" id="chkIsCallBack" name="chkIsCallBack" type="checkbox" onclick="OnclickEvent()">
                                            <input name="hdnIsCallBack" id="hdnIsCallBack" type="hidden" value="">
                                            <span></span>
                                        </label>

                                    </div>
                                    <div class="col-md-4">
                                        @*<div class="input-group input-medium date" data-date-format="mm/dd/yyyy">
                                                @Html.TextBoxFor(x => x.CallBack, new { @class = "form-control input-sm date" })
                                                <span class="input-group-btn">
                                                    <button class="btn default" type="button">
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                </span>
                                            </div>*@

                                        <div class="col-md-6 clsdatetm" style="padding-right:2px; padding-left:0px;display:none;">
                                            <input type="text" id="txtCallBack" name="txtCallBack" class="form-control input-sm date date-picker" placeholder="Date" />
                                            @*@Html.TextBoxFor(x => x.CallBack, new { @class = "form-control input-sm date date-picker" })*@
                                            <input type="hidden" name="CallBack" id="CallBack" value="@Model.CallDate" />
                                        </div>
                                        <div class="col-md-6 clsdatetm" style="padding-right:0px; padding-left:2px;display:none;">
                                            <div class="input-icon">
                                                <i class="fa fa-clock-o" style="margin-top:7px;"></i>
                                                @Html.TextBoxFor(x => x.CallTime, new { @class = "form-control input-sm timepicker timepicker-default" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clscalllogtype">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Follow By<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-4">
                                        @Html.DropDownListFor(x => x.FollowUpBy, (IEnumerable<SelectListItem>)ViewBag.ServiceCallFollowBy, new { @class = "form-control input-sm", required = "required" })
                                    </div>

                                    <div class="col-md-2 control-label" style="text-align:right;padding-left:5px!important;padding-right:5px!important;">
                                        Email Call Notes to<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-4">
                                        @*@Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "form-control input-sm", required = "required" })*@
                                        @Html.HiddenFor(x => x.EmailNotesTo, new { @id = "hdnEmailNotesTo" })
                                        @* @Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "chosen-select form-control input-sm", required = "required" })*@
                                        @Html.ListBox("ddlEmailNotesTo", ViewBag.ServiceEmailCall as MultiSelectList, new { @id = "ddlEmailNotesTo", @class = "chosen-select form-control col-md-4 input-sm", data_placeholder = "--Select--" })
                                    </div>
                                </div>
                            </div>
                        </div>

                 //Internal office note
                <div class="form-group clsinternalofficenote" style="display:none;">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label" style="text-align:right;">
                                Spoke With<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="input-sm form-control" id="txtSpokeWith2" name="txtSpokeWith2" />
                            </div>
                            <div class="col-md-2 control-label" style="text-align:right;">
                                Type<span style="color:#000000;">&nbsp;:<span class="required">*</span></span>
                            </div>
                            <div class="col-md-4">
                                @Html.DropDownList("ddlServiceLogTypeListId2", (IEnumerable<SelectListItem>)ViewBag.ServiceCallLogTypeList, new { @id = "ddlServiceLogTypeListId2", @class = "form-control input-sm", required = "required" })
                            </div>
                        </div>
                    </div>
                </div>

                        <div class="form-group clsinternalofficenote" style="display:none;">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Action<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-10">
                                        <input type="text" class="input-sm form-control" id="txtAction2" name="txtAction2" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clsinternalofficenote" style="display:none;">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Comments<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-10">
                                        <textarea id="txtComments2" name="txtComments2" class="input-sm form-control" , rows="5" style="min-width: 667px;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clsinternalofficenote" style="display:none;">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;"> Call Back:&nbsp;</div>
                                    <div class="col-md-1 control-label" style="text-align:left;width:30px;">
                                        <label class="mt-checkbox" style="margin-bottom: 13px;">
                                            <input id="chkIsCallBack2" name="chkIsCallBack2" type="checkbox">
                                            <input name="hdnIsCallBack2" id="hdnIsCallBack2" type="hidden" value="">
                                            <span></span>
                                        </label>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="col-md-6 clsdatetm2" style="padding-right:2px; padding-left:0px;display:none;">
                                            <input type="text" id="txtCallBack2" name="txtCallBack2" class="form-control input-sm date date-picker" placeholder="Date" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clsinternalofficenote" style="display:none;">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-2 control-label" style="text-align:right;">
                                        Follow By<span style="color:#000000;">&nbsp;:<span class="required" id="spnreqfollowby2" style="display:none">*</span></span>
                                    </div>
                                    <div class="col-md-4">
                                        @Html.DropDownList("ddlFollowUpBy2", (IEnumerable<SelectListItem>)ViewBag.ServiceCallFollowBy, new { @id = "ddlFollowUpBy2", @class = "form-control input-sm", required = "required" })
                                    </div>

                                    <div class="col-md-2 control-label" style="text-align:right;padding-left:5px!important;padding-right:5px!important;">
                                        Email Call Notes to<span style="color:#000000;">&nbsp;:</span>
                                    </div>
                                    <div class="col-md-4">
                                        @*@Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "form-control input-sm", required = "required" })*@
                                        <input type="hidden" id="hdnEmailNotesTo2" name="hdnEmailNotesTo2" />

                                        @* @Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "chosen-select form-control input-sm", required = "required" })*@
                                        @Html.ListBox("ddlEmailNotesTo2", ViewBag.ServiceEmailCall as MultiSelectList, new { @id = "ddlEmailNotesTo2", @class = "chosen-select form-control col-md-4 input-sm", data_placeholder = "--Select--" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        
             }
            <hr />
            <div class="form-group" style="margin-bottom:0px;margin-top:0px;">
                @*<div class="col-md-4" style="margin-left:16px;">
                    <select id="select_servicecalllog_timeduration" class="form-control input-sm">
                        <option value="1">This Week</option>
                        <option value="2">This Week-to-date</option>
                        <option value="3" selected="selected">This Month</option>
                        <option value="4">This Month-to-date</option>
                        <option value="5">This Quarter</option>
                        <option value="6">This Quarter-to-date</option>
                        <option value="7">This Fiscal Year</option>
                        <option value="8">This Fiscal Year-to-date</option>
                        <option value="9">Today</option>
                        <option value="10">Yesterday</option>
                        <option value="11">Last Week</option>
                        <option value="12">Last Month</option>
                        <option value="13">Last Quarter</option>
                        <option value="14">Last Year</option>
                        <option value="15">Custom Date</option>
                        <option value="16">Period</option>
                    </select>
                </div>*@
                <div class="col-md-4" style="padding-left: 30px;">
                    @if(ViewBag.DistributionFranchiseeId != null && Convert.ToString(ViewBag.DistributionFranchiseeId) != "" && Convert.ToString(ViewBag.DistributionFranchiseeId) != "0")
                    {
                        <input type="button" class="btn btn-custom btn btn-primary purple" onclick="ShowFranchiseeCall();" value="Franchisee Call" />
                    }
                    else
                    {
                        <input type="button" class="btn btn-custom btn btn-primary purple" disabled="disabled" value="Franchisee Call" />
                    }
                </div>
                <div class="col-md-7 col-md-offset-1 text-right" style="padding-right:32px;">

                    <input type="button" id="btnSaveSubmitForm" class="btn btn-primary btn-default" value="Save" />
                    <input type="reset" class="btn btn-primary btn-default" value="Cancel" data-dismiss="modal" />


                    @*<input type="button" class="btn btn-primary btn-default" id="btnSaveCloseForm" value="Save" />
                    <input type="reset" class="btn btn-primary btn-default" value="Cancel" id="btnServiceCallCancel" onclick="onclickServiceCallCancel()" />*@
                    @*<input type="button" class="btn btn-primary btn-default" id="btnSaveAndNewForm" value="Save & New" />*@
                </div>
            </div>
            <div id="CustomerServiceLog">
                <div class="row" style="padding-bottom:0px;">
                    <div class="col-md-12">
                        <div class="col-md-12" style="background-color: #67809F;color: #fff;"> 
                            <div class="col-md-2 pnd5" >
                                <select class="form-control input-sm" id="pageSize" style="padding-left:6px;">
                                    <option value="-1">All</option>
                                    <option value="100" selected>100</option>
                                    <option value="50">50</option>
                                    <option value="25">25</option>
                                </select>

                            </div>
                            <div class="col-md-2 pnd5" style="text-align:right;padding-top:8px;">                                
                                Date
                            </div>
                            <div class="col-md-4 pnd5" style="text-align:right;">
                                <select id="select_servicecallpp_timeduration" class="form-control input-sm">
                                    <option value="1">This Week</option>
                                    <option value="2">This Week-to-date</option>
                                    <option value="3" selected="selected">This Month</option>
                                    <option value="4">This Month-to-date</option>
                                    <option value="5">This Quarter</option>
                                    <option value="6">This Quarter-to-date</option>
                                    <option value="7">This Fiscal Year</option>
                                    <option value="8">This Fiscal Year-to-date</option>
                                    <option value="9">Today</option>
                                    <option value="10">Yesterday</option>
                                    <option value="11">Last Week</option>
                                    <option value="12">Last Month</option>
                                    <option value="13">Last Quarter</option>
                                    <option value="14">Last Year</option>
                                    <option value="15">Custom Date</option>
                                    @*<option value="16">Period</option>*@
                                </select>
                            </div>

                            <div class="col-md-4 pnd5" style="padding-top: 10px;text-align:right;" id="div_servicecallpp_spandate">
                                <span id="spn_servicecallpp_StartDate">08/01/2017</span> - <span id="spn_servicecallpp_EndtDate">08/31/2017</span>
                            </div>
                            <div class="collapse">
                                <input type="hidden" id="CustID" name="CustomerID" value="@ViewBag.CustomerId" />
                            </div>
                            <div class="col-md-2 pnd5" style="display:none; text-align:center;" id="div_servicecallpp_SD">
                                <input type="text" name="txtStartDate" id="txt_servicecallpp_StartDate" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                            </div>
                            <div class="col-md-2 pnd5" style="display:none; text-align:center;" id="div_servicecallpp_ED">
                                <input type="text" name="txtEndtDate" id="txt_servicecallpp_EndtDate" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                            </div>
                            <div class="col-md-2 pnd5" style="display: none;" id="div_servicecallpp_month">
                                <select id="servicecallpp_monthlist" class="form-control input-sm">
                                    <option value=""></option>
                                    <option value="1">Jan</option>
                                    <option value="2">Feb</option>
                                    <option value="3">Mar</option>
                                    <option value="4">Apr</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">Aug</option>
                                    <option value="9">Sep</option>
                                    <option value="10">Oct</option>
                                    <option value="11">Nov</option>
                                    <option value="12">Dec</option>
                                </select>
                            </div>
                            <div class="col-md-2 pnd5" style="display: none;" id="div_servicecallpp_year">
                                <select class="form-control input-sm" id="servicecallpp_yearlist">
                                    <option value=""></option>
                                    <option value="2018">2018</option>
                                    <option value="2017">2017</option>
                                    <option value="2016">2016</option>
                                    <option value="2015">2015</option>
                                    <option value="2014">2014</option>
                                    <option value="2013">2013</option>
                                    <option value="2012">2012</option>
                                    <option value="2011">2011</option>
                                    <option value="2010">2010</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top:0px;">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="tblServiceCall">
                                <thead>
                                    <tr>
                                        <th style="width:70px;text-align:center;" class="dtable_CustomerNo">
                                            Date/Time
                                        </th>
                                        <th style="text-align:center;width:60px;" class="dtable_Type">
                                            Type
                                        </th>
                                        <th style="text-align:center;width:53px;" class="dtable_InitiatedBy">
                                            Initiated By
                                        </th>
                                        <th style="text-align:center;width:20px;" class="dtable_Status">
                                            Status
                                        </th>
                                        <th style="text-align:center;width:60px;" class="dtable_SpokeWith">
                                            Spoke With
                                        </th>
                                        <th style="text-align:center;width:60px;" class="dtable_Action">
                                            Action
                                        </th>
                                        <th style="text-align:center;width:80px;" class="dtable_CallBack">
                                            Call Back
                                        </th>
                                        <th style="text-align:center;width:160px;" class="dtable_Comment">
                                            Comment
                                        </th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                                @*<tbody>
                                    @if (ViewBag.CustomerServiceCallLog != null)
                                    {
                                        foreach (var item in ViewBag.CustomerServiceCallLog)
                                        {
                                            <tr>
                                                <td style="text-align:left;">
                                                    <input type="hidden" name="tdClassId" id="tdClassId" value="@item.ClassId" />
                                                    <a href="@Url.Action("ServiceCallList", "Customer", new { area = "Portal", id = item.ClassId })"> @item.CustomerNo<br />@item.CallDate<br />@item.CallTime</a>
                                                </td>
                                                <td style="text-align:center;"></td>
                                                <td style="text-align:center;"></td>
                                                <td style="text-align:center;">@item.Status</td>
                                                <td style="text-align:center;">@item.SpokeWith</td>
                                                <td style="text-align:center;">@item.Action</td>
                                                <td style="text-align:center;">@item.CallBack</td>
                                                <td>@Html.Raw(HttpUtility.HtmlEncode(item.Comments))</td>
                                            </tr>
                                        }
                                    }
                                </tbody>*@

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="form-horizontal" action="" id="form_FranchiseeCall"></div>
<script>
    var dtable;
    function getTableURL() {
        var _fromDateVal = $('#spn_servicecallpp_StartDate').html();
        var _toDateVal = $('#spn_servicecallpp_EndtDate').html();                        
        var sURL1 = '@Url.Action("ServiceCallLogListResultData", "Customer", new { area = "Portal" })?id=' +$("#hdnCustomerId").val() + '&fd=' + _fromDateVal + '&td=' + _toDateVal + '&st=';

        return sURL1;
    }
    function refreshTable() {
        
        var surl1 = getTableURL();
        dtable.ajax.url(surl1).load();
    }
     
</script>
<script type="text/javascript">
    $("#chkIsCallBack2").click(function () {
        if ($("#chkIsCallBack2").is(":checked")) {
            $("#hdnIsCallBack2").val("1");
            $(".clsdatetm2").show();
            $("#spnreqfollowby2").show();
        }
        else {
            $("#hdnIsCallBack2").val("0");
            $(".clsdatetm2").hide();
            $("#spnreqfollowby2").hide();
        }
    })

    $("#btnSaveSubmitForm").click(function () {

        if ($("#chkCallLog").is(":checked")) {
            var isvalid = true;
            if ($('#InitiatedBy').val() == '') { $('#InitiatedBy').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#InitiatedBy').css('border-color', ''); }
            //if ($('#ServiceLogAreaListId').val() == '0') { $('#ServiceLogAreaListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogAreaListId').css('border-color', ''); }
            if ($('#ServiceLogTypeListId').val() == '0') { $('#ServiceLogTypeListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogTypeListId').css('border-color', ''); }
            if ($('#SpokeWith').val() == '') { $('#SpokeWith').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#SpokeWith').css('border-color', ''); }
            if ($('#StatusResultListId').val() == '0') { $('#StatusResultListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#StatusResultListId').css('border-color', ''); }
            //if ($('#CallBack').val() == '0') { $('#CallBack').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#CallBack').css('border-color', ''); }

            //$("#CallBack").val($("#txtCallBack").val() + " " + $("#CallTime").val());
            $("#CallBack").val($("#txtCallBack").val());

            var option_all = $("#ddlEmailNotesTo option:selected").map(function () {
                return $(this).val();
            }).get().join(',');

            $("#hdnEmailNotesTo").val(option_all);

            if (isvalid == true) {
                //$("#frmServiceCallLog").submit();

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ServiceCallLogPopupCustomerDetails", "Customer", "Portal")',
                    data: $("#frmServiceCallLog").serialize(),
                    dataType: 'json',
                    success: function (data) {
                        $("input[type='text']").val("");
                        $("#InitiatedBy").val("0");
                        $("#ServiceLogTypeListId").val("0");
                        $("#ServiceLogAreaListId").val("0");
                        $("#StatusResultListId").val("0");
                        $("#FollowUpBy").val("0");
                        $("#ddlServiceLogTypeListId2").val("0");
                        $("#ddlFollowUpBy2").val("0");
                        $("#txtComments2").val("");
                        $("#Comments").val("");
                         
                        refreshTable(); 
                    }
                });
            }
        }
        else {
            var isvalid = true;
            //if ($('#InitiatedBy').val() == '') { $('#InitiatedBy').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#InitiatedBy').css('border-color', ''); }
            //if ($('#ServiceLogAreaListId').val() == '0') { $('#ServiceLogAreaListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogAreaListId').css('border-color', ''); }
            if ($('#ddlServiceLogTypeListId2').val() == '0') { $('#ddlServiceLogTypeListId2').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ddlServiceLogTypeListId2').css('border-color', ''); }
            //if ($('#SpokeWith').val() == '') { $('#SpokeWith').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#SpokeWith').css('border-color', ''); }
            //if ($('#StatusResultListId').val() == '0') { $('#StatusResultListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#StatusResultListId').css('border-color', ''); }
            //if ($('#CallBack').val() == '0') { $('#CallBack').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#CallBack').css('border-color', ''); }

            //$("#CallBack").val($("#txtCallBack").val() + " " + $("#CallTime").val());
            //$("#CallBack").val($("#txtCallBack").val());
            
            if ($("#chkIsCallBack2").is(":checked")) {
                if ($('#ddlFollowUpBy2').val() == '0' || $('#ddlFollowUpBy2').val() == '') { $('#ddlFollowUpBy2').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ddlFollowUpBy2').css('border-color', ''); }
            }


            var option_all2 = $("#ddlEmailNotesTo2 option:selected").map(function () {
                return $(this).val();
            }).get().join(',');

            $("#hdnEmailNotesTo2").val(option_all2);

            if (isvalid == true) {
                //$("#frmServiceCallLog").submit();
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ServiceCallLogPopupCustomerDetails", "Customer", "Portal")',
                    data: $("#frmServiceCallLog").serialize(),
                    dataType: 'json',
                    success: function (data) {
                        $("input[type='text']").val("");
                        $("#InitiatedBy").val("0");
                        $("#ServiceLogTypeListId").val("0");
                        $("#ServiceLogAreaListId").val("0");
                        $("#StatusResultListId").val("0");
                        $("#FollowUpBy").val("0");
                        $("#ddlServiceLogTypeListId2").val("0");
                        $("#ddlFollowUpBy2").val("0");
                        $("#txtComments2").val("");
                        $("#Comments").val("");
                        refreshTable();
                    }
                });
            }
        }
    });
    function OnclickEvent() {
        if ($("#chkIsCallBack").is(":checked")) {
            $("#hdnIsCallBack").val("1");
            $(".clsdatetm").show();
        }
        else {
            $("#hdnIsCallBack").val("0");
            $(".clsdatetm").hide();
        }
    }

    function OnclickEventchkCallLog() {
        $(".clscalllogtype").show();
        $(".clsinternalofficenote").hide();
        $("#hdnActiveType").val(1);
    }

    function OnclickEventchkInternalOfficeNotes() {
        $(".clscalllogtype").hide();
        $(".clsinternalofficenote").show();
        $("#hdnActiveType").val(2);
    }

</script>
<script type="text/javascript">

    $(document).ready(function () {

        var fDay = moment().subtract(0, 'month').startOf('month').toString();
        var lDay = moment().subtract(0, 'month').endOf('month').toString();

        $('#spn_servicecallpp_StartDate').html(moment(fDay).format('L'));
        $('#spn_servicecallpp_EndtDate').html(moment(lDay).format('L'));


        $("#pageSize").change(function () {
            setPaging();
        });

        //Datepicker set
        $('.date-picker').datepicker({ autoclose: true, dateFormat: 'mm/dd/yy' });
        $('.date-picker').attr("placeholder", "mm/dd/yyyy");
        $('.timepicker').timepicker();

        //List data load
        //LoadServiceCallLogList();

        LoadDataList();

        //Save data
        $('#btnSaveCloseForm').click(function () {
            var isvalid = true;
            if ($('#InitiatedBy').val().trim() == '') { $('#InitiatedBy').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#InitiatedBy').css('border-color', ''); }
            if ($('#ServiceLogAreaListId').val().trim() == '0') { $('#ServiceLogAreaListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogAreaListId').css('border-color', ''); }
            if ($('#ServiceLogTypeListId').val().trim() == '0') { $('#ServiceLogTypeListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogTypeListId').css('border-color', ''); }
            if ($('#SpokeWith').val().trim() == '') { $('#SpokeWith').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#SpokeWith').css('border-color', ''); }
            if ($('#Action').val().trim() == '') { $('#Action').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Action').css('border-color', ''); }
            if ($('#StatusResultListId').val().trim() == '0') { $('#StatusResultListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#StatusResultListId').css('border-color', ''); }

            if (isvalid == true) {
                var Odata = {
                    CustomerId: $("#hdnCustomerId").val(),
                    RegionId: $("#RegionId").val(),
                    InitiatedById: $('#InitiatedBy').val(),
                    AreaId: $('#ServiceLogAreaListId').val(),
                    TypeId: $('#ServiceLogTypeListId').val(),
                    SpokeWith: $('#SpokeWith').val(),
                    Action: $('#Action').val(),
                    Comments: $("#Comments").val(),
                    StatusId: $("#StatusResultListId").val(),
                    //CallDate: $("#CallDate").val(),
                    //CallTime: $("#CallTime").val(),
                    Callback: $("#CallDate").val() + " " + $("#CallTime").val(),
                    FollowBy: $("#ddlFollowBy").val(),
                    EmailCallNotes: $("#ddlEmailCallNotes").val()
                };
                $.ajax({
                    url: '@Url.Action("SaveServiceCallLogDetails", "Customer")',
                    dataType: "json",
                    data: Odata,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function () {
                        $('input[type=text]').val("");
                        $('.ddl').val("0");
                        $('#Comments').val("");
                        $(".timepicker").timepicker();
                        //LoadServiceCallLogList()
                        refreshTable();
                    },
                    error: function () { }
                });
            }
        });

        if(@ViewBag.CustomerId > 0)
            BindCustomerServiceLogList($('#spn_servicecallpp_StartDate').text(), $('#spn_servicecallpp_EndtDate').text());
    });

    function setPaging() {
        var z = $("#pageSize").val();
        var table = $("#tblServiceCall").DataTable();
        if (z > 0) {
            table.page.len(z).draw();
        }
        else if (z == -1) {
            table.page.len(table.rows().count()).draw();
        }
        else {
            table.page.page.len(25).draw();
        }
    }
    //Load list data
    @*function LoadServiceCallLogList() {
        var CurrentLink = '@Url.Action("GetServiceLog", "Customer", new { area = "Portal" })?id=' + $("#hdnCustomerId").val();
        var dtable = $('#tblServiceCall').dataTable({
            "bAutoWidth": false,
            cache: false,
            "order": false,
            "bDestroy": true,
            "bLengthMenu": false,
            "bPaginate": true,
            //"bLengthChange": false,
            "dom": '<"top">rt<"bottom"lp><"clear">',
            "aaSorting": [[0, "desc"]],
            "sAjaxSource": CurrentLink,
            "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
            "rowCallback": function (nRow, data) {
            },

            "aoColumns": [
                {
                    "sName": "Date/Time",
                    "bSortable": true,
                    "sClass": "alignleft",
                    "mRender": function (data, type, full) {
                        //var datetime = "<span>" + full.CallDate + "<br />" + formatJSONTime(full.CallTime) + "</span>";

                        return '<span>' + moment(new Date(parseInt(full.CallDate.substr(6)))).format("MM/DD/YYYY") + "</br>" + full.CallTime + '</span>';
                        return datetime;
                    }
                },
                {
                    "sName": "Status",
                    "bSortable": true,
                    "sClass": "alignCenter",
                    "mRender": function (data, type, full) {
                        //var status = getstatus(full.Status);
                        return full.Status;
                    }
                },
                {
                    "sName": "SpokeWith",
                    "bSortable": true,
                    "sClass": "alignCenter",
                    "mRender": function (data, type, full) {
                        return full.SpokeWith;
                    }
                },
                {
                    "sName": "Action",
                    "bSortable": true,
                    "sClass": "alignCenter",
                    "mRender": function (data, type, full) {
                        return full.Action;
                    }
                },
                {
                    "sName": "CallBack",
                    "bSortable": true,
                    "mRender": function (data, type, full) {
                        if (full.CallBack != null && full.CallBack != "") {
                            return '<span>' + moment(new Date(parseInt(full.CallBack.substr(6)))).format("MM/DD/YYYY") + '</span>';
                            // return moment(new Date(parseInt(full.CallBack.substr(6)))).format("MM/DD/YYYY");
                        }
                        return "";

                    }
                },
                {
                    "sName": "Comments",
                    "bSortable": true,
                    "sClass": "alignleft",
                    "mRender": function (data, type, full) {
                        return full.Comments;
                    }
                },
            ],
        });
    }*@

    function LoadDataList()
    {
        var sURL1 = getTableURL();
        var ps = $('#pageSize').val();
        dtable = $('#tblServiceCall').DataTable({
            "bServerSide": false,
            "sAjaxSource": sURL1,
            "iDisplayLength": ps == '-1' ? 25 : ps,
            "dom": "<'table-responsive't><'bottom'ip><'clear'>",
            "aaSorting": [[0, "desc"]],
            columnDefs: [
                {
                    targets: "dtable_CustomerNo",
                    data: "",
                    render: function (data, type, row, meta) {
                        return row.CustomerNo + ' <br />' + moment(new Date(parseInt(row.CallDate.substr(6)))).format("MM/DD/YYYY") + '<br />' + tConvert(row.CallTime);
                    }
                },
                 {
                     targets: "dtable_Type",
                     data: "ServiceLogTypeListName",
                     sClass: "clstext-align",
                     render: function (data, type, row, meta) { return row.ServiceLogTypeListName }
                 },
                 {
                     targets: "dtable_InitiatedBy",
                     data: "InitiatedBy",
                     sClass: "clstext-align",
                     render: function (data, type, row, meta) {
                         var strInitiatedBy = "";
                         if (row.InitiatedBy == '0')
                         {
                             strInitiatedBy = "JK";
                         }
                         else if (row.InitiatedBy == '1') {
                             strInitiatedBy = "Customer";
                         }
                         else if (row.InitiatedBy == '2') {
                             strInitiatedBy = "Franachisee";
                         }
                         return strInitiatedBy;
                     }
                 },
                { targets: "dtable_Status", data: "Status", sClass: "clstext-align" },
                { targets: "dtable_SpokeWith", data: "SpokeWith", sClass: "clstext-align" },
                { targets: "dtable_Action", data: "Action", sClass: "clstext-align" },
                {
                    targets: "dtable_CallBack",
                    data: "",
                    sClass: "alignCenter clstext-align",
                    render: function (data, type, row, meta) {
                        if (row.CallBack != null && row.CallBack != "") {
                            return moment(new Date(parseInt(row.CallBack.substr(6)))).format("MM/DD/YYYY");
                        }
                        return "";
                    }
                },
                //{
                //    targets: "dtable_Completed",
                //    data: "",
                //    sClass: "clstext-align",
                //    render: function (data, type, row, meta) { return "" }
                //},
                { targets: "dtable_Comment", data: "Comments" },
                //{
                //    targets: "dtable_ActionHistory", data: "",
                //    render: function (data, type, row, meta) { return "" }
                //},
            ]

        });
    }
    function onclickServiceCallCancel() {
        $("#modal_ServiceCallLog").modal('hide');
    }

    var firstDay;
    var lastDay;



    /*Start Date Change Event*/
    $('#txt_servicecallpp_StartDate').change(function () {
        $('#spn_servicecallpp_StartDate').html($(this).val());
        if( $('#txt_servicecallpp_StartDate').val()!='' &&  $('#txt_servicecallpp_EndtDate').val()!='' && @ViewBag.CustomerId > 0)
            BindCustomerServiceLogList($('#spn_servicecallpp_StartDate').text(), $('#spn_servicecallpp_EndtDate').text());
    });
    /*END Date Change Event*/
    $('#txt_servicecallpp_EndtDate').change(function () {
        $('#spn_servicecallpp_EndtDate').html($(this).val());
        if( $('#txt_servicecallpp_StartDate').val()!='' &&  $('#txt_servicecallpp_EndtDate').val()!='' && @ViewBag.CustomerId > 0)
            BindCustomerServiceLogList($('#spn_servicecallpp_StartDate').text(), $('#spn_servicecallpp_EndtDate').text());
    });

    /*Month Change Event*/
    $('#servicecallpp_monthlist').change(function () {
        $('#spn_servicecallpp_StartDate').html('');
        if ($('#servicecallpp_monthlist').val() != '' && $('#servicecallpp_yearlist').val() != '')
            BindCustomerServiceLogList($('#spn_servicecallpp_StartDate').text(), $('#spn_servicecallpp_EndtDate').text());
    });

    /*Year Change Event*/
    $('#servicecallpp_yearlist').change(function () {
        $('#spn_servicecallpp_EndtDate').html('');
        if ($('#servicecallpp_monthlist').val() != '' && $('#servicecallpp_yearlist').val() != '')
            BindCustomerServiceLogList($('#spn_servicecallpp_StartDate').text(), $('#spn_servicecallpp_EndtDate').text());
    });


    //Change Event of Servicecalllog time duration
    $("#select_servicecallpp_timeduration").change(function () {

        $('#spn_servicecallpp_StartDate').html('');
        $('#spn_servicecallpp_EndtDate').html('');
        $('#div_servicecallpp_spandate').show();
        $('#div_servicecallpp_SD').hide();
        $('#div_servicecallpp_ED').hide();
        $('#div_servicecallpp_month').hide();
        $('#div_servicecallpp_year').hide();
        $('#servicecallpp_monthlist').val('');
        $('#servicecallpp_yearlist').val('');

        switch (parseInt($(this).val())) {
            case 1:
                firstDay = moment().startOf('isoWeek').toString();
                lastDay = moment().endOf('isoWeek').toString();
                break;
            case 2:
                //code block
                firstDay = moment().startOf('isoWeek').toString();
                lastDay = new Date().toString();
                break;
            case 3:
                firstDay = moment().subtract(0, 'month').startOf('month').toString();
                lastDay = moment().subtract(0, 'month').endOf('month').toString();
                break;
            case 4:
                //code block
                firstDay = moment().subtract(0, 'month').startOf('month').toString();
                lastDay = new Date().toString();
                break;
            case 5:
                //code block
                firstDay = moment().startOf('quarter').toString();
                lastDay = moment().endOf('quarter').toString();
                break;
            case 6:
                //code block
                firstDay = moment().startOf('quarter').toString();
                lastDay = new Date().toString();
                break;
            case 7:
                //code block
                firstDay = moment().startOf('year').toString();;
                lastDay = moment().endOf('year').toString();
                break;
            case 8:
                //code block
                firstDay = moment().startOf('year').toString();
                lastDay = new Date().toString();
                break;
            case 9:
                //code block
                firstDay = moment().toString();
                lastDay = moment().toString();
                break;
            case 10:
                //code block
                firstDay = moment().add(-1, 'days').toString();
                lastDay = moment().add(-1, 'days').toString();
                break;
            case 11:
                //code block
                firstDay = moment().subtract(1, 'week').startOf('week').toString();
                lastDay = moment().subtract(1, 'week').endOf('week').toString();
                break;
            case 12:
                //code block
                firstDay = moment().subtract(1, 'month').startOf('month').toString();
                lastDay = moment().subtract(1, 'month').endOf('month').toString();
                break;
            case 13:
                //code block
                firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                break;
            case 14:
                //code block
                firstDay = moment().subtract(1, 'year').startOf('year').toString();
                lastDay = moment().subtract(1, 'year').endOf('year').toString();
                break;
            case 15:
                //code block
                $('#div_servicecallpp_spandate').hide();
                $('#div_servicecallpp_SD').show();
                $('#div_servicecallpp_ED').show();
                $('#txt_servicecallpp_StartDate').val('');
                $('#txt_servicecallpp_EndtDate').val('')
                break;
            case 16:
                //code block
                $('#div_servicecallpp_spandate').hide();
                $('#div_servicecallpp_SD').hide();
                $('#div_servicecallpp_ED').hide();
                $('#div_servicecallpp_month').show();
                $('#div_servicecallpp_year').show();
                break;
            default:
                //code block
        }
        $('#spn_servicecallpp_StartDate').html(moment(firstDay).format('L'));
        $('#spn_servicecallpp_EndtDate').html(moment(lastDay).format('L'));

        refreshTable();


        console.log(moment(firstDay).format('L'));
        console.log(moment(lastDay).format('L'));
        if(parseInt($(this).val())!=15 && parseInt($(this).val())!=16)
            BindCustomerServiceLogList(moment(firstDay).format('L'), moment(lastDay).format('L'));
    });

    function BindCustomerServiceLogList(strdate, enddate) {

        var cusId = $("#hdnCustomerId").val();
        if(cusId){
            var currenturl = '@Url.Action("ServiceCallLogListResultData", "Customer", new { area = "Portal" })?id=' +$("#hdnCustomerId").val() + '&fd=' + strdate + '&td=' + enddate + '&st=';
            dtable.ajax.url(currenturl).load();
        }
    }

    function tConvert(time) {
        var timeString = time;
        var H = +timeString.substr(0, 2);
        var h = (H % 12) || 12;
        var ampm = H < 12 ? " AM" : " PM";
        timeString = h + timeString.substr(2, 3) + ampm;
        return timeString;
    }

    function ShowFranchiseeCall() {
        var FranchiseeId = $("#hdnFranchiseeId").val();
        var CustomerId = $("#hdnCustId").val();

        var sURL = '@Url.Action("GetFranchiseeCall", "Customer", new { area = "Portal" })' + "?FranchiseeId=" + FranchiseeId + "&CustomerId="+CustomerId;
        var FranchiseeId = FranchiseeId
        if (FranchiseeId != "" && FranchiseeId != 0) {
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_FranchiseeCall').html(data);
                    $("#modal_FranchiseeCall").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }
        else {
            swal({
                title: "Oops",
                text: "Plese Select the Customer First",
                allowOutsideClick: false,
                html: true
            });
        }
    }
</script>
