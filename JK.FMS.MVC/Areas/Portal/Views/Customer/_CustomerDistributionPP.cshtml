@model JKViewModels.Franchise.CommonFranchiseeCustomerViewModel
@{
    if (Model.CustomerDetail == null)
    {
        Model.CustomerDetail = new JKViewModels.Franchise.FCDetailViewModel();
    }
}
@section styles{
    <link href="~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/Content/admin/assets/Card/dist/card.css" rel="stylesheet" />
    <link href="~/Content/admin/assets/global/plugins/bootstrap-sweetalert/sweetalert.css" rel="stylesheet" />

    <style type="text/css">
        .has-error {
            border-color: red;
        }

        .custom-form .btn {
            margin-bottom: 5px;
        }

        .sweet-alert {
            z-index: 59999;
        }

        .pnd5 {
            padding: 5px;
        }

        .control-label.text-left {
            text-align: left;
        }

        .editvaluetext {
            background-color: white;
            showBillsetting border-style: inherit;
        }

        .editmode {
            background-color: initial;
            border-style: hidden;
        }

        .ui-autocomplete {
            z-index: 9999 !important;
        }

        .btn-custom {
            font-size: 11px;
            padding: 10px 0px;
        }

        /*input:focus, textarea:focus,select:focus {
            border-color: initial;
        }

        input.error, textarea.error,select:focus {
            border: 1px solid red;
        }*/
        .close {
            background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
            height: 12px !important;
            width: 12px !important;
            margin-top: 0px !important;
        }

        tr > td {
            font-size: 11px !important;
            padding: 4px !important;
        }

        /*tr > th {
            font-size: 10px !important;
        }*/

        /*.row {
            margin: 0;
            padding: 5px 0;
        }*/
        .modal-body .row {
            margin: 0;
            padding: 5px 0;
        }

        .opendiv {
            padding: 4px;
            background-color: gold;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .closeddiv {
            padding: 4px;
            background-color: limegreen;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overpaiddiv {
            padding: 4px;
            background-color: deepskyblue;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overduediv {
            padding: 4px;
            background-color: orangered;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .btn {
            padding: 3px 12px;
            font-size: 12px;
        }

        .alignRight {
            text-align: right;
        }

        .alignleft {
            text-align: left;
        }

        .alignCenter {
            text-align: center;
        }

        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }

            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .credit-field {
            width: 80px !important;
        }

        .txtright {
            text-align: right;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .modal-header:hover {
            cursor: move;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }

            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .payment-field {
            width: 80px !important;
        }

        .demo-container {
            width: 100%;
            max-width: 350px;
            margin: 10px auto;
        }

        form {
            margin: 30px;
        }

        .input-185 {
            width: 146px;
        }

        #ui-datepicker-div {
            z-index: 99999 !important;
        }

        /*input {
            width: 200px;
            margin: 10px auto;
            display: block;
        }*/
        .Amttext {
            text-align: right;
        }

        .clsAmounttd {
            text-align: right !important;
        }

        .toppadding {
            margin-top: 0px;
        }

        .text-bottom {
            vertical-align: bottom !important;
        }

        input[type="radio"].bigger-radio {
            -ms-transform: scale(1.5); /* IE 9 */
            -webkit-transform: scale(1.5); /* Chrome, Safari, Opera */
            transform: scale(1.5);
            margin-bottom: 10px;
        }

        .sweet-alert p {
            font-size: 18px;
        }
    </style>

}
<style type="text/css">
    .input-sm.pp {
        margin-top: 0;
        margin-bottom: 0;
        text-align: right;
        padding: 3px;
        border-radius: 0;
    }

    .has-error {
        border-color: red;
    }

    a.has-error {
        color: red;
    }

    #FD_frdestributionTable table > thead > tr > td, table > tbody > tr > td {
        padding: 3px !important;
    }

    .subSectionH4 {
        margin-top: 0px;
        margin-bottom: 0px;
        padding: 3px !important;
        font-size: 10px;
        font-weight: bold;
        background: #3598DC !important;
        color: #FFF !important;
        border: 1px solid #3598DC !important;
        padding: 0px;
        border-radius: 0;
        text-transform: uppercase;
    }
</style>

@using (Html.BeginForm("FranchiseCustomerDistributionPopup", "Customer", FormMethod.Post,
            new { @id = "frmsubmitfc_onclick", @role = "form", @class = "form form-horizontal toppadding", @style = "margin: 0px;" }))
{


    <div class="modal fade custom-model custom-form-design" id="FD_modal_FranchiseeDistribution" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" style="width:952px">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Franchisee Distribution
                    </h4>
                    <input type="hidden" value="@ViewBag.CallFrom" id="FD_hdfFranchiseeDistributionCallFrom" name="FD_hdfFranchiseeDistributionCallFrom" />
                    <input type="hidden" value="@Model.CustomerDetail.CustomerId" id="FD_hdfCustomerId" name="FD_hdfCustomerId" />
                    <input type="hidden" value="@Model.CustomerDetail.ContractId" id="FD_hdfContractId" name="FD_hdfContractId" />
                    <input type="hidden" value="@Model.CustomerDetail.ContractTypeListId" id="FD_hdfContractTypeListId" name="FD_hdfContractTypeListId" />
                </div>
                <div class="modal-body" style="padding: 0px;    ">
                    <div style="max-width: 98%;margin: 0px auto;">
                        <div class="custom-form portlet light">
                            <div class="portlet-body form">
                                <table width="100%">
                                    <tr>
                                        <td style="width: 100px;padding-left: 10px!important;font-weight: bold;">Customer No:</td>
                                        <td>@Html.DisplayFor(o => o.CustomerDetail.CustomerNo)</td>
                                        <td style="width: 120px;padding-left: 10px!important;font-weight: bold;">Customer Name:</td>
                                        <td>@Html.DisplayFor(o => o.CustomerDetail.CustomerName)</td>
                                        <td style="width: 100px;padding-left: 10px!important;font-weight: bold;">Start Date:</td>
                                        <td style="width:100px;padding-top: 5px!important;">@Html.TextBoxFor(o => o.CustomerDetail.EffectiveDate, new { @class = "form-control input-sm date-picker" })</td>
                                    </tr>
                                </table>
                                <h4 class="modal-title subSectionH4">
                                    CUSTOMER CONTRACT/CONTRACT DETAIL
                                </h4>
                                <div class="table-responsive">
                                    <table class="table" id="tblFranchiseeDistributionList">
                                        <thead>
                                            <tr>
                                                <th style="width:90px;text-align:center;">
                                                    PO No.
                                                </th>
                                                <th style="width:120px;text-align:center;">
                                                    Account Type
                                                </th>
                                                <th style="width:30px;text-align:center;">
                                                    Term (m)
                                                </th>
                                                <th style="text-align:center;width:50px;">
                                                    Start Date
                                                </th>
                                                <th style="text-align:center;width:30px;">
                                                    Expiration Date
                                                </th>
                                                <th style="text-align:center;width:30px;">
                                                    Total Amount
                                                </th>
                                                <th style="text-align:center;width:80px;">
                                                    Status
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="width:90px;text-align:center;">
                                                    @Html.DisplayFor(one => one.CustomerDetail.PONumber)
                                                </td>
                                                <td style="text-align:center;width:140px;">
                                                    @Html.DisplayFor(one => one.CustomerDetail.AccountTypeName)
                                                </td>
                                                <td style="text-align:center;width:30px;">
                                                    @Html.DisplayFor(one => one.CustomerDetail.ContractTermMonth)
                                                </td>
                                                <td style="text-align:center;width:50px;">
                                                    @if (Model.CustomerDetail.StartDate != null)
                                                    {@String.Format("{0:MM/dd/yyyy}", Model.CustomerDetail.StartDate)}
                                                </td>
                                                <td style="text-align:center;width:30px;">
                                                    <span id="DFCustomerIncreaseDecreaseDetail_ContractExpirationDate">@String.Format("{0:MM/dd/yyyy}", Model.CustomerDetail.ExpirationDate)</span>
                                                </td>
                                                <td style="text-align:center;width:30px;">
                                                    <span id="DFCustomerIncreaseDecreaseDetail_ContractTotalAmount">@String.Format("{0:c}", Model.CustomerDetail.TotalAmount)</span>
                                                </td>
                                                <td style="text-align:center;width:30px;">
                                                    @Html.DisplayFor(one => one.CustomerDetail.Status)
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="7" style="padding: 0 !important;">
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-bordered table-hover order-column">
                                                            <thead>
                                                                <tr>
                                                                    <th style="width:20px;text-align:center;">
                                                                        Contract Detail Line
                                                                    </th>
                                                                    <th style="width:242px;text-align:center;">
                                                                        Service Description
                                                                    </th>
                                                                    <th style="width:30px;text-align:center;">
                                                                        Amount
                                                                    </th>
                                                                    <th style="width:30px;text-align:center;">
                                                                        Frequency
                                                                    </th>
                                                                    <th style="width:30px;text-align:center;">
                                                                        Schedule
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item in Model.lstContractDetail)
                                                                {
                                                                    <tr>
                                                                        <td style="width:20px;text-align:center;">
                                                                            @item.LineNumber
                                                                        </td>
                                                                        <td style="text-align:center;width:242px;">@item.ServiceTypeName</td>
                                                                        <td style="text-align:center;width:30px;">@String.Format("{0:c}", @item.Amount)</td>
                                                                        <td style="text-align:center;width:30px;">@item.BillingFrequencyListName</td>
                                                                        <td style="text-align:center;width:30px;">
                                                                            <a href="javascript:void(0);" onclick="@("CIDFranchiseeservice(" + item.Mon.ToString().ToLower() + "," + item.Tues.ToString().ToLower() + "," + item.Wed.ToString().ToLower() + "," + item.Thur.ToString().ToLower() + "," + item.Fri.ToString().ToLower() + "," + item.Sat.ToString().ToLower() + "," + item.Sun.ToString().ToLower() + ")")">View</a>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>


                                <div class="form-body-outer" style="padding: 0px;">
                                    <h4 class="modal-title subSectionH4">
                                        Franchisee Destribution
                                    </h4>

                                    <table class="col-md-12" style="border:1px solid #e8e8e8" id="FD_frdestributionTable">
                                        <thead>
                                            <tr>
                                                <th colspan="1">
                                                    <select class="form-control input-sm ddldetaillinenumber clscntl" style="border-radius: 0px;margin: 0px;" id="FD_ddldetaillinenumber"></select>
                                                </th>
                                                <th colspan="5"><input type="text" id="FD_frenchiseesearchbox" autocomplete="off" name="name" value="" placeholder="Search Pay To by Number or Name" class="form-control input-sm typeahead clscntl" style="padding: 5px;border-radius: 0px;margin: 0px;" /></th>
                                            </tr>
                                            <tr>
                                                <th style="width:140px;padding:3px;margin: 0px;text-align:center;">Contract Detail Line</th>
                                                <th style="width:100px;padding:3px;margin: 0px;text-align:center;">Franchisee No.</th>
                                                <th style="width:300px;padding:3px;text-align:center;">Franchisee Name</th>
                                                <th style="width:140px;padding:3px;text-align:center;">Distribution Amount</th>
                                                <th style="width:140px;padding:3px;text-align:center;">Distribution Fees</th>
                                                <th style="width:40px;padding:3px;text-align:center;"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (ViewBag.CallFrom != "RO" && ViewBag.CallFrom != "AO" && ViewBag.CallFrom != "CD") /*RO = CRM - Region Operations*/
                                            {
                                                for (int i = 0; i < Model.lstFranchiseeDistribution.Count; i++)
                                                {
                                                    <tr>
                                                        <td style="text-align:center">
                                                            @Html.HiddenFor(o => o.lstFranchiseeDistribution[i].DistributionId)
                                                            @Html.HiddenFor(o => o.lstFranchiseeDistribution[i].FranchiseeId)
                                                            @Html.HiddenFor(o => o.lstFranchiseeDistribution[i].ContractDetailId)
                                                            @Html.DisplayFor(o => o.lstFranchiseeDistribution[i].DetailLineNumber)
                                                        </td>
                                                        <td style="text-align:center;">@Html.DisplayFor(o => o.CustomerDetail.FranchiseeNo)</td>
                                                        <td style="white-space:pre-line;text-align:center;">@Html.DisplayFor(o => o.CustomerDetail.FranchiseeName)</td>
                                                        <td style="text-align:right;">@Html.TextBoxFor(o => o.lstFranchiseeDistribution[i].Amount, new { @style = "width: 100%;" })</td>
                                                        <td style="text-align:center">
                                                            <a href="javascript:void(0);" class="clsdistview" id="@("fdt_lnkAppendDistributionFee_"+i)" relName="fdt_lnkAppendDistributionFee"
                                                               onclick="TransferDistributionfee(@Model.lstFranchiseeDistribution[i].FranchiseeId,@Model.lstFranchiseeDistribution[i].ContractDetailId,@Model.lstFranchiseeDistribution[i].DetailLineNumber,0)">Add</a>
                                                        </td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                    @if (ViewBag.CallFrom != "RO" && ViewBag.CallFrom != "AO" && ViewBag.CallFrom != "CD")
                                    {
                                        <div class="form-actions">
                                            <div class="col-md-12" style="padding-right: 28px;">
                                                <button type="button" class="btn btn-primary col-md-2 pull-right" id="btnSaveDistributionIncrease" onclick="ShowAddNEwFeeFinder()" style="margin-left: 10px; ">
                                                    CONTINUE
                                                    <i class="fa fa-check"></i>
                                                </button>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="form-actions">
                                            <div class="col-md-12" style="padding-right: 28px;">
                                                <button type="button" id="btnFDSaveDistribution" onclick="SubmitForRO()" class="btn btn-primary col-md-2 pull-right" style="margin-left: 10px; ">
                                                    SUBMIT
                                                    <i class="fa fa-check"></i>
                                                </button>
                                            </div>
                                        </div>

                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>





    @Html.HiddenFor(o => o.CustomerDetail.CustomerId)
    @Html.HiddenFor(o => o.CustomerDetail.FranchiseeId)
    @Html.HiddenFor(o => o.CustomerDetail.TotalAmount)
    @Html.HiddenFor(o => o.CustomerDetail.ContractId)
    @Html.HiddenFor(o => o.CustomerDetail.FranchiseeName)
    @Html.HiddenFor(o => o.CustomerDetail.FranchiseeNo)

    <input type="hidden" value="@ViewBag.CallFrom" id="hdfCustomerDetailCallFrom" name="hdfCustomerDetailCallFrom" />
    <input type="hidden" value="@ViewBag.SelectedFranchiseeId" id="hdfSelectedFranchiseId" name="hdfSelectedFranchiseId" />



    <div class="modal fade custom-model custom-form-design" id="FD_modal_FranchiseeDistributionFee" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm" style="width: 400px;">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Fee
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px">
                    <div style="max-width: 98%;margin: 0px auto;">
                        <div class="custom-form portlet light">
                            <div class="portlet-body form">
                                <input type="hidden" name="hdfDestributionFee_FranchiseeId" id="hdfDestributionFee_FranchiseeId" value="" />
                                <input type="hidden" name="hdfDestributionFee_ContractDetailId" id="hdfDestributionFee_ContractDetailId" value="" />
                                <input type="hidden" name="hdfDestributionFee_DestributionId" id="hdfDestributionFee_DestributionId" value="" />
                                <input type="hidden" name="hdfDestributionFee_Linenumber" id="hdfDestributionFee_Linenumber" value="" />
                                <div class="form-body-outer" style="padding: 0px;">
                                    <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                        <div class="form-group">
                                            <table class="table table-striped table-bordered table-hover order-column" id="feelist">
                                                <thead>
                                                    <tr style="background-color: #e8e8e8;font-weight: bold;">
                                                        <td>
                                                            Fee Name
                                                        </td>
                                                        <td>
                                                            Type
                                                        </td>
                                                        <td style="width:50px;">
                                                            Amount
                                                        </td>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                        <div class="form-group clsbtmpnl">
                                            <a href="#" id="btnTransDistributionFeeAddLink" onclick="TransFranchiseeserviceAddDestribution()">Include Another Fee</a>
                                        </div>
                                        <div class="form-group clsbtmpnl">
                                            <input type="button" id="btnTransDistributionFeeSave" name="btnTransDistributionFeeSave" onclick="btnTransDistributionFeeSaveOnClick()" value="Save" class="btn btn-primary input-sm pull-right" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>
    <div class="modal fade custom-model custom-form-design" id="FD_modal_AddFranchiseeDistributionFee" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm" style="width: 400px;">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Fee
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px">
                    <div style="max-width: 98%;margin: 0px auto;">
                        <div class="custom-form portlet light">
                            <div class="portlet-body form">
                                <div class="form-body-outer" style="padding: 0px;">
                                    <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                        <div class="form-group">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-bordered table-hover order-column" id="feeListAdd">
                                                    <thead>
                                                        <tr style="background-color: #e8e8e8;font-weight: bold;">
                                                            <td></td>
                                                            <td>
                                                                Fee Name
                                                            </td>
                                                            <td>
                                                                Type
                                                            </td>
                                                            <td style="width:50px;">
                                                                Amount
                                                            </td>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <input type="button" name="btnAddDistributionFeeSave" onclick="btnAddDistributionFeeSaveOnClick()" value="Add" class="btn btn-primary input-sm pull-right" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>

    <div class="modal fade custom-model custom-form-design" id="CIDmodal_service" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Contract Detail Service
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px">
                    <div style="max-width: 98%;margin: 0px auto;">
                        <div class="custom-form portlet light">
                            <div class="portlet-body form">
                                <div class="form-body-outer" style="padding: 0px;">
                                    <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleMonday" class="i-checks editcheck">Monday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleTuesday" class="i-checks editcheck">Tuesday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleWednesday" class="i-checks editcheck">Wednesday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleThursday" class="i-checks editcheck">Thursday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleFriday" class="i-checks editcheck">Friday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleSaturday" class="i-checks editcheck">Saturday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-4">
                                            </label>
                                            <div class="col-md-3">
                                                <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                    <input type="checkbox" id="cid_chkScheduleSunday" class="i-checks editcheck">Sunday
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <input id="CustomerIncreaseDecreaseDetail_FindersFeeAdjustmentCount" name="CustomerIncreaseDecreaseDetail_FindersFeeAdjustmentCount" type="hidden" value="0" />

    <input id="CustomerDistributionDetail_FeeString" name="CustomerDistributionDetail_FeeString" type="hidden" value="" />
    <input id="FranchiseeDistributionDetail_String" name="FranchiseeDistributionDetail_String" type="hidden" value="" />

    if (ViewBag.CallFrom != "RO" && ViewBag.CallFrom != "AO" && ViewBag.CallFrom != "CD")
    {
        <div class="modal fade in" id="modal_FeeFinderdetailResult" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
            <div class="modal-dialog modal-lg" style="width: 1000px;">
                <div class="modal-content" style="border-radius: 8px;">
                    <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                        <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                            Finders Fee
                            @Html.HiddenFor(one => one.FindersFee.FindersFeeId)
                            @Html.HiddenFor(one => one.FindersFee.FranchiseeId)
                            @Html.HiddenFor(one => one.FindersFee.CustomerId)
                        </h4>
                    </div>
                    <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                        <div class="form-body" style="padding-top: 0px;">
                            <div class="form-group">
                                <div class="row" style="padding-bottom: 0px;">
                                    <div class="col-md-12">
                                        <div class="col-md-3 control-label" style="padding-top: 0px;">
                                            <span><b>Franchisee No<span style="color:#000000;">&nbsp;:</span></b></span>
                                        </div>
                                        <div class="col-md-2" style="padding-left:0px;">
                                            <span><b>@Model.CustomerDetail.FranchiseeNo</b></span>
                                        </div>
                                        <div class="col-md-2">
                                        </div>
                                        <div class="col-md-2 control-label" style="padding-top: 0px;">
                                            <span><b>Customer No<span style="color:#000000;">&nbsp;:</span></b></span>
                                        </div>
                                        <div class="col-md-3" style="padding-left:0px;">
                                            <span><b>@Model.CustomerDetail.CustomerNo</b></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="padding-top: 0px;padding-bottom: 0px;">
                                    <div class="col-md-12">
                                        <div class="col-md-3 control-label" style="padding-top: 0px;">
                                        </div>
                                        <div class="col-md-3" style="padding-left: 0px;">
                                            <span>@Model.CustomerDetail.FranchiseeName <br />@Model.CustomerDetail.F_Address<br />@Model.CustomerDetail.F_City, @Model.CustomerDetail.F_StateName @Model.CustomerDetail.F_PostalCode</span>
                                        </div>
                                        <div class="col-md-1">
                                        </div>
                                        <div class="col-md-2 control-label">
                                        </div>
                                        <div class="col-md-3" style="padding-left:0px;">
                                            <span>@Model.CustomerDetail.CustomerName <br />@Model.CustomerDetail.C_Address<br />@Model.CustomerDetail.C_City, @Model.CustomerDetail.C_StateName @Model.CustomerDetail.C_PostalCode</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row" style="padding-top: 0px;padding-bottom: 0px;">
                                    <div class="col-md-1"></div>
                                    <div class="col-md-10 text-left" style="background: #99a2a2;color: #fff;font-size: 16px;">
                                        Finder Fee Information
                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-2 control-label" style="padding-left: 0px;padding-right: 0px;">
                                            Start Date<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2">
                                            @Html.TextBoxFor(one => one.FindersFee.StartDate, "{0:MM/dd/yyyy}", new { @class = "form-control input-sm  edit-txtbx date-picker ", required = "required" })
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="col-md-2 control-label">
                                            Description<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-9">
                                            @Html.TextBoxFor(one => one.FindersFee.Description, new { @class = "form-control input-sm  edit-txtbx", @value = "Finder Fees on Contract Billing", required = "required" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row" style="padding-top: 0px;padding-bottom: 0px;">
                                    <div class="col-md-1"></div>
                                    <div class="col-md-10 text-left" style="background: #99a2a2;color: #fff;font-size: 16px;">
                                        Finder Fee Calculation Information
                                    </div>
                                    <div class="col-md-1"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-2 control-label">
                                            Adjustment:<span style="color:#000000;">&nbsp;:</span>
                                            <br /><a style="margin-right: 4px;" href="javascript:void(0);" onclick="AppendNewFinderAdjestment(@Model.FindersFee.FindersFeeId,0)">+ Add</a>
                                        </div>
                                        <div class="col-md-9">
                                            <table class="table table-striped table-bordered table-hover order-column" id="tblNewFindersFeeAdjustment">
                                                <thead>
                                                    <tr>
                                                        <th class="text-center" style="width:150px;">
                                                            Type
                                                        </th>
                                                        <th class="text-center">
                                                            Description
                                                        </th>
                                                        <th class="text-center" style="width:100px;">
                                                            Amount
                                                        </th>
                                                        <th class="text-center" style="width:50px;">
                                                            Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @for (int b = 0; b < Model.lstFindersFeeAdjustment.Where(o => o.FindersFeeId == Model.FindersFee.FindersFeeId).ToList().Count; b++)
                                                    {
                                                        <tr>
                                                            <td>
                                                                @Html.HiddenFor(m => m.lstFindersFeeAdjustment[b].FindersFeeAdjustmentId)
                                                                @Html.HiddenFor(m => m.lstFindersFeeAdjustment[b].FranchiseeId)
                                                                @Html.HiddenFor(m => m.lstFindersFeeAdjustment[b].FindersFeeId)
                                                                @Html.DropDownListFor(m => m.lstFindersFeeAdjustment[b].FindersFeeAdjustmentTypeListId, (SelectList)ViewBag.FindersFeeAdjustmentTypeList, "Select", new { @class = "form-control input-sm" })
                                                            </td>
                                                            <td>@Html.TextBoxFor(o => o.lstFindersFeeAdjustment[b].Description, new { @class = "form-control input-sm", @style = "width:100%;" })</td>
                                                            <td>@Html.TextBoxFor(o => o.lstFindersFeeAdjustment[b].Amount, new { @class = "form-control input-sm", @style = "width:100px;" })</td>
                                                            <td></td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>


                                    <div class="col-md-12">
                                        <div class="col-md-1 control-label"></div>
                                        <div class="col-md-2 control-label">
                                            Note<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-8">
                                            @Html.TextBoxFor(one => one.FindersFee.Notes, new { @class = "form-control input-sm edit-txtbx" })
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="form-actions">
                        <div class="col-md-12" style="padding-right: 28px;">
                            <input type="button" id="SubmitFC_onClick" value="Submit" class="btn btn-primary col-md-2 pull-right" style="margin-left: 10px; " />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }


}

<div class="sweet-alert modal showSweetAlert visible" id="swtWarningAlertPopup" tabindex="-1" data-keyboard="false" style="display: none; margin-top: -149px; height: 250px;z-index: 15151;">
    <div class="sa-icon sa-error" style="display: none;">
        <span class="sa-x-mark">
            <span class="sa-line sa-left"></span>
            <span class="sa-line sa-right"></span>
        </span>
    </div><div class="sa-icon sa-warning" style="display: none;">
        <span class="sa-body"></span>
        <span class="sa-dot"></span>
    </div>  
    <h2 id="swtWarningAlertPopup_Title">Payment Approved!</h2>
    <p class="lead text-muted " style="display: block;" id="swtWarningAlertPopup_Message"></p>
    <div class="form-group">
        <input type="text" class="form-control" tabindex="3" placeholder="">
        <span class="sa-input-error help-block">
            <span class="glyphicon glyphicon-exclamation-sign"></span> <span class="sa-help-text">Not valid</span>
        </span>
    </div><div class="sa-button-container">
        <button class="cancel btn btn-lg btn-default" tabindex="2" style="display: none;">Cancel</button>
        <div class="sa-confirm-button-container">
            <button class="confirm btn btn-lg btn-primary" tabindex="1" style="display: inline-block;" id="btnswtWarningAlertOKPopup">OK</button><div class="la-ball-fall">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
</div>

<link href="~/Content/admin/assets/global/plugins/bootstrap-sweetalert/sweetalert.css" rel="stylesheet" />
<script src="~/Content/admin/assets/global/plugins/bootstrap-sweetalert/sweetalert.min.js"></script>

<script type="text/javascript">
    var lstContractDetailServiceTypeList = [];
    var lineNo = 0;
    var flineNo = 0;
    var typeaheadSource = [];
    var app = {};

    $(document).ready(function () {
        $('.date-picker').datepicker({ autoclose: true ,dateFormat: 'mm/dd/yy'});
        $('.date-picker').attr("placeholder","mm/dd/yyyy");
        $('#btnContractDetailSave').click(function () {

            var isvalid = true;

            if ($('#Contract_PurchaseOrderNo').val() == '') { $('#Contract_PurchaseOrderNo').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_PurchaseOrderNo').css('border-color', ''); }
            if ($('#AccountTypeList').val() == '') { $('#AccountTypeList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#AccountTypeList').css('border-color', ''); }

            if ($('#Contract_SignDate').val() == '') { $('#Contract_SignDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_SignDate').css('border-color', ''); }
            if ($('#Contract_StartDate').val() == '') { $('#Contract_StartDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_StartDate').css('border-color', ''); }

            //if ($('#Contract_ContractTermListId').val() == '') { $('#Contract_ContractTermListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_ContractTermListId').css('border-color', ''); }
            if ($('#Contract_ContractTermMonth').val() == '') { $('#Contract_ContractTermMonth').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_ContractTermMonth').css('border-color', ''); }
            if ($('#Contract_ExpirationDate').val() == '') { $('#Contract_ExpirationDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_ExpirationDate').css('border-color', ''); }

            if ($('#Contract_Amount').val() == '') { $('#Contract_Amount').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_Amount').css('border-color', ''); }
            if ($('#Contract_AmountSubjectToFee').val() == '') { $('#Contract_AmountSubjectToFee').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_AmountSubjectToFee').css('border-color', ''); }

            if ($('#Contract_StatusDate').val() == '') { $('#Contract_StatusDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_StatusDate').css('border-color', ''); }
            if ($('#Contract_ResumeDate').val() == '') { $('#Contract_ResumeDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_ResumeDate').css('border-color', ''); }
            if ($('#Contract_AmountSubjectToFee').val() == '') { $('#Contract_AmountSubjectToFee').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#Contract_AmountSubjectToFee').css('border-color', ''); }

            if (isvalid == true) {
                $("#SaveCustomerContractform_wizard_1").submit();
            }
        });


        $.ajax({
            type: "GET",
            url: '@Url.Action("Frenchiseedata", "AccountReceivable", new { area = "Portal" })',
            success: function (data) {
                custlist = data;
                var typeaheadSource = [];
                $.each(custlist, function (key, value) {
                    typeaheadSource.push({ id: value.FranchiseeId, name: value.FranchiseeNo + ' ' + $.trim(value.Name),FranchiseeNo:value.FranchiseeNo })
                });

                $('#FD_frenchiseesearchbox').typeahead({
                    source: typeaheadSource,
                    updater: function (item) {
                        $("#hdfFrenchiseeId").val(item.id);

                        if (($('#FD_ddldetaillinenumber').val() != "Select") && ($('#FD_ddldetaillinenumber').val() != "0")) {
                            //bindfranchiseedetail($('#FD_ddldetaillinenumber').val(), item.id, item.name, item.FranchiseeNo, $("#FD_ddldetaillinenumber option[value=" + $('#FD_ddldetaillinenumber').val() + "]").text(), data.Amount,0);

                            if ($.trim($('#FD_ddldetaillinenumber').val()) == "-1") {
                                $("#FD_ddldetaillinenumber>option").each(function () {
                                    if ($.trim($(this).val()) != "" && $.trim($(this).val()) != "0" && $.trim($(this).val()) != "-1") {
                                        bindfranchiseedetail($.trim($(this).val()), item.id, item.name, item.FranchiseeNo, $.trim($(this).text()), data.Amount,0);
                                    }
                                });
                            }else{
                                bindfranchiseedetail($('#FD_ddldetaillinenumber').val(), item.id, item.name, item.FranchiseeNo, $("#FD_ddldetaillinenumber option[value=" + $('#FD_ddldetaillinenumber').val() + "]").text(), data.Amount,0);
                            }
                            return item;
                        }else {
                            //swal({ title: "Please slect a line.", text: "", type: "warning" });
                            alertMsg("", "Please slect a line.");
                            return '';
                        }

                    }

                });
            }
        });




        GetFindersFeeScheduleList();
        maskCurrency('FranchiseeDistribution_Amount');
        FranchiseeDistributionData(@Model.CustomerDetail.CustomerId);
    });



    function ShowAddNEwFeeFinder() {
        if (!TransferValidateStepFirst()) {
            return;
        }
        var _FindersFeeTypeListId = $("#FindersFee_FindersFeeTypeListId").val();


        $('#FindersFee_StartDate').val('@String.Format("{0:MM/dd/yyyy}", Model.CustomerDetail.StartDate)');
        $('#FindersFee_ContractBillingAmount').val(@Model.CustomerDetail.TotalAmount);

        $('#FindersFee_MultiTenantOccupancyAmount').prop('readonly', true);
        if (_FindersFeeTypeListId == 9 || _FindersFeeTypeListId == 2 || _FindersFeeTypeListId == 7 || _FindersFeeTypeListId == 3 || _FindersFeeTypeListId == 4) {
            $('#FindersFee_MultiTenantOccupancyAmount').prop('readonly', false);
        }
        $("#modal_FeeFinderdetailResult").modal({ backdrop: 'static' });
    }

    function CIDFranchiseeservice(mo, tu, we, th, fr, sa, su) {

        $("#cid_chkScheduleMonday").prop('checked', false);
        $("#cid_chkScheduleTuesday").prop('checked', false);
        $("#cid_chkScheduleWednesday").prop('checked', false);
        $("#cid_chkScheduleThursday").prop('checked', false);
        $("#cid_chkScheduleFriday").prop('checked', false);
        $("#cid_chkScheduleSaturday").prop('checked', false);
        $("#cid_chkScheduleSunday").prop('checked', false);


        $("#cid_chkScheduleMonday").prop('checked', mo);

        $("#cid_chkScheduleTuesday").prop('checked', tu);

        $("#cid_chkScheduleWednesday").prop('checked', we);

        $("#cid_chkScheduleThursday").prop('checked', th);

        $("#cid_chkScheduleFriday").prop('checked', fr);

        $("#cid_chkScheduleSaturday").prop('checked', sa);

        $("#cid_chkScheduleSunday").prop('checked', su);

        $("#CIDmodal_service").modal({ backdrop: 'static' });
    }

    $(function () {
        window.AddContractDetailDescriptionModal = function (ContractDetailId, i) {
            $.blockUI({
                //baseZ: 99999,
                //message: '<center><img height: src="/Images/loading_icon.gif" /><h3> <b>Processing....</br> Please wait! and do not refresh page.</b></h3></center>',
                //css: { backgroundColor: 'rgb{0,0,0}', border: '0', color: '#fff', "z-index": 99999 }
            });
            var ContractId = 0;
            if ($('#CustomerIncreaseDecreaseDetail_ContractId').val() != "") {
                ContractId = $('#CustomerIncreaseDecreaseDetail_ContractId').val();
            }
            if ($('#CustomerIncreaseDecreaseDetail_ContractId').val() != 0) {
                ContractId = $('#CustomerIncreaseDecreaseDetail_ContractId').val();
            }
            else {
                //swal(
                //    'Oops...',
                //    'Save Customer Contract First, Before add Contract Detail!',
                //    'warning'
                //)
                alertMsg('Oops...','Save Customer Contract First, Before add Contract Detail!');
            }


            $('#lstContractDetail_' + i + '__StartTime').timepicker({ timeFormat: 'h:mm:ss p' });
            $('#lstContractDetail_' + i + '__EndTime').timepicker({ timeFormat: 'h:mm:ss p' });

            $('#lstContractDetail_' + i + '__CleanFrequencyListId').on('change', function () {
                if (this.value == '1') {
                    $('#lstContractDetail_' + i + '__Mon').removeAttr('checked');
                    $('#lstContractDetail_' + i + '__Tues').removeAttr('checked');
                    $('#lstContractDetail_' + i + '__Wed').removeAttr('checked');
                    $('#lstContractDetail_' + i + '__Thur').removeAttr('checked');
                    $('#lstContractDetail_' + i + '__Fri').removeAttr('checked');
                    $('#lstContractDetail_' + i + '__Sat').removeAttr('checked');
                    $('#lstContractDetail_' + i + '__Sun').removeAttr('checked');
                    $("#divweek" + ContractDetailId).show();
                }
                else {
                    $("#divweek" + ContractDetailId).hide();
                }
            });

            if (ContractId > 0 && ContractDetailId > 0) {
                $('#modalDataCusContractPopup' + ContractDetailId).modal();
            }
            else if (ContractId > 0) {
                $('#modalDataCusContractPopup' + ContractDetailId).modal();
            }


            var __ContractDetailCount = parseInt($('#CustomerIncreaseDecreaseDetail_ContractDetailCount').val());
            var __FranchiseeDistributionCount = parseInt($('#CustomerIncreaseDecreaseDetail_FranchiseeDistributionCount').val());

            if (__ContractDetailCount == 1) {
                $('#lstContractDetail_0__Amount').val($('#CustomerIncreaseDecreaseDetail_TotalAmount').val());

            }
            if (__FranchiseeDistributionCount == 1) {
                $('#lstFranchiseeDistribution_0__Amount').val($('#CustomerIncreaseDecreaseDetail_TotalAmount').val());

            }

            $('#DFCustomerIncreaseDecreaseDetail_ContractExpirationDate').text($('#CustomerIncreaseDecreaseDetail_ExpirationDate').val());
            $('#DFCustomerIncreaseDecreaseDetail_ContractTotalAmount').text($('#CustomerIncreaseDecreaseDetail_TotalAmount').val());






            $.unblockUI();
        }
    });

    function IncreaseDistribution() {

        $('#modal_CIDFranchiseeDistribution').modal({ backdrop: 'static' });
    }

    var _FFSchedule = [];
    function GetFindersFeeScheduleList() {
        $.ajax({
            type: "get",
            url: '@Url.Action("GetFindersFeeScheduleList", "Customer",new {area ="Portal" })',
            success: function (response) {
                _FFSchedule = response;
                GetFindersFeeScheduleCalculation();

                $('#CustomerDetail_EffectiveDate').datepicker("setDate", new Date());
                for (var i = 0; i < 10; i++) {
                    if ($('#lstFranchiseeDistribution_' + i + '__Amount').length > 0) {
                        maskCurrency('lstFranchiseeDistribution_' + i + '__Amount');
                    }
                    else
                        break;

                }
            },
            error: function (data) {
                console.log(data);
            }
        });
    }




    function GetFindersFeeScheduleCalculation() {
        var _AdjustmentAmount = parseFloat($("#FindersFee_TotalAdjustmentAmount").val() != '' ? $("#FindersFee_TotalAdjustmentAmount").val() : 0);
        var _BillingAmount = parseFloat($("#FranchiseeDistribution_Amount").val() != '' ? $("#FranchiseeDistribution_Amount").val() : 0);
        $("#FindersFee_ContractBillingAmount").val(_BillingAmount);
        $("#FindersFee_TotalAdjustmentAmount").val(_AdjustmentAmount);
        $("#FindersFee_PayableOnAmount").val(_BillingAmount - _AdjustmentAmount);

        maskCurrency('FindersFee_ContractBillingAmount');
        maskCurrency('FindersFee_TotalAdjustmentAmount');
        maskCurrency('FindersFee_PayableOnAmount');
    }

    function RemoveContractDetail(ContractDetailId, ContractId) {
        $.blockUI({
            baseZ: 99999,
            message: '<center><img height: src="/Images/loading_icon.gif" /><h3> <b>Processing....</br> Please wait! and do not refresh page.</b></h3></center>',
            css: { backgroundColor: 'rgb{0,0,0}', border: '0', color: '#fff', "z-index": 99999 }
        });
        $.ajax({
            type: "post",
            url: '@Url.Action("RemoveContractDetail", "Customer")',
            ajaxasync: true,
            data: { ContractDetailId: ContractDetailId, ContarctId: ContractId },
            success: function (response) {
                loadOwners(response.id);

                $.unblockUI();
            },
            error: function (data) {
                $.unblockUI();
            }
        })
        $.unblockUI();
    }

    function loadOwners(id) {
        $.blockUI({
            baseZ: 99999,
            message: '<center><img height: src="/Images/loading_icon.gif" /><h3> <b>Processing....</br> Please wait! and do not refresh page.</b></h3></center>',
            css: { backgroundColor: 'rgb{0,0,0}', border: '0', color: '#fff', "z-index": 99999 }
        });

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetContractDetail", "Customer", new { @area = "Portal" })?id=' + id,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (response) {
                $('#tblContractDescriptionData').html(response);
                $.unblockUI();
            },
            error: function (xhr, textStatus, error) {
                if (typeof console == "object") {

                    $('#tblContractDescriptionData').html(xhr.responseText);
                    console.log(xhr.status + "," + xhr.responseText + "," + textStatus + "," + error);
                }
                $.unblockUI();
            }
        });
        $.unblockUI();
    }

    $("#CustomerIncreaseDecreaseDetail_ContractTermMonth").change(function () {

        var monthadd = $("#CustomerIncreaseDecreaseDetail_ContractTermMonth").val();
        var startdate = $("#CustomerIncreaseDecreaseDetail_StartDate").val();
        var contractstartdate = new Date(startdate);

        if (monthadd == "")
            monthadd = 0;

        contractstartdate.setMonth(contractstartdate.getMonth() + parseInt(monthadd));
        var c = (contractstartdate.getMonth() + 1) + '/' + contractstartdate.getDate() + '/' + contractstartdate.getFullYear()
        $("#CustomerIncreaseDecreaseDetail_ExpirationDate").val(c);

    });

    $("#FindersFee_FindersFeeTypeListId").change(function () {

        var _FindersFeeTypeListId = $("#FindersFee_FindersFeeTypeListId").val();

        $('#FindersFee_MultiTenantOccupancyAmount').prop('readonly', true);
        if (_FindersFeeTypeListId == 9 || _FindersFeeTypeListId == 2 || _FindersFeeTypeListId == 7 || _FindersFeeTypeListId == 3 || _FindersFeeTypeListId == 4) {
            $('#FindersFee_MultiTenantOccupancyAmount').prop('readonly', false);
        } else { $("#FindersFee_MultiTenantOccupancyAmount").val(0)}

        $.each(_FFSchedule, function (index, item) {
            if (item.FindersFeeTypeListId == parseInt(_FindersFeeTypeListId)) {

                var _AdjustmentAmount = parseFloat($("#FindersFee_TotalAdjustmentAmount").val() != '' ? $("#FindersFee_TotalAdjustmentAmount").val() : 0);
                var _BillingAmount = parseFloat($("#FindersFee_ContractBillingAmount").val() != '' ? $("#FindersFee_ContractBillingAmount").val() : 0);

                $("#FindersFee_TotalAdjustmentAmount").val(_AdjustmentAmount);
                $("#FindersFee_PayableOnAmount").val(_BillingAmount - _AdjustmentAmount);
                var _Payable = parseFloat($("#FindersFee_PayableOnAmount").val())

                if (_Payable >= item.StartAmount && _Payable <= item.EndAmount) {
                    $("#FindersFee_Factor").val(item.Factor);
                    $("#FindersFee_DownPayPercentage").val(item.DownPayPercentage);
                    $("#FindersFee_DownPaymentAmount").val((item.DownPayPercentage * _Payable / 100).toFixed(2));
                    $("#FindersFee_MonthlyPaymentPercentage").val(item.MonthlyPercentage);
                    $("#FindersFee_MonthlyPaymentAmount").val((item.MonthlyPercentage * _Payable / 100).toFixed(2));
                    $("#FindersFee_TotalNumOfpayments").val(item.NumOfPayments);

                    $("#FindersFee_FinancedAmount").val((item.MonthlyPercentage * _Payable / 100) * item.NumOfPayments);
                    $("#FindersFee_TotalAmount").val(((item.DownPayPercentage * _Payable / 100) + ((item.MonthlyPercentage * _Payable / 100) * item.NumOfPayments)).toFixed(2));

                    maskCurrency('FindersFee_DownPaymentAmount');
                    maskCurrency('FindersFee_MonthlyPaymentAmount');
                    maskCurrency('FindersFee_FinancedAmount');
                    maskCurrency('FindersFee_TotalAmount');
                    maskCurrency('FindersFee_MultiTenantOccupancyAmount');

                    maskPercentage('FindersFee_DownPayPercentage');
                    maskPercentage('FindersFee_MonthlyPaymentPercentage');

                }
            }
        });
    });

    $("#FindersFee_DownPayPercentage").change(function () {
        CalculateFindersFee();
    });
    $("#FindersFee_MonthlyPaymentPercentage").change(function () {
        CalculateFindersFee();
    });
    $("#FindersFee_TotalNumOfpayments").change(function () {
        CalculateFindersFee();
    });
    $("#FindersFee_MultiTenantOccupancyAmount").change(function () {
        CalculateFindersFee();
    });
    $("#FindersFee_ContractBillingAmount").change(function () {
        var _FindersFeeTypeListId = $("#FindersFee_FindersFeeTypeListId").val();
        var ctTemp = 0;
        var _this = this;
        $.each(_FFSchedule, function (index, item) {
            ctTemp++;
            if (item.FindersFeeTypeListId == parseInt(_FindersFeeTypeListId)) {
                var _Payable = parseFloat(_this.value);//parseFloat($("#FindersFee_PayableOnAmount").val())

                if (_Payable >= item.StartAmount && _Payable <= item.EndAmount) {
                 
                    $("#FindersFee_Factor").val(item.Factor);
                    $("#FindersFee_DownPayPercentage").val(item.DownPayPercentage);
                    $("#FindersFee_DownPaymentAmount").val((item.DownPayPercentage * _Payable / 100).toFixed(2));
                    $("#FindersFee_MonthlyPaymentPercentage").val(item.MonthlyPercentage);
                    $("#FindersFee_MonthlyPaymentAmount").val((item.MonthlyPercentage * _Payable / 100).toFixed(2));
                    $("#FindersFee_TotalNumOfpayments").val(item.NumOfPayments);

                    $("#FindersFee_FinancedAmount").val((item.MonthlyPercentage * _Payable / 100) * item.NumOfPayments);
                    $("#FindersFee_TotalAmount").val(((item.DownPayPercentage * _Payable / 100) + ((item.MonthlyPercentage * _Payable / 100) * item.NumOfPayments)).toFixed(2));

                    maskCurrency('FindersFee_DownPaymentAmount');
                    maskCurrency('FindersFee_MonthlyPaymentAmount');
                    maskCurrency('FindersFee_FinancedAmount');
                    maskCurrency('FindersFee_TotalAmount');
                    maskCurrency('FindersFee_MultiTenantOccupancyAmount');

                    maskPercentage('FindersFee_DownPayPercentage');
                    maskPercentage('FindersFee_MonthlyPaymentPercentage');

                }
            }

            if (ctTemp == _FFSchedule.length) {
              
                setTimeout(CalculateFindersFee(), 100);
            }

        });



    });
    function CalculateFindersFee() {
        _Factor = $("#FindersFee_Factor").val();
        var _FindersFeeTypeListId = $("#FindersFee_FindersFeeTypeListId").val();
        _ContractBillingAmount = $("#FindersFee_ContractBillingAmount").val() != '' ? $("#FindersFee_ContractBillingAmount").val() : 0;
        _TotalAdjustmentAmount = $("#FindersFee_TotalAdjustmentAmount").val() != '' ? $("#FindersFee_TotalAdjustmentAmount").val() : 0;
        var _FindersFee_MultiTenantOccupancyAmount = $("#FindersFee_MultiTenantOccupancyAmount").val() != '' ? parseFloat($("#FindersFee_MultiTenantOccupancyAmount").val()) : 0;
        if (_FindersFeeTypeListId == 9 || _FindersFeeTypeListId == 2 || _FindersFeeTypeListId == 7 || _FindersFeeTypeListId == 3 || _FindersFeeTypeListId == 4) {
            _DownPayPercentage = parseFloat($("#FindersFee_DownPayPercentage").val() != '' ? $("#FindersFee_DownPayPercentage").val() : 0);
            _MonthlyPaymentPercentage = parseFloat($("#FindersFee_MonthlyPaymentPercentage").val() != '' ? $("#FindersFee_MonthlyPaymentPercentage").val() : 0);

            var _amtMT = _FindersFee_MultiTenantOccupancyAmount * 3;

            _PayableOnAmount = parseFloat($("#FindersFee_PayableOnAmount").val());


            _DownPayPercentage = parseFloat($("#FindersFee_DownPayPercentage").val() != '' ? $("#FindersFee_DownPayPercentage").val() : 0);
            $("#FindersFee_DownPaymentAmount").val((_PayableOnAmount * _DownPayPercentage / 100).toFixed(2));

            _MonthlyPaymentPercentage = parseFloat($("#FindersFee_MonthlyPaymentPercentage").val() != '' ? $("#FindersFee_MonthlyPaymentPercentage").val() : 0);
            $("#FindersFee_MonthlyPaymentAmount").val((_PayableOnAmount * _MonthlyPaymentPercentage / 100).toFixed(2));

            _TotalNumOfpayments = parseInt($("#FindersFee_TotalNumOfpayments").val() != '' ? $("#FindersFee_TotalNumOfpayments").val() : 0);

            $("#FindersFee_FinancedAmount").val((_amtMT).toFixed(2));
            $("#FindersFee_TotalAmount").val(((_PayableOnAmount * _DownPayPercentage / 100) + _amtMT).toFixed(2));



        } else {
            _PayableOnAmount = parseFloat($("#FindersFee_PayableOnAmount").val());

            _DownPayPercentage = parseFloat($("#FindersFee_DownPayPercentage").val() != '' ? $("#FindersFee_DownPayPercentage").val() : 0);
            $("#FindersFee_DownPaymentAmount").val((_PayableOnAmount * _DownPayPercentage / 100).toFixed(2));

            _MonthlyPaymentPercentage = parseFloat($("#FindersFee_MonthlyPaymentPercentage").val() != '' ? $("#FindersFee_MonthlyPaymentPercentage").val() : 0);
            $("#FindersFee_MonthlyPaymentAmount").val((_PayableOnAmount * _MonthlyPaymentPercentage / 100).toFixed(2));

            _TotalNumOfpayments = parseInt($("#FindersFee_TotalNumOfpayments").val() != '' ? $("#FindersFee_TotalNumOfpayments").val() : 0);

            $("#FindersFee_FinancedAmount").val(((_PayableOnAmount * _MonthlyPaymentPercentage / 100) * _TotalNumOfpayments).toFixed(2));
            $("#FindersFee_TotalAmount").val(((_PayableOnAmount * _DownPayPercentage / 100) + ((_PayableOnAmount * _MonthlyPaymentPercentage / 100) * _TotalNumOfpayments)).toFixed(2));
        }
    }

    function RemoveFindersFeeAdjustmentRow(item) {
        console.log(item)
        $('tr[rel="' + item + '"]').remove()
    }

    var FindersFeeAdjustmentRowCount = 0;
    function AppendNewFinderAdjestment(ffID, i) {
        FindersFeeAdjustmentRowCount++;
        var rFFA = "";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetFindersFeeAdjustmentList", "Customer", new { @area = "Portal" })',
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (response) {

                rFFA += '<tr rel="trFindersFeeAdjustment_' + ffID + '"><td><select id="txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Adjustment" name="txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Adjustment" class="form-control input-sm">';
                rFFA += "<option value=" + 0 + ">" + "Select" + "</option>";
                for (var i = 0; i < response.length; i++) {
                    rFFA += "<option value=" + response[i].Value + ">" + $.trim(response[i].Text) + "</option>";
                }
                rFFA += '</select>';

                rFFA += '<td><input type="text" id="txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Description" name="txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Description" value="" class="form-control input-sm" /></td>';
                rFFA += '<td><input type="text" id="txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Amount" name="txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Amount" value="" class="form-control input-sm"/></td>';
                rFFA += '<td style="text-align:center;"><a style="font-size: 16px;padding: 3px;color: mediumvioletred;" href="#" onclick="RemoveFindersFeeAdjustmentRow(\'trFindersFeeAdjustment_' + ffID +'\')"><i class="fa fa-trash" aria-hidden="true"></i></a></td>';


                rFFA += '</tr>';
                rFFA += '</tr>';



                $('#tblNewFindersFeeAdjustment').append(rFFA);

                maskCurrency('txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Amount');

                $('#txtFindersFeeAdjustment_' + ffID + '_' + FindersFeeAdjustmentRowCount + '_Amount').change(function () {

                    var amt = 0.00;
                    for (var j = 1; j <= FindersFeeAdjustmentRowCount; j++) {
                        if ($.trim($('#txtFindersFeeAdjustment_' + ffID + '_' + j + '_Amount').val()) != '')
                            amt += parseFloat($('#txtFindersFeeAdjustment_' + ffID + '_' + j + '_Amount').val());
                    }
                    $("#FindersFee_TotalAdjustmentAmount").val(amt);
                    $("#FindersFee_PayableOnAmount").val((parseFloat($('#FindersFee_ContractBillingAmount').val()) - amt).toFixed(2));
                    //GetFindersFeeScheduleCalculation();
                    CalculateFindersFee();
                });
            }
        });
        $("#CustomerIncreaseDecreaseDetail_FindersFeeAdjustmentCount").val(FindersFeeAdjustmentRowCount);
    }


    /********************************************************************************************************************************************/
    /********************************************************************************************************************************************/

    function bindfranchiseedetail(linenumber, franchiseeid, franchiseename, franchiseeno, ln, Amount,DistributionId) {
       


        flineNo++;
        //var txtmarkup = parseFloat($('#txtmarkup' + linenumber).val() == '' ? 0 : $('#txtmarkup' + linenumber).val())
        var txtqty = isNaN($('#txtqty' + linenumber).val()) ? parseFloat(0.00) :  parseFloat($('#txtqty' + linenumber).val());
        var txtunitprice = isNaN($('#txtunitprice' + linenumber).val()) ?  parseFloat(0.00) : parseFloat($('#txtunitprice' + linenumber).inputmask('unmaskedvalue') == '' ? 0 : $('#txtunitprice' + linenumber).inputmask('unmaskedvalue'));
        var txttotal = parseFloat(txtqty * txtunitprice);
        var customerId = $('#CustomerDetail_CustomerId').val();
        var contractId = $('#CustomerDetail_ContractId').val();

        FDistributionFinal.push({ FranchiseeId: franchiseeid, Amount: Amount, CustomerId: customerId, ContractId: contractId, ContractDetailId: linenumber, DetailLineNumber: ln, FranchiseeName: franchiseename, FranchiseeNo: franchiseeno })
        var lineTotalAmount = 0;
        $('input[relLinea="' + linenumber + '"]').each(function (el) {
            lineTotalAmount += parseFloat(this.defaultValue);
        });
        if (lineTotalAmount + txttotal > txttotal) {
            if (lineTotalAmount < txttotal) {
                txttotal = parseFloat(txttotal - lineTotalAmount);
            }
            else {
                txttotal = parseFloat(0.00);
            }
        }
        var someString = '';
        var index = 0;  // Gets the first index where a space occours
        var FranchiseeNo = ''; // Gets the first part


        if ($('#hdfCustomerDetailCallFrom').val() == "RO" || $('#hdfCustomerDetailCallFrom').val() == "AO" || $('#hdfCustomerDetailCallFrom').val() == "CD") {
            someString = franchiseename;
            index = someString.indexOf(" ");  // Gets the first index where a space occours
            FranchiseeNo = franchiseeno; // Gets the first part
            franchiseename = franchiseename;

            AppendDistribution(ln, franchiseeid, FranchiseeNo, franchiseename, Amount, linenumber, DistributionId);
        } else {
            someString = franchiseename;
            index = someString.indexOf(" ");  // Gets the first index where a space occours
            FranchiseeNo = someString.substr(0, index); // Gets the first part
            franchiseename = someString.substr(index + 1);

            AppendDistribution(ln, franchiseeid, FranchiseeNo, franchiseename, txttotal, linenumber, 0);
        }
        if($("#FD_hdfFranchiseeDistributionCallFrom").val() =="CD")
        {
            $(".clsdistview").html("View");            
            //$(".clscntl").attr("disabled", "disabled");
            //$(".clsdel").hide();

        }
        else
        {
            $(".clsdistview").html("View/Edit");            
            //$(".clscntl").removeAttr("disabled");
            //$(".clsdel").show();            
        }

        setTimeout(function () {
            $("#hdfFrenchiseeId").val(0);
            document.getElementById('FD_ddldetaillinenumber').selectedIndex = 0;
            $('#FD_frenchiseesearchbox').val('');
        }, 500);
    }



    $('#FD_frenchiseesearchbox').keypress(function (event) {

        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == '13') {
            $(this).typeahead('val', '');
            $("#FD_ddldetaillinenumber").val('')
        }
    });

    var FDistributionFinal = [];

    var tempRowDistribution = "";
    var tempRowLineNo = 0;
    var tempFRowLineNo = 0;
    var lineitems =[];
    var lineItemCombo=[];
    function FranchiseeDistributionData(id) {
       
        $('#hdffrenchiseedetail_customerid').val(id);
        var sURL = '@Url.Action("GetCustomerFranchiseeDistributionData", "Customer", new { area = "Portal" })?Id=' + id;
        $.ajax({
            type: "GET",
            url: sURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
              
                $('#hdfdistributioncustomerid').val(data.CustomerId);
                $('#spnCustomerName').html(data.CustomerName);
                $('#spnCustomerNo').html(data.CustomerNo);
                $('#tblFranchiseeDistributionList>tbody').html('');
                $('#hdfcontractAmount').val(data.TotalAmount);
                $("#CustomerDetail_EffectiveDate").val(formatJSONDateUtc(data.StartDate));

                tempRow = "";
                tempRow += '<tr><td style="width:90px;text-align:center;">' + data.PONumber + '</td>';
                tempRow += '<td style="text-align:left;width:120px;">' + data.AccountTypeName + '</td>';
                tempRow += '<td style="text-align:center;width:30px;">' + data.Term + '</td>';
                tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDateUtc(data.StartDate) + '</td>';
                tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDateUtc(data.ExpirationDate) + '</td>';
                tempRow += '<td style="text-align:right;width:30px;"><span>' + formatCurrency(data.TotalAmount) + '</span></td>';
                tempRow += '<td style="text-align:center;width:80px;">' + data.Status + '</td>';

                tempRow += '<tr><td colspan="7" style="padding:5px;"><div class="table-responsive">';
                tempRow += '<table class="table table-striped table-bordered table-hover order-column" id="FranchiseeDistributionDetailList">';
                tempRow += '<thead>';
                tempRow += '<tr><th style="width:150px;text-align:center;">Contract Detail Line</th>';
                tempRow += '<th style="text-align:center;"> Service Description</th>';
                tempRow += '<th style="width:120px;text-align:center;">Amount</th>';
                tempRow += '<th style="width:100px;text-align:center;">Frequency</th>';
                tempRow += '<th style="width:50px;text-align:center;">Schedule</th>';
                tempRow += '</tr></thead><tbody></tbody></table></div></td></tr>';


                $('#tblFranchiseeDistributionList>tbody').append(tempRow);
                $('#FD_ddldetaillinenumber').html('');
                lineitems = []; lineitems.push("<option value='0'>Select</option>");

                var isMany=false;
                if(data.listContractDetail.length>1)
                {
                    isMany=true;
                }

                $.each(data.listContractDetail, function (index, value) {
                    tempRowLineNo = value.LineNumber;
                    tempRowDistribution = "";
                    tempRowDistribution += '<tr>'
                    tempRowDistribution += '<td style="text-align:center;"><input type="hidden" relcdamt="cd_relcdamt" id="cd_relcdamt' + tempRowLineNo + '" value="' + value.Amount + '" />'
                    tempRowDistribution += value.LineNumber + '</td>';
                    tempRowDistribution += '<td style="text-align:center;">' + value.ServiceTypeName + '</td>';
                    tempRowDistribution += '<td style="text-align:right;"><input type="text" value="' +   formatCurrency(value.Amount) + '" class="form-control input-sm editvalue" style="text-align:right;" readonly="readonly"/></td>';
                    tempRowDistribution += '<td style="text-align:center;">' + value.CleanFrequencyName + '</td>';
                    tempRowDistribution += '<td style="text-align:center;"><a href="#" onclick="CIDFranchiseeservice(' + value.Mon + ',' + value.Tues + ',' + value.Wed + ',' + value.Thur + ',' + value.Fri + ',' + value.Sat + ',' + value.Sun + ')">View</a></td>'
                    tempRowDistribution += '</tr>'

                    $('#FranchiseeDistributionDetailList>tbody').append(tempRowDistribution);
                    if(isMany)
                    {
                        var newLineCombo1={
                            ContractDetailId:-1,
                            LineNumber:"All"
                        };
                        lineItemCombo.push(newLineCombo1);
                        lineitems.push("<option value='-1'>All</option>");
                        isMany=false;
                    }
                    var newLineCombo={
                        ContractDetailId:value.ContractDetailId,
                        LineNumber:value.LineNumber
                    };
                    lineItemCombo.push(newLineCombo);

                    lineitems.push("<option value=" + value.ContractDetailId + ">" + value.LineNumber + "</option>");

                    $('#FD_frdestributionTable>tbody').html('');
                    var flineNo = 0;
                    if(data.listFranchiseeDistribution.length == 0)
                    {
                        data.listFranchiseeDistribution.push({DetailLineNumber: value.LineNumber, FranchiseeId: $('#hdfSelectedFranchiseId').val(), FranchiseeNo:$('#CustomerDetail_FranchiseeNo').val(), FranchiseeName:$('#CustomerDetail_FranchiseeName').val(), Amount: value.Amount, ContractDetailId: value.ContractDetailId});
                    }
                    $.each(data.listFranchiseeDistribution, function (index, value) {

                        if ($('#hdfCustomerDetailCallFrom').val() == "RO" || $('#hdfCustomerDetailCallFrom').val() == "AO" || $('#hdfCustomerDetailCallFrom').val() == "CD" ) {
                            bindfranchiseedetail(value.ContractDetailId, value.FranchiseeId, value.FranchiseeName, value.FranchiseeNo, value.DetailLineNumber, value.Amount,value.DistributionId)
                            //TransferDistributionfee(value.FranchiseeId, value.ContractDetailId, value.DistributionId, value.DetailLineNumber, 0);
                        } else {
                            AppendDistribution(value.DetailLineNumber, value.FranchiseeId, value.FranchiseeNo, value.FranchiseeName, value.Amount, value.ContractDetailId, value.DistributionId);
                        }
                    }),

                    bindfrenchiseelistbox(tempRowLineNo);

                });

                $('#FD_ddldetaillinenumber').html(lineitems.join(' '));

                $("#hdfcontractdetail_linecount").val(tempRowLineNo);
                $("#hdffrenchiseedetail_linecount").val(tempFRowLineNo);

                $("#FD_modal_FranchiseeDistribution").modal({ backdrop: 'static' });
                //InItTransferDistributionfee();
            },
            error: function () {
                alert("Content load failed.");
            }
        });
    }

    function bindfrenchiseelistbox(lineno) {
        $("#FD_frenchiseesearchbox_" + lineno).autocomplete({
            source: typeaheadSource,
            appendTo: $("#tblFranchiseeDistributionList"),
            select: function (event, ui) {
                event.preventDefault();
                tempFRowLineNo++;
                tempRowDistribution = "";
                tempRowDistribution += '<tr><td style="width:20px;text-align:center;">'
                tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionFranchiseeId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionFranchiseeId_' + lineno + '_' + tempFRowLineNo + '" value="' + ui.item.value + '" />';
                tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionContractDetailId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionContractDetailId_' + lineno + '_' + tempFRowLineNo + '" value="' + $("#ContractDetailId_" + lineno).val() + '" />';
                tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionDetailId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionDetailId_' + lineno + '_' + tempFRowLineNo + '" value="' + ui.item.value + '" /><span>' + ui.item.label.split(' ')[0] + '</span></td>';
                tempRowDistribution += '<td style="text-align:center;width:242px;">' + ui.item.label.replace(ui.item.label.split(' ')[0], "").trim() + '</td>';
                tempRowDistribution += '<td style="text-align:center;width:30px;"><input type="text" rel="ContractDetailAmount_' + lineno + '" value="' + $("#ContractDetailAmount_" + lineno).val() + '" class="form-control input-sm editvalue" id="FranchiseeDistributionAmountId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionAmountId_' + lineno + '_' + tempFRowLineNo + '" style="margin-top:-6px;margin-bottom: -6px;" /></td>';
                tempRowDistribution += '</tr>'
                onlyDecimal('#FranchiseeDistributionAmountId_' + tempRowLineNo + '_' + tempFRowLineNo);
                $("#FD_frenchiseesearchbox").val("");
                console.log(ui.item.label);
                console.log(ui.item.value);

                $("#hdffrenchiseedetail_linecount").val(tempFRowLineNo);
            }
        });


    }

    function addCommas(nStr) {
        nStr += '';
        var x = nStr.split('.');
        var x1 = x[0];
        var x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }

    var lnFranchiseeDistribution = 0;
    function AppendDistribution(ln, fid, fnumber, fname, amt, contractdetailid, distributionid) {
       
        lnFranchiseeDistribution++;
        if (isNaN(amt)) { amt = 0.0;} else {amt = formatCurrency(amt)}

        var newComboGen=[];
        newComboGen.push("<option value='0'>Select</option>");
        //if(lineItemCombo.length>1){
        //newComboGen.push("<option value='-1'>All</option>");
        //}

        $.each(lineItemCombo, function (index, value) {
            if(value.ContractDetailId==contractdetailid)
            {
                newComboGen.push("<option value=" + value.LineNumber + " selected='selected'>" + value.LineNumber + "</option>");
            }else{
                newComboGen.push("<option value=" + value.LineNumber + ">" + value.LineNumber + "</option>");
            }
        });


        var tempRow = '';
        tempRow = tempRow + '<tr id=row_' + lnFranchiseeDistribution  + '>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="hidden" relLine="' + lnFranchiseeDistribution + '" id="fd_hdfdistributionid' + lnFranchiseeDistribution + '" name="fd_hdfdistributionid' + lnFranchiseeDistribution + '" value="' + distributionid + '" />'
        tempRow = tempRow + '   <input type="hidden" relLine="' + lnFranchiseeDistribution + '" id="fd_hdfcontractdetailid' + lnFranchiseeDistribution + '" name="fd_hdfcontractdetailid' + lnFranchiseeDistribution + '" value="' + contractdetailid + '" />'
        tempRow = tempRow + '   <input type="hidden" relLine="' + lnFranchiseeDistribution + '" id="fd_hdfFrenchiseeId' + lnFranchiseeDistribution + '" name="fd_hdfFrenchiseeId' + lnFranchiseeDistribution + '" value="' + fid + '" />'
        tempRow=tempRow+ ' <select  relLine="' + lnFranchiseeDistribution + '" id="fd_txtlinenumber' + lnFranchiseeDistribution + '" name="fd_txtlinenumber' + lnFranchiseeDistribution + '" class="form-control input-sm clscntl " style="border-radius: 0px;margin: 0px; width:100%">"'+newComboGen.join(' ')+'"</select>'
        //tempRow = tempRow + '   <input type="text"   relLine="' + lnFranchiseeDistribution + '" id="fd_txtlinenumber' + lnFranchiseeDistribution + '" name="fd_txtlinenumber' + lnFranchiseeDistribution + '" required readonly value="' + ln + '" class="form-control input-sm cnumeric" style="text-align:center;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="text" relLine="' + lnFranchiseeDistribution + '" id="fd_txtfranchiseeno' + lnFranchiseeDistribution + '" name="fd_txtfranchiseeno' + lnFranchiseeDistribution + '" required readonly   value="' + $.trim(fnumber) + '" class="form-control input-sm cnumeric" style="text-align:center;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="text" relLine="' + lnFranchiseeDistribution + '" id="fd_txtfranchiseename' + lnFranchiseeDistribution + '" name="fd_txtfranchiseename' + lnFranchiseeDistribution + '" required readonly  value="' + $.trim(fname) + '" class="form-control input-sm cnumeric" style="text-align:center;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="text" relfbamt="fb_amt' + ln + '" relLine="' + lnFranchiseeDistribution + '" id="fd_txtfranchiseeamount' + lnFranchiseeDistribution + '" name="fd_txtfranchiseeamount' + lnFranchiseeDistribution + '" required value="' + amt + '" class="form-control input-sm cnumeric clscntl" style="text-align:right;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>';
        tempRow = tempRow + '<td style="text-align: center;">'

        if ($('#hdfCustomerDetailCallFrom').val() == "RO" || $('#hdfCustomerDetailCallFrom').val() =="AO" || $('#hdfCustomerDetailCallFrom').val() =="CD") {
            tempRow = tempRow + '   <a href="#" class="clsdistview" onclick="TransferDistributionfee(' + fid + ',' + contractdetailid + ',' + distributionid + ',' + ln + ')">View/Edit</a>'
        }else {
            if (distributionid > 0)
                tempRow = tempRow + '   <a href="#"  class="clsdistview" onclick="TransferDistributionfee(' + fid + ',' + contractdetailid + ',' + distributionid + ',' + ln + ')">View/Edit</a>'
            else
                tempRow = tempRow + '   <a href="#" class="clsdistview" onclick="TransferDistributionfee(' + fid + ',' + contractdetailid + ',' + distributionid + ',' + ln + ')">View/Add</a>'
        }
        tempRow = tempRow + '</td>';
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <a style="font-size: 16px;padding: 3px;color: mediumvioletred;" class="clsdel" href="#" onclick="deleteFrenchisee(' + lnFranchiseeDistribution + ',' + fnumber + ');"><i class="fa fa-trash" aria-hidden="true"></i></a>'
        tempRow = tempRow + '</td></tr>';

        $('#FD_frdestributionTable tbody').append(tempRow);
        FD_DistributionfeeInIt(fid, contractdetailid, distributionid, ln);
        //var newId='#fd_txtlinenumber'+lnFranchiseeDistribution;

    }
    $('#hdffrenchiseedetail_linecount').val(lnFranchiseeDistribution);

    function deleteFrenchisee(linenumber, flineNo) {
        $("tr[id=row_" + linenumber + "]").remove();
        lnFranchiseeDistribution = lnFranchiseeDistribution - 1;
    }

    function scrubvalue(number) {
     
        var num = ''
        if (number != null) {
            num = number;
            num = num.replace('$', '');
            num = num.replace(',', '');
            num = num.replace(',', '');
            num = num.replace(' ', '');
            num = !isNaN(num) && isFinite(num) && num != '' ? num : 0;

        }
        return num;

    }

    function TransferValidateStepFirst() {
        debugger
        var retVal = true;

        if ($('#CustomerDetail_EffectiveDate').val().trim() == '') {
            $('#CustomerDetail_EffectiveDate').addClass("has-error");
            retVal = false;

        } else {
            $('#CustomerDetail_EffectiveDate').removeClass("has-error");
        }

        if ($('#hdfCustomerDetailCallFrom').val() != 'RO' && $('#hdfCustomerDetailCallFrom').val() != 'AO' && $('#hdfCustomerDetailCallFrom').val() != 'CD')
        {
            if (DistributionfeeListFinal.length == 0) {
                $('#fdt_lnkAppendDistributionFee').addClass("has-error");
                //swal({ title: "Distribution Fee is Required", text: "", type: "warning" });
                alertMsg("", "Distribution Fee is Required");
                retVal = false;
            }
            else {
                $('#fdt_lnkAppendDistributionFee').removeClass("has-error");

            }
        }

        var itmCount = 0
        var dtAmount = 0.00;
        var distributionAmount = 0.00
        var contractAmount = $('#CustomerDetail_TotalAmount').val();
        var contractAmount = @(Model.CustomerDetail.TotalAmount.HasValue ? Model.CustomerDetail.TotalAmount.Value: 0);

        var rowIds=[];
        $('#FD_frdestributionTable>tbody>tr').each(function(j){
            var trId=$(this).attr('id');
            var id=trId.split("_")[1]

            var newRowId={
                sl:j,
                id:id
            };
            rowIds.push(newRowId);
        });

        //for (var i = 1; i <= lnFranchiseeDistribution; i++) {
        for (var j = 0; j < rowIds.length; j++) {
            var i=rowIds[j].id;

            if ($('#hdfCustomerDetailCallFrom').val() != 'RO' && $('#hdfCustomerDetailCallFrom').val() != 'AO' && $('#hdfCustomerDetailCallFrom').val() != 'CD') {
                if ($('#lstFranchiseeDistribution_' + i + '__Amount').length > 0) {
                    itmCount++;
                    maskCurrency('lstFranchiseeDistribution_' + i + '__Amount');

                    if ($('#lstFranchiseeDistribution_' + i + '__Amount').val() == '') {
                        $('#lstFranchiseeDistribution_' + i + '__Amount').addClass("has-error");
                        retVal = false;
                    }
                    else {
                        $('#lstFranchiseeDistribution_' + i + '__Amount').removeClass("has-error");

                        dtAmount += parseFloat(scrubvalue($('#lstFranchiseeDistribution_' + i + '__Amount').val()) != '' ? scrubvalue($('#lstFranchiseeDistribution_' + i + '__Amount')).val() : '0');
                    }
                } else {
                    break;
                }


            } else {

                if (isNaN(scrubvalue($('#fd_txtfranchiseeamount' + i).val())))
                {
                    //swal({ title: "Total Distribution amount must be equal contract amount.", text: "", type: "warning" });
                    alertMsg("", "Total Distribution amount must be equal contract amount.");
                    break;

                }else {
                    if ((parseFloat(scrubvalue($('#fd_txtfranchiseeamount' + i).val())) == 0 && $('#FD_hdfContractTypeListId').val() != 3) || $('#fd_txtfranchiseeamount' + i).val()=='') {
                        //swal({ title: "Distribution Amount should be greater than zero", text: "", type: "warning" });
                        alertMsg("", "Distribution Amount should be greater than zero.");
                        break;
                    }else {


                        var lineNumber= $('#fd_txtlinenumber'+i).val();
                        var lineMaxValue=$('#cd_relcdamt'+lineNumber).val();
                        //alert("Line- "+lineNumber+ " Max Va="+lineMaxValue);
                        //alert("LM-"+lineMaxValue+" giv-"+scrubvalue($('#fd_txtfranchiseeamount' + i).val()));
                        if (typeof lineNumber != 'undefined') {
                            if (parseInt(lineMaxValue) == parseInt(scrubvalue($('#fd_txtfranchiseeamount' + i).val()))) {
                                distributionAmount = distributionAmount + parseFloat(scrubvalue($('#fd_txtfranchiseeamount' + i).val()));
                            } else {
                                //swal({ title: "Distribution amount of this contract line must be equal to it's contract amount.", text: "", type: "warning" });
                                alertMsg("", "Distribution amount of this contract line must be equal to it's contract amount.");
                                retVal = false;
                                break;
                            }
                        } else {
                            distributionAmount = distributionAmount + parseFloat(scrubvalue($('#fd_txtfranchiseeamount' + i).val()));
                        }

                    }
                }



            }
        }
    
        if ($('#hdfCustomerDetailCallFrom').val() != 'RO' && $('#hdfCustomerDetailCallFrom').val() !="AO" && $('#hdfCustomerDetailCallFrom').val() !="CD")
        {
            if (dtAmount != (@(Model.CustomerDetail.TotalAmount.HasValue ? Model.CustomerDetail.TotalAmount.Value: 0))) {
                for (var i = 0; i < itmCount; i++) {
                    $('#lstFranchiseeDistribution_' + i + '__Amount').addClass("has-error");
                    retVal = false;
                }
            }

        } else {
          
            //alert("DIS-"+ parseFloat(distributionAmount) + " CON-"+ parseFloat(contractAmount))
            if (Math.floor(distributionAmount) != Math.floor(contractAmount))
            {
                //alert(" DA- "+distributionAmount+" CA-"+contractAmount);
                //swal({ title: "Total Distribution amount must be equal contract amount.", text: "", type: "warning" });
                alertMsg("", "Total Distribution amount must be equal contract amount.");
                retVal = false;
            }
        }

        return retVal;

    }




    var DistributionfeeList = [];
    var DistributionfeeListFinal = [];

    function TransferDistributionfee(fid, ContractDetailId, DistributionId, ln, isReadonly) {

        $('#hdfDestributionFee_FranchiseeId').val(fid);
        $('#hdfDestributionFee_ContractDetailId').val(ContractDetailId);
        $('#hdfDestributionFee_DestributionId').val(DistributionId);
        $('#hdfDestributionFee_Linenumber').val($('#fdt_ddldetaillinenumber' + ln).val());

        var new_arr = $.grep(DistributionfeeListFinal, function (n, i) { return (n.ContractDetailId == ContractDetailId && n.FranchiseeId == fid) });
        if (new_arr.length > 0) {
            DistributionfeeBindData(new_arr);
            DistributionfeeList = new_arr;
            if (isReadonly == 1) {
                $('#btnTransDistributionFeeSave').hide();
                $('#btnTransDistributionFeeAddLink').hide();

            }
            else {
                $('#btnTransDistributionFeeSave').show();
                $('#btnTransDistributionFeeAddLink').show();
            }


            $("#FD_modal_FranchiseeDistributionFee").modal({ backdrop: 'static' });
        }
        else {
            var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + fid + '&ContractDetailId=' + ContractDetailId + '&DistributionId=' + DistributionId;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#feelist>tbody').html('');
                    DistributionfeeList = data;
                    DistributionfeeBindData(DistributionfeeList);

                    if (DistributionfeeList.ContractDetailId != undefined) {
                        DistributionfeeList.push({
                            DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                            FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                        });
                    }

                    if (isReadonly == 1) {
                        $('#btnTransDistributionFeeSave').hide();
                        $('#btnTransDistributionFeeAddLink').hide();

                    }
                    else {
                        $('#btnTransDistributionFeeSave').show();
                        $('#btnTransDistributionFeeAddLink').show();
                    }


                    $("#FD_modal_FranchiseeDistributionFee").modal({ backdrop: 'static' });

                }
            });
        }

        if($("#FD_hdfFranchiseeDistributionCallFrom").val() =="CD")
        {
            $(".clsbtmpnl").hide();
            //$(".clscntl").attr("disabled", "disabled");
        }
        else
        {
            $(".clsbtmpnl").show();
            //$(".clscntl").removeAttr("disabled");
        }
    }

    function FD_DistributionfeeInIt(fid, ContractDetailId, DistributionId, ln, isReadonly) {

        $('#hdfDestributionFee_FranchiseeId').val(fid);
        $('#hdfDestributionFee_ContractDetailId').val(ContractDetailId);
        $('#hdfDestributionFee_DestributionId').val(DistributionId);
        $('#hdfDestributionFee_Linenumber').val($('#fdt_ddldetaillinenumber' + ln).val());


        var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + fid + '&ContractDetailId=' + ContractDetailId + '&DistributionId=' + DistributionId;
        $.ajax({
            type: "GET",
            url: sURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
                $('#feelist>tbody').html('');
                DistributionfeeList = data;
                DistributionfeeBindData(DistributionfeeList);

                if (DistributionfeeList.ContractDetailId != undefined) {
                    DistributionfeeList.push({
                        DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                        FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                    });
                }

                if (isReadonly == 1) {
                    $('#btnTransDistributionFeeSave').hide();
                    $('#btnTransDistributionFeeAddLink').hide();

                }
                else {
                    $('#btnTransDistributionFeeSave').show();
                    $('#btnTransDistributionFeeAddLink').show();
                }

                $.each(DistributionfeeList, function (index, value) {
                    DistributionfeeListFinal.push(value);

                    if (DistributionfeeListFinal.length > 0)
                        $("a[relName='fdt_lnkAppendDistributionFee']").text('View/Edit');
                });
                $("#CustomerDistributionDetail_FeeString").val(JSON.stringify(DistributionfeeListFinal));




            }
        });

    }




    function btnTransDistributionFeeSaveOnClick() {
        $.each(DistributionfeeList, function (index, value) {
            var new_arr = $.grep(DistributionfeeListFinal, function (n, i) { return (n.ContractDetailId == value.ContractDetailId && n.FranchiseeId == value.FranchiseeId && n.FeeId == value.FeeId); });
            if (new_arr.length > 0) {
                var amt = parseFloat($('#DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId).val());
                new_arr[0].Amount = amt;
            }
            else {
                DistributionfeeListFinal.push(value);
            }


            if (DistributionfeeListFinal.length > 0)
                $("#fdt_lnkAppendDistributionFee").text('View/Edit');


        });
        $("#CustomerDistributionDetail_FeeString").val(JSON.stringify(DistributionfeeListFinal));

        DistributionfeeList = [];
        $("#FD_modal_FranchiseeDistributionFee").modal('hide');
    }

    @*function InItTransferDistributionfee() {

        for(var i=1;i<=@Model.lstFranchiseeDistribution.Count;i++)
        {
          
            var ContractDetailId = $('#fd_hdfcontractdetailid'+i).val();
            var fid = $('#fd_hdfFrenchiseeId' + i).val();
            var DistributionId = $('#fd_hdfdistributionid' + i).val();
            var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + fid + '&ContractDetailId=' + ContractDetailId + '&DistributionId=' + DistributionId;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#feelist>tbody').html('');
                    DistributionfeeList = data;
                    DistributionfeeBindData(DistributionfeeList);

                    if (DistributionfeeList.ContractDetailId != undefined) {
                        DistributionfeeList.push({
                            DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                            FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                        });
                    }

                    $.each(DistributionfeeList, function (index, value) {
                        DistributionfeeListFinal.push(value);

                        if (DistributionfeeListFinal.length > 0)
                            $("a[relName='fdt_lnkAppendDistributionFee']").text('View/Edit');
                    });
                    $("#CustomerDistributionDetail_FeeString").val(JSON.stringify(DistributionfeeListFinal));
                    DistributionfeeList = [];
                }
            });
        }
    }*@

    var DistributionfeeList = [];
    var DistributionfeeListFinal = [];

    function Distributionfee(fid, ContractDetailId, DistributionId, ln) {

        $('#hdfDestributionFee_FranchiseeId').val(fid);
        $('#hdfDestributionFee_ContractDetailId').val(ContractDetailId);
        $('#hdfDestributionFee_DestributionId').val(DistributionId);
        $('#hdfDestributionFee_Linenumber').val(ln);
        var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + fid + '&ContractDetailId=' + ContractDetailId + '&DistributionId=' + DistributionId;
        $.ajax({
            type: "GET",
            url: sURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
                $('#feelist>tbody').html('');
                console.log(data)
                DistributionfeeList = data;
                DistributionfeeBindData(DistributionfeeList);

                if (DistributionfeeList.ContractDetailId != undefined) {
                    DistributionfeeList.push({
                        DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdffrenchiseedetail_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                        FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                    });
                }
                $("#FD_modal_FranchiseeDistributionFee").modal({ backdrop: 'static' });

            }
        });
    }

    function TransFranchiseeserviceAddDestribution() {

        $.ajax({
            url: '@Url.Action("GetFeeData", "Customer","Portal")',
            success: function (res) {
                console.log(res);
                FeeDataForDistribution = res;
                var tempRow = "";
                $('#feeListAdd tbody').html('');
                $.each(res, function (index, value) {
                    tempRow = "";
                    tempRow += '<tr>';
                    tempRow += '    <td><input type="checkbox" rel="feeid_distribution" value="' + value.FeeId + '" /></td>';
                    tempRow += '    <td>' + value.FeeName + '</td>';
                    tempRow += '    <td>' + value.FeeRateTypeName + '</td>';
                    tempRow += '    <td style="text-align: right;">' + (value.FeeRateTypeListId == 1 ? (value.Amount + '%') : ('$ ' + value.Amount)) + '</td>';
                    tempRow += '</tr>';
                    $('#feeListAdd tbody').append(tempRow);
                });

                $("#FD_modal_AddFranchiseeDistributionFee").modal({ backdrop: 'static' });
            },
            error: function () { }
        });
    }
    function DistributionfeeBindData(DistributionfeeList) {
        $('#feelist>tbody').html('');
        $.each(DistributionfeeList, function (index, value) {

            tempRow = "";
            tempRow += '<tr relDistributionFeeId="' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId + '">';
            tempRow += '<td style="vertical-align: middle;">' + value.FeeName + '</td>';
            tempRow += '<td style="vertical-align: middle;">' + value.FeeRateTypeName + '</td>';
            tempRow += '<td><input type="text" id="DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId + '" class="form-control input-sm pp clscntl" value="' + value.Amount + '" /></td>';
            tempRow += '</tr>';
            $('#feelist>tbody').append(tempRow);

            $('#DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId).change(function () {
                var new_arr = $.grep(DistributionfeeList, function (n, i) { return (n.FranchiseeId == value.FranchiseeId && n.ContractDetailId == value.ContractDetailId && n.FeeId == value.FeeId); });
                if (new_arr.length > 0) {
                    var amt = parseFloat($(this).val());
                    new_arr[0].Amount = amt;
                }
            });

        });
    }


    function showAddTransferAppendDistribution() {

        $("#modal_SearchFranchiseeforTransfer").modal({ backdrop: 'static' });
        $("#fsearch-boxI").autocomplete({
            source: typeaheadSourceF,
            appendTo: $("#fsearch-box-div"),
            select: function (event, ui) {
                event.preventDefault();
                var vFid = ui.item.value;
                var vFnumber = ui.item.label.split(' ')[0].trim();
                var vFname = ui.item.label.replace(ui.item.label.split(' ')[0], "").trim();

                CTAppendDistribution(0, vFid, vFnumber, vFname, 00, 0, 0);
                $("#fsearch-boxI").val('');
                $("#modal_SearchFranchiseeforTransfer").modal('hide');
            }
        });
    }
    function btnAddDistributionFeeSaveOnClick() {
      
        $('input[rel="feeid_distribution"]').each(function (item) {
            if ($(this).is(":checked")) {
               
                var _FeeId = $(this).val();
                var new_arr = $.grep(FeeDataForDistribution, function (n, i) { return n.FeeId == _FeeId; })[0];
                var isFeeExists = false;
                for (var i = 0; i < DistributionfeeList.length; i++) {
                    if (DistributionfeeList[i].FeeId == _FeeId) { isFeeExists = true; }
                }

                if (!isFeeExists) {
                    DistributionfeeList.push({
                        DistributionFeesId: 0,
                        DistributionId: $('#hdfDestributionFee_DestributionId').val(),
                        CustomerId: $('#lblCustomerID').val(),
                        ContractDetailId: $('#hdfDestributionFee_ContractDetailId').val(),
                        FranchiseeId: $('#hdfDestributionFee_FranchiseeId').val(),
                        DetailLineNumber: $('#hdfDestributionFee_Linenumber').val(),
                        FeeId: _FeeId,
                        FeeName: new_arr.FeeName,
                        FeeRateTypeListId: new_arr.FeeRateTypeListId,
                        FeeRateTypeName: new_arr.FeeRateTypeName,
                        Amount: new_arr.Amount
                    });
                } else {
                    //swal({ title: "Fee is already added", text: "", type: "warning" });
                    alertMsg("", "Fee is already added.");
                }

            }
        });
        DistributionfeeBindData(DistributionfeeList);

        $("#FD_modal_AddFranchiseeDistributionFee").modal('hide');

    }
    function btnDistributionFeeSaveOnClick() {
        $.each(DistributionfeeList, function (index, value) {
            var new_arr = $.grep(DistributionfeeListFinal, function (n, i) { return (n.ContractDetailId == value.ContractDetailId && n.FranchiseeId == value.FranchiseeId && n.FeeId == value.FeeId); });
            if (new_arr.length > 0) {
                var amt = parseFloat($('#DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId).val());
                new_arr[0].Amount = amt;
            }
            else {
                DistributionfeeListFinal.push(value);
            }
        });
        DistributionfeeList = [];
        $("#FD_modal_FranchiseeDistributionFee").modal('hide');
    }

    $("#SubmitFC_onClick").click(function (e) {
        if(!TransferValidateStepFinderFee())
            return

        e.preventDefault();


        $("#FranchiseeDistributionDetail_String").val(JSON.stringify(FDistributionFinal));

        //$("#frmsubmitfc_onclick").submit();
        $.ajax({
            url: '@Url.Action("SaveFranchiseCustomerDistributionPopup", "Customer", new { area = "Portal" })',
            type: "POST",
            data: $('#frmsubmitfc_onclick').serialize(),
            success: function (data) {
                $('#modal_CIDFranchiseeDistribution').modal('hide');
                $(".modal-backdrop").remove();
                if(data!= null)
                {
                    if(data.CallFrom =="RO")
                    {
                        showDetailPopup(data.CustomerId, 38);
                    }
                    else  if(data.CallFrom =="AO"){
                        showDetailPopup(data.CustomerId, 39);
                    }
                    else  if(data.CallFrom =="CD"){

                    }
                }
            },
            error: function () { }
        });

    });

    function SubmitForRO() {
       

        if (!TransferValidateStepFirst()) {
            return;
        }

        FDistributionFinal=[];

        $('#FD_frdestributionTable>tbody>tr').each(function(j){
            var trId=$(this).attr('id');
            var id=trId.split("_")[1];

            var customerId = $('#CustomerDetail_CustomerId').val();
            var contractId = $('#CustomerDetail_ContractId').val();

            var distributionid=$("#fd_hdfdistributionid"+id).val();
            var contractdetailid=$("#fd_hdfcontractdetailid"+id).val();
            var frenchiseeId=$("#fd_hdfFrenchiseeId"+id).val();
            var linenumber=$("#fd_txtlinenumber"+id).val();
            var franchiseeno=$("#fd_txtfranchiseeno"+id).val();
            var amount=parseFloat(scrubvalue($("#fd_txtfranchiseeamount"+id).val()));
            var franchiseename=$("#fd_txtfranchiseename"+id).val();

            FDistributionFinal.push({ FranchiseeId: frenchiseeId, Amount: amount, CustomerId: customerId, ContractId: contractId, ContractDetailId: contractdetailid, DetailLineNumber: linenumber, FranchiseeName: franchiseename, FranchiseeNo: franchiseeno })

        });
        $("#FranchiseeDistributionDetail_String").val(JSON.stringify(FDistributionFinal));

        $.each(DistributionfeeList, function (index, value) {
            var new_arr = $.grep(DistributionfeeListFinal, function (n, i) { return (n.ContractDetailId == value.ContractDetailId && n.FranchiseeId == value.FranchiseeId && n.FeeId == value.FeeId); });
            if (new_arr.length > 0) {
                var amt = parseFloat($('#DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId).val());
                new_arr[0].Amount = amt;
            }
            else {
                DistributionfeeListFinal.push(value);
            }
        });
        DistributionfeeList = [];


        $("#CustomerDistributionDetail_FeeString").val(JSON.stringify(DistributionfeeListFinal));
        //$("#frmsubmitfc_onclick").submit();
        $.ajax({
            url: '@Url.Action("SaveFranchiseCustomerDistributionPopup", "Customer", new { area = "Portal" })',
            type: "POST",
            data: $('#frmsubmitfc_onclick').serialize(),
            success: function (data) {
                $('#FD_modal_FranchiseeDistribution').modal('hide');
                $(".modal-backdrop").remove();
                if(data!= null)
                {
                    console.log(data.CallFrom);
                    if(data.CallFrom =="RO")
                    {
                        showDetailPopup(data.CustomerId, 38);
                    }
                    else  if(data.CallFrom =="AO"){
                        showDetailPopup(data.CustomerId, 39);
                    }
                    else  if(data.CallFrom =="CD"){

                    } else if (data.CallFrom == "PCD") {

                    }
                }

            },
            error: function () { }
        });
    }


    /**************************************************************************************************************************************/
    /**************************************************************************************************************************************/


    //var _FFSchedule = JSON.parse('ViewBag.FFSchedule');

    function maskCurrency(id) {
        $('#' + id).inputmask("currency", {
            alias: 'currency',
            prefix: '$ ',
            digits: 2,
            autoUnmask: true,
            removeMaskOnSubmit: true,
            unmaskAsNumber: true,
            allowPlus: false,
            allowMinus: false,
            autoGroup: true,
            groupSeparator: ",",
        });
    }

    function maskPercentage(id) {
        $('#' + id).inputmask("numeric", {
            radixPoint: ".",
            groupSeparator: ",",
            autoGroup: true,
            suffix: " %",
            rightAlign: true,
            autoUnmask: true,
            removeMaskOnSubmit: true,
            clearMaskOnLostFocus: false,
            oncleared: function () { self.Value(''); }
        });
    }

    function TransferValidateStepFinderFee() {

        var retVal = true;


        $('#frmsubmitfc_onclick').find('select, textarea, input').each(function(){
            if(!$(this).prop('required')){


            } else {
                if ($(this).val() == '') {
                    $(this).addClass("has-error");
                    retVal = false;
                } else {
                    $(this).removeClass("has-error");
                };
            }
        });


        return retVal;
    }
    function formatJSONDateUtc(jsonDate) {
        if (jsonDate != null) {
            var dtstr = jsonDate.substr(6);
            var dateString = dtstr.substring(0, dtstr.length - 2);
            var currentTime = new Date(parseInt(dateString)).toUTCString();
            var date = moment.utc(currentTime).format("MM/DD/YYYY");
            return date;
        }
        return null;
    }
    function formatCurrency(total) {

        var neg = false;
        if (total < 0) {
            neg = true;
            total = Math.abs(total);
        }
        return (neg ? "-" : '') +'$ '+ parseFloat(total, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString();

    }

    function alertMsg(title,msg) {
        $('#swtWarningAlertPopup_Title').html(title);
        $('#swtWarningAlertPopup_Message').html(msg);

        $("#swtWarningAlertPopup").show();

        $("#btnswtWarningAlertOKPopup").click(function () {
            $("#swtWarningAlertPopup").hide();
        });
    }





</script>
