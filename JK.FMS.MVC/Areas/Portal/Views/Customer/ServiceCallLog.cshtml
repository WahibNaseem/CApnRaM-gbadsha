@{
    ViewBag.Title = "ServiceCallLog";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model JKViewModels.Customer.ServiceCallLogModel
<div class="custom-form portlet light form-horizontal" style="max-width:1139px;margin: 0px auto;padding:0;min-height: 100px;">
    <div class="headerbox">
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-6">
                    <div class="input-icon">
                        <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                        <input id="csearch-box" type="text" required name="customernumber" autocomplete="off" placeholder="Search Customer Name" value="" class="form-control input-sm typeahead" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="portlet-body form">
        <div class="form-body">
            @*<div class="row" style="padding-left: 7px;padding-right: 7px;margin-top: -8px;">
                <div class="col-md-12 text-center" style="border: 1px solid #b1acac;background-color: #e6e6dc;">
                    <h4><b>CUSTOMER SERVICE CALL LOG</b></h4>
                </div>
            </div>*@
            @using (Html.BeginForm("ServiceCallLog", "Customer", FormMethod.Post, new { @id = "frmServiceCallLog", @role = "form" }))
            {
                if (ViewBag.CustomerDetail != null)
                {
                    @Html.HiddenFor(x => x.ClassId, new { @Value = ViewBag.CustomerDetail.CustomerId })
                    @Html.HiddenFor(x => x.TypeListId, new { @Value = "1" })
                    @Html.HiddenFor(x=>x.RegionId,new { @Value= ViewBag.CustomerDetail.RegionId })
                    @Html.HiddenFor(x=>x.SaveClose)
                    @Html.HiddenFor(x=>x.SaveNew)
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3 control-label" style="padding-top: 0px;">
                                    <span>Customer No.<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-2">
                                    <span><b>@ViewBag.CustomerDetail.CustomerNo</b></span>
                                </div>
                                <div class="col-md-2">
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;">
                                    <span>Contact<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-3">
                                    <span><b>@ViewBag.CustomerDetail.ContactName</b></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3 control-label" style="padding-top: 0px;">
                                    <span>Customer Name<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-4">
                                    <span><b>@ViewBag.CustomerDetail.CustomerName</b></span>
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;">
                                    <span>Phone No.<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-3">
                                    <span><b>@ViewBag.CustomerDetail.Phone</b></span>
                                </div>
                            </div>
                        </div>
                    </div>
                } 
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label">
                                Initiated By<span style="color:#000000;"> &nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                @Html.DropDownListFor(x => x.InitiatedBy, new SelectList(ViewBag.InitiatedBy, "Value", "Key"), new { @class = "form-control input-sm", required = "required" })
                            </div>
                            <div class="col-md-2 control-label">
                                Area<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                @Html.DropDownListFor(x => x.ServiceLogAreaListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallAreaList, new { @class = "form-control input-sm", required = "required" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label">
                                Spoke With<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                @*<input type="text" class="input-sm form-control" />*@
                                @Html.TextBoxFor(x => x.SpokeWith, new { @class = "input-sm form-control" })
                            </div>

                            <div class="col-md-2 control-label">
                                Type<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                @Html.DropDownListFor(x => x.ServiceLogTypeListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallLogTypeList, new { @class = "form-control input-sm", required = "required" })
                                @*<select class="input-sm form-control">
                                        <option>Claim / Incident</option>
                                    </select>*@
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label">
                                Action<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-10">
                                @Html.TextBoxFor(x => x.Action, new { @class = "input-sm form-control" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label">
                                Comments<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-10">
                                @Html.TextAreaFor(x => x.Comments, new { @class = "input-sm form-control", @rows = "5",@style= "min-width: 882px;" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label">
                                Status<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                @*@Html.DropDownListFor(, ViewBag.StatusResultList, new { @class = "form-control input-sm", required = "required", @id = "StatusResultListId", @name = "StatusResultListId" })*@
                                @Html.DropDownListFor(x => x.StatusResultListId, (IEnumerable<SelectListItem>)ViewBag.StatusResultList, new { @class = "form-control input-sm", required = "required" })
                            </div>
                            <div class="col-md-2 control-label">
                                Call Back<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group input-medium date date-picker" data-date-format="dd-mm-yyyy" data-date-start-date="+0d">
                                    @Html.TextBoxFor(x => x.CallBack, new { @class = "form-control input-sm" })
                                    <span class="input-group-btn">
                                        <button class="btn default" type="button">
                                            <i class="fa fa-calendar"></i>
                                        </button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2 control-label">
                                Follow By<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                <select class="input-sm form-control">
                                    <option>Option1</option>
                                    <option>Option2</option>
                                </select>
                            </div>

                            <div class="col-md-2 control-label">
                                Email Call Notes to<span style="color:#000000;">&nbsp;:</span>
                            </div>
                            <div class="col-md-4">
                                <select class="input-sm form-control">
                                    <option>Option1</option>
                                    <option>Option2</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <hr style="margin-bottom: -10px;" />
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12 text-right" style="padding:25px;">
                            <input type="reset" class="btn btn-primary btn-default" value="Cancel" />
                            <input type="submit" class="btn btn-primary btn-default" onclick="return SaveCloseForm();"  value="Save & Close" />
                            <input type="submit" class="btn btn-primary btn-default" onclick="return SaveAndNewForm();"  value="Save & New" />
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
@section pageplugins{

    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-typeahead/bootstrap3-typeahead.min.js")" type="text/javascript"></script>
}
@section scripts{
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/components-date-time-pickers.min.js")" type="text/javascript"></script>
    <script>

        $('#txtCallBack').datepicker("option", {
            minDate: new Date()
        });

        var app = {};
        (function (app) {
            var _id;
            app.init = function (id) {
                _id = id;
                bindcustomerdetail(_id);
            }
        })(app);

          function bindcustomerdetail(customerid) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("CustomerDetaildata", "AccountReceivable", new { area = "Portal" })',
                data: 'customerid=' + customerid,
                success: function (data) {
                    console.log(data);
                    $("#customername").val($.trim(data.Name));
                }
            });
        }
          function SaveAndNewForm() {
              //$("#SaveAndNewForm").click(function () {
              $("#SaveNew").val("SaveNew");
              checkMandatoryFields();
                  if (Validation == true) {
                      $("#frmServiceCallLog").submit();
                  }
                  else
                      return false;
             // })
          }
          function SaveCloseForm() {
             // $("#SaveCloseForm").click(function () {
              $("#SaveClose").val("SaveClose");
              checkMandatoryFields();
                  if (Validation == true) {
                      $("#frmServiceCallLog").submit();
                  }
                  else
                      return false;
             // })
          }
          var Validation = false;
          function checkMandatoryFields() {
              var Validation = false;
              if ($('#StatusResultListId').val() == 0) {
                  $('#StatusResultListId').css('border-color', 'red');
                  Validation = false;
              } else { $('#StatusResultListId').css('border-color', ''); Validation = true }
              if ($('#StatusResultListId').val() == 1) {
                  $('#SpokeWith').css('border-color', 'red');
                  Validation = false;
              }
              else {
                  $('#SpokeWith').removeAttr('style', ''); Validation = true
              }
              if ($('#Action').val() == "") {
                  $('#Action').css('border-color', 'red');
                  Validation = false;
              } else { $('#Action').css('border-color', ''); Validation = true }
              if ($('#Comments').val() == "") {
                  $('#Comments').css('border-color', 'red');
                  Validation = false;
              } else { $('#Comments').css('border-color', ''); Validation = true }
          }
          $(document).ready(function () {
              $("#csearch-box").keyup(function () {
                  $.ajax({
                      type: "GET",
                      url: '@Url.Action("Customerdata", "AccountReceivable", new { area = "Portal" })',
                      data: 'keyword=' + $(this).val(),
                      success: function (data) {
                          var typeaheadSource = [];
                          $.each(data, function (key, value) {
                              typeaheadSource.push({ id: value.CustomerId, name: value.CustomerNo + ' ' + $.trim(value.Name) })
                          });

                          $('#csearch-box').typeahead({
                              source: typeaheadSource,
                              updater: function (item) {
                                  console.log(item);
                                  //$("#customername").val($.trim(item.name));
                                  redirect(item.id);
                                  return item;
                              },
                              minLength: 2
                          }).focus();
                      }
                  });
              });
          });
          function redirect(id) {
              var url = '/Portal/Customer/ServiceCallLog/-1';
              var path = url.replace("-1", id);
              location.href = path;
          }
    </script>
}


