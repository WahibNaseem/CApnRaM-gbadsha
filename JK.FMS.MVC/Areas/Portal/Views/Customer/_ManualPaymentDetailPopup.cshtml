
<link href="~/Content/admin/assets/Card/dist/card.css" rel="stylesheet" />
<link href="~/Content/admin/assets/global/plugins/bootstrap-sweetalert/sweetalert.css" rel="stylesheet" />
<link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css")" rel="stylesheet" />

    <style type="text/css">
        .trim-padding {
            padding: 3px;
        }

        #InvoiceList thead > tr > th {
            font-size: 10px !important;
            padding: 3px !important;
            margin-left: 5px;
            vertical-align: middle;
        }

        #InvoiceList tbody > tr > td {
            font-size: 11px !important;
            padding: 3px !important;
            margin-left: 5px;
            vertical-align: middle;
        }

        #InvoiceList thead > tr > th {
            vertical-align: middle;
            text-align: center !important;
            /*padding-right: 15px!important;*/
        }

        #InvoiceList tbody > tr > td {
            padding-top: 5px !important;
        }

        #InvoiceList thead .sorting:after, #InvoiceList thead .sorting_asc:after {
            content: none;
        }

        .headerbox > .row {
            margin-left: 0px !important;
            margin-right: 0px !important;
        }

        .topheader {
            font-size: 14px;
            font-weight: bold;
            color: #FFF !important;
            text-transform: uppercase;
            margin-top: 3px;
        }

        .alignRight {
            text-align: right;
        }

        .alignCenter {
            text-align: center;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .modal-header:hover {
            cursor: move;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }

            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .payment-field {
            /*width: 80px !important;*/
        }

        .demo-container {
            width: 100%;
            max-width: 350px;
            margin: 10px auto;
        }

        form {
            margin: 30px;
        }

        .input-185 {
            width: 185px;
        }

        .custom-listbox .headerbox {
            padding: 3px 0px 3px 5px;
            font-weight: normal;
        }

        .custom-listbox {
            margin-top: 4px;
            margin-bottom: 0px;
        }

        /*input {
            width: 200px;
            margin: 10px auto;
            display: block;
        }*/
        .Amttext {
            text-align: right;
        }

        .clsAmounttd {
            text-align: right !important;
        }

        .btn.multiselect {
            text-align: left;
            padding-top: 4px;
            padding-bottom: 4px;
            font-size: 11px;
            color: #555;
        }

        .multiselect .caret {
            right: 0;
            position: absolute;
            margin-top: 8px;
            margin-right: 8px;
        }

        .multiselect-container.dropdown-menu {
            text-transform: none;
            font-size: 14px;
            padding-left: 35px;
            padding-right: 10px;
        }

        .no-padding {
            padding: 0;
        }

        #modal_RegionModel .modal-content {
            width: 55% !important;
            margin-left: 30% !important;
        }
        .payment-field {
            width: 110px !important;
        }
    </style>
    <div class="modal fade in" id="modal_ManualPayment" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
        <div class="modal-dialog modal-lg" id="Render_ManualPayment">
            <div class="modal-content" style="border-radius: 8px;width:1120px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                        Manual Payment
                    </h4>
                </div>
                <form class="form-horizontal" role="form" id="form_applypayment" action="@Url.Action("ApplyManualPayment","Customer","Portal")" method="post" style="margin: 0">
                    @*@Html.HiddenFor(one => one.CustomerDetail.CustomerId, new { id = "hdfCustomerId" })*@
                    <input type="hidden" name="hdMPCallFrom" id="hdMPCallFrom" value="" />
                    <input type="hidden" name="hdfCustomerIdMP" id="hdfCustomerIdMP" value="" />
                    @Html.Hidden("Last4CC")
                    <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                        <div class="form-body">
                            <div class="form-group" style="margin-bottom:0px !important;">
                                <div class="row" style="padding:0px !important;">
                                    <div class="col-md-12">
                                        <div class="col-md-6">
                                            <div class="col-md-3">
                                                Customer No.<span style="color:#000000;">&nbsp;:</span>
                                            </div>
                                            <div class="col-md-2">
                                                <label id="lblCusomerNo">@ViewBag.CustomerDetail.CustomerNo</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="col-md-2">
                                                Contact<span style="color:#000000;">&nbsp;:</span>
                                            </div>
                                            <div class="col-md-4">
                                                <lable id="lblContact">@ViewBag.CustomerDetail.ContactName</lable>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" style="margin-bottom:0px !important;">
                                <div class="row" style="padding:0px !important;">
                                    <div class="col-md-12">
                                        <div class="col-md-6">
                                            <div class="col-md-4" style="width: 128px;">
                                                Customer Name<span style="color:#000000;">&nbsp;:</span>
                                            </div>
                                            <div class="col-md-6">
                                                <lable id="lblCustomerName">@ViewBag.CustomerDetail.CustomerName</lable>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="col-md-3" style="width: 95px;">
                                                Phone No.<span style="color:#000000;">&nbsp;:</span>
                                            </div>
                                            <div class="col-md-4">
                                                <lable id="lblPhoneNo">@ViewBag.CustomerDetail.Phone</lable>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-2">
                                            Payment Type<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2">
                                            <select id="slPaymentType" name="slPaymentTypeMP" class="form-control input-sm">
                                                <option value="1">Check</option>
                                                <option value="2">Payment Card</option>
                                                <option value="3">Lockbox</option>
                                                <option value="4">Payment</option>
                                            </select>
                                        </div>
                                        <div class="col-md-1">
                                            Date<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="input-group date" data-date-format="mm/dd/yyyy">
                                                <input type="text" name="paymentDateMP" id="paymentDateMP" value=@DateTime.Today.ToString("MM/dd/yyyy") class="form-control input-sm date-picker" />
                                                <span class="input-group-btn">
                                                    <button class="btn default" type="button">
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-1 text-right col-md-offset-2">
                                            Amount<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2 form-inline">
                                            <span>$</span>&nbsp;&nbsp;&nbsp;<input type="text" id="paymentAmtMP" name="paymentAmtMP" value="0.00" class="form-control input-sm payment-field Amttext credit-field" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-2">
                                            Reference No.<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2">
                                            <input type="text" id="referenceNoMP" name="referenceNoMP" value="" class="form-control input-sm" />
                                        </div>
                                        <div class="col-md-1">
                                            Customer Balance<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2 form-inline" style="margin-top: 1px;">
                                            <span>$</span>&nbsp;&nbsp;&nbsp;<input type="text" id="txtCustomerbalance" name="txtCustomerbalance" readonly="" class="form-control input-sm input-185" style="width: 130px;text-align: right;" value="@ViewBag.CustomerDetail.Balance" />
                                        </div>
                                        <div class="col-md-2 text-right">
                                            <label class="mt-checkbox">
                                                <input type="checkbox" id="chkApplyCreditMP">Apply Credit
                                                <span></span>
                                            </label>
                                        </div>
                                        <div class="col-md-1 text-right">
                                            Credit<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2 form-inline">
                                            <span>$</span>&nbsp;&nbsp;&nbsp;<input type="text" id="customerCreditAmtMP" name="customerCreditAmtMP" value="0.00" class="form-control input-sm payment-field Amttext credit-field" disabled />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-2">
                                            Notes<span style="color:#000000;">&nbsp;:</span>
                                        </div>
                                        <div class="col-md-2">
                                            <input type="text" id="txtNotes" name="txtNotes" value="" class="form-control input-sm input-185" />
                                        </div>
                                        <div class="col-md-1">
                                        </div>
                                        <div class="col-md-2">
                                        </div>
                                        <div class="col-md-1 text-right col-md-offset-2">
                                            Balance
                                        </div>
                                        <div class="col-md-2 form-inline">
                                            <span>$</span>&nbsp;&nbsp;&nbsp;<input type="text" id="balanceMP" name="balanceMP" value="0.00" class="form-control input-sm payment-field Amttext credit-field" disabled />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row" style="background-color: #4b85cc;color: #fff;padding-top:8px;padding-bottom:8px">
                                    <div class="col-md-12">
                                        <div class="col-md-3">
                                            <div class="input-icon">
                                                <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                                                <input type="text" placeholder="Search..." class="form-control input-sm typeahead" value="" autocomplete="off" id="input_SearchMP" />
                                            </div>
                                            <div id="container">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="mt-checkbox" style="margin-bottom: 0px;">
                                                <input type="checkbox" id="chkConsolidatedMP" class="search-field"> Consolidated
                                                <span></span>
                                            </label>
                                        </div>
                                        <div class="col-md-7">
                                            <div class="pull-right">
                                                @Html.DropDownList("optionList", (SelectList)ViewBag.OptionList, new { @class = "form-control input-sm", @id = "select_dateRangeMP", style = "width: 180px;float: left;margin-right:10px" })<span style="width: 40px;float: left;padding: 5px;">From</span>
                                                <input type="text" name="dtpfrom" value="" class="form-control input-sm search-date-field date-picker" id="dtpfromMP" onkeydown="return false" style="width: 85px;float: left;" />
                                                <span style="width: 25px;float: left;padding: 5px;">To</span>
                                                <input type="text" name="dtpto" value="" class="form-control input-sm search-date-field date-picker" id="dtptoMP" onkeydown="return false" style="width: 85px;float: left;" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" style="margin-left:-30px;margin-right:-30px;">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered table-hover order-column" style="width:100%;" id="ManualPaymentList">
                                            <thead>
                                                <tr>
                                                    <th class="tblInvoice_chk" style="text-align:center; width: 30px">
                                                        <input type="checkbox" id="chkAll" name="chkAll" />
                                                    </th>
                                                    <th class="tblInvoice_invoiceNo" style="width:80px;text-align:center;">
                                                        Invoice No
                                                    </th>
                                                    <th class="tblInvoice_invoiceDate" style="width:80px;text-align:center;">
                                                        Invoice Date
                                                    </th>
                                                    <th class="tblInvoice_customerNo" style="width:70px;text-align:center;">
                                                        Customer No.
                                                    </th>
                                                    <th class="tblInvoice_customerName" style="width:180px;text-align:center;">
                                                        Customer Name
                                                    </th>
                                                    <th class="tblInvoice_invoiceDesc" style="width:220px;text-align:center;">
                                                        Invoice Desc.
                                                    </th>
                                                    <th class="tblInvoice_invoiceAmt" style="text-align:center;width:60px;">
                                                        Inv. Amount
                                                    </th>
                                                    <th class="tblInvoice_payment" style="text-align:center;width:60px;">
                                                        Payment Apply
                                                    </th>
                                                    <th class="tblInvoice_balance" style="text-align:center;width:60px;">
                                                        Balance
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-8">
                                        <input type="hidden" name="SaveMethod" id="SaveMethod" />
                                    </div>
                                    <div class="col-md-2">
                                        @*<button id="btnSaveAndClose" type="button" class="btn green btn-block" onclick="onClickSaveAndCloseMP()">Save & Close</button>*@
                                    </div>

                                    <div class="col-md-2">
                                        <button id="btnSaveAndClose" type="button" class="btn green btn-block" onclick="onClickSaveAndCloseMP()">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="div_applypaymentforms"></div>
    <script type="text/javascript">
        $("#chkApplyCreditMP").change(function () {
            $("input[id='customerCreditAmtMP']").val($("input[id='txtCustomerbalance']").val());
                toggleCustomerCreditAmtField(this.checked);
            });
        function toggleCustomerCreditAmtField(enabled = null) {
            console.log(enabled);
            if (enabled == null)
                enabled = $("#chkApplyCreditMP").is(":checked");
            $("input[id='customerCreditAmtMP']").prop("disabled", !enabled);
             if (enabled == false) {
                 $("input[id='customerCreditAmtMP']").val(0);
                 calculateBalanceMP();
             } else {
                 calculateBalanceMP();
             }
        }
        function setInvoiceBalance(invPrefix, amt) {
            $(invPrefix + "balance").val(commaSeparateNumber((amt).toFixed(2)));
        }
        function setInvoicePayment(invPrefix, amt) {
            var txt = '';
            if (amt > 0)
                txt = commaSeparateNumber((amt).toFixed(2));
            $(invPrefix + "totalPayment").val(txt);
        }
    function manualPaymentInIt(id) {
        PopulateManualPayment();

        $('#hdfCustomerIdMP').val(id)
        //Manual Payment Date Change
        $("#select_dateRangeMP").change(function () {
            var value = this.value;
            setSearchMPTime(value);
            // refreshTable();
        });
        //Manual Payment
        setSearchMPTime(7);



    }

    $("#slPaymentType").change(function () {
        if ($(this).val() == "2") {
            var data = $(".payment-checkbox")
            if (data.length >= 1) {
                $('#myModal').modal('show');
                $("#txtAmountToBePay").val($("#paymentAmtMP").val().replace(',', ''));
            }
            else {
                alert("You Don't have invoice.");
            }
        }
        else
            $('#myModal').modal('hide');

    });

    $("#BtnCCPay").click(function () {
        if ($("#DivCustomer").css("display") != "block") {
            CCPAY();
        }
        else
            NextStepPayment();
    });

    $("#btnSuccessPopUp").click(function () {
        $("#swtModel").remove();

        if (!Mxmarchant) {
            swal({
                title: "Do you want to save CC in your profile?",
                text: "For Future Transaction You will be able to make payment without entering the CC Details.",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: '#DD6B55',
                confirmButtonText: 'Yes',
                cancelButtonText: "No",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {

                        CreateProfile();
                        swal(
                            'CC Saved in Profile.',
                            '',
                            'success'
                        )
                    }
                    else {
                        swal(
                            'Cancelled.',
                            '',
                            'error'
                        )
                    }
                });
        }

    });

        $("#paymentAmtMP").change(function () {
        calculateBalanceMP();
    });
    $('#chkAll').change(function () {
        if ($(this).is(":checked")) {
            $('input[rel="mgglchk"]').prop('checked', true);
        }
        else {
            $('input[rel="mgglchk"]').prop('checked', false);
        }
    });
        function calculateBalanceMP() {
            
        validateCustomerCreditAmtField();
        var paymentAmount = parseFloat(removeFormatting($("#paymentAmtMP").val()));
        var creditAmount = parseFloat($("#customerCreditAmtMP").val());
        var allocatedPayments = 0;
        $("[id$=totalPayment]").each(function () {
            var amt = parseFloat(removeFormatting($(this).val()));
            if ($.isNumeric(amt))
                allocatedPayments += amt;
        });

        var balance = paymentAmount + creditAmount - allocatedPayments; // todo: subtract all allocated payments

        setAmount(paymentAmount);
        setBalance(balance);
    }
        function validateCustomerCreditAmtField() {
            if ($("#chkApplyCreditMP").is(":checked")) {
                $("input[id='customerCreditAmtMP']").val(Math.max(Math.max(0, $("input[id='customerCreditAmtMP']").val()), Math.max(0, $("input[id='txtCustomerbalance']").val())).toFixed(2));
            }
        }
    function setAmount(amt) {
        var txt = '';
        if (amt > 0)
            txt = commaSeparateNumber((amt).toFixed(2));
        $("#paymentAmtMP").val(txt);
    }
    function setBalance(amt) {
        var txt = commaSeparateNumber((amt).toFixed(2));
        $("#balanceMP").val(txt);
    }

        function selectInvoice(inv) {
            
        var invPrefix = "#" + getInvoicePrefix(inv);
        var balance = parseFloat(removeFormatting($("#balanceMP").val()));
        var invAmount = parseFloat(removeFormatting($(invPrefix + "amount").val()));

        var payment = 0.00;
        var isChecked = $(invPrefix + "chk").prop("checked");

        if (!isChecked) // currently selected, so deselect
            setInvoicePayment(invPrefix, 0);
        else {
            payment = Math.min(balance, invAmount); // get either the full invoice amount, or what's left in the balance
            setInvoicePayment(invPrefix, payment);
        }

        setInvoiceBalance(invPrefix, invAmount - payment);
        calculateBalanceMP();
    }
     var Mxmarchant = false;
        function CCPAY() {
            var sURL = '@Url.Action("PayWithCC", "AccountReceivable", new { area = "Portal" })?CardNumber=' + $("#txtCard").val().replace(/ /g, '') + '&CardHolderName=' + $("#txtCCName").val() + '&CardExpiry=' + $("#txtCCExpiry").val() + '&CardCVC=' + $("#txtCCcvc").val() + '&Amount=' + $("#txtAmountToBePay").val() + '&ClassID=' + $("#hdfCustomerId").val() + '&IsProfile=' + true + '&CustomerNo=' + $("#CustomerNo").val() + '&IsCheckedPrevCard=' + $("#ChkCustomerProfile").prop("checked") + '&PaymentProfileID=' + $("#PaymentProfileID").val() + '&regID=' + $("#selectregionlist").val();
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    console.log(data);
                    if (data.aadata != null) {

                        if (data.aadata.messages != null && data.aadata.messages.message[0].code == "I00001") {
                            $("#paymentAmt").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#balance").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#referenceNo").val(data.aadata.transactionResponse.authCode);
                            $("#txtNotes").val(data.aadata.transactionResponse.transId);
                            $("#Last4CC").val(data.aadata.transactionResponse.accountNumber);
                            $("#slPaymentType").prop("disabled", true);
                            $("#referenceNo").prop("readonly", true);
                            $("#txtNotes").prop("readonly", true);
                            $("#paymentAmt").prop("readonly", true);
                            $("#paymentDate").prop("readonly", true);
                            $("#btnCCCancle").trigger("click");
                            if (!$("#ChkCustomerProfile").prop("checked")) {
                                $("#swtModel").show();
                            }
                            else {
                                $("#swtModel").remove();
                                swal(
                                    'Payment Approved!',
                                    'Transaction ID: ' + data.aadata.transactionResponse.transId,
                                    'success'
                                )
                            }
                        }
                        else if (data.aadata.Status != null && data.aadata.Status == "Approved") {
                            $("#paymentAmt").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#balance").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#referenceNo").val(data.aadata.AuthCode);
                            $("#txtNotes").val(data.aadata.BatchId);
                            $("#Last4CC").val(data.aadata.CardAccount.Last4);
                            $("#slPaymentType").prop("readonly", true);
                            $("#referenceNo").prop("readonly", true);
                            $("#txtNotes").prop("readonly", true);
                            $("#paymentAmt").prop("readonly", true);
                            $("#paymentDate").prop("readonly", true);
                            $("#btnCCCancle").trigger("click");
                            if (!$("#ChkCustomerProfile").prop("checked")) {
                                $("#swtModel").show();
                                Mxmarchant = true;
                            }
                            else {
                                $("#swtModel").remove();
                                swal(
                                    'Payment Approved!',
                                    'Transaction ID: ' + data.aadata.BatchId,
                                    'success'
                                )
                            }
                        }
                        else {
                            $("#btnCCCancle").trigger("click");
                            alert("Credit Card decline, please check Credit Card number or enter new Credit Card.", function (ctl) {
                                if (ctl) {
                                    location.reload();
                                }
                            });
                        }

                    }
                    else {
                        $("#btnCCCancle").trigger("click");
                        alert("Credit Card decline, please check Credit Card number or enter new Credit Card.", function (ctl) {
                            if (ctl) {
                                location.reload();
                            }
                        });
                    }
                },
                error: function () {
                    alert("Credit Card decline, please check Credit Card number or enter new Credit Card.");
                }
            });
            $("#input_Search").val($("#csearch-box").val());
            $("#input_Search").trigger("keyup");
        }


    function setSearchMPTime(value) {

        value = parseInt(value);
        $("#select_dateRangeMP").val(value.toString());
        var custom_enabled = false;
        var firstDay;
        var lastDay;

        switch (parseInt(value)) {
            case 1:
                firstDay = moment().startOf('isoWeek').toString();
                lastDay = moment().endOf('isoWeek').toString();
                break;
            case 2:
                //code block
                firstDay = moment().startOf('isoWeek').toString();
                lastDay = new Date().toString();
                break;
            case 3:
                firstDay = moment().subtract(0, 'month').startOf('month').toString();
                lastDay = moment().subtract(0, 'month').endOf('month').toString();
                break;
            case 4:
                //code block
                firstDay = moment().subtract(0, 'month').startOf('month').toString();
                lastDay = new Date().toString();
                break;
            case 5:
                //code block
                firstDay = moment().startOf('quarter').toString();
                lastDay = moment().endOf('quarter').toString();
                break;
            case 6:
                //code block
                firstDay = moment().startOf('quarter').toString();
                lastDay = new Date().toString();
                break;
            case 7:
                //code block
                firstDay = moment().startOf('year').toString();;
                lastDay = moment().endOf('year').toString();
                break;
            case 8:
                //code block
                firstDay = moment().startOf('year').toString();
                lastDay = new Date().toString();
                break;
            case 9:
                //code block
                firstDay = moment().add(-1, 'days').toString();
                lastDay = moment().add(-1, 'days').toString();
                break;
            case 10:
                //code block
                firstDay = moment().subtract(1, 'week').startOf('week').toString();
                lastDay = moment().subtract(1, 'week').endOf('week').toString();
                break;
            case 11:
                //code block
                firstDay = moment().subtract(1, 'month').startOf('month').toString();
                lastDay = moment().subtract(1, 'month').endOf('month').toString();
                break;
            case 12:
                //code block
                firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                break;
            case 13:
                //code block
                firstDay = moment().subtract(1, 'year').startOf('year').toString();
                lastDay = moment().subtract(1, 'year').endOf('year').toString();
                break;
            case 14:
                custom_enabled = true;
                //code block
                $('#dtpfrom').html(moment(firstDay).format('L'));
                $('#dtpto').html(moment(lastDay).format('L'));
                break;
            default:
                //code block
        }
        $('#dtpfromMP').val(moment(firstDay).format('L'));
        $('#dtptoMP').val(moment(lastDay).format('L'));

        $(".search-date-field").prop('disabled', !custom_enabled);
    };

    $("#input_SearchMP").keyup(function () {
       
        var table = $("#ManualPaymentList").DataTable();
        table.search($(this).val()).draw();
    });

    function PopulateManualPayment() {
        var sURL = '@Url.Action("InvoicesSearchForPaymentResultData", "Customer", new { area = "Portal" })?customerId=' + @ViewBag.CustomerDetail.CustomerId;

            ManualPaymentList = $('#ManualPaymentList').DataTable({
                //"bProcessing": true,
                "bServerSide": false,
                "bDestroy": true,
                "sAjaxSource": sURL,
                "bLengthChange": false, //thought this line could hide the LengthMenu
                "bInfo": false,
                "bPaginate": false,
                "aLengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                "pageLength": 25, // default records per page
                "dom": '<"top">rt<"bottom"lp><"clear">'
                //"dom": "<'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'<'table-group-actions pull-right'>>r><'table-responsive't><'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'>>", // datatable layout
                ,
                columnDefs: [
                    {
                        targets: "tblInvoice_chk",
                        data: "",
                        className: "dt-center",
                        render: function (data, type, row, meta) {
                            return '<input rel="mgglchk" type="checkbox" style="margin-left: 5px;" id="inv' + row.InvoiceId + '_chk" name="inv' + row.InvoiceId + '_chk"  onchange="paymentcheckboxFun(this)" />';
                        }
                    },
                    {
                        targets: "tblInvoice_invoiceNo",
                        data: "InvoiceNo",
                        render: function (data, type, row, meta) {
                            var s = '<input type="hidden" id="inv' + row.InvoiceId + '_invoiceNo" value="' + data + '" />';
                            s += '<input type="hidden" id="inv' + row.InvoiceId + '_hasMultipleItems" value="' + row.HasMultipleLineItems + '" />';
                            s += '<a  onclick="btnOpenApplyPaymentForm(' + row.InvoiceId + ')">' + data + '</a>';
                            return s;
                        }
                    },
                    {
                        targets: "tblInvoice_invoiceDate",
                        data: "InvoiceDate",
                        type: "date",
                        render: function (data, type, row, meta) {
                            return moment(new Date(parseInt(data.substr(6)))).format("MM/DD/YYYY");
                        }
                    },
                    { targets: "tblInvoice_customerNo", data: "CustomerNo" },
                    { targets: "tblInvoice_customerName", data: "CustomerName" },
                    { targets: "tblInvoice_invoiceDesc", data: "Description" },
                    {
                        targets: "tblInvoice_invoiceAmt",
                        data: "Balance",
                        sClass: "clsAmounttd",
                        render: function (data, type, row, meta) {
                            return '<input type="text" id="inv' + row.InvoiceId + '_amount" value="' + parseFloat(data).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '" class="amount-format form-control input-sm payment-field Amttext" readonly="readonly" />';
                        }
                    },
                    {
                        targets: "tblInvoice_payment",
                        data: "",
                        sClass: "clsAmounttd",
                        render: function (data, type, row, meta) {
                            return '<input type="text" id="inv' + row.InvoiceId + '_totalPayment" name="inv' + row.InvoiceId + '_totalPayment" class="amount-format form-control input-sm payment-field payment-apply-field Amttext" />';
                        }
                    },
                    {
                        targets: "tblInvoice_balance",
                        data: "Balance",
                        sClass: "clsAmounttd",
                        render: function (data, type, row, meta) {
                            return ' <input type="text" id="inv' + row.InvoiceId + '_balance" name="inv' + row.InvoiceId + '_balance" value="' + parseFloat(data).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '" class="amount-format form-control input-sm payment-field Amttext" readonly="readonly" />';
                        }
                    },
                ]
            });
    }

            function openApplyPaymentForm(id) {

            var form = null;

            var existingForm = $("#inv" + id + "_modal_applypaymentform");

            if ($(existingForm).length > 0) // already fetched form, so just display it again
            {
                form = existingForm;
                var inv = getInvoiceIdChunk(form);
                showApplyPaymentForm(inv);
            }
            else // first time loading form, so fetch by ajax
            {
                var sURL = '@Url.Action("ApplyManualPaymentForm", "Customer", new { area = "Portal" })?Id=' + id;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#div_applypaymentforms').append(data);
                        form = $('#div_applypaymentforms').children().last();

                        $(".date-picker").datepicker();

                        var inv = getInvoiceIdChunk(form);
                        initPaymentForm(inv);
                        showApplyPaymentForm(inv);
                    },
                    error: function () {
                        alert("Content load failed.");
                    }
                });
            }

         
        };

      


        function paymentcheckboxFun(item) {
            var inv = getInvoiceIdChunk(item);
            selectInvoice(inv);
        }

        function removeFormatting(i) {
            return typeof i === 'string' ?
                i.replace(/[\$,]/g, '') * 1 :
                typeof i === 'number' ?
                    i : 0;
        }

        function getInvoiceIdChunk(elem) {
            return $(elem).attr("id").split('_')[0];
        }
        function getInvoiceFilter(inv) {
            return "[id^=" + getInvoicePrefix(inv) + "]";
        }
        function getInvoicePrefix(inv) {
            return inv + "_";
        }
        function getInvoiceParentFormFilter(inv) {
            return "#" + getInvoicePrefix(inv) + "modal_applypaymentform ";
        }
        function commaSeparateNumber(val) {
            //if (val != "") {
            //    val =parseFloat(val).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()

            //    //while (/(\d+)(\d{3})/.test(val.toString())) {
            //    //    val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
            //    //}
            //}
            return val;
        }

        function commaSeparateNumber(val) {
            if (val != "") {
                val = parseFloat(val).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()

                //while (/(\d+)(\d{3})/.test(val.toString())) {
                //    val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
                //}
            }
            return val;
        }

    </script>