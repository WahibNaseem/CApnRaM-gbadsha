@model JKViewModels.Customer.ServiceCallLogModel
@{
    ViewBag.Title = "CollectionCallList";
    Layout = "~/Views/Shared/_Layout.cshtml";

    List<JKViewModels.AccountReceivable.AgingReportViewModel> AginList = new List<JKViewModels.AccountReceivable.AgingReportViewModel>();
    decimal currentTotal = 0;
    decimal oneMoTotal = 0;
    decimal twoMoTotal = 0;
    decimal threeMoTotal = 0;
    decimal fourMoTotal = 0;
    decimal fiveMoTotal = 0;
    decimal sixMoTotal = 0;
    if (ViewBag.AgingData != null)
    {
        AginList = (List<JKViewModels.AccountReceivable.AgingReportViewModel>)ViewBag.AgingData;
        foreach (var item in AginList)
        {
            currentTotal += Convert.ToDecimal(item.totalAmount);
            oneMoTotal += Convert.ToDecimal(item.onemo);
            twoMoTotal += Convert.ToDecimal(item.twomo);
            threeMoTotal += Convert.ToDecimal(item.threemo);
            fourMoTotal += Convert.ToDecimal(item.fourmo);
            fiveMoTotal += Convert.ToDecimal(item.fivemo);
            sixMoTotal += Convert.ToDecimal(item.sixmo);
        }
    }
}


@section styles{
    <link href="~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <style type="text/css">
        .no-padding {
            padding: 0;
        }

        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }


            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .credit-field {
            width: 80px !important;
        }

        .alignRight {
            text-align: right;
        }

        .alignCenter {
            text-align: center;
        }

        .close {
            background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
            height: 12px !important;
            width: 12px !important;
            margin-top: 0px !important;
        }

        .clstext-align {
            text-align: center;
        }

        #ui-datepicker-div {
            z-index: 99999 !important;
        }
    </style>

}

<div class="custom-form portlet light">
    <div class="headerbox">
        <div class="row">
            <div class="col-md-2">
            </div>
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-12 text-center" style="font-size:13px;">
                        <b>COLLECTION CALL LIST</b>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="row" style="text-align:right;">
                    @if (!string.IsNullOrEmpty(Convert.ToString(ViewBag.CustId)))
                    {
                        <b><a href="javascript:void(0);" onclick="redirect_list()" style="color:white;padding-right:20px;"> Show List</a></b>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="portlet-body form">
        <div class="form-body" style="padding-top:0px !important;margin-top: 0px !important;">
            <div class="form-group" style="margin-top: 0px !important;">
                <div class="row" style="background-color: #fff;background-color: #fff !important;margin-left:-18px !important;margin-right:-18px;">
                    <div class="col-md-12">
                        <div class="row" style="background-color: #4b85cc;color: #fff;padding-top:8px;padding-bottom:8px">
                            <div class="row no-padding">
                                @*<div class="col-sm-1 page-size">
                                        <select class="form-control input-sm" id="pageSize" style="padding-left:6px;">
                                            <option value="-1">All</option>
                                            <option value="100" selected>100</option>
                                            <option value="50">50</option>
                                            <option value="25">25</option>
                                        </select>
                                    </div>*@
                                <div class="col-md-4" style="margin-left: 10px;">
                                    <div class="input-icon">
                                        <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                                        <input id="csearch-box" type="text" required name="customernumber" autocomplete="off" placeholder="Search..." value="" class="form-control input-sm typeahead" />
                                    </div>
                                </div>

                                <div class="col-md-5 pull-right no-padding">

                                    <div class="col-md-10 pull-right no-padding" style="text-align:center;">
                                        <div class="col-md-6 no-padding" style="margin-left:30px;">
                                            <select id="select_timeduration" class="form-control input-sm">
                                                <option value="1">This Week</option>
                                                <option value="2">This Week-to-date</option>
                                                <option value="3" selected="selected">This Month</option>
                                                <option value="4">This Month-to-date</option>
                                                <option value="5">This Quarter</option>
                                                <option value="6">This Quarter-to-date</option>
                                                <option value="7">This Fiscal Year</option>
                                                <option value="8">This Fiscal Year-to-date</option>
                                                <option value="9">Today</option>
                                                <option value="10">Yesterday</option>
                                                <option value="11">Last Week</option>
                                                <option value="12">Last Month</option>
                                                <option value="13">Last Quarter</option>
                                                <option value="14">Last Year</option>
                                                <option value="15">Custom Date</option>
                                            </select>
                                        </div>
                                        <div class="col-md-5 divspandate no-padding" style="margin-top: 3px; margin-left: 0px; display: block; float: right;" id="divspandate">
                                            <span id="spnStartDate"></span> - <span id="spnEndtDate"></span>
                                        </div>
                                        <div class="col-md-3 no-padding" style="margin-left: 3px; width: 70px; display: none;" id="divSD">
                                            <input type="text" name="txtStartDate" id="txtStartDate" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                        </div>
                                        <div class="col-md-3 no-padding" style="margin-left: 3px; width: 70px; display: none;" id="divED">
                                            <input type="text" name="txtEndtDate" id="txtEndtDate" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @*<div class="col-md-6">
                                    <div class="col-md-2"></div>
                                    <div class="col-md-4 pnd5">
                                        <select id="select_timeduration" class="form-control input-sm">
                                            <option value="1">This Week</option>
                                            <option value="2">This Week-to-date</option>
                                            <option value="3" selected="selected">This Month</option>
                                            <option value="4">This Month-to-date</option>
                                            <option value="5">This Quarter</option>
                                            <option value="6">This Quarter-to-date</option>
                                            <option value="7">This Fiscal Year</option>
                                            <option value="8">This Fiscal Year-to-date</option>
                                            <option value="9">Today</option>
                                            <option value="10">Yesterday</option>
                                            <option value="11">Last Week</option>
                                            <option value="12">Last Month</option>
                                            <option value="13">Last Quarter</option>
                                            <option value="14">Last Year</option>
                                            <option value="15">Custom Date</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 pnd5" style="padding-top: 5px;" id="divspandate">
                                        <span id="spnStartDate">08/01/2017</span>&nbsp; To &nbsp;<span id="spnEndtDate">08/31/2017</span>
                                    </div>
                                    <div class="col-md-3 pnd5" style="display:none;" id="divSD">
                                        <input type="text" name="txtStartDate" id="dtpfrom" value="" class="form-control input-sm search-date-field date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                    </div>
                                    <div class="col-md-3 pnd5" style="display:none;" id="divED">
                                        <input type="text" name="txtEndtDate" id="dtpto" value="" class="form-control input-sm search-date-field date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                    </div>
                                </div>*@
                        </div>
                    </div>
                </div>
                <div class="col-md-12" style="background-color: #b3f1f1;">
                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-12" style="padding-right:0px;padding-left:0px;">
                            <div class="table-responsive" style="overflow-x:hidden;">
                                <table class="table-striped table-bordered order-column" style="width:100%;">
                                    <tr>
                                        <td>
                                            <div class="col-md-4">
                                                <div class="form-horizontal" style="width: 109%;">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0">
                                                            <input type="hidden" id="hdnCustId" value="@(ViewBag.CustId != null ? ViewBag.CustId : 0)" />
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px;">Customer No:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                @if (ViewBag.CustomerDetail != null)
                                                                {
                                                                    if (ViewBag.CustomerDetail.CustomerNo != null)
                                                                    {
                                                                        <label class="control-label" style="text-align:left!important;padding-top: 0px;font-weight:bold;"> @ViewBag.CustomerDetail.CustomerNo </label>
                                                                    }
                                                                }

                                                            </div>
                                                        </div>
                                                        <div class="form-group mr0">
                                                            <label class="col-md-4 control-label" style="padding-top: 0px;padding-left: 4px;padding-right: 4px;">Customer Name:</label>
                                                            <div class="col-md-8" style="padding-top: 0px;padding-left: 4px;padding-right: 4px;">
                                                                @if (ViewBag.CustomerDetail != null)
                                                                {
                                                                    if (ViewBag.CustomerDetail.CustomerName != null)
                                                                    {
                                                                        <label class="control-label" style="text-align:left!important;padding-top: 0px;font-weight:bold;">@ViewBag.CustomerDetail.CustomerName</label>
                                                                    }
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-horizontal" style="width: 109%;">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0">
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px;">Contact:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                @if (ViewBag.CustomerDetail != null)
                                                                {
                                                                    if (ViewBag.CustomerDetail.ContactName != null)
                                                                    {
                                                                        <label class="control-label" style="text-align:left!important;padding-top: 0px;font-weight:bold;"> @ViewBag.CustomerDetail.ContactName </label>
                                                                    }
                                                                }
                                                            </div>
                                                        </div>
                                                        <div class="form-group mr0">
                                                            <label class="col-md-4 control-label" style="padding-top: 0px;padding-left: 4px;padding-right: 4px;">Phone No:</label>
                                                            <div class="col-md-8" style="padding-top: 0px;padding-left: 4px;padding-right: 4px;">
                                                                @if (ViewBag.CustomerDetail != null)
                                                                {
                                                                    if (ViewBag.CustomerDetail.Phone != null)
                                                                    {
                                                                        <label class="control-label" style="text-align:left!important;padding-top: 0px;font-weight:bold;">@ViewBag.CustomerDetail.Phone </label>
                                                                    }
                                                                }

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-horizontal" style="width: 109%;">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0">
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px;">Total Call Log:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;font-weight:bold;"> @ViewBag.CollectionsCallLogCount </label>
                                                            </div>
                                                        </div>
                                                        <div class="form-group mr0">
                                                            <label class="col-md-4 control-label" style="padding-top: 0px;padding-left: 4px;padding-right: 4px;">Number Call Open:</label>
                                                            <div class="col-md-8" style="padding-top: 0px;padding-left: 4px;padding-right: 4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;">1</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-2" style="margin-top:-19px;">
                                                @*<div class="form-horizontal">*@
                                                <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                    <div class="form-group mr0" style="width:375px;">
                                                        <label class="col-md-4 control-label" style="font-weight:bold;">AR Status:</label>
                                                        <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                            <label class="control-label" style="margin-left:-50px; text-align:left!important;padding-top: 0px;">@(ViewBag.ARStatus != null ? ViewBag.ARStatus : string.Empty )  </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                @*</div>*@
                                            </div>
                                            <div class="col-md-2" style="margin-top:-19px;width:155px;">
                                                <div class="form-horizontal">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0" style="width:290px;">
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px; font-weight:bold; margin-left:-20px;">Current:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;">@string.Format("{0:C}", currentTotal) </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2" style="margin-top:-19px;width:155px;">
                                                <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                    <div class="form-group mr0" style="width:249px;">
                                                        <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px; font-weight:bold;">1 to 30 Days:</label>
                                                        <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                            <label class="control-label" style="text-align:left!important;padding-top: 0px;">@string.Format("{0:C}", oneMoTotal)</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2" style="margin-top:-19px;width:155px;">
                                                <div class="form-horizontal">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0" style="width:275px;">
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px; font-weight:bold;">31 to 60 Days:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;">@string.Format("{0:C}", twoMoTotal)</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2" style="margin-top:-19px;width:115px;">
                                                <div class="form-horizontal">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0" style="width:325px;">
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px; font-weight:bold;">61 to 90 Days:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;">@string.Format("{0:C}", threeMoTotal)</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2" style="margin-top:-19px;width:115px;">
                                                <div class="form-horizontal">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0" style="width:400px;">
                                                            <label class="col-md-4 control-label" style="padding-right: 4px;padding-top:0px; font-weight:bold;">120 Days:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;">@string.Format("{0:C}", fourMoTotal)</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2" style="margin-top:-19px;width:115px;">
                                                <div class="form-horizontal">
                                                    <div class="form-body" style="padding: 5px;padding-bottom:0px;">
                                                        <div class="form-group mr0" style="width:400px;">
                                                            <label class="col-md-4 control-label" style="padding-left: 4px;padding-right: 4px;padding-top:0px; font-weight:bold;">Total:</label>
                                                            <div class="col-md-8" style="padding-top:0px;padding-left: 4px;padding-right:4px;">
                                                                <label class="control-label" style="text-align:left!important;padding-top: 0px;">@string.Format("{0:C}", sixMoTotal)</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            @*<div class="col-md-2"></div>*@
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: 5px;">
                    <div class="col-md-12">
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="showServiceCallLog();" value="Log Call" style="margin-right:142px;" />
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="showEditCustomerInfo();" value="Customer Info" style="margin-right:20px;" />
                        <input type="button" class="btn btn-custom btn btn-primary" value="Contract Info" onclick="OpenCustomerContractPopup()" style="margin-right:20px;" />
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="FranchiseeDistribution();" value="Distribution " style="margin-right:20px;" />
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="CustomerInvoice();" value="Invoices" style="margin-right:20px;" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <input type="hidden" id="CutmID" value="@ViewBag.CustId" />
                            <table class="table table-striped table-bordered table-hover" id="tblCollectionCall">
                                <thead>
                                    <tr>
                                        <th style="width:60px;text-align:center;vertical-align:middle;" class="dtable_CustomerNo">
                                            Date/Time
                                        </th>
                                        <th style="text-align:center;width:93px;vertical-align:middle;" class="dtable_status">
                                            Status
                                        </th>
                                        <th style="text-align:center;width:64px;vertical-align:middle;" class="dtable_SpokeWith">
                                            Spoke With
                                        </th>
                                        <th style="text-align:center;width:50px;vertical-align:middle;" class="dtable_Action">
                                            Action
                                        </th>
                                        <th style="text-align:center;width:82px;vertical-align:middle;" class="dtable_CallBack">
                                            Call Back /  Follow-up By
                                        </th>
                                        @*<th style="text-align:center;width:50px;vertical-align:middle;" class="dtable_Completed">
                                                Status
                                            </th>*@
                                        <th style="text-align:center;width:200px;vertical-align:middle;" class="dtable_Comments">
                                            Comment
                                        </th>
                                        <th style="text-align:center;width:40px;vertical-align:middle;" class="dtable_ActionHistory">
                                            Action History
                                        </th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                                @*<tbody>
                                        @if (ViewBag.CollectionsCallLog != null)
                                        {
                                            foreach (var item in ViewBag.CollectionsCallLog)
                                            {
                                                <tr>
                                                    <td style="text-align:left;">
                                                        <input type="hidden" name="tdClassId" id="tdClassId" value="@item.ClassId" />
                                                        <a href="@Url.Action("CollectionCallList", "Customer", new { area = "Portal", id = item.ClassId })"> @item.CustomerNo<br />@item.CallDate.ToString("MM/dd/yyyy")<br />@item.CallTime</a>
                                                    <td style="text-align:center;">@item.status</td>
                                                    <td style="text-align:center;">@item.SpokeWith</td>
                                                    <td style="text-align:center;">@item.Action</td>
                                                    <td style="text-align:center;">@item.CallBack</td>
                                                    <td style="text-align:center;">Completed</td>
                                                    <td>@Html.Raw(HttpUtility.HtmlEncode(item.Comments))</td>
                                                    <td style="text-align:center;"></td>
                                                </tr>
                                            }
                                        }
                                    </tbody>*@
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal fade custom-model custom-form-design" id="modal_ServiceCallLog" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog" style="width:869px">
                        <div class="modal-content" style="border-radius: 8px;">
                            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                                    Collection Call Log
                                    @*<a href="Javascrpit:void(0)" onclick=Editfunction(); style="color:red"><b>Edit</b></a>*@
                                </h4>
                            </div>
                            <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                                @using (Html.BeginForm("CollectionsCallLog", "Customer", FormMethod.Post, new { @id = "frmCollectionsCallLog", @role = "form" }))
                                {
                                    @Html.HiddenFor(x => x.ClassId)
                                    @Html.HiddenFor(x => x.TypeListId, new { @Value = "1" })
                                    @Html.HiddenFor(x => x.RegionId)
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="padding-top: 0px;">
                                                    <span><b>Customer No.</b><span style="color:#000000;">&nbsp;:</span></span>
                                                </div>
                                                <div class="col-md-2">
                                                    @*<span><b>@ViewBag.CustomerDetail.CustomerNo</b></span>*@
                                                    <span><b><label id="CustomerNos"></label></b></span>
                                                </div>
                                                <div class="col-md-2">
                                                </div>
                                                <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;">
                                                    <span><b>Contact</b><span style="color:#000000;">&nbsp;:</span></span>
                                                </div>
                                                <div class="col-md-3">
                                                    <span><b><label id="ContactNames"></label></b></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="padding-top: 0px;">
                                                    <span><b>Customer Name</b><span style="color:#000000;">&nbsp;:</span></span>
                                                </div>
                                                <div class="col-md-4">
                                                    <span><b><label id="CustomerNames"></label></b></span>
                                                </div>
                                                <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;">
                                                    <span><b>Phone No</b><span style="color:#000000;">&nbsp;:</span></span>
                                                </div>
                                                <div class="col-md-3">
                                                    <span><b><label id="Phones"></label></b></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-6">
                                                    <div class="control-label" style="text-align:right;padding-right:65px;">
                                                        <label class="mt-radio" style="margin-bottom: 13px;">
                                                            <input class="i-checks" checked="checked" id="chkCallLog" name="chkCallLogType" type="radio" onclick="OnclickEventchkCallLog()">
                                                            <span></span>
                                                            Call Log
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="control-label" style="text-align:left;">
                                                        <label class="mt-radio" style="margin-bottom: 13px;">
                                                            <input class="i-checks" id="chkInternalOfficeNotes" name="chkCallLogType" type="radio" onclick="OnclickEventchkInternalOfficeNotes()">
                                                            <span></span>
                                                            Internal Office Notes
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" name="hdnActiveType" id="hdnActiveType" value="1" />

                                    <div class="form-group clscalllogtype">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Initiated By<span class="required"> * </span>
                                                </div>
                                                <div class="col-md-4">
                                                    @Html.DropDownListFor(x => x.InitiatedBy, new SelectList(ViewBag.InitiatedBy, "Value", "Key"), new { @class = "form-control input-sm", required = "required" })
                                                </div>
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Type<span class="required"> * </span>
                                                </div>
                                                <div class="col-md-4">
                                                    @Html.DropDownListFor(x => x.ServiceLogTypeListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallLogTypeList, new { @class = "form-control input-sm", required = "required" })
                                                    @*<select class="input-sm form-control"><option>Claim / Incident</option></select>*@
                                                </div>
                                                @*<div class="col-md-2 control-label" style="text-align:right;">
                                                        Area<span style="color:#000000;">&nbsp;:</span><span class="required"> * </span> <-- comment -->
                                                    </div>
                                                    <div class="col-md-4">
                                                        @Html.DropDownListFor(x => x.ServiceLogAreaListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallAreaList, new { @class = "form-control input-sm", required = "required" }) <-- comment -->
                                                        @Html.CheckBoxFor(x => x.boolInternal, new { @class = "checkbox-inline" }) &nbsp; Internal
                                                    </div>*@
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clscalllogtype">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Spoke With<span class="required"> * </span>
                                                </div>
                                                <div class="col-md-10">
                                                    @*<input type="text" class="input-sm form-control" />*@
                                                    @Html.TextBoxFor(x => x.SpokeWith, new { @class = "input-sm form-control" })
                                                </div>

                                                @*<div class="col-md-2 control-label" style="text-align:right;">
                                                        Type<span class="required"> * </span>
                                                    </div>
                                                    <div class="col-md-4">
                                                        @Html.DropDownListFor(x => x.ServiceLogTypeListId, (IEnumerable<SelectListItem>)ViewBag.ServiceCallLogTypeList, new { @class = "form-control input-sm", required = "required" })
                                                    </div>*@
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clscalllogtype">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Action<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-10">
                                                    @Html.TextBoxFor(x => x.Action, new { @class = "input-sm form-control" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clscalllogtype">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Comments<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-10">
                                                    @Html.TextAreaFor(x => x.Comments, new { @class = "input-sm form-control", @rows = "5", @style = "min-width: 667px;" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clscalllogtype">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Status<span style="color:#000000;">&nbsp;:</span><span class="required"> * </span>
                                                </div>
                                                <div class="col-md-4">
                                                    @*@Html.DropDownListFor(, ViewBag.StatusResultList, new { @class = "form-control input-sm", required = "required", @id = "StatusResultListId", @name = "StatusResultListId" })*@
                                                    @Html.DropDownListFor(x => x.StatusResultListId, (IEnumerable<SelectListItem>)ViewBag.StatusResultList, new { @class = "form-control input-sm", required = "required" })
                                                </div>
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    @*Call Back<span style="color:#000000;">&nbsp;:</span>*@
                                                    Call Back &nbsp;
                                                    <label class="mt-checkbox" style="margin-bottom: 13px;">
                                                        <input class="i-checks" data-val="true" data-val-required="field is required" id="chkIsCallBack" name="chkIsCallBack" type="checkbox" onclick="OnclickEvent()">
                                                        <input name="hdnIsCallBack" id="hdnIsCallBack" type="hidden" value="">
                                                        <span></span>
                                                    </label>
                                                </div>
                                                <div class="col-md-4">
                                                    @*<div class="input-group input-medium date" data-date-format="dd-mm-yyyy">
                                                            @Html.TextBoxFor(x => x.CallBack, new { @class = "form-control input-sm date" })
                                                            <span class="input-group-btn cal-btn">
                                                                <button class="btn default cal-btn" type="button">
                                                                    <i class="fa fa-calendar"></i>
                                                                </button>
                                                            </span>
                                                        </div>*@
                                                    <div class="col-md-6 clsdatetm" style="padding-right:2px; padding-left:0px;display:none;">
                                                        <input type="text" id="txtCallBack" name="txtCallBack" class="form-control input-sm date date-picker" placeholder="Date" />
                                                        @*@Html.TextBoxFor(x => x.CallBack, new { @class = "form-control input-sm date date-picker" })*@
                                                        <input type="hidden" name="CallBack" id="CallBack" value="@Model.CallDate" />
                                                    </div>
                                                    <div class="col-md-6 clsdatetm" style="padding-right:0px; padding-left:2px;display:none;">
                                                        <div class="input-icon">
                                                            <i class="fa fa-clock-o" style="margin-top:7px;"></i>
                                                            @Html.TextBoxFor(x => x.CallTime, new { @class = "form-control input-sm timepicker timepicker-default" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clscalllogtype">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Follow By<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-4">
                                                    @Html.DropDownListFor(x => x.FollowUpBy, (IEnumerable<SelectListItem>)ViewBag.ServiceCallFollowBy, new { @class = "form-control input-sm", required = "required" })
                                                    @*<select class="input-sm form-control">
                                                            <option>Option1</option>
                                                            <option>Option2</option>
                                                        </select>*@
                                                </div>

                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Email Call Notes to<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-4">
                                                    @*@Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "form-control input-sm", required = "required" })*@
                                                    @Html.HiddenFor(x => x.EmailNotesTo, new { @id = "hdnEmailNotesTo" })
                                                    @Html.ListBox("ddlEmailNotesTo", ViewBag.ServiceEmailCall as MultiSelectList, new { @id = "ddlEmailNotesTo", @class = "chosen-select form-control col-md-4 input-sm", data_placeholder = "--Select--" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    //Internal office note
                                    <div class="form-group clsinternalofficenote" style="display:none;">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Spoke With<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-4">
                                                    <input type="text" class="input-sm form-control" id="txtSpokeWith2" name="txtSpokeWith2" />
                                                </div>
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Type<span style="color:#000000;">&nbsp;:<span class="required">*</span></span>
                                                </div>
                                                <div class="col-md-4">
                                                    @Html.DropDownList("ddlServiceLogTypeListId2", (IEnumerable<SelectListItem>)ViewBag.ServiceCallLogTypeList, "All Type", new { @id = "ddlServiceLogTypeListId2", @class = "form-control input-sm", required = "required" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clsinternalofficenote" style="display:none;">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Action<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-10">
                                                    <input type="text" class="input-sm form-control" id="txtAction2" name="txtAction2" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clsinternalofficenote" style="display:none;">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Comments<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-10">
                                                    <textarea id="txtComments2" name="txtComments2" class="input-sm form-control" , rows="5" style="min-width: 667px;"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clsinternalofficenote" style="display:none;">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;"> Call Back:&nbsp;</div>
                                                <div class="col-md-1 control-label" style="text-align:left;width:30px;">
                                                    <label class="mt-checkbox" style="margin-bottom: 13px;">
                                                        <input id="chkIsCallBack2" name="chkIsCallBack2" type="checkbox">
                                                        <input name="hdnIsCallBack2" id="hdnIsCallBack2" type="hidden" value="">
                                                        <span></span>
                                                    </label>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="col-md-6 clsdatetm2" style="padding-right:2px; padding-left:0px;display:none;">
                                                        <input type="text" id="txtCallBack2" name="txtCallBack2" class="form-control input-sm date date-picker" placeholder="Date" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group clsinternalofficenote" style="display:none;">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Follow By<span style="color:#000000;">&nbsp;:<span class="required" id="spnreqfollowby2" style="display:none">*</span></span>                                                    
                                                </div>
                                                <div class="col-md-4">
                                                    @Html.DropDownList("ddlFollowUpBy2", (IEnumerable<SelectListItem>)ViewBag.ServiceCallFollowBy, "Select User", new { @id = "ddlFollowUpBy2", @class = "form-control input-sm", required = "required" })
                                                </div>

                                                <div class="col-md-2 control-label" style="text-align:right;">
                                                    Email Call Notes to<span style="color:#000000;">&nbsp;:</span>
                                                </div>
                                                <div class="col-md-4">
                                                    @*@Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "form-control input-sm", required = "required" })*@
                                                    <input type="hidden" id="hdnEmailNotesTo2" name="hdnEmailNotesTo2" />

                                                    @* @Html.DropDownListFor(x => x.EmailNotesTo, (IEnumerable<SelectListItem>)ViewBag.ServiceEmailCall, new { @class = "chosen-select form-control input-sm", required = "required" })*@
                                                    @Html.ListBox("ddlEmailNotesTo2", ViewBag.ServiceEmailCall as MultiSelectList, new { @id = "ddlEmailNotesTo2", @class = "chosen-select form-control col-md-4 input-sm", data_placeholder = "--Select--" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <hr style="margin-bottom: -10px;" />
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-12 text-right" style="padding:25px;">
                                                <input type="button" id="btnSaveSubmitForm" class="btn btn-primary btn-default" value="Save" />
                                                <input type="reset" class="btn btn-primary btn-default" value="Cancel" data-dismiss="modal" />
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <form class="form-horizontal" action="" id="form_Billingsetting" method="POST"></form>
                <!--Customer Contract-->
                <div class="modal fade custom-model custom-form-design" id="modal_CustomerContractPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog" style="width:785px">
                        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerContractDetails">
                        </div>
                    </div>
                </div>

                <div class="form-horizontal" action="" id="form_CustomerInvoice"></div>
                <div class="form-horizontal" action="" id="form_FranchiseeDistribution"></div>
                <div class="modal fade custom-model custom-form-design" id="modal_CustomerInvoice" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog" style="width:869px">
                        <div class="modal-content" style="border-radius: 8px;">
                            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                                    Invoice List
                                </h4>
                            </div>
                            <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover" id="tblinvoice">
                                        <thead>
                                            <tr>
                                                <th style="width:70px;text-align:center;">
                                                    INVOICE NO
                                                </th>
                                                <th style="text-align:center;width:30px;">
                                                    DATE
                                                </th>
                                                <th style="text-align:center;width:60px;">
                                                    CUSTOMER NAME
                                                </th>
                                                <th style="text-align:center;width:60px;">
                                                    CUSTOMER NO
                                                </th>
                                                <th style="text-align:center;width:70px;">
                                                    E/P
                                                </th>
                                                <th style="text-align:center;width:200px;">
                                                    DESCRIPTION
                                                </th>
                                                <th style="text-align:center;width:70px;">
                                                    AMOUNT
                                                </th>
                                                <th style="text-align:center;width:200px;">
                                                    BALANCE
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (ViewBag.CustomerInvoice != null)
                                            {
                                                foreach (var item in ViewBag.CustomerInvoice)
                                                {

                                                    <tr>
                                                        <td style="text-align:center;">@item.InvoiceNo</td>
                                                        <td style="text-align:center;">@Convert.ToDateTime(item.InvoiceDate).ToString("dd-MM-yyyy") </td>
                                                        <td style="text-align:center;">@item.CustomerName</td>
                                                        <td style="text-align:center;">@item.CustomerNo</td>
                                                        <td style="text-align:center;"></td>
                                                        <td style="text-align:justify;">@item.InvoiceDescription</td>
                                                        <td style="text-align:right;">@string.Format("{0:c}", item.OriginalTotal)</td>
                                                        <td style="text-align:right;">@string.Format("{0:c}", item.BalanceTotal)</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>

                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section pageplugins{

    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    @*<script src="@Url.Content("~/Content/admin/assets/global/scripts/app.min.js")" type="text/javascript" )"></script>*@
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-typeahead/bootstrap3-typeahead.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Content/admin/assets/global/plugins/select2/js/select2.full.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/additional-methods.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="/Content/chosen.css" />
    <script src="/Scripts/chosen.jquery.min.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.uniform.min.js"></script>
}


@section scripts{
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/components-date-time-pickers.min.js")" type="text/javascript"></script>

    <script>

        $(document).ready(function ($) {

            // $(".chosen-select").chosen({ no_results_text: "Oops, nothing found!" });

            $('#ddlEmailNotesTo').chosen();
            $('#ddlEmailNotesTo2').chosen();
        });
        //jQuery(document).ready(function () {
        //    var dtable = $('#tblCollectionCall').dataTable({
        //        "bAutoWidth": false,
        //        cache: false,
        //        "bSort": false,
        //        "order": false,
        //        "iDisplayLength": 25,
        //        "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
        //        "dom": '<"top">rt<"bottom"lp><"clear">',
        //        "aaSorting": false,

        //    });

        //    $("#input_Search").keyup(function () {
        //        var table = $("#tblCollectionCall").DataTable();
        //        table.search($(this).val()).draw();
        //    });
        //})
        jQuery(document).ready(function () {
            var dtable = $('#tblinvoice').dataTable({
                dom: 'Bfrtip',
                buttons: [
                     'excel', 'print'
                ],
                "bAutoWidth": false,
                cache: false,
                "bSort": false,
                "order": false,
                "iDisplayLength": 25,
                "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                "dom": '<"top">rt<"bottom"lp><"clear">',
                "aaSorting": false,

            });

            $("#CallBack").datepicker({ numberOfMonths: 1, });

        })

        $(document).ready(function () {
            @*$("#csearch-box").keyup(function () {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("Customerdata", "AccountReceivable", new { area = "Portal" })',
                    data: 'keyword=' + $(this).val(),
                    success: function (data) {
                        var typeaheadSource = [];
                        $.each(data, function (key, value) {
                            typeaheadSource.push({ id: value.CustomerId, name: value.CustomerNo + ' ' + $.trim(value.Name) })
                        });

                        $('#csearch-box').typeahead({
                            source: typeaheadSource,
                            updater: function (item) {
                                console.log(item);
                                redirect(item.id);
                                return item;
                            }
                        }).focus();
                    }
                });
            });*@


            applyAutoSeacrh();
        });
        $("#chkIsCallBack2").click(function () {
            if ($("#chkIsCallBack2").is(":checked")) {
                $("#hdnIsCallBack2").val("1");
                $(".clsdatetm2").show();
                $("#spnreqfollowby2").show();
            }
            else {
                $("#hdnIsCallBack2").val("0");
                $(".clsdatetm2").hide();
                $("#spnreqfollowby2").hide();
            }
        })
        function OnclickEvent() {
            if ($("#chkIsCallBack").is(":checked")) {
                $("#hdnIsCallBack").val("1");
                $(".clsdatetm").show();
            }
            else {
                $("#hdnIsCallBack").val("0");
                $(".clsdatetm").hide();
            }
        }

        function OnclickEventchkCallLog() {
            $(".clscalllogtype").show();
            $(".clsinternalofficenote").hide();
            $("#hdnActiveType").val(1);
        }

        function OnclickEventchkInternalOfficeNotes() {
            $(".clscalllogtype").hide();
            $(".clsinternalofficenote").show();
            $("#hdnActiveType").val(2);
        }

        function applyAutoSeacrh() {

            $.ajax({
                type: "GET",
                url: '@Url.Action("GetAllCustomer", "Customer", new { area = "Portal" })',
                data: {},
                success: function (data) {

                    var typeaheadSource = [];
                    $.each(data, function (key, value) {
                        typeaheadSource.push({ id: value.CustomerId, name: value.CustomerNo + ' ' + $.trim(value.Name) })
                    });
                    var box = $('#csearch-box').data('typeahead');
                    if (box != null) {

                        console.log('csearch source change');
                        box.source = typeaheadSource;
                    }
                    else {
                        console.log('csearch initiated');
                        $('#csearch-box').typeahead({
                            source: typeaheadSource,
                            updater: function (item) {
                                console.log(item);
                                redirect(item.id);
                                return item;
                            },
                            minLength: 1
                        }).focus();
                    }
                }
            });
        }
        function redirect(id) {
            var url = '/Portal/Customer/CollectionCallList/-1';
            var path = url.replace("-1", id);
            location.href = path;
        }
        function redirect_list() {
            location.href = '/Portal/Customer/CollectionCallList/';
        }

        function formatCurrency(total, dollar) {
            dollar = (dollar == true ? true : false);
            var neg = false;
            if (total < 0) {
                neg = true;
                total = Math.abs(total);
            }
            return (neg ? "-" : '') + (dollar ? "$" : "") + parseFloat(total, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString();
        };
    </script>

    <script>
        var dtable;
        function getTableURL() {
            var _fromDateVal = $('#spnStartDate').text();
            var _toDateVal = $('#spnEndtDate').text();
            var _searchtextVal = "";
            var _incClosed = "false";
            var _consolidated = $('#chkConsolidated').prop("checked");
            var sURL = '@Url.Action("CollectionCallListResultData", "Customer", new { area = "Portal" })?id=' + $("#hdnCustId").val() + '&fd=' + _fromDateVal + '&td=' + _toDateVal + '&st=' + _searchtextVal

            return sURL;
        }
        function refreshTable() {

            var surl = getTableURL();
            dtable.ajax.url(surl).load();

        }

        jQuery(document).ready(function () {

            $('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();

            $('#select_timeduration').val(3);
            firstDay = moment().subtract(0, 'month').startOf('month').toString();
            lastDay = moment().subtract(0, 'month').endOf('month').toString();
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));

            //$('#txtStartDate').inputmask("mm/dd/yyyy", {});
            //$('#txtEndtDate').inputmask("mm/dd/yyyy", {});

            //setSearchTime(3);
            var sURL = getTableURL();
            dtable = $('#tblCollectionCall').DataTable({
                //"bAutoWidth": false,
                //cache: false,
                //"order": false,
                //"sAjaxSource": sURL,
                //"iDisplayLength": 25,
                //"aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                //"dom": '<"top">rt<"bottom"lp><"clear">',
                //"aaSorting": false,
                "bServerSide": false,
                "sAjaxSource": sURL,
                "aLengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                "pageLength": 25, // default records per page
                "dom": '<"top">rt<"bottom"lp><"clear">',
                columnDefs: [
                    {
                        targets: "dtable_CustomerNo",
                        data: "",
                        render: function (data, type, row, meta) {
                            //return row.CustomerNo + ' <br />' + moment(new Date(parseInt(row.CallDate.substr(6)))).format("MM/DD/YYYY") + '<br />' + row.CallTime;
                            return row.CustomerNo + ' <br />' + moment(new Date(parseInt(row.CallDate.substr(6)))).format("MM/DD/YYYY") + '<br />' + tConvert(row.CallTime);

                        }
                    },
                    { targets: "dtable_status", data: "status", sClass: "clstext-align" },
                    { targets: "dtable_SpokeWith", data: "SpokeWith", sClass: "clstext-align" },
                    { targets: "dtable_Action", data: "Action", sClass: "clstext-align" },
                    {
                        targets: "dtable_CallBack",
                        data: "CallBack",
                        sClass: "clstext-align",
                        render: function (data, type, row, meta) {
                            if (row.CallBack != null && row.CallBack != "") {
                                return moment(new Date(parseInt(row.CallBack.substr(6)))).format("MM/DD/YYYY");
                            }
                            return "";
                        }
                    },
                    //{
                    //    targets: "dtable_Completed",
                    //    data: "",
                    //    sClass: "clstext-align",
                    //    render: function (data, type, row, meta) { return "" }
                    //},
                    { targets: "dtable_Comments", data: "Comments" },
                    {
                        targets: "dtable_ActionHistory", data: "",
                        render: function (data, type, row, meta) { return "" }
                    },
                ]

            });
            //$("#input_Search").keyup(function () {
            //    var table = $("#tblCollectionCall").DataTable();
            //    table.search($(this).val()).draw();
            //});
        })

        var date = new Date(), y = date.getFullYear(), m = date.getMonth();
        var firstDay;
        var lastDay;
        Date.prototype.getWeek = function (start) {
            //Calcing the starting point
            start = start || 0;
            var today = new Date(this.setHours(0, 0, 0, 0));
            var day = today.getDay() - start;
            var date = today.getDate() - day;

            // Grabbing Start/End Dates
            var StartDate = new Date(today.setDate(date));
            var EndDate = new Date(today.setDate(date + 6));
            return [StartDate, EndDate];
        }

        $('#txtStartDate').change(function () {
            $('#spnStartDate').html($(this).val());
            if ($('#txtStartDate').val() != '' && $('#txtEndtDate').val() != '')
                refreshTable();

        });
        $('#txtEndtDate').change(function () {
            $('#spnEndtDate').html($(this).val());
            if ($('#txtStartDate').val() != '' && $('#txtEndtDate').val() != '')
                refreshTable();
        });

        $(".search-date-field").on('changeDate', function (e) {
            refreshTable();
        });

        $('#select_timeduration').change(function () {

            //alert($(this).val());
            $('#spnStartDate').html('');
            $('#spnEndtDate').html('');
            $('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();
            switch (parseInt($(this).val())) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().toString();
                    lastDay = moment().toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 14:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 15:
                    //code block
                    $('#divspandate').hide();
                    $('#divSD').show();
                    $('#divED').show();
                    $('#txtStartDate').val('');
                    $('#txtEndtDate').val('')
                    break;
                default:
                    //code block
            }
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));

            //Set Values becuase due to Filter Is not working
            $('#dtpfrom').val(moment(firstDay).format('L'));
            $('#dtpto').val(moment(lastDay).format('L'));

            refreshTable();
            // _bindTrasaction($('#select_transactionstype').val(), moment(firstDay).format('L'), moment(lastDay).format('L'));
        });

    </script>

    <script type="text/javascript">
        function showServiceCallLog() {



            var CustomerID = $("#CutmID").val();
            if (CustomerID != "" && CustomerID != 0) {
                $.ajax({
                    type: "POST",
                    url: "/Customer/GetCustomerDataByID",
                    data: JSON.stringify({ "CustomerID": CustomerID }),
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {

                        $("#CustomerNos").empty();
                        $("#ContactNames").empty();
                        $("#CustomerNames").empty();
                        $("#Phones").empty();
                        $("#CustomerNos").append(data.CustomerNo);
                        $("#ContactNames").append(data.ContactName);
                        $("#CustomerNames").append(data.CustomerName);
                        $("#Phones").append(data.Phone);
                        $("#ClassId").val(data.CustomerId);
                        $("#RegionId").val(data.RegionId);
                        $("#modal_ServiceCallLog").modal({ backdrop: 'static' });
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            }
            else {
                swal({
                    title: "Oops",
                    text: "Please Select the Customer First",
                    allowOutsideClick: false,
                    html: true
                });
            }

        }
        function CustomerInfo() {
            $("#modal_Billingsetting").modal({ backdrop: 'static' });
        }
        function CustomerInvoice() {
            $("#modal_CustomerInvoice").modal({ backdrop: 'static' });
        }
        function EditContactfunction1() {
            $(".editmain1").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave1").removeAttr("disabled");
            $("#btnContactCancel1").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact1").hide();
            $("#btnContactSave1").show();
            $("#btnContactCancel1").show();


            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }
    </script>

    <script type="text/javascript">

        $(document).ready(function () {
            $.validator.messages.required = '';


            $('#chkbillingsameas').click(function () {
                var checked = $('#chkbillingsameas').is(':checked');

                var MainAddress_Name = $('#BillingContact_Name'),
                    MainAddress_Address1 = $('#BillingAddress_Address1'),
                    MainAddress_City = $('#BillingAddress_City'),
                    MainAddress_State = $('#BillingStatesList'),
                    MainAddress_PostalCode = $('#BillingAddress_PostalCode');

                if (checked) {
                    MainAddress_Name.val($('#CustomerViewModel_Name').val());
                    MainAddress_Address1.val($('#MainAddress_Address1').val());
                    MainAddress_City.val($('#MainAddress_City').val());
                    MainAddress_State.val($('#MainStatesList').val());
                    MainAddress_PostalCode.val($('#MainAddress_PostalCode').val());

                    MainAddress_Name.attr("readonly", "readonly");
                    MainAddress_Address1.attr("readonly", "readonly");
                    MainAddress_City.attr("readonly", "readonly");
                    MainAddress_State.attr("readonly", "readonly");
                    MainAddress_PostalCode.attr("readonly", "readonly");

                }
                else {
                    MainAddress_Name.val('');
                    MainAddress_Address1.val('');
                    MainAddress_City.val('');
                    MainAddress_State.val('');
                    MainAddress_PostalCode.val('');

                    MainAddress_Name.removeAttr("readonly");
                    MainAddress_Address1.removeAttr("readonly");
                    MainAddress_City.removeAttr("readonly");
                    MainAddress_State.removeAttr("readonly");
                    MainAddress_PostalCode.removeAttr("readonly");
                }
            });
            $('#chkbillingcontactsameas').click(function () {
                var MainContactAddress_FName = $('#BillingContactInformation2_Name'),
                    //MainContactAddress_LastName = $('#BillingContact_LastName'),
                    MainContactAddress_Title = $('#BillingContactInformation2_Title'),
                    MainContactAddress_Phone = $('#BillingPhone_Phone1'),
                    MainContactAddress_PhoneExt = $('#BillingPhone_PhoneExt'),
                    MainContactAddress_Cell = $('#BillingPhone_Cell'),
                    MainContactAddress_Fax = $('#BillingPhone_Fax'),
                    MainContactAddress_Email = $('#BillingEmail_EmailAddress');
                if ($(this).prop('checked')) {
                    MainContactAddress_FName.val($('#MainContact_Name').val());
                    // MainContactAddress_LastName.val($('#ContactInformation_LastName').val());
                    MainContactAddress_Title.val($('#MainContact_Title').val());
                    MainContactAddress_Phone.val($('#MainPhone2_Phone1').val());
                    MainContactAddress_PhoneExt.val($('#MainPhone2_PhoneExt').val());
                    MainContactAddress_Cell.val($('#MainPhone2_Cell').val());
                    MainContactAddress_Fax.val($('#MainPhone2_Fax').val());
                    MainContactAddress_Email.val($('#MainEmail_EmailAddress').val());

                    MainContactAddress_FName.attr("readonly", "readonly");
                    //MainContactAddress_LastName.attr("readonly", "readonly");
                    MainContactAddress_Title.attr("readonly", "readonly");
                    MainContactAddress_Phone.attr("readonly", "readonly");
                    MainContactAddress_PhoneExt.attr("readonly", "readonly");
                    MainContactAddress_Cell.attr("readonly", "readonly");
                    MainContactAddress_Fax.attr("readonly", "readonly");
                    MainContactAddress_Email.attr("readonly", "readonly");
                }
                else {
                    MainContactAddress_FName.val('');
                    //MainContactAddress_LastName.val('');
                    MainContactAddress_Title.val('');
                    MainContactAddress_Phone.val('');
                    MainContactAddress_PhoneExt.val('');
                    MainContactAddress_Cell.val('');
                    MainContactAddress_Fax.val('');
                    MainContactAddress_Email.val('');

                    MainContactAddress_FName.removeAttr("readonly");
                    //MainContactAddress_LastName.removeAttr("readonly");
                    MainContactAddress_Title.removeAttr("readonly");
                    MainContactAddress_Phone.removeAttr("readonly");
                    MainContactAddress_PhoneExt.removeAttr("readonly");
                    MainContactAddress_Cell.removeAttr("readonly");
                    MainContactAddress_Fax.removeAttr("readonly");
                    MainContactAddress_Email.removeAttr("readonly");
                }
            });

            // _bindTrasaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());

            $('.modal-dialog').draggable();


        });
    </script>

    <script>
        $("#btnSave").click(function () {
            var isvalid = true;

            if ($('#BillSetting_EffectiveDate').val().trim() == '') { $('#BillSetting_EffectiveDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillSetting_EffectiveDate').css('border-color', ''); }

            if (isvalid == true) {

                var BillSettingsId = 0;
                var EBill = 0;
                //var PrintInvoice = 0;
                var PrintPastDue = 0;
                var TaxExcempt = 0;
                var ConsolidatedInvoice = 0;


                if ($("#BillSetting_BillSettingsId").val() != undefined && $("#BillSetting_BillSettingsId").val() != "") {
                    BillSettingsId = $("#BillSetting_BillSettingsId").val();
                }
                if ($("#BillSetting_EBill").is(':checked')) {
                    EBill = 1;

                }
                //if ($("#BillSetting_PrintInvoice").is(':checked')) {
                //    PrintInvoice = 1;
                //}
                if ($("#BillSetting_PrintPastDue").is(':checked')) {
                    PrintPastDue = 1;
                }
                if ($("#BillSetting_TaxExcempt").is(':checked')) {
                    TaxExcempt = 1;
                }
                if ($("#BillSetting_ConsolidatedInvoice").is(':checked')) {
                    ConsolidatedInvoice = 1;
                }

                var CustBillSettings = { CustomerId: $("#CustomerViewModel_CustomerId").val(), BillSettingsId: BillSettingsId, ArStatus: $(".ddlArStatus").val(), EffectiveDate: $("#BillSetting_EffectiveDate").val(), InvoiceDateListId: $(".ddlInvoiceDate").val(), InvoiceTermListId: $(".ddlTermDate").val(), EBill: EBill, PrintPastDue: PrintPastDue, TaxExcempt: TaxExcempt, ConsolidatedInvoice: ConsolidatedInvoice, Note: $("#BillSetting_Notes").val(), EBillEmails: $("#hdfEBill_Emails").val() };

                $.ajax({
                    url: '@Url.Action("SaveBillSettings", "Customer")',
                    dataType: "json",
                    data: CustBillSettings,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }

        });

        $('#btnCancel').click(function () {

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");
            $("#btnSave").prop("disabled", "false");
            $("#btnSave").prop("readonly", "true");

            $("#btnCancel").prop("disabled", "false");
            $("#btnCancel").prop("readonly", "true");

            $("#EditBSetting").show();
            $("#btnSave").hide();
            $("#btnCancel").hide();

            //$('#modal_Billingsetting').hide();
            //$("#modal_Billingsetting").close();
            //$('.modal-backdrop').remove();
            // $('#modal_Billingsetting').dismiss('Cancel');

        });

        $('#btnContactSave1').click(function () {

            var isvalid = true;

            //if ($('#MainContact_FirstName').val().trim() == '') { $('#MainContact_FirstName').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainContact_FirstName').css('border-color', ''); }
            if ($('#MainAddress_Address1').val().trim() == '') { $('#MainAddress_Address1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_Address1').css('border-color', ''); }
            if ($('#MainAddress_City').val().trim() == '') { $('#MainAddress_City').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_City').css('border-color', ''); }
            if ($('#MainStatesList').val().trim() == '') { $('#MainStatesList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainStatesList').css('border-color', ''); }
            if ($('#MainAddress_PostalCode').val().trim() == '') { $('#MainAddress_PostalCode').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_PostalCode').css('border-color', ''); }

            if ($('#MainPhone_Phone1').val().trim() == '' || $('#MainPhone_Phone1').val() == NaN || parseInt($("#MainPhone_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#MainPhone_Phone1').css('border-color', 'red');
                if (isvalid == true) {
                    isvalid = false;
                }
            }
            else {
                $('#MainPhone_Phone1').css('border-color', '');
            }

            if (isvalid == true) {

                var AddressId = 0;
                var PhoneId = 0;

                if ($("#MainAddress_AddressId").val() != undefined && $("#MainAddress_AddressId").val() != "") {
                    AddressId = $("#MainAddress_AddressId").val();
                }
                if ($("#MainPhone_PhoneId").val() != undefined && $("#MainPhone_PhoneId").val() != "") {
                    PhoneId = $("#MainPhone_PhoneId").val();
                }

                var EditCustM1data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), AddressId: AddressId, Address1: $("#MainAddress_Address1").val(), Address2: $("#MainAddress_Address2").val(), City: $("#MainAddress_City").val(), StateId: $("#MainStatesList").val(), PostalCode: $("#MainAddress_PostalCode").val(), PhoneId: PhoneId, Phone1: $("#MainPhone_Phone1").val(), Fax: $("#MainPhone_Fax").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupMainContactTab1", "Customer")',
                    dataType: "json",
                    data: EditCustM1data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",

                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }
        });

        $('#btnContactCancel1').click(function () {
            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $("#btnContactSave1").prop("disabled", "false");
            $("#btnContactSave1").prop("readonly", "true");

            $("#btnContactCancel1").prop("disabled", "false");
            $("#btnContactCancel1").prop("readonly", "true");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();
        });

        $('#btnContactSave').click(function () {

            var isvalid = true;

            if ($('#MainContact_Name').val().trim() == '') { $('#MainContact_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainContact_Name').css('border-color', ''); }
            if ($('#MainPhone2_Phone1').val().trim() == '' || $('#MainPhone2_Phone1').val() == NaN || parseInt($("#MainPhone2_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#MainPhone2_Phone1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
            } else { $('#MainPhone2_Phone1').css('border-color', ''); }

            if ($('#MainEmail_EmailAddress').val().trim() != '') {
                if (!ValidateEmail($('#MainEmail_EmailAddress').val())) {
                    if (isvalid == true) { isvalid = false; }
                    $('#MainEmail_EmailAddress').css('border-color', 'red');
                } else { $('#MainEmail_EmailAddress').css('border-color', ''); }
            }
            if ($('#MainPhone2_Cell').val().trim() != '') {
                if (parseInt($("#MainPhone2_Cell").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                    $('#MainPhone2_Cell').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
                    $('#MainPhone2_Cell').css('border-color', 'red');
                } else { $('#MainPhone2_Cell').css('border-color', ''); }
            }


            if (isvalid == true) {

                var ContactId = 0;
                var PhoneId = 0;
                var EmailId = 0;

                if ($("#MainContact_ContactId").val() != undefined && $("#MainContact_ContactId").val() != "") {
                    ContactId = $("#MainContact_ContactId").val();
                }
                if ($("#MainPhone2_PhoneId").val() != undefined && $("#MainPhone2_PhoneId").val() != "") {
                    PhoneId = $("#MainPhone2_PhoneId").val();
                }
                if ($("#MainEmail_EmailId").val() != undefined && $("#MainEmail_EmailId").val() != "") {
                    EmailId = $("#MainEmail_EmailId").val();
                }

                var EditCustM2data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#MainContact_Name").val(), Title: $("#MainContact_Title").val(), PhoneId: PhoneId, Phone1: $("#MainPhone2_Phone1").val(), PhoneExt: $("#MainPhone2_PhoneExt").val(), Cell: $("#MainPhone2_Cell").val(), Fax: $("#MainPhone2_Fax").val(), EmailId: EmailId, EmailAddress: $("#MainEmail_EmailAddress").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupMainContactTab2", "Customer")',
                    dataType: "json",
                    data: EditCustM2data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",

                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }


        });
        $('#btnContactCancel').click(function () {
            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $("#btnContactSave").prop("disabled", "false");
            $("#btnContactSave").prop("readonly", "true");

            $("#btnContactCancel").prop("disabled", "false");
            $("#btnContactCancel").prop("readonly", "true");


            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();
        });

        $('#btnBContactSave1').click(function () {

            var isvalid = true;
            if ($('#BillingContact_Name').val().trim() == '') { $('#BillingContact_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingContact_Name').css('border-color', ''); }
            if ($('#BillingAddress_Address1').val().trim() == '') { $('#BillingAddress_Address1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_Address1').css('border-color', ''); }
            if ($('#BillingAddress_City').val().trim() == '') { $('#BillingAddress_City').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_City').css('border-color', ''); }
            if ($('#BillingStatesList').val().trim() == '') { $('#BillingStatesList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingStatesList').css('border-color', ''); }
            if ($('#BillingAddress_PostalCode').val().trim() == '') { $('#BillingAddress_PostalCode').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_PostalCode').css('border-color', ''); }

            if (isvalid == true) {

                var ContactId = 0;
                var BAddressId = 0;

                if ($("#BillingContact_ContactId").val() != undefined && $("#BillingContact_ContactId").val() != "") {
                    ContactId = $("#BillingContact_ContactId").val();
                }
                if ($("#BillingAddress_AddressId").val() != undefined && $("#BillingAddress_AddressId").val() != "") {
                    BAddressId = $("#BillingAddress_AddressId").val();
                }

                var EditCustB1data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#BillingContact_Name").val(), Attention: $("#BillingContact_Attention").val(), AddressId: BAddressId, Address1: $("#BillingAddress_Address1").val(), Address2: $("#BillingAddress_Address2").val(), City: $("#BillingAddress_City").val(), StateId: $("#BillingStatesList").val(), PostalCode: $("#BillingAddress_PostalCode").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupBillingTab1", "Customer")',
                    dataType: "json",
                    data: EditCustB1data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",

                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }
        });
        $('#btnBContactCancel1').click(function () {
            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $("#btnBContactSave1").prop("disabled", "false");
            $("#btnBContactSave1").prop("readonly", "true");

            $("#btnBContactCancel1").prop("disabled", "false");
            $("#btnBContactCancel1").prop("readonly", "true");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

        });

        $('#btnBContactSave').click(function () {

            //var data = $("form").serialize();
            //alert(data);

            var isvalid = true;

            if ($('#BillingContactInformation2_Name').val().trim() == '') { $('#BillingContactInformation2_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingContactInformation2_Name').css('border-color', ''); }
            if ($('#BillingPhone_Phone1').val().trim() == '' || $('#BillingPhone_Phone1').val() == NaN || parseInt($("#BillingPhone_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#BillingPhone_Phone1').css('border-color', 'red');
                if (isvalid == true) { isvalid = false; }
            }
            else {
                $('#BillingPhone_Phone1').css('border-color', '');
            }
            if ($('#BillingEmail_EmailAddress').val().trim() != '') {
                if (!ValidateEmail($('#BillingEmail_EmailAddress').val())) {
                    if (isvalid == true) { isvalid = false; }
                    $('#BillingEmail_EmailAddress').css('border-color', 'red');
                } else { $('#BillingEmail_EmailAddress').css('border-color', ''); }
            }
            if ($('#BillingPhone_Cell').val().trim() != '') {
                if (parseInt($("#BillingPhone_Cell").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                    $('#BillingPhone_Cell').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
                    $('#BillingPhone_Cell').css('border-color', 'red');
                } else { $('#BillingPhone_Cell').css('border-color', ''); }
            }

            if (isvalid == true) {

                var ContactId = 0;
                var BPhoneId = 0;
                var BEmailId = 0;

                if ($("#BillingContactInformation2_ContactId").val() != undefined && $("#BillingContactInformation2_ContactId").val() != "") {
                    ContactId = $("#BillingContactInformation2_ContactId").val();
                }
                if ($("#BillingPhone_PhoneId").val() != undefined && $("#BillingPhone_PhoneId").val() != "") {
                    BPhoneId = $("#BillingPhone_PhoneId").val();
                }
                if ($("#BillingEmail_EmailId").val() != undefined && $("#BillingEmail_EmailId").val() != "") {
                    BEmailId = $("#BillingEmail_EmailId").val();
                }

                var EditCustB2data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#BillingContactInformation2_Name").val(), Title: $("#BillingContactInformation2_Title").val(), PhoneId: BPhoneId, Phone1: $("#BillingPhone_Phone1").val(), PhoneExt: $("#BillingPhone_PhoneExt").val(), Cell: $("#BillingPhone_Cell").val(), Fax: $("#BillingPhone_Fax").val(), EmailId: BEmailId, EmailAddress: $("#BillingEmail_EmailAddress").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupBillingTab2", "Customer")',
                    dataType: "json",
                    data: EditCustB2data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;

            }
        });
        $('#btnBContactCancel').click(function () {
            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $("#btnBContactSave").prop("disabled", "false");
            $("#btnBContactSave").prop("readonly", "true");

            $("#btnBContactCancel").prop("disabled", "false");
            $("#btnBContactCancel").prop("readonly", "true");

            $("#EditBContact").show();
            $("#btnBContactSave").hide();
            $("#btnBContactCancel").hide();
        });


        $("#btnEditDistribution").click(function () {

            $(".editvalue").addClass("editvaluetext");
            $(".editvalue").removeClass("editmode");
            //$("#btnSaveDistribution").show();
            //$("#btnEditDistribution").hide();
            $(".editvalue").removeAttr("disabled").removeAttr("readonly");
            $(".editcheck").removeAttr("disabled").removeAttr("readonly");
        });

        $("#btnSaveDistribution").click(function () {

            if (tempFRowLineNo > 0) {
                alert('save')
            }
            $(".editvalue").removeClass("editvaluetext");
            $(".editvalue").addClass("editmode");
            //$("#btnSaveDistribution").hide();
            //$("#btnEditDistribution").show();
            $(".editvalue").attr("readonly", "readonly");
            $(".editcheck").attr("disabled", "disabled");
            $(".editcheck").attr("readonly", "readonly");
        });

        function onlyDecimal(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) { }
                else { event.preventDefault(); }
                if ($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110)) event.preventDefault();
            });
        }
        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }
        function applyMaskCurrency(id) {
            $(id).inputmask("currency", {
                alias: 'currency',
                prefix: '$ ',
                digits: 2,
                autoUnmask: true,
                removeMaskOnSubmit: true,
                unmaskAsNumber: true,
                allowPlus: false,
                allowMinus: false,
                autoGroup: true,
                groupSeparator: ",",
            });
        }
        function OnClickContractDetailCancel() {
            $('#modal_CustomerContractPopup').modal("hide");
        }
        function ValidateEmail(email) {
            // Validate email format
            var expr = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
            return expr.test(email);
        };
    </script>

    <script>
        function showCustomerMaintenance(id) {
            var sURL = '@Url.Action("CustomerMaintenancePartial", "customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_customermaintenancem').html(data);

                    $('#form_customermaintenance').validate({ // initialize the plugin
                        // your rules and options,
                        errorPlacement: function () {
                            return false;  // suppresses error message text
                        }
                    });
                    $("#manediv").hide();
                    $("#divresumedate").hide();
                    $('#divlastservicedate').hide();
                    $("#divtable").hide();

                    $("#ddlStatus").prop('required', true);
                    $("#StatusDate").prop('required', true);

                    if ($("#ddlStatus").val() > 0) {
                        bindCustomerMaintenanceLoad_popup($("#ddlStatus").val());
                    }
                    $("#ddlStatus").change(function () {
                        var value = this.value;
                        bindCustomerMaintenanceLoad_popup(value);
                    });
                    $(".date-picker").datepicker();

                    $('#tblMaintance').dataTable({
                        "bProcessing": true,
                        "aLengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                        "pageLength": 200, // default records per page
                        "dom": "<'table-responsive't>"
                    });
                    $("#modal_customermaintenanceDetail").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }


        function bindCustomerMaintenanceLoad_popup(id) {
            var value = id;
            if (value == 1 || value == 4 || value == 0) {
                $("#manediv").hide();

                $("#ResumeDate").prop('required', false);
                $("#LastServiceDate").prop('required', false);
                $("#ddlReason").prop('required', false);
                $("#StatusNotes").prop('required', false);
            }
            else if (value == 3) {
                $("#manediv").show();
                $("#divtable").hide();
                $('#divlastservicedate').hide();
                $("#divresumedate").show();

                $("#ResumeDate").prop('required', true);
                $("#LastServiceDate").prop('required', false);
                $("#ddlReason").prop('required', true);
                $("#StatusNotes").prop('required', true);
            }
            else if (value == 2) {
                $("#manediv").show();
                $("#divresumedate").hide();
                $('#divlastservicedate').show();
                $("#divtable").show();

                $("#ResumeDate").prop('required', false);
                $("#LastServiceDate").prop('required', true);
                $("#ddlReason").prop('required', true);
                $("#StatusNotes").prop('required', true);
            }
        }


        function saveCustomerMaintenance() {
            var isValid = $('#form_customermaintenance').valid();
            if (!isValid || parseInt($('#hdfCustomerId').val()) == 0) {
                e.preventDefault(); //prevent the default action
            }
            else {
                $.ajax({
                    url: '@Url.Action("CustomerMaintenancePartial", "Customer",new { area = "Portal" })',
                    type: "POST",
                    data: $('#form_customermaintenance').serialize(),
                    success: function (res) {
                        $('#modal_customermaintenanceDetail').modal('hide');
                    },
                    error: function () { }
                });
            }

        };



        function ValidateEmail(email) {
            var expr = /^([\w-\.]+@@([\w-]+\.)+[\w-]{2,4})?$/;
            return expr.test(email);
        };
        $('#BillSetting_EBill').click(function () {
            var checkvalue = $('#BillSetting_EBill').prop('checked')
            if (checkvalue) {
                $('#btnshowbillingcontactemail').show();
            }
            else {
                $('#btnshowbillingcontactemail').hide();
            }

        });
        $('#btnshowbillingcontactemail').click(function () {

            bindEBillEmails();
            $('#divEBill_Emails').html('');
            $('#txtemailaddress_ebill').val('')
            var strEmail = '';
            $.each(ebill_email, function (index, value) {
                $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + value + '</span><br />');
                strEmail += (strEmail != "" ? "," : "") + value;
            });
            $('#mdlAppendemail').modal({ backdrop: 'static' });

        });

        $('#btnaddemailaddress_ebill').click(function () {

            if (!ValidateEmail($("#txtemailaddress_ebill").val())) {
                alert("Invalid email address.");
            }
            else {
                var strEmail = $('#hdfEBill_Emails').val();
                ebill_email.push($('#txtemailaddress_ebill').val());
                $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + $('#txtemailaddress_ebill').val() + '</span><br />');
                strEmail += (strEmail != "" ? "," : "") + $('#txtemailaddress_ebill').val();
                $('#hdfEBill_Emails').val(strEmail);
                $('#txtemailaddress_ebill').val('')
            }
        });


        function bindEBillEmails() {
            ebill_email = [];
            var strEma = $('#hdfEBill_Emails').val();
            $('#divEBill_Emails').html('');
            if (strEma.length > 0) {
                $.each(strEma.split(','), function (index, value) {
                    console.log(value);
                    ebill_email.push(value);
                });
            }
            else {
                if ($('#BillingEmail_EmailAddress').val() != '') {
                    $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + $('#BillingEmail_EmailAddress').val() + '</span><br />');
                    ebill_email.push($('#txtemailaddress_ebill').val());
                }
            }
        }
        function btnInvoiceWinClose() {
            $("#modal_invoicedetail").modal('hide');
        }

    </script>

    <script type="text/javascript">

        $("#btnSaveSubmitForm").click(function () {
            if ($("#chkCallLog").is(":checked")) {
                var isvalid = true;
                if ($('#InitiatedBy').val() == '') { $('#InitiatedBy').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#InitiatedBy').css('border-color', ''); }
                //if ($('#ServiceLogAreaListId').val() == '0') { $('#ServiceLogAreaListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogAreaListId').css('border-color', ''); }
                if ($('#ServiceLogTypeListId').val() == '0') { $('#ServiceLogTypeListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogTypeListId').css('border-color', ''); }
                if ($('#SpokeWith').val() == '') { $('#SpokeWith').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#SpokeWith').css('border-color', ''); }
                if ($('#StatusResultListId').val() == '0') { $('#StatusResultListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#StatusResultListId').css('border-color', ''); }
                if ($('#CallBack').val() == '0') { $('#CallBack').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#CallBack').css('border-color', ''); }

                var option_all = $("#ddlEmailNotesTo option:selected").map(function () {
                    return $(this).val();
                }).get().join(',');

                $("#hdnEmailNotesTo").val(option_all);
                if (isvalid == true) {
                    $("#frmCollectionsCallLog").submit();
                }
            }
            else {
                var isvalid = true;
                //if ($('#InitiatedBy').val() == '') { $('#InitiatedBy').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#InitiatedBy').css('border-color', ''); }
                //if ($('#ServiceLogAreaListId').val() == '0') { $('#ServiceLogAreaListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogAreaListId').css('border-color', ''); }
                if ($('#ddlServiceLogTypeListId2').val() == '0' || $('#ddlServiceLogTypeListId2').val() == '') { $('#ddlServiceLogTypeListId2').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ddlServiceLogTypeListId2').css('border-color', ''); }
                //if ($('#SpokeWith').val() == '') { $('#SpokeWith').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#SpokeWith').css('border-color', ''); }
                //if ($('#StatusResultListId').val() == '0') { $('#StatusResultListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#StatusResultListId').css('border-color', ''); }
                //if ($('#CallBack').val() == '0') { $('#CallBack').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#CallBack').css('border-color', ''); }

                //$("#CallBack").val($("#txtCallBack").val() + " " + $("#CallTime").val());
                //$("#CallBack").val($("#txtCallBack").val());

                $('#ddlFollowUpBy2').css('border-color', '');
                if ($("#chkIsCallBack2").is(":checked")) {
                    if ($('#ddlFollowUpBy2').val() == '0' || $('#ddlFollowUpBy2').val() == '') { $('#ddlFollowUpBy2').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ddlFollowUpBy2').css('border-color', ''); }
                }

                var option_all2 = $("#ddlEmailNotesTo2 option:selected").map(function () {
                    return $(this).val();
                }).get().join(',');

                $("#hdnEmailNotesTo2").val(option_all2);

                if (isvalid == true) {
                    $("#frmCollectionsCallLog").submit();
                }
            }
        });
        function AccountOffringModel() {
            $("#modal_AccountOffring").modal("show");
        }

        function SearchAccountOffer() {
            $("#modal_AccountOffringResult").modal("show");
        }

        function Editfunction() {
            $(".edit").removeAttr("disabled").removeAttr("readonly");
            $("#btnSave").removeAttr("disabled");
            $("#btnCancel").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBSetting").hide();
            $("#btnSave").show();
            $("#btnCancel").show();


            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

        }

        function EditContactfunction1() {
            $(".editmain1").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave1").removeAttr("disabled");
            $("#btnContactCancel1").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact1").hide();
            $("#btnContactSave1").show();
            $("#btnContactCancel1").show();


            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function EditContactfunction() {

            $(".editmain").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave").removeAttr("disabled");
            $("#btnContactCancel").removeAttr("disabled");
            //$(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact").hide(); btnContactSave1
            $("#btnContactSave").show();
            $("#btnContactCancel").show();

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function EditBContactfunction1() {
            $(".editbill1").removeAttr("disabled").removeAttr("readonly");
            $("#btnBContactSave1").removeAttr("disabled");
            $("#btnBContactCancel1").removeAttr("disabled");
            //$(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBContact1").hide();
            $("#btnBContactSave1").show();
            $("#btnBContactCancel1").show();


            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");
        }
        function EditBContactfunction() {
            $(".editbill").removeAttr("disabled").removeAttr("readonly");
            $("#btnBContactSave").removeAttr("disabled");
            $("#btnBContactCancel").removeAttr("disabled");
            // $(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBContact").hide();
            $("#btnBContactSave").show();
            $("#btnBContactCancel").show();


            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");
        }

    </script>

    <script type="text/javascript">
        function formatJSONDate(jsonDate) {
            if (jsonDate != "") {
                var dateString = jsonDate.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var month = currentTime.getMonth() + 1;
                var day = currentTime.getDate();
                var year = currentTime.getFullYear();
                var date = month + "/" + day + "/" + year;
                return date;
            }
            else
                return '';
        }

        function formatJSONTime(jsonTime) {
            if (jsonTime != "") {
                var dateString = jsonTime.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var hour = currentTime.getHours();
                var min = currentTime.getMinutes();
                var sec = currentTime.getSeconds();
                var time = hour + ":" + min + ":" + sec;
                return time;
            }
            else
                return '';
        }
        var typeaheadSource = [];
        function bindcustomerDetailDisLoad(customerid) {

        }
        function bindfrenchiseelistbox(lineno) {

            $("#fsearch-box_" + lineno).autocomplete({
                source: typeaheadSource,
                appendTo: $("#tblFranchiseeDistributionList"),
                select: function (event, ui) {
                    event.preventDefault();
                    tempFRowLineNo++;
                    tempRowDistribution = "";
                    tempRowDistribution += '<tr><td style="width:20px;text-align:center;">'
                    tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionFranchiseeId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionFranchiseeId_' + lineno + '_' + tempFRowLineNo + '" value="' + ui.item.value + '" />';
                    tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionContractDetailId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionContractDetailId_' + lineno + '_' + tempFRowLineNo + '" value="' + $("#ContractDetailId_" + lineno).val() + '" />';
                    tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionDetailId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionDetailId_' + lineno + '_' + tempFRowLineNo + '" value="' + ui.item.value + '" /><span>' + ui.item.label.split(' ')[0] + '</span></td>';
                    tempRowDistribution += '<td style="text-align:center;width:242px;">' + ui.item.label.replace(ui.item.label.split(' ')[0], "").trim() + '</td>';
                    tempRowDistribution += '<td style="text-align:center;width:30px;"><input type="text" rel="ContractDetailAmount_' + lineno + '" value="' + $("#ContractDetailAmount_" + lineno).val() + '" class="form-control input-sm editvalue" id="FranchiseeDistributionAmountId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionAmountId_' + lineno + '_' + tempFRowLineNo + '" style="margin-top:-6px;margin-bottom: -6px;" /></td>';
                    tempRowDistribution += '</tr>'
                    onlyDecimal('#FranchiseeDistributionAmountId_' + tempRowLineNo + '_' + tempFRowLineNo);
                    $("#fsearch-box").val("");
                    console.log(ui.item.label);
                    console.log(ui.item.value);

                    $("#hdffrenchiseedetail_linecount").val(tempFRowLineNo);
                }
            });


        }
        var editFranchiseeDistribution = function () {

            $(".editvalue").addClass("editvaluetext");
            $(".editvalue").removeClass("editmode");
            //$("#btnSaveDistribution").show();
            //$("#btnEditDistribution").hide();
            $(".editvalue").removeAttr("disabled").removeAttr("readonly");
            $(".editcheck").removeAttr("disabled").removeAttr("readonly");
        };

        function FranchiseeDistribution() {
            var id = $("#CutmID").val();
            var sURL = '@Url.Action("CustomerDetailFranchiseeDistribution", "Customer", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_FranchiseeDistribution').html(data);

                    $(".editvalue").removeClass("editvaluetext");
                    $(".editvalue").addClass("editmode");
                    $(".editvalue").attr("readonly", "readonly");
                    //$("#btnSaveDistribution").hide();
                    //$("#btnEditDistribution").show();
                    $(".editcheck").attr("disabled", "disabled");
                    $(".editcheck").attr("readonly", "readonly");

                    FranchiseeDistributionData(id);
                    bindcustomerDetailDisLoad(id);
                    $('.modal-dialog').draggable();
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }


        var FDistributionFinal = [];

        var tempRowDistribution = "";
        var tempRowLineNo = 0;
        var tempFRowLineNo = 0;

        function FranchiseeDistributionData(id) {
            $('#hdffrenchiseedetail_customerid').val(id);
            var sURL = '@Url.Action("GetCustomerFranchiseeDistributionData", "Customer", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    $('#hdfdistributioncustomerid').val(data.CustomerId);
                    $('#spnCustomerName').html(data.CustomerName);
                    $('#spnCustomerNo').html(data.CustomerNo);
                    $('#tblFranchiseeDistributionList>tbody').html('');
                    tempRow = "";
                    tempRow += '<tr><td style="width:20px;text-align:center;">' + data.PurchaseOrderNo + '</td>';
                    tempRow += '<td style="text-align:left;width:140px;">' + data.AccountTypeName + '</td>';
                    tempRow += '<td style="text-align:center;width:30px;">' + data.Term + '</td>';
                    tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDate(data.StartDate) + '</td>';
                    tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDate(data.ExpirationDate) + '</td>';
                    tempRow += '<td style="text-align:right;width:30px;">$<span>' + data.TotalAmount + '</span></td>';
                    tempRow += '<td style="text-align:center;width:30px;">' + data.Status + '</td>';

                    tempRow += '<tr><td colspan="7" style="padding:5px;"><div class="table-responsive">';
                    tempRow += '<table class="table table-striped table-bordered table-hover order-column" id="FranchiseeDistributionDetailList">';
                    tempRow += '<thead>';
                    tempRow += '<tr><th style="width:150px;text-align:center;">Contract Detail Line</th>';
                    tempRow += '<th style="text-align:center;"> Service Description</th>';
                    tempRow += '<th style="width:120px;text-align:center;">Amount</th>';
                    tempRow += '<th style="width:100px;text-align:center;">Frequency</th>';
                    tempRow += '<th style="width:50px;text-align:center;">Schedule</th>';
                    tempRow += '</tr></thead><tbody></tbody></table></div></td></tr>';


                    $('#tblFranchiseeDistributionList>tbody').append(tempRow);
                    $('#ddldetaillinenumber').html('');
                    var lineitems = []; lineitems.push("<option value='0'>Select</option>");

                    $.each(data.listContractDetail, function (index, value) {
                        tempRowLineNo = value.LineNumber;
                        tempRowDistribution = "";
                        tempRowDistribution += '<tr>'
                        tempRowDistribution += '<td style="text-align:center;"><input type="hidden" relcdamt="cd_relcdamt" id="cd_relcdamt' + tempRowLineNo + '" value="' + value.Amount + '" />'
                        tempRowDistribution += value.LineNumber + '</td>';
                        tempRowDistribution += '<td style="text-align:center;">' + value.ServiceTypeName + '</td>';
                        tempRowDistribution += '<td style="text-align:right;"><input type="text" value="' + value.Amount + '" class="form-control input-sm editvalue" style="text-align:right;" readonly="readonly"/></td>';
                        tempRowDistribution += '<td style="text-align:center;">' + value.BillingFrequencyListName + '</td>';
                        tempRowDistribution += '<td style="text-align:center;"><a href="javascript:void(0);" onclick="Franchiseeservice(' + value.Mon + ',' + value.Tues + ',' + value.Wed + ',' + value.Thur + ',' + value.Fri + ',' + value.Sat + ',' + value.Sun + ')">View</a></td>'
                        tempRowDistribution += '</tr>'

                        $('#FranchiseeDistributionDetailList>tbody').append(tempRowDistribution);

                        lineitems.push("<option value=" + value.ContractDetailId + ">" + value.LineNumber + "</option>");

                        $('#frdestributionTable>tbody').html('');
                        var flineNo = 0;
                        $.each(data.listFranchiseeDistribution, function (index, value) {
                            AppendDistribution(value.DetailLineNumber, value.FranchiseeId, value.FranchiseeNo, value.FranchiseeName, value.Amount, value.ContractDetailId, value.DistributionId);
                        }),
                        bindfrenchiseelistbox(tempRowLineNo);


                    });

                    $('#ddldetaillinenumber').html(lineitems.join(' '));

                    $("#hdfcontractdetail_linecount").val(tempRowLineNo);
                    $("#hdffrenchiseedetail_linecount").val(tempFRowLineNo);

                    $("#modal_FranchiseeDistribution").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });


        }
        function showEditCustomerInfo() {

            var Id = $("#hdnCustId").val();
            if (Id != "" && Id != "0") {
                var sURL = '@Url.Action("PendingApprovalListEditCustomerPopup", "Customer", new { area = "Portal" })?id=' + Id;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#form_Billingsetting').html(data);
                        $("#ModalEditCustomerInfo").modal({ backdrop: 'static' });
                        $(".input-group-btn").click(function () {
                            $(this).prev().trigger("focus");
                            $(this).prev().trigger("focus");
                        });
                        $(".date-picker").datepicker();
                        $(".edit").attr("disabled", "disabled");
                        $(".edit").attr("readonly", "readonly");

                        $("#btnSave").prop("disabled", "false");
                        $("#btnSave").prop("readonly", "true");
                        $("#btnCancel").prop("disabled", "false");
                        $("#btnCancel").prop("readonly", "true");
                        $("#btnSave").hide();
                        $("#btnCancel").hide();

                        $(".editmain1").attr("disabled", "disabled");
                        $(".editmain1").attr("readonly", "readonly");
                        $(".editmain").attr("disabled", "disabled");
                        $(".editmain").attr("readonly", "readonly");

                        $(".editbill1").attr("disabled", "disabled");
                        $(".editbill1").attr("readonly", "readonly");
                        $(".editbill").attr("disabled", "disabled");
                        $(".editbill").attr("readonly", "readonly");

                        $(".EditBtn").show();
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();

                    },
                    error: function () {
                        alert("Content load failed.");
                    }
                });
            }
        }
        function OpenCustomerContractPopup() {

            var Id = $("#hdnCustId").val();
            if (Id != "" && Id != "0") {

                var sURL = '@Url.Action("RenderCustomerContractDetails", "Customer", new { area = "Portal" })?id=' + Id;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#RenderCustomerContractDetails').html(data);
                        $(".date-picker").datepicker();
                        $(".input-group-btn").click(function () {
                            $(this).prev().trigger("focus");
                            $(this).prev().trigger("focus");
                        });
                        contractDetailPopupInIt();
                        $("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
                    },
                    error: function () {
                        alert("Content load failed.");
                    }
                });
            }
            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }

        function tConvert(time) {
            var timeString = time;
            var H = +timeString.substr(0, 2);
            var h = (H % 12) || 12;
            var ampm = H < 12 ? " AM" : " PM";
            timeString = h + timeString.substr(2, 3) + ampm;
            return timeString;
        }
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#tblCollectionCall > tbody > tr").click(function () {
                window.location = '/Portal/Customer/CollectionCallList/' + $(this).find("[id=tdClassId]").val();
            })
        })
    </script>
}
