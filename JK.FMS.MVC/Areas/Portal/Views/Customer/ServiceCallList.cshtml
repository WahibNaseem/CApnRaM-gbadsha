@*@model List<JKViewModels.Customer.ServiceCallLogModel*@ @model JKViewModels.Customer.ServiceCallLogModel
@{
    ViewBag.Title = "ServiceCallList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    JKViewModels.Customer.FullCustomerViewModel CustModel = new JKViewModels.Customer.FullCustomerViewModel();
    if (ViewBag.CustomerDetail != null)
    {
        CustModel = (JKViewModels.Customer.FullCustomerViewModel)ViewBag.CustomerDetail;
    }
    JKViewModels.Franchisee.FranchiseeBasicInfo FranModel = new JKViewModels.Franchisee.FranchiseeBasicInfo();
    if (ViewBag.FranchiseeInfo != null)
    {
        FranModel = (JKViewModels.Franchisee.FranchiseeBasicInfo)ViewBag.FranchiseeInfo;
    }
    List<JKViewModels.AccountReceivable.AgingReportViewModel> AginList = new List<JKViewModels.AccountReceivable.AgingReportViewModel>();
    decimal currentTotal = 0;
    decimal oneMoTotal = 0;
    decimal twoMoTotal = 0;
    decimal threeMoTotal = 0;
    decimal fourMoTotal = 0;
    decimal fiveMoTotal = 0;
    decimal sixMoTotal = 0;
    if (ViewBag.AgingData != null)
    {
        AginList = (List<JKViewModels.AccountReceivable.AgingReportViewModel>)ViewBag.AgingData;
        foreach (var item in AginList)
        {
            currentTotal += Convert.ToDecimal(item.totalAmount);
            oneMoTotal += Convert.ToDecimal(item.onemo);
            twoMoTotal += Convert.ToDecimal(item.twomo);
            threeMoTotal += Convert.ToDecimal(item.threemo);
            fourMoTotal += Convert.ToDecimal(item.fourmo);
            fiveMoTotal += Convert.ToDecimal(item.fivemo);
            sixMoTotal += Convert.ToDecimal(item.sixmo);
        }
    }
}
@section styles{
    <link href="~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/Content/admin/assets/Card/dist/card.css" rel="stylesheet" />
    <link href="~/Content/admin/assets/global/plugins/bootstrap-sweetalert/sweetalert.css" rel="stylesheet" />
    <link href="~/Content/admin/assets/global/plugins/wow-alert-master/css/wow-alert.css" rel="stylesheet" />
    <style type="text/css">
        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }


            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .no-padding {
            padding: 0;
        }

        .credit-field {
            width: 80px !important;
        }

        .alignRight {
            text-align: right;
        }

        .alignCenter {
            text-align: center;
        }

        .close {
            background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
            height: 12px !important;
            width: 12px !important;
            margin-top: 0px !important;
        }

        #ui-datepicker-div {
            z-index: 99999 !important;
        }

        .clsmodelbody {
            padding: 0px 10px 15px 10px !important;
        }
    </style>
    <style type="text/css">
        .has-error {
            border-color: red;
        }

        .custom-form .btn {
            margin-bottom: 5px;
        }

        .sweet-alert {
            z-index: 59999;
        }

        .pnd5 {
            padding: 5px;
        }

        .control-label.text-left {
            text-align: left;
        }

        .editvaluetext {
            background-color: white;
            showBillsetting border-style: inherit;
        }

        .editmode {
            background-color: initial;
            border-style: hidden;
        }

        .ui-autocomplete {
            z-index: 9999 !important;
        }

        .btn-custom {
            font-size: 11px;
            padding: 10px 0px;
        }

        /*input:focus, textarea:focus,select:focus {
            border-color: initial;
        }

        input.error, textarea.error,select:focus {
            border: 1px solid red;
        }*/
        .close {
            background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
            height: 12px !important;
            width: 12px !important;
            margin-top: 0px !important;
        }

        tr > td {
            font-size: 11px !important;
            padding: 4px !important;
        }

        /*tr > th {
            font-size: 10px !important;
        }*/

        /*.row {
            margin: 0;
            padding: 5px 0;
        }*/
        .modal-body .row {
            margin: 0;
            padding: 5px 0;
        }

        .opendiv {
            padding: 4px;
            background-color: gold;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .closeddiv {
            padding: 4px;
            background-color: limegreen;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overpaiddiv {
            padding: 4px;
            background-color: deepskyblue;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .overduediv {
            padding: 4px;
            background-color: orangered;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .btn {
            padding: 3px 12px;
            font-size: 12px;
        }

        .alignRight {
            text-align: right;
        }

        .alignleft {
            text-align: left;
        }

        .alignCenter {
            text-align: center;
        }



        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .credit-field {
            width: 80px !important;
        }

        .txtright {
            text-align: right;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .modal-header:hover {
            cursor: move;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }

            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .payment-field {
            width: 80px !important;
        }

        .demo-container {
            width: 100%;
            max-width: 350px;
            margin: 10px auto;
        }

        form {
            margin: 30px;
        }

        .input-185 {
            width: 146px;
        }



        /*input {
            width: 200px;
            margin: 10px auto;
            display: block;
        }*/
        .Amttext {
            text-align: right;
        }

        .clsAmounttd {
            text-align: right !important;
        }

        .toppadding {
            margin-top: 0px;
        }

        .text-bottom {
            vertical-align: bottom !important;
        }

        input[type="radio"].bigger-radio {
            -ms-transform: scale(1.5); /* IE 9 */
            -webkit-transform: scale(1.5); /* Chrome, Safari, Opera */
            transform: scale(1.5);
            margin-bottom: 10px;
        }
    </style>
}
<div class="modal fade custom-model custom-form-design" id="modal_CustomerMoreDetailsPopup" tabindex="-1" role="basic" style="display: none;">
    <div class="modal-dialog" style="width:785px" id="RenderCustomerMoreDetails">
    </div>
</div>
<div class="custom-form portlet light">
    <div class="headerbox">
        <div class="row">
            <div class="col-md-10">
                <div class="row">
                    <div class="col-md-12 text-center" style="font-size:13px;">
                        <b>CS-Services Call Log</b>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="row" style="text-align:right;">
                    @if (!string.IsNullOrEmpty(Convert.ToString(ViewBag.CustId)))
                    {
                    <b><a href="javascript:void(0);" onclick="redirect_list()" style="color:white;padding-right:20px;"> Show List</a></b>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="portlet-body form">
        <div class="form-body" style="padding-top:0px !important;margin-top: 0px !important;">
            <div class="form-group" style="margin-top: 0px !important;">
                <div class="row" style="background-color: #fff !important;margin-left:-18px !important;margin-right:-18px;">
                    <div class="col-md-12">
                        <div class="row no-padding" style="background-color: #4b85cc;color: #fff;padding-top:8px;padding-bottom:8px">
                            @*<div class="col-md-6">
                                    <div class="col-md-8" style="margin-left:-16px;">
                                        <div class="input-icon">
                                            <i class="icon-magnifier icon-align-Customer No
                                               Customer No" style="margin-top: 8px;"></i>
                                            <input id="csearch-box" type="text" required name="customernumber" autocomplete="off" placeholder="Search..." value="" class="form-control input-sm typeahead" />
                                        </div>
                                        <div id="container">
                                        </div>
                                    </div>
                                </div>*@
                            <div class="col-sm-1 page-size">
                                <select class="form-control input-sm" id="pageSize" style="padding-left:6px;">
                                    <option value="-1">All</option>
                                    <option value="100" selected>100</option>
                                    <option value="50">50</option>
                                    <option value="25">25</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <div class="input-icon">
                                    <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                                    <input id="csearch-box" type="text" required name="customernumber" autocomplete="off" placeholder="Search...." value="" class="form-control input-sm typeahead" />
                                </div>
                            </div>
                            <div class="col-md-5 pull-right no-padding">
                                <div class="col-md-10 pull-right no-padding" style="text-align:center;min-width:380px;">
                                    <div class="col-md-6 no-padding" style="margin-left:30px;">
                                        <select id="select_timeduration" class="form-control input-sm">
                                            <option value="1">This Week</option>
                                            <option value="2">This Week-to-date</option>
                                            <option value="3">This Month</option>
                                            <option value="4">This Month-to-date</option>
                                            <option value="5">This Quarter</option>
                                            <option value="6">This Quarter-to-date</option>
                                            <option value="7" selected="selected">This Fiscal Year</option>
                                            <option value="8">This Fiscal Year-to-date</option>
                                            <option value="9">Today</option>
                                            <option value="10">Yesterday</option>
                                            <option value="11">Last Week</option>
                                            <option value="12">Last Month</option>
                                            <option value="13">Last Quarter</option>
                                            <option value="14">Last Year</option>
                                            <option value="15">Custom Date</option>
                                        </select>
                                    </div>
                                    <div class="col-md-5 divspandate no-padding" style="margin-top: 3px; margin-left: 0px; display: block; float: right;" id="divspandate">
                                        <span id="spnStartDate"></span> - <span id="spnEndtDate"></span>
                                    </div>
                                    <div class="col-md-3 no-padding" style="margin-left: 3px; width: 70px; display: none;" id="divSD">
                                        <input type="text" name="txtStartDate" id="dtpfrom" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                    </div>
                                    <div class="col-md-3 no-padding" style="margin-left: 3px; width: 70px; display: none;" id="divED">
                                        <input type="text" name="txtEndtDate" id="dtpto" value="" class="form-control input-sm date-picker RemovePeriodvalidation" style="padding: 3px;" />
                                    </div>
                                </div>
                            </div>
                            @*<div class="col-md-6">
                                    <div class="col-md-2"></div>
                                    <div class="col-md-4 pnd5">
                                        <select id="select_timeduration" class="form-control input-sm">
                                            <option value="1">This Week</option>
                                            <option value="2">This Week-to-date</option>
                                            <option value="3" selected="selected">This Month</option>
                                            <option value="4">This Month-to-date</option>
                                            <option value="5">This Quarter</option>
                                            <option value="6">This Quarter-to-date</option>
                                            <option value="7">This Fiscal Year</option>
                                            <option value="8">This Fiscal Year-to-date</option>
                                            <option value="9">Today</option>
                                            <option value="10">Yesterday</option>
                                            <option value="11">Last Week</option>
                                            <option value="12">Last Month</option>
                                            <option value="13">Last Quarter</option>
                                            <option value="14">Last Year</option>
                                            <option value="15">Custom Date</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 pnd5" style="padding-top: 5px;" id="divspandate">
                                        <span id="spnStartDate">08/01/2017</span>&nbsp; To &nbsp;<span id="spnEndtDate">08/31/2017</span>
                                    </div>
                                    <div class="col-md-3 no-padding" style="padding-top: 7px;display:none;" id="divSD">
                                        <input type="text" name="txtStartDate" id="txtStartDate" value="" class="form-control input-sm date-picker" style="padding: 3px;" />
                                    </div>
                                    <div class="col-md-3 no-padding" style="padding-top: 7px;display:none;" id="divED">
                                        <input type="text" name="txtEndtDate" id="txtEndtDate" value="" class="form-control input-sm date-picker" style="padding: 3px;" />
                                    </div>
                                </div>*@
                        </div>
                    </div>
                </div>
                <input type="hidden" id="hdnFranchiseeId" value="@ViewBag.DistributionFranchiseeId" />
                <input type="hidden" id="calFromSchedule" value="@ViewBag.CallFromSchedule" />
                <input type="hidden" id="hdnCallFromCustomer" value="@ViewBag.CallFromCustomer" />
                <input type="hidden" id="hdnCustId" value="@(ViewBag.CustId != null ? ViewBag.CustId : 0)" />
                <div class="col-md-12" style="background-color: #b3f1f1;">
                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-12" style="padding-right:0px;padding-left:0px;">
                            <div class="table-responsive" style="overflow-x:hidden;">
                                <div class="col-md-12">
                                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                                </div>
                                <div class="col-md-12">
                                    <table style="width:100%">
                                        <tbody>
                                            <tr>
                                                <td style="width:10%;"><label class="control-label"><b>No:</b></label>&nbsp;&nbsp;<label class="control-label"> @(CustModel.CustomerViewModel != null ? CustModel.CustomerViewModel.CustomerNo : string.Empty) </label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Name:</b></label>&nbsp;&nbsp;<label class="control-label">@(CustModel.CustomerViewModel != null ? CustModel.CustomerViewModel.Name : string.Empty) </label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Contract Type:</b> @ViewBag.ContractTypeName </label></td>
                                                <td style="width:10%;"><label class="control-label"><b></b> </label></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12">
                                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                                </div>
                                <div class="col-md-12" style="margin-top:0px;">
                                    <table style="width:100%;">
                                        <tbody>
                                            <tr>
                                                @{
                                                    string strdays = "";
                                                    if (CustModel.ContractDetail != null)
                                                    {
                                                        if (CustModel.ContractDetail.Mon == true) { strdays += "Mo "; }
                                                        if (CustModel.ContractDetail.Tues == true) { strdays += "Tu "; }
                                                        if (CustModel.ContractDetail.Wed == true) { strdays += "We "; }
                                                        if (CustModel.ContractDetail.Thur == true) { strdays += "Th "; }
                                                        if (CustModel.ContractDetail.Fri == true) { strdays += "Fr "; }
                                                        if (CustModel.ContractDetail.Sat == true) { strdays += "Sa "; }
                                                        if (CustModel.ContractDetail.Sun == true) { strdays += "Su "; }
                                                    }
                                                }
                                                <td style="width:10%;"><label class="control-label"><b>Clean Times:</b></label>&nbsp;&nbsp;<label class="control-label"> @(CustModel.ContractDetail != null ? Convert.ToString(CustModel.ContractDetail.CleanTimes) : string.Empty) Per @ViewBag.CleanFrequencyName (@strdays)</label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Billing:</b></label> &nbsp;&nbsp;<label class="control-label"> @(CustModel.Contract != null ? string.Format("{0:c}", CustModel.Contract.Amount) : string.Empty)</label></td>
                                                <td style="width:10%;"><label class="control-label"><b>AR Status:</b></label>&nbsp;&nbsp;<label class="control-label"> @(ViewBag.ARStatus != null ? ViewBag.ARStatus : string.Empty ) </label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Effective:</b></label>&nbsp;&nbsp;<label class="control-label">@((CustModel.BillSetting != null && CustModel.BillSetting.EffectiveDate != null) ? Convert.ToDateTime(CustModel.BillSetting.EffectiveDate).ToString("MM/dd/yyyy") : string.Empty)</label></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12" style="margin-top:-5px;">
                                    <table style="width:100%">
                                        <tbody>
                                            <tr>
                                                <td style="width:20%;"><label class="control-label"><b>Address:</b></label>&nbsp;&nbsp;<label class="control-label">@(CustModel.MainAddress != null ? CustModel.MainAddress.Address1 : string.Empty)  @(CustModel.MainAddress != null ? CustModel.MainAddress.Address2 : string.Empty) , @(CustModel.MainAddress != null ? CustModel.MainAddress.City : string.Empty) , @(CustModel.MainAddress != null ? CustModel.MainAddress.StateName : string.Empty)  @(CustModel.MainAddress != null ? CustModel.MainAddress.PostalCode : string.Empty) </label></td>
                                                <td style="width:20%;"><label class="control-label"><b>Natl Acct:</b></label>&nbsp;&nbsp;<label class="control-label">N</label></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12">
                                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                                </div>
                                <div class="col-md-12">
                                    <table style="width:100%">
                                        <tbody>
                                            <tr>
                                                <td style="width:10%;"><label class="control-label"><b>Contact :</b></label>&nbsp;&nbsp;<label class="control-label">@(CustModel.MainContact != null ? CustModel.MainContact.Name : string.Empty)</label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Phone :</b></label>&nbsp;&nbsp;<label class="control-label">@((CustModel.MainPhone != null && CustModel.MainPhone.Phone1 != null && CustModel.MainPhone.Phone1 != "") ? string.Format("{0:(###) ###-####}", Convert.ToDecimal(CustModel.MainPhone.Phone1.Trim().Replace(" ", "").Replace("-", "").Replace(")", "").Replace("(", ""))) : string.Empty)  <b>  Ext.</b> @(CustModel.MainPhone != null ? CustModel.MainPhone.PhoneExt : string.Empty) </label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Fax:</b></label>&nbsp;&nbsp;<label class="control-label">@((CustModel.MainPhone != null && CustModel.MainPhone.Fax != null && CustModel.MainPhone.Fax != "") ? string.Format("{0:(###) ###-####}", Convert.ToDecimal(CustModel.MainPhone.Fax.Trim().Replace(" ", "").Replace("-", "").Replace(")", "").Replace("(", ""))) : string.Empty) </label></td>
                                                @*<td style="width:10%;"><label class="control-label"><b>Email:</b></label>&nbsp;&nbsp;<label class="control-label">@(CustModel.MainEmail != null ? CustModel.MainEmail.EmailAddress : string.Empty)</label></td>*@
                                                <td style="width:10%;"><label class="control-label"><b>Email:</b></label>&nbsp;&nbsp;<label class="control-label"> <a href="mailto:@(CustModel.MainEmail != null ? CustModel.MainEmail.EmailAddress : string.Empty)">@(CustModel.MainEmail != null ? CustModel.MainEmail.EmailAddress : string.Empty)</a></label></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12">
                                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                                </div>
                                <div class="col-md-12">
                                    <table style="width:100%">
                                        <tbody>
                                            <tr>
                                                <td style="width:5%;"><label class="control-label"><b><u>Aging Status:</u></b></label>&nbsp;&nbsp;<label class="control-label"></label></td>
                                                <td style="width:5%;"><label class="control-label"><b>Current:</b></label>&nbsp;&nbsp;<label class="control-label">@string.Format("{0:C}", currentTotal)</label></td>
                                                <td style="width:5%;"><label class="control-label"><b>30-days:</b></label>&nbsp;&nbsp;<label class="control-label">@string.Format("{0:C}", oneMoTotal)</label></td>
                                                <td style="width:5%;"><label class="control-label"><b>60-days:</b></label>&nbsp;&nbsp;<label class="control-label">@string.Format("{0:C}", twoMoTotal)</label></td>
                                                <td style="width:5%;"><label class="control-label"><b>90-days:</b></label>&nbsp;&nbsp;<label class="control-label">@string.Format("{0:C}", threeMoTotal)</label></td>
                                                <td style="width:5%;"><label class="control-label"><b>120-days+:</b></label>&nbsp;&nbsp;<label class="control-label">@string.Format("{0:C}", fourMoTotal)</label></td>
                                                <td style="width:10%;"><label class="control-label"><b>Total:</b></label>&nbsp;&nbsp;<label class="control-label">@string.Format("{0:C}", sixMoTotal)</label></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12">
                                    <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;" />
                                </div>
                                <div class="col-md-4">
                                    <table style="width:100%;margin-top:5px; @(Convert.ToInt32(ViewBag.CustId) == 0 ?  "display:none" :string.Empty);">
                                        <tbody>
                                            <tr>
                                                <td style="width:10%;">
                                                    <label class="control-label"><b>Notes:</b></label>&nbsp;&nbsp;
                                                </td>
                                                <td>
                                                    <input type="hidden" id="hdnNoteId" value="@(ViewBag.notesDetailId != null ?ViewBag.notesDetailId:0)" />
                                                    <textarea class="input-sm form-control" id="txtnotes" name="txtnotes" rows="1" style="min-width:400px;" disabled="disabled">@ViewBag.custNotes</textarea>
                                                </td>
                                                <td style="width:10%;">
                                                    <a class="btn btn-custom btn btn-primary" style="margin-left:16px;" id="_edit" onclick="onClickEdit()">Edit</a>
                                                </td>
                                                <td style="width:10%;">
                                                    <a class="btn btn-custom btn btn-primary" style="margin-left:16px;display:none;" id="_save" onclick="onClickSave()">Save</a>
                                                </td>
                                                <td style="width:10%;">
                                                    <a class="btn btn-custom btn btn-primary" style="margin-left:16px;display:none;" id="_cancel" onclick="onClickCancel()">Cancel</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-2"></div>
                                <div class="col-md-4" style="padding-top: 15px;">
                                    @if (ViewBag.LogMessage != null)
                                    {
                                    <i class="fa fa-bell blinkcolor blink"></i> <label style="font-size:14px;">@ViewBag.LogMessage</label> <i class="fa fa-bell blinkcolor blink"></i>
                                    }
                                </div>
                                <div class="col-md-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
                @*<div class="row">
                            <div class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                                 <div class="col-md-8">
                                     <div class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                                         <div class="col-md-5">
                                             <label class="control-label"><b>Customer No:</b> @(CustModel.CustomerViewModel != null ? CustModel.CustomerViewModel.CustomerNo : string.Empty)</label>
                                         </div>
                                         <div class="col-md-4">
                                             <label class="control-label"><b>Contact:</b> @(CustModel.MainContact != null ? CustModel.MainContact.Name : string.Empty)</label>
                                         </div>
                                         <div class="col-md-3">
                                             <label class="control-label"><b>Total Call Log:</b> @ViewBag.ServiceCallLogCount</label>
                                         </div>
                                     </div>
                                 </div>
                                <div class="col-md-4">
                                    <div class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                                        <div class="col-md-6">
                                            <label class="control-label"><b>Franchisee No:</b> @(FranModel.FranchiseeNo != null ? FranModel.FranchiseeNo : string.Empty)</label>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="control-label"><b>Contact:</b> @(FranModel.FranchiseeContact != null ? FranModel.FranchiseeContact : string.Empty)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <div class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                            <div class="col-md-8">
                                <div class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                                    <div class="col-md-5">
                                        <label class="control-label"><b>Customer Name:</b> @(CustModel.CustomerViewModel != null ? CustModel.CustomerViewModel.Name : string.Empty)</label>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="control-label"><b>Phone: </b> @((CustModel.MainPhone != null && CustModel.MainPhone.Phone1 != null && CustModel.MainPhone.Phone1 != "") ? string.Format("{0:(###) ###-####}", Convert.ToDecimal(CustModel.MainPhone.Phone1.Trim().Replace(" ", "").Replace("-", "").Replace(")", "").Replace("(", ""))) : string.Empty) </label>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="control-label"><b>Number Call Open:</b></label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                                    <div class="col-md-6">
                                        <label class="control-label"><b>Franchisee Name:</b> @(FranModel.FranchiseeName != null ? FranModel.FranchiseeName : string.Empty)</label>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="control-label"><b>Phone:</b> @((FranModel.FranchiseePhone != null && FranModel.FranchiseePhone != null && FranModel.FranchiseePhone != "") ? string.Format("{0:(###) ###-####}", Convert.ToDecimal(FranModel.FranchiseePhone.Trim().Replace(" ", "").Replace("-", "").Replace(")", "").Replace("(", ""))) : string.Empty)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div  class="col-md-12"  style="padding-left:0px !important;padding-right:0px !important;">
                            <div class="col-md-8">
                                <div class="col-md-12" style="padding-left:0px !important;padding-right:0px !important;">
                                    <div class="col-md-5">
                                        <label class="control-label"><b>Contract Type:</b> @ViewBag.ContractTypeName </label>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@

                @*<div class="row" style="padding-left:14px;padding-right:14px;">
                        <div class="col-md-12" style="background-color: #b3f1f1;">
                            <div class="control-label col-md-2" style="padding-top:2px;padding-bottom:2px;margin-left:-16px;"><b>Customer No:</b></div>
                            @if (ViewBag.CustomerDetail != null)
                            {
                                if (ViewBag.CustomerDetail.CustomerNo != null)
                                {
                                    <div class="col-md-2" style="padding-left:0px;">@ViewBag.CustomerDetail.CustomerNo</div>
                                }
                            }
                            <div class="control-label col-md-2" style="margin:0 0 0 88px;"><b>Contact:</b></div>
                            @if (ViewBag.CustomerDetail != null)
                            {
                                if (ViewBag.CustomerDetail.ContactName != null)
                                {
                                    <div class="col-md-2" style="padding-left:0px;">@ViewBag.CustomerDetail.ContactName</div>
                                }
                            }
                            <div class="control-label col-md-2"><b>Total Call Log:</b></div>
                            @if (ViewBag.CustomerServiceCallLog != null && !(string.IsNullOrEmpty(Convert.ToString(ViewBag.CustId))))
                            {
                                <div class="col-md-2" style="margin:0 0 0 -88px;">@ViewBag.CustomerServiceCallLog.Count</div>
                            }
                        </div>
                        <div class="col-md-12" style="background-color: #b3f1f1;">
                            <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;margin-left: -14px;margin-right: -14px;" />
                        </div>
                    </div>
                    <div class="row" style="padding-left:14px;padding-right:14px;">
                        <div class="col-md-12" style="background-color: #b3f1f1;">
                            <div class="control-label col-md-2" style="padding-top:2px;padding-bottom:2px;margin-left:-16px;"><b> Customer Name:</b></div>
                            @if (ViewBag.CustomerDetail != null)
                            {
                                if (ViewBag.CustomerDetail.CustomerName != null)
                                {
                                    <div class="col-md-3" style="padding-left:0px;">@ViewBag.CustomerDetail.CustomerName</div>
                                }
                            }
                            <div class="control-label col-md-2"><b>Phone:</b></div>
                            @if (ViewBag.CustomerDetail != null)
                            {
                                if (ViewBag.CustomerDetail.Phone != null)
                                {
                                    <div class="col-md-2" style="padding-left:0px;">@ViewBag.CustomerDetail.Phone</div>
                                }
                            }
                            <div class="control-label col-md-2"><b>Number Call Open:</b></div>
                            <div class="col-md-2" style="padding-left:0px;"></div>

                        </div>
                        <div class="col-md-12" style="background-color: #b3f1f1;">
                            <hr style="margin-top: 0px;margin-bottom: 0px;border-top: 1px solid #cac0c0;margin-left: -14px;margin-right: -14px;" />
                        </div>
                    </div>

                    <div class="row" style="padding-left:14px;padding-right:14px;">
                        <div class="col-md-12" style="background-color: #b3f1f1;">
                            <div class="col-md-3" style="padding-top:2px;padding-bottom:2px;margin-left:-16px;">AR Status Effective: @DateTime.Now.ToString("MM/dd/yyyy")</div>
                            <div class="col-md-3">Aging Current: $0.00</div>
                            <div class="col-md-2">30 Days: $0.00</div>
                            <div class="col-md-2">60 Days: $0.00</div>
                            <div class="col-md-2">90 Days: $0.00</div>
                            <div class="col-md-2"></div>
                        </div>
                    </div>*@
                <div class="row" style="padding-top: 5px; @(Convert.ToInt32(ViewBag.CustId) == 0 ?  "display:none" :string.Empty);">
                    <div class="col-md-6">
                        @*<input type="button" class="btn btn-custom btn btn-primary" onclick="showServiceCallLog();" value="Log Call" style="margin-right:142px;" />*@
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="showServiceCallLogOpenPopup();" value="Log Call" style="margin-right:20px;margin-top:4px;" />
                        @*<input type="button" class="btn btn-custom btn btn-primary" onclick="showEditCustomerInfo();" value="Customer Info" style="margin-right:20px;margin-top:4px;" />*@
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="OpenCustomerDetailPopup('@(ViewBag.CustId != null ? ViewBag.CustId : 0)');" value="Customer" style="margin-right:20px;margin-top:4px;" />
                        @*<input type="button" class="btn btn-custom btn btn-primary" value="Contract Info" onclick="OpenCustomerContractPopup()" style="margin-right:20px;margin-top:4px;" />*@
                        @*<input type="button" class="btn btn-custom btn btn-primary" onclick="FranchiseeDistribution();" value="Distribution" style="margin-right:20px;" />*@
                        @*@if (ViewBag.Distributions != null)
                            {
                                if (CustModel.CustomerViewModel != null && (CustModel.CustomerViewModel.ContractTypeListId.HasValue ? CustModel.CustomerViewModel.ContractTypeListId.Value : 0) == (int)JKApi.Business.Enumeration.ContractTypeList.OneTime)
                                {
                                    <input type="button" class="btn btn-custom btn btn-primary" onclick="BindFranchiseeCustomerDistribution(@ViewBag.CustId,@ViewBag.DistributionFranchiseeId)" value="Distribution" style="margin-right:20px;margin-top:4px;" disabled="disabled" />
                                }
                                else
                                {
                                    <input type="button" class="btn btn-custom btn btn-primary" onclick="BindFranchiseeCustomerDistribution(@ViewBag.CustId,@ViewBag.DistributionFranchiseeId)" value="Distribution" style="margin-right:20px;margin-top:4px;" />
                                }
                            }
                            else
                            {
                                <input type="button" class="btn btn-custom btn btn-primary" onclick="ShowCustomerSuggetionBox()" value="Distribution" style="margin-right:20px;margin-top:4px;" />
                            }*@
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="CustomerInvoice();" value="Invoices" style="margin-right:20px;margin-top:4px;" />
                        <input type="button" class="btn btn-custom btn btn-primary" onclick="CustomerServiceSchedulePopup(@ViewBag.CustId);" value="Schedule" style="margin-right:20px;margin-top:4px;" />
                    </div>
                    <div class="col-md-4">
                        <label class="control-label" style="text-align:left!important;padding-right:15px;"><b>Franchisee No:&nbsp;&nbsp;</b>@(FranModel.FranchiseeNo != null ? FranModel.FranchiseeNo : string.Empty) </label>
                        <label class="control-label" style="text-align:left!important;"><b>Franchisee Name:&nbsp;&nbsp;</b>@(FranModel.FranchiseeName != null ? FranModel.FranchiseeName : string.Empty) </label>
                    </div>
                    <div class="col-md-1">
                        @if (CustModel.CustomerViewModel != null && (CustModel.CustomerViewModel.ContractTypeListId.HasValue ? CustModel.CustomerViewModel.ContractTypeListId.Value : 0) == (int)JKApi.Business.Enumeration.ContractTypeList.OneTime)
                        {
                        <input type="button" class="btn btn-custom btn btn-primary purple" onclick="ShowFranchiseeCall();" value="Franchisee Call" style="margin-right:20px;margin-top:4px;" disabled="disabled" />
                        }
                        else
                        {
                        <input type="button" class="btn btn-custom btn btn-primary purple" onclick="ShowFranchiseeCall();" value="Franchisee Call" style="margin-right:20px;margin-top:4px;" />
                        }
                    </div>
                    <div class="col-md-1">
                        @*@Html.DropDownList("ddlStatuslist", (SelectList)ViewBag.statusList,"Select Status" ,new { @class = "form-control input-sm", @id = "select_ddlStatuslist", onchange = "onchangeStatusFilter()" })*@  
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <input type="hidden" id="CutmID" value="@ViewBag.CustId" />
                            <div class="row">
                                <div class="col-md-10"></div>
                                <div class="col-md-1"></div>
                                <div class="col-md-1">
                                    @Html.DropDownList("ddlStatuslist", (SelectList)ViewBag.statusList, "Select", new { @class = "form-control input-sm", @id = "select_ddlStatuslist", onchange = "onchangeStatusFilter()", style = "min-width:85px;" })
                                </div>
                            </div>
                            <table class="table table-striped table-bordered table-hover" id="tblServiceCall">
                                <thead>
                                    <tr>
                                        <th style="width:7%;text-align:center;" class="dtable_CustomerNo">
                                            Date/Time
                                        </th>
                                        <th style="text-align:center;width:8px;" class="dtable_Type">
                                            Type
                                        </th>
                                        <th style="text-align:center;width:8px;" class="dtable_InitiatedBy">
                                            Initiated By
                                        </th>
                                        <th style="text-align:center;width:9px;" class="dtable_Status">
                                            Call Status
                                        </th>
                                        <th style="text-align:center;width:10px;" class="dtable_SpokeWith">
                                            Spoke With
                                        </th>
                                        <th style="text-align:center;width:8px;" class="dtable_Action">
                                            Action
                                        </th>
                                        <th style="text-align:center;width:8px;" class="dtable_FollowBy">
                                            Follow By
                                        </th>
                                        <th style="text-align:center;width:8px;" class="dtable_CallBack">
                                            Call Back
                                        </th>
                                        <th style="text-align:center;width:22px;" class="dtable_Comment">
                                            Comment
                                        </th>
                                        <th style="text-align:center;width:9px;" class="dtable_CreatedByName">
                                            User Name
                                        </th>
                                        <th style="text-align:center;width:9px;" class="dtable_StatusListName">
                                            Status 
                                        </th>

                                        
                                    </tr>
                                </thead>
                                <tbody></tbody>
                                @*<tbody>
                                        @if (ViewBag.CustomerServiceCallLog != null)
                                        {
                                            foreach (var item in ViewBag.CustomerServiceCallLog)
                                            {
                                                <tr>
                                                    <td style="text-align:left;">
                                                        <input type="hidden" name="tdClassId" id="tdClassId" value="@item.ClassId" />
                                                        <a href="@Url.Action("ServiceCallList", "Customer", new { area = "Portal", id = item.ClassId })"> @item.CustomerNo<br />@item.CallDate<br />@item.CallTime</a>
                                                    </td>
                                                    <td style="text-align:center;"></td>
                                                    <td style="text-align:center;"></td>
                                                    <td style="text-align:center;">@item.Status</td>
                                                    <td style="text-align:center;">@item.SpokeWith</td>
                                                    <td style="text-align:center;">@item.Action</td>
                                                    <td style="text-align:center;">@item.CallBack</td>
                                                    <td>@Html.Raw(HttpUtility.HtmlEncode(item.Comments))</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>*@
                            </table>
                        </div>
                    </div>
                </div>
                <!--Show Service Call log Modal (Log call pop up)-->
                <div class="modal fade custom-model custom-form-design" id="modal_ServiceCallLog1" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog" style="width:869px" id="RenderServiceCallLogDetails">
                    </div>
                </div>
                <form class="form-horizontal" action="" id="form_Billingsetting" method="POST"></form>
                <!--Customer Contract-->
                @*<div class="modal fade custom-model custom-form-design" id="modal_CustomerContractPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
                        <div class="modal-dialog" style="width:785px">
                            <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerContractDetails">
                            </div>
                        </div>
                    </div>*@
                <div class="form-horizontal" action="" id="form_CustomerInvoice"></div>
                @*<div class="form-horizontal" action="" id="form_FranchiseeDistribution"></div>*@
                <div class="form-horizontal" action="" id="form_FranchiseeCall"></div>
                <div class="form-horizontal" action="" id="form_LogCall"></div>
                <div class="modal fade custom-model custom-form-design" id="modal_CustomerInvoice" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog" style="width:869px">
                        <div class="modal-content" style="border-radius: 8px;">
                            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                                    Invoice List
                                </h4>
                            </div>
                            <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover" id="tblinvoice">
                                        <thead>
                                            <tr>
                                                <th style="width:70px;text-align:center;">
                                                    INVOICE NO
                                                </th>
                                                <th style="text-align:center;width:30px;">
                                                    DATE
                                                </th>
                                                <th style="text-align:center;width:60px;">
                                                    CUSTOMER NAME
                                                </th>
                                                <th style="text-align:center;width:60px;">
                                                    CUSTOMER NO
                                                </th>
                                                <th style="text-align:center;width:70px;">
                                                    E/P
                                                </th>
                                                <th style="text-align:center;width:200px;">
                                                    DESCRIPTION
                                                </th>
                                                <th style="text-align:center;width:70px;">
                                                    AMOUNT
                                                </th>
                                                <th style="text-align:center;width:70px;">
                                                    BALANCE
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (ViewBag.CustomerInvoice != null)
                                            {
                                                foreach (var item in ViewBag.CustomerInvoice)
                                                {

                                            <tr>
                                                <td style="text-align:center;">@item.InvoiceNo</td>
                                                <td style="text-align:center;">@Convert.ToDateTime(item.InvoiceDate).ToString("MM/dd/yyyy") </td>
                                                <td style="text-align:center;">@item.CustomerName</td>
                                                <td style="text-align:center;">@item.CustomerNo</td>
                                                <td style="text-align:center;"></td>
                                                <td style="text-align:justify;">@item.InvoiceDescription</td>
                                                <td style="text-align:right;">@string.Format("{0:c}", item.OriginalTotal)</td>
                                                <td style="text-align:right;">@string.Format("{0:c}", item.BalanceTotal)</td>
                                            </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*<div id="form_FranchiseCustomersDistributionPopup"></div>

    <div class="modal fade custom-model custom-form-design" id="ModalFranchiseDistribution_CustomerPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" style="width:350px">
            <div class="modal-content" style="border-radius: 0px;" id="RenderFranchiseDistributionCustomer">
                <div class="modal-content" style="border-radius: 8px;" id="RenderFranchiseDistribution">
                    <div class="custom-form portlet light" id="" style="margin-top:0px;box-shadow: none;">
                        <div class="headerbox" style="font-weight: normal;border-radius: 0;">
                            <div class="col-md-12 text-center" style="font-size:15px;">
                                <b> SEARCH FRANCHISEE </b>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 5px !important;margin-right: 12px !important;"></button>
                            </div>
                            <div class="clearfix"> </div>
                        </div>
                        <div class="row" style="padding-top:8px;padding-bottom:8px;margin-left: 0px;margin-right: 0px;min-height: 100px;">
                            <div class="col-md-12">
                                <div class="col-md-12">
                                    <input type="hidden" id="hdfsearch_franchiseeid" name="hdfsearch_franchiseeid" value="0" />
                                    <div class="input-icon" style="margin-top: 30px;">
                                        <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                                        <input id="fcsearch-box" type="text" required name="franchiseenumber" autocomplete="off" placeholder="Search Franchisee Name or Number" value="" class="form-control input-sm typeahead" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>*@

@*------------------------- New Code  ------------------------*@
<div class="modal fade custom-model custom-form-design" id="modal_CustomerContractPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:800px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerContractDetails">
        </div>
    </div>
</div>
<div id="modal_IncreaseDecreaseDIV"></div>

<div class="form-horizontal" action="" id="form_FranchiseeDistribution"></div>
<div id="form_FranchiseCustomersDistributionPopup"></div>
<div class="modal fade custom-model custom-form-design" id="ModalFranchiseDistribution_CustomerPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:350px">
        <div class="modal-content" style="border-radius: 0px;" id="RenderFranchiseDistributionCustomer">
            <div class="modal-content" style="border-radius: 8px;" id="RenderFranchiseDistribution">
                <div class="custom-form portlet light" id="" style="margin-top:0px;box-shadow: none;">
                    <div class="headerbox" style="font-weight: normal;border-radius: 0;">
                        <div class="col-md-12 text-center" style="font-size:15px;">
                            <b> SEARCH FRANCHISEE </b>
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 5px !important;margin-right: 12px !important;"></button>
                        </div>
                        <div class="clearfix"> </div>
                    </div>
                    <div class="row" style="padding-top:8px;padding-bottom:8px;margin-left: 0px;margin-right: 0px;min-height: 100px;">
                        <div class="col-md-12">
                            <div class="col-md-12">
                                <input type="hidden" id="hdfsearch_franchiseeid" name="hdfsearch_franchiseeid" value="0" />
                                <div class="input-icon" style="margin-top: 30px;">
                                    <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                                    <input id="fcsearch-box" type="text" required name="franchiseenumber" autocomplete="off" placeholder="Search Franchisee Name or Number" value="" class="form-control input-sm typeahead" />
                                </div>
                            </div>
                        </div>
                    </div>
                    @*<div class="row">
                            <div class="col-md-12">
                                <div class="col-md-12">
                                    <button type="button" class="btn btn-primary button-next pull-right" onclick="ShowCustomerSave()">Submit</button>
                                </div>
                            </div>
                        </div>*@
                </div>
            </div>
        </div>
    </div>
</div>
<div class="form-horizontal" action="" id="form_FranchiseeIncreaseDistribution"></div>
<form class="form-horizontal" action="" id="form_service" method="POST">
    <div class="modal fade custom-model custom-form-design" id="modal_service" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Contract Detail Service
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                    <section>
                        <div class="row">
                            <div style="max-width: 98%;margin: 0px auto;">
                                <div class="custom-form portlet light " id="form_wizard_1">
                                    <div class="portlet-body form">
                                        <form class="form-horizontal" action="#" id="submit_form" method="POST">
                                            <div class="form-body-outer" style="padding: 0px;">
                                                <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleMonday" class="i-checks editcheck">Monday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleTuesday" class="i-checks editcheck">Tuesday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleWednesday" class="i-checks editcheck">Wednesday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleThursday" class="i-checks editcheck">Thursday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleFriday" class="i-checks editcheck">Friday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleSaturday" class="i-checks editcheck">Saturday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="chkScheduleSunday" class="i-checks editcheck">Sunday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>
</form>

<div class="modal fade custom-model custom-form-design form-horizontal" id="modal_AccountOffring" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    Account Offering
                </h4>
            </div>
            <div class="modal-body" style="padding: 3px">
                <section>
                    <div class="row">
                        <div style="max-width: 99%;margin: 0px auto;">
                            <div class="custom-form portlet light " id="form_wizard_1">
                                <div class="portlet-body form">
                                    <div class="form-body-outer" style="padding: 0px;">
                                        <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tb_fr_page1">
                                                    <div class="form-group">
                                                        <div class="col-md-6" style="padding: 10px;">
                                                            <div class="row" style="padding: 3px;margin-top:-10px;"><b>Customer Name: @Html.DisplayFor(one => one.CustomerViewModel.Name)</b></div>
                                                            <div class="row" style="padding: 3px;"><b>Customer No: @Html.DisplayFor(one => one.CustomerViewModel.CustomerNo)</b></div>
                                                        </div>
                                                        <div class="col-md-6 text-right" style="padding-right:30px;text-align:right">
                                                            <div class="row" style="padding: 3px;"><b>Address</b> @(Model.MainAddress.Address1 ), </div>
                                                            <div class="row" style="padding: 3px;">@(Model.MainAddress.City + "," + ViewBag.Address + " " + Model.MainAddress.PostalCode)</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-actions">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="control-label col-md-4" id="selectAccountOfferingFranchisee">
                                                            Franchisees Type:
                                                        </div>
                                                        <div class="col-md-3">
                                                            @Html.DropDownList("FranchiseeTypeList", (SelectList)ViewBag.FranchiseeTypeList, new { @class = "form-control input-sm", @id = "select_AOFranchiseeTypeList" })
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="control-label col-md-4">
                                                            Distance within:
                                                        </div>
                                                        <div class="col-md-3">
                                                            <input class="form-control input-sm" id="txtAccountOfferingDistance" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="control-label col-md-4">
                                                            Include Call Results From:
                                                        </div>
                                                        <div class="col-md-3">
                                                            <select id="select_timedurationAccountOffering" class="form-control input-sm">
                                                                <option value="1">This Week</option>
                                                                <option value="2">This Week-to-date</option>
                                                                <option value="3" selected="selected">This Month</option>
                                                                <option value="4">This Month-to-date</option>
                                                                <option value="5">This Fiscal Quarter</option>
                                                                <option value="6">This Fiscal Quarter-to-date</option>
                                                                <option value="7">This Fiscal Year</option>
                                                                <option value="8">This Fiscal Year-to-date</option>
                                                                <option value="9">Yesterday</option>
                                                                <option value="10">Last Week</option>
                                                                <option value="11">Last Month</option>
                                                                <option value="12">Last Quarter</option>
                                                                <option value="13">Last Year</option>
                                                                <option value="14">Custom Date</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <input class="date date-picker input-sm form-control" id="sDateAccountOffering" />
                                                        </div>
                                                        <div class="col-md-1 control-label" style="padding-right: 12px;">
                                                            To
                                                        </div>
                                                        <div class="col-md-2">
                                                            <input class="date date-picker input-sm form-control" id="eDateAccountOffering" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr />
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-12 text-center">
                                                            <a class="btn btn-primary" href="javascript:void(0)" onclick="SearchAccountOffer(@ViewBag.CustId)">Search</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal fade custom-model custom-form-design" id="modalData" tabindex="-1" role="basic" aria-hidden="true" style="display: none;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.modal-content -->
        </div>
    </div>
</div>
@*Account Offering Modal*@
<div id="_div_AccountOffringResult"></div>

<!--Maintenance-->
<div class="modal fade custom-model custom-form-design" id="modal_customermaintenanceDetail" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-sm" style="width: 950px;">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    Customer Maintenance
                </h4>
            </div>
            <div id="form_customermaintenancem">
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-modal-sm in" id="mdlAppendemail" aria-hidden="true">
    <div class="modal-dialog modal-sm" style="width:300px;">
        <div class="modal-content">
            <div class="modal-header" id="mdlAppendemail_header" style="padding-top: 7px;padding-bottom: 7px;background: #3598DC !important;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title" style="font-weight: bold;color:white;font-size: 12px;">Add Emails</h4>
            </div>
            <div class="modal-body" id="mdlAppendemail_body" style="padding: 0;">
                <form action="#" id="mdlAppendemail_form">
                    <div class="col-md-12" id="divEBill_Emails"></div>
                    <div class="col-md-9"><input type="email" name="txtemailaddress_ebill" id="txtemailaddress_ebill" value="" class="form-control input-sm" /></div>
                    <div class="col-md-2"><input type="button" name="btnaddemailaddress_ebill" id="btnaddemailaddress_ebill" value="Add" class="btn btn-primary button-next" style="padding: 3px 8px;font-size: 12px;" /></div>
                </form>
            </div>
            <div class="modal-footer" id="childmodal_modalview_footer">
                &nbsp;
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
</div>

<div class="modal fade bs-modal-sm in" id="mdlAppendemail" aria-hidden="true">
    <div class="modal-dialog modal-sm" style="width:300px;">
        <div class="modal-content">
            <div class="modal-header" id="mdlAppendemail_header" style="padding-top: 7px;padding-bottom: 7px;background: #3598DC !important;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title" style="font-weight: bold;color:white;font-size: 12px;">Add Emails</h4>
            </div>
            <div class="modal-body" id="mdlAppendemail_body" style="padding: 0;">
            </div>
            <div class="modal-footer" id="childmodal_modalview_footer">
                &nbsp;
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
</div>
<div id="divfinderfeelist"></div>
<div class="modal fade in" id="modal_CustomerInspectionHistoryPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_CustomerInspectionHistory">
    </div>
</div>
<div class="modal fade in" id="modal_CustomerInspectionFormPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_CustomerInspectionForm">
    </div>
</div>
<div class="modal fade in" id="modal_CustomerServiceSchedulePopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_CustomerServiceSchedule" style="width:1050px;">
    </div>
</div>
@*COLLECTION CALL LOG Modal*@
<div class="modal fade in" id="modal_CollectionCallLog" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_CollectionCallLogDetails">
    </div>
</div>
<div class="modal fade in" id="modal_ServiceCallLog" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_ServiceCallLogDetails">
    </div>
</div>
<div class="modal fade in" id="modal_CustomerAccountHistoryPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_CustomerAccountHistoryPopup">
    </div>
</div>
<div class="modal fade in" id="modal_IncreaseDecreaseReportPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg" id="Render_IncreaseDecreaseReportPopup">
    </div>
</div>
@*CREDIT TRANSACTION Modal *@
<div class="modal fade in" id="modal_CreditTransaction" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    CREDIT TRANSACTION
                </h4>
            </div>
            <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                <div class="form-body">
                    <div class="form-group">
                        <div class="form-group">
                            <div class="col-md-12">
                                <div class="col-md-3 control-label">
                                    <span>Customer No.<span style="color:#000000;">&nbsp;:</span></span>
                                    @Html.HiddenFor(one => one.CustomerViewModel.CustomerId, new { id = "CTMC" })
                                </div>
                                <div class="col-md-2" style="padding-top: 8px;">
                                    <span><b>@Html.DisplayFor(one => one.CustomerViewModel.CustomerNo)</b></span>
                                </div>
                                <div class="col-md-2">
                                </div>
                                <div class="col-md-2 control-label">
                                    <span>Contact<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-3" style="padding-top: 8px;">
                                    <span><b>@Html.DisplayFor(one => one.CustomerDetail.ContactName)</b></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-12">
                                <div class="col-md-3 control-label" style="padding-top: 0px;">
                                    <span>Customer Name<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-4" style="">
                                    <span><b>@Html.DisplayFor(one => one.CustomerDetail.CustomerName)</b></span>
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;">
                                    <span>Phone No.<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-3">
                                    <span><b>@Html.DisplayFor(one => one.CustomerDetail.Phone)</b></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-left:-3px; margin-right:-3px;">
                            <div class="row" style="background-color: #4b85cc;color: #fff;padding-top:8px;padding-bottom:8px">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <div class="input-icon">
                                            <i class="icon-magnifier icon-align-right" style="margin-top: 8px; margin-left:-12px;"></i>
                                            <input type="text" placeholder="Search..." class="form-control input-sm typeahead" style="margin-left:-25px;" value="" autocomplete="off" id="input_SearchCT" />
                                        </div>
                                        <div id="container">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="mt-checkbox" style="margin-bottom: 0px;">
                                            <input type="checkbox" id="chkOpenMP" class="search-field" checked="checked">Open
                                            <span></span>
                                        </label>
                                        <label class="mt-checkbox" style="margin-bottom: 0px;">
                                            <input type="checkbox" id="chkCloseMP" class="search-field">Closed
                                            <span></span>
                                        </label>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="pull-right">
                                            @Html.DropDownList("optionList", (SelectList)ViewBag.OptionList, new { @class = "form-control input-sm", @id = "select_dateRangeCT", style = "width: 180px;float: left;margin-right:10px;margin-left: -25px" })<span style="width: 40px;float: left;padding: 5px;">From</span>
                                            <input type="text" name="dtpfrom" value="" class="form-control input-sm search-date-field date-picker" id="dtpfromCT" onkeydown="return false" style="width: 85px;float: left;" />
                                            <label></label>
                                            <span style="width: 25px;float: left;padding: 5px;">To</span>
                                            <input type="text" name="dtpto" value="" class="form-control input-sm search-date-field date-picker" id="dtptoCT" onkeydown="return false" style="width: 85px;float: left;" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:-13px;">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover" id="tblCustomerCreditsList" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <th class="tblInvoice_invoiceNo" style="width:80px;text-align:center;">
                                                    Invoice No
                                                </th>
                                                <th class="tblInvoice_invoiceDate" style="width:80px;text-align:center;">
                                                    Invoice Date
                                                </th>
                                                <th class="tblInvoice_customerNo" style="width:70px;text-align:center;">
                                                    Customer Number
                                                </th>
                                                <th class="tblInvoice_customerName" style="width:180px;text-align:center;">
                                                    Customer Name
                                                </th>
                                                <th class="tblInvoice_invoiceDesc" style="width:180px;text-align:center;">
                                                    Invoice Desc.
                                                </th>
                                                <th class="tblInvoice_invoiceAmt" style="text-align:center;width:100px;">
                                                    Inv. Amount
                                                </th>
                                                <th class="tblInvoice_balance" style="text-align:center;width:70px;">
                                                    Balance
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="form_applycreditformDiv">
</div>
@*<form class="form-horizontal" role="form" id="form_applycreditform" action="@Url.Action("ApplyCredit","AccountReceivable","Portal")" method="post">
        <div class="modal fade custom-model custom-form-design" id="modal_applycreditform" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
            <div class="modal-dialog" style="width:1000px">
                <div class="modal-content" style="border-radius: 8px;">
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </form>*@
<div id="cancellationcreditforms">
</div>

<div id="divmodal_ManualPayment"></div>
<div class="modal fade bs-modal-sm in" id="modal_AddFee" aria-hidden="true">
    <div class="modal-dialog modal-sm" style="padding-top: 100px;">
        <div class="modal-content">
            <div class="modal-header" id="mdlAppendemail_header" style="padding-top: 7px;padding-bottom: 7px;background: #3598DC !important;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title" style="font-weight: bold;color:white;font-size: 12px;">FEE</h4>
            </div>
            <div class="modal-body" id="mdlAppendemail_body" style="padding: 0;">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover order-column" id="tblContractDetail">
                        <thead>
                            <tr>
                                <th class="text-center" style="width: 140px;background: lightgray;">FEE NAME</th>
                                <th class="text-center" style="background: lightgray;">TYPE</th>
                                <th class="text-center" style="background: lightgray;">AMOUNT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="text-center">Technology Fee</td>
                                <td class="text-center">Percentage</td>
                                <td class="text-center"><input type="text" class="form-control input-sm text-right" value="2.5" /></td>
                            </tr>
                            <tr>
                                <td class="text-center">Advertising Fee</td>
                                <td class="text-center">Percentage</td>
                                <td class="text-center"><input type="text" class="form-control input-sm text-right" value="1.5" /></td>
                            </tr>
                            <tr>
                                <td class="text-center">Royalty</td>
                                <td class="text-center">Percentage</td>
                                <td class="text-center"><input type="text" class="form-control input-sm text-right" value="10" /></td>
                            </tr>
                            <tr>
                                <td class="text-center">Business Protection</td>
                                <td class="text-center">Percentage</td>
                                <td class="text-center"><input type="text" class="form-control input-sm text-right" value="6.75" /></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <a href="javascript:void(0);" style="padding-left: 10px;">Include Another Fee</a>
                </div>
                <hr style="margin-top:0px;margin-bottom:0px;" />
                <div class="modal-footer">
                    <div class="col-md-12">
                        <div class="col-md-10"></div><div class="col-md-2">
                            <button class="btn btn-primary" id="btnAddFee">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
</div>
<div class="modal fade in" id="modal_SaveAddFee" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog" style="padding-top: 90px;">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    STOP FINDER'S FEE
                </h4>
            </div>
            <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                <div class="form-body">
                    <div class="form-group">
                        <div class="form-group">
                            <div class="col-md-12">
                                <div class="col-md-8" style="padding-top: 0px;">
                                    <span><b>Bill Month/Year: 11/2017</b></span></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover order-column" id="tblContractDetail">
                                        <thead>
                                            <tr>
                                                <th class="text-center" style="width: 140px;background: lightgray;">Franchisee No</th>
                                                <th class="text-center" style="background: lightgray;">Franchisee Name</th>
                                                <th class="text-center" style="background: lightgray;">Finders Fee Stop Date</th>
                                                <th class="text-center" style="background: lightgray;">Note</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="text-center">701011</td>
                                                <td class="text-center">KIMBURNS, LLC</td>
                                                <td class="text-center"></td>
                                                <td class="text-center"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade custom-model custom-form custom-form-design" id="modal_applypaymentprompt" tabindex="-1" style="display: none;">
    <div class="modal-dialog" style="width:500px">
        <div class="modal-content" style="border-radius: 8px; font-size: 16px">
            <div class="headerbox">
                <div class="row">
                    &nbsp;
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="padding: 20px 100px 40px 100px;">
                        Do you want to apply partial payment against Invoice No. <span id="lblPromptInvoiceNo">&nbsp;</span>?
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-6"></div>
                        <div class="col-md-3">
                            <button id="btnSaveAndClose" type="button" class="btn green btn-block" onclick="onClickYesApplyPayment()">Yes</button>
                        </div>
                        <div class="col-md-3">
                            <button id="btnSaveAndNew" type="button" class="btn green btn-block" onclick="onClickNoApplyPayment()">No</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade custom-model custom-form custom-form-design" id="modal_customercreditprompt" tabindex="-1" style="display: none;">
    <div class="modal-dialog" style="width:500px">
        <div class="modal-content" style="border-radius: 8px; font-size: 16px">
            <div class="headerbox">
                <div class="row">
                    &nbsp;
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="padding: 20px 100px 40px 100px;">
                        Do you want to apply <span id="lblPromptCreditAmt">&nbsp;</span> in customer credit for Customer <span id="lblPromptCreditCustomerName">&nbsp;</span>?
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-6"></div>
                        <div class="col-md-3">
                            <button type="button" class="btn green btn-block" onclick="onClickYesApplyCustomerCredit()">Yes</button>
                        </div>
                        <div class="col-md-3">
                            <button type="button" class="btn green btn-block" onclick="onClickNoApplyCustomerCredit()">No</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="sweet-alert modal  showSweetAlert visible" id="swtModel" tabindex="-1" data-keyboard="false" style="display: none; margin-top: -149px; height: 250px;z-index: 15151;">
    <div class="sa-icon sa-error" style="display: none;">
        <span class="sa-x-mark">
            <span class="sa-line sa-left"></span>
            <span class="sa-line sa-right"></span>
        </span>
    </div><div class="sa-icon sa-warning" style="display: none;">
        <span class="sa-body"></span>
        <span class="sa-dot"></span>
    </div><div class="sa-icon sa-info" style="display: none;"></div><div class="sa-icon sa-success animate" style="display: block;">
        <span class="sa-line sa-tip animateSuccessTip"></span>
        <span class="sa-line sa-long animateSuccessLong"></span>
        <div class="sa-placeholder"></div>
        <div class="sa-fix"></div>
    </div><div class="sa-icon sa-custom" style="display: none;"></div><h2>Payment Approved!</h2>
    <p class="lead text-muted " style="display: block;"></p>
    <div class="form-group">
        <input type="text" class="form-control" tabindex="3" placeholder="">
        <span class="sa-input-error help-block">
            <span class="glyphicon glyphicon-exclamation-sign"></span> <span class="sa-help-text">Not valid</span>
        </span>
    </div><div class="sa-button-container">
        <button class="cancel btn btn-lg btn-default" tabindex="2" style="display: none;">Cancel</button>
        <div class="sa-confirm-button-container">
            <button class="confirm btn btn-lg btn-primary" tabindex="1" style="display: inline-block;" id="btnSuccessPopUp">OK</button><div class="la-ball-fall">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="margin: 110px auto;" role="document">
        <div class="modal-content">
            <div class="modal-header" style="padding: 8px;background-color: #346587 !important;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel" style="color: white;">Credit Card Details</h4>
            </div>
            <div class="modal-body">
                <div class="form-body" id="DivCustomer">
                    <div class="row">
                        <div class="col-md-12">
                            @*<div class="form-group">
                                    <label class="control-label col-md-2" style="padding: 5px;">
                                        Invoice For&nbsp;:
                                    </label>
                                    <div class="col-md-5 inline-block">
                                        <input id="csearch-box" type="text" required name="customernumber" autocomplete="off" placeholder="Search Customer Name or Number" value="" class="form-control input-sm typeahead" />
                                    </div>
                                    <div class="col-md-2 inline-block">

                                    </div>
                                </div>*@
                            <div class="form-group">
                                <label class="control-label col-md-2" style="padding: 5px;">
                                    Amount&nbsp;:
                                </label>
                                <div class="col-md-5 inline-block">
                                    <input id="txtAmountToBePay" type="text" required name="txtAmountToBePay" autocomplete="off" placeholder="Amount" value="" class="form-control input-sm" />
                                </div>
                                <div class="col-md-2 inline-block">
                                </div>
                            </div>
                            <hr style="margin: 0px;" />
                        </div>
                    </div>
                </div>
                <div class="form-body" id="DivCustomerProfile" style="display:none;">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-md-2" style="padding: 5px;">
                                    Previous Card &nbsp;:
                                </label>
                                <div class="col-md-5 inline-block">
                                    <label for="ChkCustomerProfile" id="lblAccount" style="margin-top: 8px;">Text</label>
                                    <input id="ChkCustomerProfile" type="checkbox" name="ChkCustomerProfile" onclick="CustomerChk(this)" style="width: 20px;margin-left: 60px;margin-top: -25px;" class="form-control input-sm" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                    <hr />
                    <br />
                </div>
                <div class="demo-container" style="display:none;">
                    <div class="card-wrapper"></div>
                    <br />
                    <div class="form-container active">
                        <form id="CCForm" action="">
                            <input placeholder="Card number" type="tel" id="txtCard" name="number" class="form-control"><br />
                            <input placeholder="Full name" type="text" id="txtCCName" name="name" class="form-control"><br />
                            <input placeholder="MM/YY" type="tel" name="expiry" id="txtCCExpiry" class="form-control"><br />
                            <input placeholder="CVC" type="number" name="cvc" id="txtCCcvc" class="form-control">
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="btnCCCancle" data-dismiss="modal">Cancle</button>
                <button type="button" id="BtnCCPay" class="btn btn-primary">Pay</button>
            </div>
        </div>
    </div>
</div>
<div id="div_FeeFinderdetailResultData"></div>
@*<div class="form-horizontal" action="" id="form_FranchiseeCall"></div>*@
<div class="form-horizontal" action="" id="form_LogCall"></div>
<div class="modal fade custom-model custom-form-design" id="modal_showStatements" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg ui-draggable ui-draggable-handle">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;background:#3598DC !important;border-bottom-width:0px">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title" style="padding:10px;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    Statements
                </h4>
            </div>
            <div class="modal-body form form-horizontal">
                <div class="col-md-12" style="background-color:#67809F !important; color: #fff; padding: 5px">
                    <div class="col-md-1 col-md-offset-5 pnd5">
                        Date
                    </div>
                    <div class="col-md-3">
                        <select id="select_timedurationStatements" class="form-control input-sm">
                            <option value="1">This Week</option>
                            <option value="2">This Week-to-date</option>
                            <option value="3">This Month</option>
                            <option value="4">This Month-to-date</option>
                            <option value="5">This Quarter</option>
                            <option value="6">This Quarter-to-date</option>
                            <option value="7" selected="selected">This Fiscal Year</option>
                            <option value="8">This Fiscal Year-to-date</option>
                            <option value="9">Yesterday</option>
                            <option value="10">Last Week</option>
                            <option value="11">Last Month</option>
                            <option value="12">Last Quarter</option>
                            <option value="13">Last Year</option>
                            <option value="14">Custom Date</option>
                        </select>
                    </div>
                    <div class="col-md-2 pnd5" style="padding-top: 5px;padding-left: 0px;padding-right: 0px;" id="divspandateStatements">
                        <span id="spnStartDateStatements">08/01/2017</span> - <span id="spnEndtDateStatements">08/31/2017</span>
                    </div>
                    <div class="col-md-1 pnd5" style="padding-top: 7px;display:none;" id="divSDStatements">
                        <input type="text" name="txtStartDateStatements" value="" class="form-control input-sm date-picker" style="padding: 3px;" />
                    </div>
                    <div class="col-md-1 pnd5" style="padding-top: 7px;display:none;" id="divED">
                        <input type="text" name="txtEndtDateStatements" value="" class="form-control input-sm date-picker" style="padding: 3px;" />
                    </div>
                </div>
                <div class="form-body" style="padding-top: 0px;">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-8" style="padding-top: 12px;">
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <div class="col-md-3 control-label">
                                            <span>Customer No.<span style="color:#000000;">&nbsp;:</span></span>
                                        </div>
                                        <div class="col-md-4" style="padding-top: 8px;">
                                            <span><b>@Html.DisplayFor(one => one.CustomerViewModel.CustomerNo)</b></span>
                                        </div>
                                        <div class="col-md-2 control-label">
                                            <span>Contact<span style="color:#000000;">&nbsp;:</span></span>
                                        </div>
                                        <div class="col-md-3" style="padding-top: 8px;">
                                            <span><b>@Html.DisplayFor(one => one.CustomerDetail.ContactName)</b></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <div class="col-md-3 control-label" style="padding-top: 0px;">
                                            <span>Customer Name<span style="color:#000000;">&nbsp;:</span></span>
                                        </div>
                                        <div class="col-md-4" style="">
                                            <span><b>@Html.DisplayFor(one => one.CustomerDetail.CustomerName)</b></span>
                                        </div>
                                        <div class="col-md-2 control-label" style="padding-top: 0px;padding-left: 0px;">
                                            <span>Phone No.<span style="color:#000000;">&nbsp;:</span></span>
                                        </div>
                                        <div class="col-md-3">
                                            <span><b>@Html.DisplayFor(one => one.CustomerDetail.Phone)</b></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4" style="padding-top: 5px;">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <tr>
                                            <td class="text-center">Previous Balance</td>
                                            <td class="text-right"><span id="spnStatements_PreviousBalance">&nbsp;</span></td>
                                        </tr>
                                        <tr>
                                            <td class="text-center">Credit/Payment</td>
                                            <td class="text-right">(<span id="spnStatements_Credits">&nbsp;</span>)</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center">New Invoices</td>
                                            <td class="text-right"><span id="spnStatements_Debits">&nbsp;</span></td>
                                        </tr>
                                        <tr>
                                            <td class="text-center"><b>Total Balance Due</b></td>
                                            <td class="text-right"><b><span id="spnStatements_NewBalance">&nbsp;</span></b></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top:5px">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover" id="tbl_statementTransactions">
                                        <thead>
                                            <tr>
                                                <th style="width:70px;text-align:center;background-color: #4b85cc;color:white">
                                                    Trx Type
                                                </th>
                                                <th style="text-align:center;width:30px;background-color: #4b85cc;color:white">
                                                    Trx Date
                                                </th>
                                                <th style="text-align:center;width:60px;background-color: #4b85cc;color:white">
                                                    Trx Number
                                                </th>
                                                <th style="text-align:center;width:200px;background-color: #4b85cc;color:white">
                                                    Description
                                                </th>
                                                <th style="text-align:center;width:70px;background-color: #4b85cc;color:white">
                                                    Charges
                                                </th>
                                                <th style="text-align:center;width:60px;background-color: #4b85cc;color:white">
                                                    Credits
                                                </th>
                                                <th style="text-align:center;width:60px;background-color: #4b85cc;color:white">
                                                    Balance
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="form-group">
                            <div class="col-md-12">
                                <div class="col-md-2 control-label" style="padding-top: 0px;">
                                    <button type="button" class="col-md-12 btn btn-primary" id="btnPrintStatement">Print<i class="fa fa-print" style="padding-left: 7px;"></i></button>
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;">
                                    <button type="button" class="col-md-12 btn btn-primary" id="btnExportStatement">Export<i class="fa fa-download" style="padding-left: 7px;"></i></button>
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;">
                                    <button type="button" class="col-md-12 btn btn-primary" id="btnEmailStatement" onclick="DetailInvoiceListSendEmail(@ViewBag.CustomerID)">Email<i class="fa fa-envelope" style="padding-left: 7px;"></i></button>
                                </div>
                                <div class="col-md-2 col-md-offset-4 control-label" style="padding-top: 0px;">
                                    <button type="button" class="col-md-12 btn btn-primary" id="btnCloseStatements">Close<i class="fa fa-close" style="padding-left: 7px;"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade custom-model custom-form-design" id="modal_invoicedetailEmail" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:600px">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    Email
                </h4>
            </div>

            <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                <div class="row">
                    <label class="control-label col-md-2">From</label>
                    <div class="col-md-10">
                        <input type="text" id="invdetail_txtfromemail" name="invdetail_txtfromemail" class="form-control input-sm" value="" />
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-md-2">To</label>
                    <div class="col-md-10">
                        <input type="text" id="invdetail_txttoemail" name="invdetail_txttoemail" class="form-control input-sm" value="@(ViewBag.CustBillingEmail != null ? ViewBag.CustBillingEmail :string.Empty )" />
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-md-2">CC</label>
                    <div class="col-md-10">
                        <input type="text" id="invdetail_txtccemail" name="invdetail_txtccemail" class="form-control input-sm" value="" />
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-md-2">Subject</label>
                    <div class="col-md-10">
                        <input type="text" id="invdetail_txtsubjectemail" name="invdetail_txtsubjectemail" class="form-control input-sm" value="Statements" />
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-md-2">Email Body</label>
                    <div class="col-md-10">
                        <textarea rows="5" id="invdetail_txtemailbodyemail" name="invdetail_txtemailbodyemail" class="form-control input-sm"></textarea>
                    </div>
                </div>
                <hr />
                <div class="row">
                    <label class="control-label col-md-2">Email Body</label>
                    <div class="col-md-10">
                        <span>
                            To open the attached pdf, You need the free Adobe Reader software which can be here <a javascript:void(0);>Adobe</a>
                        </span>
                        <hr />
                        <p>
                            This email is intended for the party listed in the 'Sold To' field of the attached invoice. Delivery of this email to anyone other than the party to which is was intended is unintentional. In the event this email was misdirected to a party other that the intended party, please notify the sender destroy this email.
                        </p>
                    </div>
                </div>
                <hr />
                <div class="row">
                    <div class="col-md-7"></div>
                    <div class="col-md-5">
                        <button type="button" id="invdetail_btnsendemail" class="btn btn-primary button-next pull-right" onclick="invdetail_sendemail()">Send&nbsp;<i class="fa fa-floppy-o"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="form-horizontal" id="form_CustomerTransfer"></div>
@*PartialView PaymentDetail*@
<div class="form-horizontal" id="form_paymentlist"></div>
@*PartialView CustomerCredit*@
<div class="form-horizontal" id="form_CusCreditDetails"></div>
<div class="modal fade in" id="ModelCustomerUploadDocumentPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:810px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerUploadDocumentPopup">
        </div>
    </div>
</div>

<div class="modal fade custom-model custom-form custom-form-design" id="modal_ExistsMaintenancePrompt" tabindex="-1" style="display: none;">
    <div class="modal-dialog" style="width:400px">
        <div class="modal-content" style="border-radius: 8px; font-size: 12px">
            <div class="modal-header" id="mdlAppendemail_header" style="padding-top: 7px;padding-bottom: 7px;background: #3598DC !important;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title" style="font-weight: bold;color:white;font-size: 12px;">Warning</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="text-align:center;">
                        <span id="spnExistsMaintenancePromptMsg"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*MANUAL INVOICE Modal *@
<div id="form_modal_customermanualinvoice"></div>
<div class="form-horizontal" id="form_invoicedetail"></div>

@section pageplugins{
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    @*<script src="@Url.Content("~/Content/admin/assets/global/scripts/app.min.js")" type="text/javascript" )"></script>*@
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-typeahead/bootstrap3-typeahead.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/select2/js/select2.full.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/additional-methods.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>
    <script src="~/Scripts/jquery-ui.js" type="text/javascript"></script>
    <script src="~/Content/admin/assets/Card/dist/jquery.card.js"></script>
    @if (Request.IsSecureConnection)
    {
        <script src="https://maps.google.com/maps/api/js?key=AIzaSyCrw533WZZijl0sItzXs-DjfyHMN5g4xD8" async defer></script>
    }
    else
    {
        <script src="http://maps.google.com/maps/api/js?key=AIzaSyCrw533WZZijl0sItzXs-DjfyHMN5g4xD8" async defer></script>
    }
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/wow-alert-master/js/wow-alert.js")"></script>
    <link rel="stylesheet" type="text/css" href="/Content/chosen.css" />
    <script src="/Scripts/chosen.jquery.min.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.uniform.min.js"></script>
}

@section scripts{
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/components-date-time-pickers.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Areas/Portal/Scripts/ApplyCreditForm.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Areas/Portal/Scripts/ApplyCreditFormINV.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function ($) {
            var callFromSchedule=$('#calFromSchedule').val();
            var hdnCustId=$('#hdnCustId').val();
            if (callFromSchedule == 1) {
                var dayToAdd = 0;
                var regionId='0';
                var userId=0;
                var isMonthly=false;
                var startDate=null;
                var callBackAction = "CustomerServiceCallList";
                var callBackController ="Customer";
                var passId="id";
                var statusListId=75; //For refrence : see table StatusList

                var sURL = '@Url.Action("CustomerServiceSchedulePopup", "Customer", new { area = "Portal" })' + "?customerId=" + hdnCustId + "&regionId=" + regionId + "&isMonthly=" + isMonthly + "&dayToAdd=" + dayToAdd + "&userId=" + userId + "&startDate=" + startDate + "&callBackAction=" + callBackAction + "&callBackController=" + callBackController+"&passId="+passId+"&statusListId="+statusListId;

                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#Render_CustomerServiceSchedule').html(data);
                        $("#modal_CustomerServiceSchedulePopup").modal({ backdrop: 'static' });
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });

            }
        });
    </script>
    <script>

        $(document).ready(function ($) {
            // $(".chosen-select").chosen({ no_results_text: "Oops, nothing found!" });

            $('#ddlEmailNotesTo').chosen();
            $('#ddlEmailNotesTo2').chosen();
            if('@ViewBag.FilterArea'!= 0)
            {
                $("#select_timeduration").val('@ViewBag.FilterArea');
            }
        });
        //jQuery(document).ready(function () {
        //    var dtable = $('#tblServiceCall').dataTable({
        //        "bAutoWidth": false,
        //        cache: false,
        //        "bSort": false,
        //        "order": false,
        //        "iDisplayLength": 25,
        //        "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
        //        "dom": '<"top">rt<"bottom"lp><"clear">',
        //        "aaSorting": false,

        //    });

        //    $("#input_Search").keyup(function () {
        //        var table = $("#tblServiceCall").DataTable();
        //        table.search($(this).val()).draw();
        //        // var CutmID = $("#tblServiceCall tbody tr input").first().val();

        //    });
        //})
        jQuery(document).ready(function () {
            $("#pageSize").change(function () {
                setPaging();
            });
            $('.date-picker').datepicker({ autoclose: true, dateFormat: 'mm/dd/yy' });
            $('.date-picker').attr("placeholder", "mm/dd/yyyy");
            $('.timepicker').timepicker();

            var dtable = $('#tblinvoice').dataTable({
                dom: 'Bfrtip',
                buttons: [
                     'excel', 'print'
                ],
                "bAutoWidth": false,
                cache: false,
                "bSort": false,
                "order": false,
                "iDisplayLength": 25,
                "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                "dom": '<"top">rt<"bottom"lp><"clear">',
                "aaSorting": false,

            });
            $("#CallBack").datepicker({ numberOfMonths: 1, });
        })

        $(document).ready(function () {
            @*$("#csearch-box").keyup(function () {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("Customerdata", "AccountReceivable", new { area = "Portal" })',
                    data: 'keyword=' + $(this).val(),
                    success: function (data) {
                        var typeaheadSource = [];
                        $.each(data, function (key, value) {
                            typeaheadSource.push({ id: value.CustomerId, name: value.CustomerNo + ' ' + $.trim(value.Name) })
                        });

                        $('#csearch-box').typeahead({
                            source: typeaheadSource,
                            updater: function (item) {
                                console.log(item);
                                redirect(item.id);
                                return item;
                            }
                        }).focus();
                    }
                });
            });*@
            applyAutoSeacrh();
        });
        function applyAutoSeacrh() {

            $.ajax({
                type: "GET",
                url: '@Url.Action("GetAllCustomer", "Customer", new { area = "Portal" })',
                data: {},
                success: function (data) {

                    var typeaheadSource = [];
                    $.each(data, function (key, value) {
                        typeaheadSource.push({ id: value.CustomerId, name: value.CustomerNo + ' ' + $.trim(value.Name) })
                    });
                    var box = $('#csearch-box').data('typeahead');
                    if (box != null) {

                        console.log('csearch source change');
                        box.source = typeaheadSource;
                    }
                    else {
                        console.log('csearch initiated');
                        $('#csearch-box').typeahead({
                            source: typeaheadSource,
                            updater: function (item) {
                                console.log(item);
                                redirect(item.id);
                                return item;
                            },
                            minLength: 1
                        }).focus();
                    }
                }
            });
        }
        function redirect(id) {
            if ('@ViewBag.CallFromCustomer' == "1") {
                var url = '/Portal/Customer/ServiceCallList/-1';
                var path = url.replace("-1", id);
                location.href = path;
            }
            else {
                var url = '/Portal/Customer/CustomerServiceCallList/-1';
                var path = url.replace("-1", id);
                location.href = path;
            }
        }
        function redirect_list() {
            if ('@ViewBag.CallFromCustomer' == "1") {
                location.href = '/Portal/Customer/ServiceCallList';
            }
            else {
                location.href = '/Portal/Customer/CustomerServiceCallList';
            }
        }
    </script>
    <script>
        var dtable;
        function getTableURLServiceCall() {
            var _fromDateVal = $('#dtpfrom').val();
            var _toDateVal = $('#dtpto').val();
            var _searchtextVal = "";
            var _incClosed = "false";
            var _consolidated = $('#chkConsolidated').prop("checked");
            var _statusid = 0;             
            if($("#select_ddlStatuslist").val() != "")
            {
                _statusid = $("#select_ddlStatuslist").val();
            }
            var sURL = '@Url.Action("ServiceCallLogListResultData", "Customer", new { area = "Portal" })?id=' + $("#hdnCustId").val() + '&fd=' + _fromDateVal + '&td=' + _toDateVal + '&st=' + _searchtextVal +'&statusid='+ _statusid

            return sURL;
        }
        function refreshTable() {             
            var surl = getTableURLServiceCall();
            dtable.ajax.url(surl).load();

        }

        function btncloseFranchiseecall() {
            $("#modal_FranchiseeCall").modal('hide');
        }

        function btnlogcallClose() {
            $("#modal_LogCall").modal('hide');
        }

        function setPaging() {
            var z = $("#pageSize").val();
            var table = $("#tblinvoice").DataTable();
            if (z > 0) {
                table.page.len(z).draw();
            }
            else if (z == -1) {
                table.page.len(table.rows().count()).draw();
            }
            else {
                table.page.page.len(25).draw();
            }
        }

        function onchangeStatusFilter() {
            var surl = getTableURLServiceCall();
            dtable.ajax.url(surl).load();         
        }

        jQuery(document).ready(function () {

            $('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();
            //firstDay = moment().subtract(0, 'month').startOf('month').toString();
            //lastDay = moment().subtract(0, 'month').endOf('month').toString();
            //firstDay = moment().subtract(0, 'month').startOf('month').toString();
            //lastDay = moment().subtract(0, 'month').endOf('month').toString();

            firstDay = moment().startOf('year').toString();;
            lastDay = moment().endOf('year').toString();

             
            $('#dtpfrom').val(moment(firstDay).format('L'));
            $('#dtpto').val(moment(lastDay).format('L'));
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));

            //$('#txtStartDate').inputmask("mm/dd/yyyy", {});
            //$('#txtEndtDate').inputmask("mm/dd/yyyy", {});

            //setSearchTime(3);
            var sURLServiceCall = getTableURLServiceCall();
            var ps = $('#pageSize').val();
            dtable = $('#tblServiceCall').DataTable({
                "bServerSide": false,
                "sAjaxSource": sURLServiceCall,
                "iDisplayLength": ps == '-1' ? 25 : ps,
                "dom": "<'table-responsive't><'bottom'ip><'clear'>",
                "aaSorting": [[0, "desc"]],
                columnDefs: [
                    {
                        targets: "dtable_CustomerNo",
                        data: "",
                        render: function (data, type, row, meta) {
                            //return row.CustomerNo + ' <br />' + moment(new Date(parseInt(row.CallDate.substr(6)))).format("MM/DD/YYYY") + '<br />' + tConvert(row.CallTime);
                            return moment(new Date(parseInt(row.CallDate.substr(6)))).format("MM/DD/YYYY") + '<br />' + tConvert(row.CallTime);
                        }
                    },
                     {
                         targets: "dtable_Type",
                         data: "ServiceLogTypeListName",
                         sClass: "clstext-align",
                         render: function (data, type, row, meta) { return row.ServiceLogTypeListName }
                     },
                     {
                         targets: "dtable_InitiatedBy",
                         data: "InitiatedBy",
                         sClass: "clstext-align",
                         render: function (data, type, row, meta) {
                             var strInitiatedBy = "";
                             if (row.InitiatedBy == '0') {
                                 strInitiatedBy = "JK";
                             }
                             else if (row.InitiatedBy == '1') {
                                 strInitiatedBy = "Customer";
                             }
                             else if (row.InitiatedBy == '2') {
                                 strInitiatedBy = "Franachisee";
                             }
                             return strInitiatedBy;
                         }
                     },
                    { targets: "dtable_Status", data: "Status", sClass: "clstext-align" },
                    { targets: "dtable_SpokeWith", data: "SpokeWith", sClass: "clstext-align" },
                    { targets: "dtable_Action", data: "Action", sClass: "clstext-align" },
                    { targets: "dtable_FollowBy", data: "FollowUpByName", sClass: "clstext-align" },                    
                    {
                        targets: "dtable_CallBack",
                        data: "",
                        sClass: "alignCenter clstext-align",
                        render: function (data, type, row, meta) {
                            if (row.CallBack != null && row.CallBack != "") {
                                return moment(new Date(parseInt(row.CallBack.substr(6)))).format("MM/DD/YYYY");
                            }
                            return "";
                        }
                    },
                    //{
                    //    targets: "dtable_Completed",
                    //    data: "",
                    //    sClass: "clstext-align",
                    //    render: function (data, type, row, meta) { return "" }
                    //},
                    { targets: "dtable_Comment", data: "Comments" },
                    { targets: "dtable_CreatedByName", data: "CreatedByName", sClass: "clstext-align" },
                    { targets: "dtable_StatusListName", data: "StatusListName", sClass: "alignCenter" },
                    //{
                    //    targets: "dtable_ActionHistory", data: "",
                    //    render: function (data, type, row, meta) { return "" }
                    //},
                ]

            });
            //$("#input_Search").keyup(function () {
            //    var table = $("#tblServiceCall").DataTable();
            //    table.search($(this).val()).draw();
            //});

            $('#dtpfrom').change(function () {
                $('#spnStartDate').html($(this).val());
                if ($('#dtpfrom').val() != '' && $('#dtpto').val() != '')
                    refreshTable();
            });
            $('#dtpto').change(function () {
                $('#spnEndtDate').html($(this).val());
                if ($('#dtpfrom').val() != '' && $('#dtpto').val() != '')
                    refreshTable();
            });
        })

        var date = new Date(), y = date.getFullYear(), m = date.getMonth();
        var firstDay;
        var lastDay;
        Date.prototype.getWeek = function (start) {
            //Calcing the starting point
            start = start || 0;
            var today = new Date(this.setHours(0, 0, 0, 0));
            var day = today.getDay() - start;
            var date = today.getDate() - day;

            // Grabbing Start/End Dates
            var StartDate = new Date(today.setDate(date));
            var EndDate = new Date(today.setDate(date + 6));
            return [StartDate, EndDate];
        }

        //$('#txtStartDate').change(function () {
        //    $('#spnStartDate').html($(this).val());
        //});
        //$('#txtEndtDate').change(function () {
        //    $('#spnEndtDate').html($(this).val());
        //});


        $(".search-date-field").on('changeDate', function (e) {
            refreshTable();
        });

        $('#select_timeduration').change(function () {

            //alert($(this).val());
            $('#spnStartDate').html('');
            $('#spnEndtDate').html('');
            $('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();
            switch (parseInt($(this).val())) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().toString();
                    lastDay = moment().toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 14:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 15:
                    //code block
                    $('#divspandate').hide();
                    $('#divSD').show();
                    $('#divED').show();
                    $('#txtStartDate').val('');
                    $('#txtEndtDate').val('')
                    break;
                default:
                    //code block
            }
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));

            //Set Values becuase due to Filter Is not working
            $('#dtpfrom').val(moment(firstDay).format('L'));
            $('#dtpto').val(moment(lastDay).format('L'));

            refreshTable();
            // _bindTrasaction($('#select_transactionstype').val(), moment(firstDay).format('L'), moment(lastDay).format('L'));
        });

    </script>
    <script type="text/javascript">

        function OpenCustomerDetailPopup(Id) {
            if (Id != "" && Id != "0") {
                var sURL = '@Url.Action("OpenCustomerDetailPopup", "Customer", new { area = "Portal" })?id=' + Id;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#RenderCustomerMoreDetails').html(data);
                        $("#modal_CustomerMoreDetailsPopup").modal({ backdrop: 'static' });
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            }
        }
        function onClickEdit() {
            $("#txtnotes").prop("disabled", false);
            $("#_edit").hide();
            $("#_save").show();
            $("#_cancel").show();
        }
        function onClickSave() {
            $("#_edit").show();
            $("#_save").hide();
            $("#_cancel").hide();
            $("#txtnotes").prop("disabled", true);

            var _id = $("#hdnNoteId").val();
            var _notes = $("#txtnotes").val();
            var _classId = $("#hdnCustId").val();

            var o = { Id: _id, ClassId: _classId, Notes: _notes };

            var sURL = '@Url.Action("SaveCustomerNotesDetails", "Customer", new { area = "Portal" })';
            $.ajax({
                type: "GET",
                url: sURL,
                data: o,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    if (data != null) {
                        $("#hdnNoteId").val(data);
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function onClickCancel() {
            $("#_edit").show();
            $("#_save").hide();
            $("#_cancel").hide();
            $("#txtnotes").prop("disabled", true);
            $("#txtnotes").val('');
            $("#txtnotes").val('@ViewBag.custNotes');
        }

        function showServiceCallLogOpenPopup() {
            var CustomerID = $("#CutmID").val();
            if (CustomerID != "" && CustomerID != 0) {

                var callfrom = $("#hdnCallFromCustomer").val();

                var sURL = '@Url.Action("showServiceCallLogPopup", "Customer", new { area = "Portal" })' + "?id=" + CustomerID + "&callfrom=" + callfrom;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#RenderServiceCallLogDetails').html(data);
                        $("#modal_ServiceCallLog1").modal({ backdrop: 'static' });
                        $(".date-picker").datepicker();
                        $(".timepicker").timepicker();

                        //$("#CustomerNos").append($(".clscustno").html());
                        //$("#ContactNames").append($(".clscustcont").html());
                        //$("#CustomerNames").append($(".clscustname").html());
                        //$("#Phones").append($(".clscustphon").html());
                        $('#ddlEmailNotesTo').chosen();
                        $('#ddlEmailNotesTo2').chosen();

                        $('#txtCallBack').datepicker("option", {
                            minDate: new Date()
                        });
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            }
        }

        function showServiceCallLog() {

            var CustomerID = $("#CutmID").val();
            if (CustomerID != "" && CustomerID != 0) {
                $.ajax({
                    type: "POST",
                    url: "/Customer/GetCustomerDataByID",
                    data: JSON.stringify({ "CustomerID": CustomerID }),
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#CustomerNos").empty();
                        $("#ContactNames").empty();
                        $("#CustomerNames").empty();
                        $("#Phones").empty();
                        $("#CustomerNos").append(data.CustomerNo);
                        $("#ContactNames").append(data.ContactName);
                        $("#CustomerNames").append(data.CustomerName);
                        $("#Phones").append(data.Phone);
                        $("#ClassId").val(data.CustomerId);
                        $("#RegionId").val(data.RegionId);
                        $("#modal_ServiceCallLog1").modal({ backdrop: 'static' });
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            }
            else {
                swal({
                    title: "Oops",
                    text: "Plese Select the Customer First",
                    allowOutsideClick: false,
                    html: true
                });
            }
        }
        function CustomerInfo() {
            $("#modal_Billingsetting").modal({ backdrop: 'static' });
        }
        function CustomerInvoice() {
            $("#modal_CustomerInvoice").modal({ backdrop: 'static' });
        }
        function EditContactfunction1() {
            $(".editmain1").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave1").removeAttr("disabled");
            $("#btnContactCancel1").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact1").hide();
            $("#btnContactSave1").show();
            $("#btnContactCancel1").show();


            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function ShowFranchiseeCall() {
            var FranchiseeId = $("#hdnFranchiseeId").val();
            var CustomerId = $("#hdnCustId").val();

            var sURL = '@Url.Action("GetFranchiseeCall", "Customer", new { area = "Portal" })' + "?FranchiseeId=" + FranchiseeId + "&CustomerId=" + CustomerId;
            var FranchiseeId = FranchiseeId
            if (FranchiseeId != "" && FranchiseeId != 0) {
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#form_FranchiseeCall').html(data);
                        $("#modal_FranchiseeCall").modal({ backdrop: 'static' });
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            }
            else {
                swal({
                    title: "Oops",
                    text: "This customer not associate franchise",
                    allowOutsideClick: false,
                    html: true
                });
            }
        }


        function ShowLogCall() {
            var sURL = '@Url.Action("GetLogCall", "Customer", new { area = "Portal" })';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_LogCall').html(data);
                    $("#modal_LogCall").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }

        function openCustomerInspectionHistoryPopup(Id) {

            var sURL = '@Url.Action("OpenCustomerInspectionHistoryPopup", "Customer", new { area = "Portal" })'+"?Id=" + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_CustomerInspectionHistory').html(data);
                    $("#modal_CustomerInspectionHistoryPopup").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }
        function openCustomerInspectionFormPopup(Id) {
            var sURL = '@Url.Action("OpenCustomerInspectionFormPopup", "Customer", new { area = "Portal" })'+"?Id=" + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_CustomerInspectionForm').html(data);
                    $("#modal_CustomerInspectionFormPopup").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }
        function  CustomerServiceSchedulePopup(customerId)
        {
            if(customerId){
                var dayToAdd = 0;
                var regionId='0';
                var userId=0;
                var isMonthly=false;
                var startDate=null;

                var callBackAction = "CustomerServiceCallList";
                var callBackController ="Customer";
                var passId="id";
                var statusListId=75; //For refrence : see table StatusList

                var sURL = '@Url.Action("CustomerServiceSchedulePopup", "Customer", new { area = "Portal" })' + "?customerId=" + customerId + "&regionId=" + regionId + "&isMonthly=" + isMonthly + "&dayToAdd=" + dayToAdd + "&userId=" + userId + "&startDate=" + startDate + "&callBackAction=" + callBackAction + "&callBackController=" + callBackController + "&passId=" + passId+"&statusListId="+statusListId;

                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#Render_CustomerServiceSchedule').html(data);
                        $("#modal_CustomerServiceSchedulePopup").modal({ backdrop: 'static' });
                    },
                    error: function () {
                        alert("Error occured!!")
                    }
                });
            }
        }


    </script>
    <script type="text/javascript">

        $(document).ready(function () {
            $.validator.messages.required = '';


            $('#chkbillingsameas').click(function () {
                var checked = $('#chkbillingsameas').is(':checked');

                var MainAddress_Name = $('#BillingContact_Name'),
                    MainAddress_Address1 = $('#BillingAddress_Address1'),
                    MainAddress_City = $('#BillingAddress_City'),
                    MainAddress_State = $('#BillingStatesList'),
                    MainAddress_PostalCode = $('#BillingAddress_PostalCode');

                if (checked) {
                    MainAddress_Name.val($('#CustomerViewModel_Name').val());
                    MainAddress_Address1.val($('#MainAddress_Address1').val());
                    MainAddress_City.val($('#MainAddress_City').val());
                    MainAddress_State.val($('#MainStatesList').val());
                    MainAddress_PostalCode.val($('#MainAddress_PostalCode').val());

                    MainAddress_Name.attr("readonly", "readonly");
                    MainAddress_Address1.attr("readonly", "readonly");
                    MainAddress_City.attr("readonly", "readonly");
                    MainAddress_State.attr("readonly", "readonly");
                    MainAddress_PostalCode.attr("readonly", "readonly");

                }
                else {
                    MainAddress_Name.val('');
                    MainAddress_Address1.val('');
                    MainAddress_City.val('');
                    MainAddress_State.val('');
                    MainAddress_PostalCode.val('');

                    MainAddress_Name.removeAttr("readonly");
                    MainAddress_Address1.removeAttr("readonly");
                    MainAddress_City.removeAttr("readonly");
                    MainAddress_State.removeAttr("readonly");
                    MainAddress_PostalCode.removeAttr("readonly");
                }
            });
            $('#chkbillingcontactsameas').click(function () {
                var MainContactAddress_FName = $('#BillingContactInformation2_Name'),
                    //MainContactAddress_LastName = $('#BillingContact_LastName'),
                    MainContactAddress_Title = $('#BillingContactInformation2_Title'),
                    MainContactAddress_Phone = $('#BillingPhone_Phone1'),
                    MainContactAddress_PhoneExt = $('#BillingPhone_PhoneExt'),
                    MainContactAddress_Cell = $('#BillingPhone_Cell'),
                    MainContactAddress_Fax = $('#BillingPhone_Fax'),
                    MainContactAddress_Email = $('#BillingEmail_EmailAddress');
                if ($(this).prop('checked')) {
                    MainContactAddress_FName.val($('#MainContact_Name').val());
                    // MainContactAddress_LastName.val($('#ContactInformation_LastName').val());
                    MainContactAddress_Title.val($('#MainContact_Title').val());
                    MainContactAddress_Phone.val($('#MainPhone2_Phone1').val());
                    MainContactAddress_PhoneExt.val($('#MainPhone2_PhoneExt').val());
                    MainContactAddress_Cell.val($('#MainPhone2_Cell').val());
                    MainContactAddress_Fax.val($('#MainPhone2_Fax').val());
                    MainContactAddress_Email.val($('#MainEmail_EmailAddress').val());

                    MainContactAddress_FName.attr("readonly", "readonly");
                    //MainContactAddress_LastName.attr("readonly", "readonly");
                    MainContactAddress_Title.attr("readonly", "readonly");
                    MainContactAddress_Phone.attr("readonly", "readonly");
                    MainContactAddress_PhoneExt.attr("readonly", "readonly");
                    MainContactAddress_Cell.attr("readonly", "readonly");
                    MainContactAddress_Fax.attr("readonly", "readonly");
                    MainContactAddress_Email.attr("readonly", "readonly");
                }
                else {
                    MainContactAddress_FName.val('');
                    //MainContactAddress_LastName.val('');
                    MainContactAddress_Title.val('');
                    MainContactAddress_Phone.val('');
                    MainContactAddress_PhoneExt.val('');
                    MainContactAddress_Cell.val('');
                    MainContactAddress_Fax.val('');
                    MainContactAddress_Email.val('');

                    MainContactAddress_FName.removeAttr("readonly");
                    //MainContactAddress_LastName.removeAttr("readonly");
                    MainContactAddress_Title.removeAttr("readonly");
                    MainContactAddress_Phone.removeAttr("readonly");
                    MainContactAddress_PhoneExt.removeAttr("readonly");
                    MainContactAddress_Cell.removeAttr("readonly");
                    MainContactAddress_Fax.removeAttr("readonly");
                    MainContactAddress_Email.removeAttr("readonly");
                }
            });

            // _bindTrasaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());

            $('.modal-dialog').draggable();


        });
    </script>
    <script>
        $("#btnSave").click(function () {
            var isvalid = true;

            if ($('#BillSetting_EffectiveDate').val().trim() == '') { $('#BillSetting_EffectiveDate').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillSetting_EffectiveDate').css('border-color', ''); }

            if (isvalid == true) {

                var BillSettingsId = 0;
                var EBill = 0;
                //var PrintInvoice = 0;
                var PrintPastDue = 0;
                var TaxExcempt = 0;
                var ConsolidatedInvoice = 0;


                if ($("#BillSetting_BillSettingsId").val() != undefined && $("#BillSetting_BillSettingsId").val() != "") {
                    BillSettingsId = $("#BillSetting_BillSettingsId").val();
                }
                if ($("#BillSetting_EBill").is(':checked')) {
                    EBill = 1;

                }
                //if ($("#BillSetting_PrintInvoice").is(':checked')) {
                //    PrintInvoice = 1;
                //}
                if ($("#BillSetting_PrintPastDue").is(':checked')) {
                    PrintPastDue = 1;
                }
                if ($("#BillSetting_TaxExcempt").is(':checked')) {
                    TaxExcempt = 1;
                }
                if ($("#BillSetting_ConsolidatedInvoice").is(':checked')) {
                    ConsolidatedInvoice = 1;
                }

                var CustBillSettings = { CustomerId: $("#CustomerViewModel_CustomerId").val(), BillSettingsId: BillSettingsId, ArStatus: $(".ddlArStatus").val(), EffectiveDate: $("#BillSetting_EffectiveDate").val(), InvoiceDateListId: $(".ddlInvoiceDate").val(), InvoiceTermListId: $(".ddlTermDate").val(), EBill: EBill, PrintPastDue: PrintPastDue, TaxExcempt: TaxExcempt, ConsolidatedInvoice: ConsolidatedInvoice, Note: $("#BillSetting_Notes").val(), EBillEmails: $("#hdfEBill_Emails").val() };

                $.ajax({
                    url: '@Url.Action("SaveBillSettings", "Customer")',
                    dataType: "json",
                    data: CustBillSettings,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }

        });

        $('#btnCancel').click(function () {

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");
            $("#btnSave").prop("disabled", "false");
            $("#btnSave").prop("readonly", "true");

            $("#btnCancel").prop("disabled", "false");
            $("#btnCancel").prop("readonly", "true");

            $("#EditBSetting").show();
            $("#btnSave").hide();
            $("#btnCancel").hide();

            //$('#modal_Billingsetting').hide();
            //$("#modal_Billingsetting").close();
            //$('.modal-backdrop').remove();
            // $('#modal_Billingsetting').dismiss('Cancel');

        });

        $('#btnContactSave1').click(function () {

            var isvalid = true;

            //if ($('#MainContact_FirstName').val().trim() == '') { $('#MainContact_FirstName').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainContact_FirstName').css('border-color', ''); }
            if ($('#MainAddress_Address1').val().trim() == '') { $('#MainAddress_Address1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_Address1').css('border-color', ''); }
            if ($('#MainAddress_City').val().trim() == '') { $('#MainAddress_City').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_City').css('border-color', ''); }
            if ($('#MainStatesList').val().trim() == '') { $('#MainStatesList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainStatesList').css('border-color', ''); }
            if ($('#MainAddress_PostalCode').val().trim() == '') { $('#MainAddress_PostalCode').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_PostalCode').css('border-color', ''); }

            if ($('#MainPhone_Phone1').val().trim() == '' || $('#MainPhone_Phone1').val() == NaN || parseInt($("#MainPhone_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#MainPhone_Phone1').css('border-color', 'red');
                if (isvalid == true) {
                    isvalid = false;
                }
            }
            else {
                $('#MainPhone_Phone1').css('border-color', '');
            }

            if (isvalid == true) {

                var AddressId = 0;
                var PhoneId = 0;

                if ($("#MainAddress_AddressId").val() != undefined && $("#MainAddress_AddressId").val() != "") {
                    AddressId = $("#MainAddress_AddressId").val();
                }
                if ($("#MainPhone_PhoneId").val() != undefined && $("#MainPhone_PhoneId").val() != "") {
                    PhoneId = $("#MainPhone_PhoneId").val();
                }

                var EditCustM1data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), AddressId: AddressId, Address1: $("#MainAddress_Address1").val(), Address2: $("#MainAddress_Address2").val(), City: $("#MainAddress_City").val(), StateId: $("#MainStatesList").val(), PostalCode: $("#MainAddress_PostalCode").val(), PhoneId: PhoneId, Phone1: $("#MainPhone_Phone1").val(), Fax: $("#MainPhone_Fax").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupMainContactTab1", "Customer")',
                    dataType: "json",
                    data: EditCustM1data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",

                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }
        });

        $('#btnContactCancel1').click(function () {
            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $("#btnContactSave1").prop("disabled", "false");
            $("#btnContactSave1").prop("readonly", "true");

            $("#btnContactCancel1").prop("disabled", "false");
            $("#btnContactCancel1").prop("readonly", "true");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();
        });

        $('#btnContactSave').click(function () {

            var isvalid = true;

            if ($('#MainContact_Name').val().trim() == '') { $('#MainContact_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainContact_Name').css('border-color', ''); }
            if ($('#MainPhone2_Phone1').val().trim() == '' || $('#MainPhone2_Phone1').val() == NaN || parseInt($("#MainPhone2_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#MainPhone2_Phone1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
            } else { $('#MainPhone2_Phone1').css('border-color', ''); }

            if ($('#MainEmail_EmailAddress').val().trim() != '') {
                if (!ValidateEmail($('#MainEmail_EmailAddress').val())) {
                    if (isvalid == true) { isvalid = false; }
                    $('#MainEmail_EmailAddress').css('border-color', 'red');
                } else { $('#MainEmail_EmailAddress').css('border-color', ''); }
            }
            if ($('#MainPhone2_Cell').val().trim() != '') {
                if (parseInt($("#MainPhone2_Cell").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                    $('#MainPhone2_Cell').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
                    $('#MainPhone2_Cell').css('border-color', 'red');
                } else { $('#MainPhone2_Cell').css('border-color', ''); }
            }


            if (isvalid == true) {

                var ContactId = 0;
                var PhoneId = 0;
                var EmailId = 0;

                if ($("#MainContact_ContactId").val() != undefined && $("#MainContact_ContactId").val() != "") {
                    ContactId = $("#MainContact_ContactId").val();
                }
                if ($("#MainPhone2_PhoneId").val() != undefined && $("#MainPhone2_PhoneId").val() != "") {
                    PhoneId = $("#MainPhone2_PhoneId").val();
                }
                if ($("#MainEmail_EmailId").val() != undefined && $("#MainEmail_EmailId").val() != "") {
                    EmailId = $("#MainEmail_EmailId").val();
                }

                var EditCustM2data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#MainContact_Name").val(), Title: $("#MainContact_Title").val(), PhoneId: PhoneId, Phone1: $("#MainPhone2_Phone1").val(), PhoneExt: $("#MainPhone2_PhoneExt").val(), Cell: $("#MainPhone2_Cell").val(), Fax: $("#MainPhone2_Fax").val(), EmailId: EmailId, EmailAddress: $("#MainEmail_EmailAddress").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupMainContactTab2", "Customer")',
                    dataType: "json",
                    data: EditCustM2data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",

                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }


        });
        $('#btnContactCancel').click(function () {
            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $("#btnContactSave").prop("disabled", "false");
            $("#btnContactSave").prop("readonly", "true");

            $("#btnContactCancel").prop("disabled", "false");
            $("#btnContactCancel").prop("readonly", "true");


            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();
        });

        $('#btnBContactSave1').click(function () {

            var isvalid = true;
            if ($('#BillingContact_Name').val().trim() == '') { $('#BillingContact_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingContact_Name').css('border-color', ''); }
            if ($('#BillingAddress_Address1').val().trim() == '') { $('#BillingAddress_Address1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_Address1').css('border-color', ''); }
            if ($('#BillingAddress_City').val().trim() == '') { $('#BillingAddress_City').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_City').css('border-color', ''); }
            if ($('#BillingStatesList').val().trim() == '') { $('#BillingStatesList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingStatesList').css('border-color', ''); }
            if ($('#BillingAddress_PostalCode').val().trim() == '') { $('#BillingAddress_PostalCode').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_PostalCode').css('border-color', ''); }

            if (isvalid == true) {

                var ContactId = 0;
                var BAddressId = 0;

                if ($("#BillingContact_ContactId").val() != undefined && $("#BillingContact_ContactId").val() != "") {
                    ContactId = $("#BillingContact_ContactId").val();
                }
                if ($("#BillingAddress_AddressId").val() != undefined && $("#BillingAddress_AddressId").val() != "") {
                    BAddressId = $("#BillingAddress_AddressId").val();
                }

                var EditCustB1data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#BillingContact_Name").val(), Attention: $("#BillingContact_Attention").val(), AddressId: BAddressId, Address1: $("#BillingAddress_Address1").val(), Address2: $("#BillingAddress_Address2").val(), City: $("#BillingAddress_City").val(), StateId: $("#BillingStatesList").val(), PostalCode: $("#BillingAddress_PostalCode").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupBillingTab1", "Customer")',
                    dataType: "json",
                    data: EditCustB1data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",

                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;
            }
        });
        $('#btnBContactCancel1').click(function () {
            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $("#btnBContactSave1").prop("disabled", "false");
            $("#btnBContactSave1").prop("readonly", "true");

            $("#btnBContactCancel1").prop("disabled", "false");
            $("#btnBContactCancel1").prop("readonly", "true");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

        });

        $('#btnBContactSave').click(function () {

            //var data = $("form").serialize();
            //alert(data);

            var isvalid = true;

            if ($('#BillingContactInformation2_Name').val().trim() == '') { $('#BillingContactInformation2_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingContactInformation2_Name').css('border-color', ''); }
            if ($('#BillingPhone_Phone1').val().trim() == '' || $('#BillingPhone_Phone1').val() == NaN || parseInt($("#BillingPhone_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#BillingPhone_Phone1').css('border-color', 'red');
                if (isvalid == true) { isvalid = false; }
            }
            else {
                $('#BillingPhone_Phone1').css('border-color', '');
            }
            if ($('#BillingEmail_EmailAddress').val().trim() != '') {
                if (!ValidateEmail($('#BillingEmail_EmailAddress').val())) {
                    if (isvalid == true) { isvalid = false; }
                    $('#BillingEmail_EmailAddress').css('border-color', 'red');
                } else { $('#BillingEmail_EmailAddress').css('border-color', ''); }
            }
            if ($('#BillingPhone_Cell').val().trim() != '') {
                if (parseInt($("#BillingPhone_Cell").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                    $('#BillingPhone_Cell').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
                    $('#BillingPhone_Cell').css('border-color', 'red');
                } else { $('#BillingPhone_Cell').css('border-color', ''); }
            }

            if (isvalid == true) {

                var ContactId = 0;
                var BPhoneId = 0;
                var BEmailId = 0;

                if ($("#BillingContactInformation2_ContactId").val() != undefined && $("#BillingContactInformation2_ContactId").val() != "") {
                    ContactId = $("#BillingContactInformation2_ContactId").val();
                }
                if ($("#BillingPhone_PhoneId").val() != undefined && $("#BillingPhone_PhoneId").val() != "") {
                    BPhoneId = $("#BillingPhone_PhoneId").val();
                }
                if ($("#BillingEmail_EmailId").val() != undefined && $("#BillingEmail_EmailId").val() != "") {
                    BEmailId = $("#BillingEmail_EmailId").val();
                }

                var EditCustB2data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#BillingContactInformation2_Name").val(), Title: $("#BillingContactInformation2_Title").val(), PhoneId: BPhoneId, Phone1: $("#BillingPhone_Phone1").val(), PhoneExt: $("#BillingPhone_PhoneExt").val(), Cell: $("#BillingPhone_Cell").val(), Fax: $("#BillingPhone_Fax").val(), EmailId: BEmailId, EmailAddress: $("#BillingEmail_EmailAddress").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupBillingTab2", "Customer")',
                    dataType: "json",
                    data: EditCustB2data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function () { alert('Success'); },
                    error: function () { }
                });
                window.location.href = window.location.href;

            }
        });
        $('#btnBContactCancel').click(function () {
            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $("#btnBContactSave").prop("disabled", "false");
            $("#btnBContactSave").prop("readonly", "true");

            $("#btnBContactCancel").prop("disabled", "false");
            $("#btnBContactCancel").prop("readonly", "true");

            $("#EditBContact").show();
            $("#btnBContactSave").hide();
            $("#btnBContactCancel").hide();
        });


        $("#btnEditDistribution").click(function () {

            $(".editvalue").addClass("editvaluetext");
            $(".editvalue").removeClass("editmode");
            //$("#btnSaveDistribution").show();
            //$("#btnEditDistribution").hide();
            $(".editvalue").removeAttr("disabled").removeAttr("readonly");
            $(".editcheck").removeAttr("disabled").removeAttr("readonly");
        });

        $("#btnSaveDistribution").click(function () {

            if (tempFRowLineNo > 0) {
                alert('save')
            }
            $(".editvalue").removeClass("editvaluetext");
            $(".editvalue").addClass("editmode");
            //$("#btnSaveDistribution").hide();
            //$("#btnEditDistribution").show();
            $(".editvalue").attr("readonly", "readonly");
            $(".editcheck").attr("disabled", "disabled");
            $(".editcheck").attr("readonly", "readonly");
        });

        function onlyDecimal(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) { }
                else { event.preventDefault(); }
                if ($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110)) event.preventDefault();
            });
        }
        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }
        function applyMaskCurrency(id) {
            $(id).inputmask("currency", {
                alias: 'currency',
                prefix: '$ ',
                digits: 2,
                autoUnmask: true,
                removeMaskOnSubmit: true,
                unmaskAsNumber: true,
                allowPlus: false,
                allowMinus: false,
                autoGroup: true,
                groupSeparator: ",",
            });
        }
        function OnClickContractDetailCancel() {
            $('#modal_CustomerContractPopup').modal("hide");
        }
        function ValidateEmail(email) {
            // Validate email format
            var expr = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
            return expr.test(email);
        };
    </script>
    <script>
        function showCustomerMaintenance(id) {
            var sURL = '@Url.Action("CustomerMaintenancePartial", "customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_customermaintenancem').html(data);

                    $('#form_customermaintenance').validate({ // initialize the plugin
                        // your rules and options,
                        errorPlacement: function () {
                            return false;  // suppresses error message text
                        }
                    });
                    $("#manediv").hide();
                    $("#divresumedate").hide();
                    $('#divlastservicedate').hide();
                    $("#divtable").hide();

                    $("#ddlStatus").prop('required', true);
                    $("#StatusDate").prop('required', true);

                    if ($("#ddlStatus").val() > 0) {
                        bindCustomerMaintenanceLoad_popup($("#ddlStatus").val());
                    }
                    $("#ddlStatus").change(function () {
                        var value = this.value;
                        bindCustomerMaintenanceLoad_popup(value);
                    });
                    $(".date-picker").datepicker();

                    $('#tblMaintance').dataTable({
                        "bProcessing": true,
                        "aLengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                        "pageLength": 200, // default records per page
                        "dom": "<'table-responsive't>"
                    });
                    $("#modal_customermaintenanceDetail").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


        function bindCustomerMaintenanceLoad_popup(id) {
            var value = id;
            if (value == 1 || value == 4 || value == 0) {
                $("#manediv").hide();

                $("#ResumeDate").prop('required', false);
                $("#LastServiceDate").prop('required', false);
                $("#ddlReason").prop('required', false);
                $("#StatusNotes").prop('required', false);
            }
            else if (value == 3) {
                $("#manediv").show();
                $("#divtable").hide();
                $('#divlastservicedate').hide();
                $("#divresumedate").show();

                $("#ResumeDate").prop('required', true);
                $("#LastServiceDate").prop('required', false);
                $("#ddlReason").prop('required', true);
                $("#StatusNotes").prop('required', true);
            }
            else if (value == 2) {
                $("#manediv").show();
                $("#divresumedate").hide();
                $('#divlastservicedate').show();
                $("#divtable").show();

                $("#ResumeDate").prop('required', false);
                $("#LastServiceDate").prop('required', true);
                $("#ddlReason").prop('required', true);
                $("#StatusNotes").prop('required', true);
            }
        }


        function saveCustomerMaintenance() {
            var isValid = $('#form_customermaintenance').valid();
            if (!isValid || parseInt($('#hdfCustomerId').val()) == 0) {
                e.preventDefault(); //prevent the default action
            }
            else {
                $.ajax({
                    url: '@Url.Action("CustomerMaintenancePartial", "Customer",new { area = "Portal" })',
                    type: "POST",
                    data: $('#form_customermaintenance').serialize(),
                    success: function (res) {
                        $('#modal_customermaintenanceDetail').modal('hide');
                    },
                    error: function () { }
                });
            }

        };



        function ValidateEmail(email) {
            var expr = /^([\w-\.]+@@([\w-]+\.)+[\w-]{2,4})?$/;
            return expr.test(email);
        };
        $('#BillSetting_EBill').click(function () {
            var checkvalue = $('#BillSetting_EBill').prop('checked')
            if (checkvalue) {
                $('#btnshowbillingcontactemail').show();
            }
            else {
                $('#btnshowbillingcontactemail').hide();
            }

        });
        $('#btnshowbillingcontactemail').click(function () {

            bindEBillEmails();
            $('#divEBill_Emails').html('');
            $('#txtemailaddress_ebill').val('')
            var strEmail = '';
            $.each(ebill_email, function (index, value) {
                $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + value + '</span><br />');
                strEmail += (strEmail != "" ? "," : "") + value;
            });
            $('#mdlAppendemail').modal({ backdrop: 'static' });

        });

        $('#btnaddemailaddress_ebill').click(function () {

            if (!ValidateEmail($("#txtemailaddress_ebill").val())) {
                alert("Invalid email address.");
            }
            else {
                var strEmail = $('#hdfEBill_Emails').val();
                ebill_email.push($('#txtemailaddress_ebill').val());
                $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + $('#txtemailaddress_ebill').val() + '</span><br />');
                strEmail += (strEmail != "" ? "," : "") + $('#txtemailaddress_ebill').val();
                $('#hdfEBill_Emails').val(strEmail);
                $('#txtemailaddress_ebill').val('')
            }
        });


        function bindEBillEmails() {
            ebill_email = [];
            var strEma = $('#hdfEBill_Emails').val();
            $('#divEBill_Emails').html('');
            if (strEma.length > 0) {
                $.each(strEma.split(','), function (index, value) {
                    console.log(value);
                    ebill_email.push(value);
                });
            }
            else {
                if ($('#BillingEmail_EmailAddress').val() != '') {
                    $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + $('#BillingEmail_EmailAddress').val() + '</span><br />');
                    ebill_email.push($('#txtemailaddress_ebill').val());
                }
            }
        }
        //function btnInvoiceWinClose() {
        //    $("#modal_invoicedetail").modal('hide');
        //}

    </script>
    <script type="text/javascript">
        //$("#btnSaveSubmitForm").click(function () {

        //    var isvalid = true;
        //    if ($('#InitiatedBy').val() == '') { $('#InitiatedBy').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#InitiatedBy').css('border-color', ''); }
        //    if ($('#ServiceLogAreaListId').val() == '0') { $('#ServiceLogAreaListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogAreaListId').css('border-color', ''); }
        //    if ($('#ServiceLogTypeListId').val() == '0') { $('#ServiceLogTypeListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#ServiceLogTypeListId').css('border-color', ''); }
        //    if ($('#SpokeWith').val() == '') { $('#SpokeWith').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#SpokeWith').css('border-color', ''); }
        //    if ($('#StatusResultListId').val() == '0') { $('#StatusResultListId').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#StatusResultListId').css('border-color', ''); }
        //    //if ($('#CallBack').val() == '0') { $('#CallBack').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#CallBack').css('border-color', ''); }

        //    $("#CallBack").val($("#txtCallBack").val() + " " + $("#CallTime").val());

        //    var option_all = $("#ddlEmailNotesTo option:selected").map(function () {
        //        return $(this).val();
        //    }).get().join(',');

        //    $("#hdnEmailNotesTo").val(option_all);

        //    if (isvalid == true) {
        //        $("#frmServiceCallLog").submit();
        //    }
        //});
        //function AccountOffringModel() {
        //    $("#modal_AccountOffring").modal("show");
        //}

        //function SearchAccountOffer() {
        //    $("#modal_AccountOffringResult").modal("show");
        //}

        function Editfunction() {
            $(".edit").removeAttr("disabled").removeAttr("readonly");
            $("#btnSave").removeAttr("disabled");
            $("#btnCancel").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBSetting").hide();
            $("#btnSave").show();
            $("#btnCancel").show();


            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

        }

        function EditContactfunction1() {
            $(".editmain1").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave1").removeAttr("disabled");
            $("#btnContactCancel1").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact1").hide();
            $("#btnContactSave1").show();
            $("#btnContactCancel1").show();


            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function EditContactfunction() {

            $(".editmain").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave").removeAttr("disabled");
            $("#btnContactCancel").removeAttr("disabled");
            //$(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact").hide(); btnContactSave1
            $("#btnContactSave").show();
            $("#btnContactCancel").show();

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function EditBContactfunction1() {
            $(".editbill1").removeAttr("disabled").removeAttr("readonly");
            $("#btnBContactSave1").removeAttr("disabled");
            $("#btnBContactCancel1").removeAttr("disabled");
            //$(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBContact1").hide();
            $("#btnBContactSave1").show();
            $("#btnBContactCancel1").show();


            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");
        }
        function EditBContactfunction() {
            $(".editbill").removeAttr("disabled").removeAttr("readonly");
            $("#btnBContactSave").removeAttr("disabled");
            $("#btnBContactCancel").removeAttr("disabled");
            // $(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBContact").hide();
            $("#btnBContactSave").show();
            $("#btnBContactCancel").show();


            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");
        }

    </script>
    <script type="text/javascript">
        function formatJSONDate(jsonDate) {
            if (jsonDate != "") {
                var dateString = jsonDate.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var month = currentTime.getMonth() + 1;
                var day = currentTime.getDate();
                var year = currentTime.getFullYear();
                var date = month + "/" + day + "/" + year;
                return date;
            }
            else
                return '';
        }

        function formatJSONTime(jsonTime) {
            if (jsonTime != "") {
                var dateString = jsonTime.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var hour = currentTime.getHours();
                var min = currentTime.getMinutes();
                var sec = currentTime.getSeconds();
                var time = hour + ":" + min + ":" + sec;
                return time;
            }
            else
                return '';
        }
        var typeaheadSource = [];
        function bindcustomerDetailDisLoad(customerid) {

        }
        function bindfrenchiseelistbox(lineno) {

            $("#fsearch-box_" + lineno).autocomplete({
                source: typeaheadSource,
                appendTo: $("#tblFranchiseeDistributionList"),
                select: function (event, ui) {
                    event.preventDefault();
                    tempFRowLineNo++;
                    tempRowDistribution = "";
                    tempRowDistribution += '<tr><td style="width:20px;text-align:center;">'
                    tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionFranchiseeId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionFranchiseeId_' + lineno + '_' + tempFRowLineNo + '" value="' + ui.item.value + '" />';
                    tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionContractDetailId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionContractDetailId_' + lineno + '_' + tempFRowLineNo + '" value="' + $("#ContractDetailId_" + lineno).val() + '" />';
                    tempRowDistribution += '<input type="hidden" id="FranchiseeDistributionDetailId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionDetailId_' + lineno + '_' + tempFRowLineNo + '" value="' + ui.item.value + '" /><span>' + ui.item.label.split(' ')[0] + '</span></td>';
                    tempRowDistribution += '<td style="text-align:center;width:242px;">' + ui.item.label.replace(ui.item.label.split(' ')[0], "").trim() + '</td>';
                    tempRowDistribution += '<td style="text-align:center;width:30px;"><input type="text" rel="ContractDetailAmount_' + lineno + '" value="' + $("#ContractDetailAmount_" + lineno).val() + '" class="form-control input-sm editvalue" id="FranchiseeDistributionAmountId_' + lineno + '_' + tempFRowLineNo + '" name="FranchiseeDistributionAmountId_' + lineno + '_' + tempFRowLineNo + '" style="margin-top:-6px;margin-bottom: -6px;" /></td>';
                    tempRowDistribution += '</tr>'
                    onlyDecimal('#FranchiseeDistributionAmountId_' + tempRowLineNo + '_' + tempFRowLineNo);
                    $("#fsearch-box").val("");
                    console.log(ui.item.label);
                    console.log(ui.item.value);

                    $("#hdffrenchiseedetail_linecount").val(tempFRowLineNo);
                }
            });


        }
        var editFranchiseeDistribution = function () {

            $(".editvalue").addClass("editvaluetext");
            $(".editvalue").removeClass("editmode");
            //$("#btnSaveDistribution").show();
            //$("#btnEditDistribution").hide();
            $(".editvalue").removeAttr("disabled").removeAttr("readonly");
            $(".editcheck").removeAttr("disabled").removeAttr("readonly");
        };

        function FranchiseeDistribution() {
            var id = $("#CutmID").val();
            var sURL = '@Url.Action("CustomerDetailFranchiseeDistribution", "Customer", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_FranchiseeDistribution').html(data);

                    $(".editvalue").removeClass("editvaluetext");
                    $(".editvalue").addClass("editmode");
                    $(".editvalue").attr("readonly", "readonly");
                    //$("#btnSaveDistribution").hide();
                    //$("#btnEditDistribution").show();
                    $(".editcheck").attr("disabled", "disabled");
                    $(".editcheck").attr("readonly", "readonly");

                    FranchiseeDistributionData(id);
                    bindcustomerDetailDisLoad(id);
                    $('.modal-dialog').draggable();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


        var FDistributionFinal = [];

        var tempRowDistribution = "";
        var tempRowLineNo = 0;
        var tempFRowLineNo = 0;

        function FranchiseeDistributionData(id) {
            $('#hdffrenchiseedetail_customerid').val(id);
            var sURL = '@Url.Action("GetCustomerFranchiseeDistributionData", "Customer", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    $('#hdfdistributioncustomerid').val(data.CustomerId);
                    $('#spnCustomerName').html(data.CustomerName);
                    $('#spnCustomerNo').html(data.CustomerNo);
                    $('#tblFranchiseeDistributionList>tbody').html('');
                    tempRow = "";
                    tempRow += '<tr><td style="width:20px;text-align:center;">' + data.PurchaseOrderNo + '</td>';
                    tempRow += '<td style="text-align:left;width:140px;">' + data.AccountTypeName + '</td>';
                    tempRow += '<td style="text-align:center;width:30px;">' + data.Term + '</td>';
                    tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDate(data.StartDate) + '</td>';
                    tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDate(data.ExpirationDate) + '</td>';
                    tempRow += '<td style="text-align:right;width:30px;">$<span>' + data.TotalAmount + '</span></td>';
                    tempRow += '<td style="text-align:center;width:30px;">' + data.Status + '</td>';

                    tempRow += '<tr><td colspan="7" style="padding:5px;"><div class="table-responsive">';
                    tempRow += '<table class="table table-striped table-bordered table-hover order-column" id="FranchiseeDistributionDetailList">';
                    tempRow += '<thead>';
                    tempRow += '<tr><th style="width:150px;text-align:center;">Contract Detail Line</th>';
                    tempRow += '<th style="text-align:center;"> Service Description</th>';
                    tempRow += '<th style="width:120px;text-align:center;">Amount</th>';
                    tempRow += '<th style="width:100px;text-align:center;">Frequency</th>';
                    tempRow += '<th style="width:50px;text-align:center;">Schedule</th>';
                    tempRow += '</tr></thead><tbody></tbody></table></div></td></tr>';


                    $('#tblFranchiseeDistributionList>tbody').append(tempRow);
                    $('#ddldetaillinenumber').html('');
                    var lineitems = []; lineitems.push("<option value='0'>Select</option>");

                    $.each(data.listContractDetail, function (index, value) {
                        tempRowLineNo = value.LineNumber;
                        tempRowDistribution = "";
                        tempRowDistribution += '<tr>'
                        tempRowDistribution += '<td style="text-align:center;"><input type="hidden" relcdamt="cd_relcdamt" id="cd_relcdamt' + tempRowLineNo + '" value="' + value.Amount + '" />'
                        tempRowDistribution += value.LineNumber + '</td>';
                        tempRowDistribution += '<td style="text-align:center;">' + value.ServiceTypeName + '</td>';
                        tempRowDistribution += '<td style="text-align:right;"><input type="text" value="' + value.Amount + '" class="form-control input-sm editvalue" style="text-align:right;" readonly="readonly"/></td>';
                        tempRowDistribution += '<td style="text-align:center;">' + value.BillingFrequencyListName + '</td>';
                        tempRowDistribution += '<td style="text-align:center;"><a href="javascript:void(0);" onclick="Franchiseeservice(' + value.Mon + ',' + value.Tues + ',' + value.Wed + ',' + value.Thur + ',' + value.Fri + ',' + value.Sat + ',' + value.Sun + ')">View</a></td>'
                        tempRowDistribution += '</tr>'

                        $('#FranchiseeDistributionDetailList>tbody').append(tempRowDistribution);

                        lineitems.push("<option value=" + value.ContractDetailId + ">" + value.LineNumber + "</option>");

                        $('#frdestributionTable>tbody').html('');
                        var flineNo = 0;
                        $.each(data.listFranchiseeDistribution, function (index, value) {
                            AppendDistribution(value.DetailLineNumber, value.FranchiseeId, value.FranchiseeNo, value.FranchiseeName, value.Amount, value.ContractDetailId, value.DistributionId);
                        }),
                        bindfrenchiseelistbox(tempRowLineNo);


                    });

                    $('#ddldetaillinenumber').html(lineitems.join(' '));

                    $("#hdfcontractdetail_linecount").val(tempRowLineNo);
                    $("#hdffrenchiseedetail_linecount").val(tempFRowLineNo);

                    $("#modal_FranchiseeDistribution").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });


        }
        function showEditCustomerInfo() {

            var Id = $("#hdnCustId").val();
            if (Id != "" && Id != "0") {
                var sURL = '@Url.Action("PendingApprovalListEditCustomerPopup", "Customer", new { area = "Portal" })?id=' + Id;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#form_Billingsetting').html(data);
                        $("#ModalEditCustomerInfo").modal({ backdrop: 'static' });
                        $(".input-group-btn").click(function () {
                            $(this).prev().trigger("focus");
                            $(this).prev().trigger("focus");
                        });
                        $(".date-picker").datepicker();
                        $(".edit").attr("disabled", "disabled");
                        $(".edit").attr("readonly", "readonly");

                        $("#btnSave").prop("disabled", "false");
                        $("#btnSave").prop("readonly", "true");
                        $("#btnCancel").prop("disabled", "false");
                        $("#btnCancel").prop("readonly", "true");
                        $("#btnSave").hide();
                        $("#btnCancel").hide();

                        $(".editmain1").attr("disabled", "disabled");
                        $(".editmain1").attr("readonly", "readonly");
                        $(".editmain").attr("disabled", "disabled");
                        $(".editmain").attr("readonly", "readonly");

                        $(".editbill1").attr("disabled", "disabled");
                        $(".editbill1").attr("readonly", "readonly");
                        $(".editbill").attr("disabled", "disabled");
                        $(".editbill").attr("readonly", "readonly");

                        $(".EditBtn").show();
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();

                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            }
        }
        function OpenCustomerContractPopup() {

            var Id = $("#hdnCustId").val();
            if (Id != "" && Id != "0") {

                var sURL = '@Url.Action("RenderCustomerContractDetails", "Customer", new { area = "Portal" })?id=' + Id;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#RenderCustomerContractDetails').html(data);
                        $(".date-picker").datepicker();
                        $(".input-group-btn").click(function () {
                            $(this).prev().trigger("focus");
                            $(this).prev().trigger("focus");
                        });
                        contractDetailPopupInIt();
                        $("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            }
            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }
        // Franchisee Customer Distribution new code
        function BindFranchiseeCustomerDistribution(cid, fid) {

            $("#ModalFranchiseDistribution_CustomerPopup").modal("hide");

            //var sURL = '@Url.Action("RenderFranchiseCustomerDistributionPopup", "Customer", new { area = "Portal" })?cid=' + cid + '&fid=' + fid + '&callfrom=' + $('#hdfCustomerDetailCallFrom').val();
            var sURL = '@Url.Action("RenderFranchiseCustomerOnlyDistributionPopup", "Customer", new { area = "Portal" })?cid=' + cid + '&fid=' + fid + '&callfrom=CD';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    $('#form_FranchiseCustomersDistributionPopup').html(data);
                    $("#CustomerDetail_EffectiveDate").datepicker("setDate", new Date());
                    //$("#modal_CIDFranchiseeDistribution").modal({ backdrop: 'static' });
                    //$("#FD_modal_FranchiseeDistribution").modal({ backdrop: 'static' });



                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function ShowCustomerSuggetionBox() {

            $('#fcsearch-box').val('');
            $('#hdfsearch_franchiseeid').val('');
            var box = $('#fcsearch-box').data('typeahead');
            if (box != null) {
                box.source = c_typeaheadSource;
            }
            else {
                $('#fcsearch-box').typeahead({
                    source: c_typeaheadSource,
                    updater: function (item) {
                        $('#hdfsearch_franchiseeid').val(item.id);
                        BindFranchiseeCustomerDistribution('@(Model.CustomerDetail != null? ViewBag.CustId : "0")', $('#hdfsearch_franchiseeid').val());
                        return item;
                    },
                    minLength: 1
                }).focus();
            }

            $("#ModalFranchiseDistribution_CustomerPopup").modal({ backdrop: 'static' });
        }



        function bindcustomerDetailDisLoad(customerid) {

        }


        function tConvert(time) {
            var timeString = time;
            var H = +timeString.substr(0, 2);
            var h = (H % 12) || 12;
            var ampm = H < 12 ? " AM" : " PM";
            timeString = h + timeString.substr(2, 3) + ampm;
            return timeString;
        }
        function showServiceLog(Id) {

            var sURL = '@Url.Action("CustomerServiceCallLogPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_ServiceCallLogDetails').html(data);
                    //$("#CallBack").datepicker();
                    //$(".input-group-btn").click(function () {
                    //    $(this).prev().trigger("focus");
                    //    $(this).prev().trigger("focus");
                    //});
                    $("#modal_ServiceCallLog").modal({ backdrop: 'static' });
                    $(".date-picker").datepicker();
                    $(".timepicker").timepicker();

                    //$("#CustomerNos").append($(".clscustno").html());
                    //$("#ContactNames").append($(".clscustcont").html());
                    //$("#CustomerNames").append($(".clscustname").html());
                    //$("#Phones").append($(".clscustphon").html());
                    $('#ddlEmailNotesTo').chosen();
                    $('#ddlEmailNotesTo2').chosen();
                },
                error: function (err) {
                    console.log(err);
                }
            });

        }
        function showCollectionLog(Id) {
            var sURL = '@Url.Action("CustomerCollectionLogPopup", "Customer", new { area = "Portal" })?id=' + Id; +
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_CollectionCallLogDetails').html(data);
                    $("#strCallBack").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#modal_CollectionCallLog").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function showFeeFinderList(id) {

            $('#divfinderfeelist').html('');
            var sURL = '@Url.Action("GetFeeFinderList", "Customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#divfinderfeelist').html(data);
                    $("#modal_CustomerFinderFeeDetailPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
            //

        }
        function AccountOffringModel() {
            settimedurationAccountOffering_select(3);
            OnlyNumber('#txtAccountOfferingDistance');
            $("#modal_AccountOffring").modal("show");
        }
        function settimedurationAccountOffering_select(id) {
            $('#select_timedurationAccountOffering').val(id)
            $("#sDateAccountOffering").prop("disabled", true);
            $("#eDateAccountOffering").prop("disabled", true);
            switch (parseInt(id)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    //code block
                    $("#sDateAccountOffering").prop("disabled", false);
                    $("#eDateAccountOffering").prop("disabled", false);
                    break;
                default:
                    //code block
            }
            $('#sDateAccountOffering').val(moment(firstDay).format('L'));
            $('#eDateAccountOffering').val(moment(lastDay).format('L'));
        }
        function showStatements(id) {

            _bindTransactions($('#tbl_statementTransactions tbody'), 0, $('#spnStartDateStatements').text(), $('#spnEndtDateStatements').text(), true);

            $("#modal_showStatements").modal('show');

        }
        function _bindTransactions(elem, typeid, sdate, edate, isForStatements) {
            isForStatements = (isForStatements == true ? true : false);
            var customerId = $('#CustomerID').val();
            if (customerId){

                $.ajax({
                    url: '@Url.Action("CustomerDetailTransactions", "Customer","Portal")&CustomerId='+customerId+'&TypeId=' + typeid + '&StartDate=' + sdate + '&EndDate=' + edate,
                    success: function (res) {

                        var tempRow = "";
                        $(elem).html('');
                        //var vBalamt = -parseFloat(res.StartingBalance);
                        var vBalamt = 0; // temporary until balance is fixed

                        var showAllTransactions = parseInt(typeid) == 0;

                        /*tempRow += '<tr>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">' + moment(new Date(sdate)).format("MM/DD/YYYY") + '</td>'
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">Previous Balance (as of ' + moment(new Date(sdate)).format("MM/DD/YYYY") + ')</td>';
                        tempRow += '<td style="text-align: right;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: right;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: right;font-size: 12px;' + ((vBalamt < 0 && showAllTransactions) ? 'color:red' : '') + '">' + formatCurrency(vBalamt, true) + '</td>';
                        tempRow += '</tr>';
                        $(elem).append(tempRow);*/

                        var credits = 0;
                        var debits = 0;

                        $.each(res.Transactions, function (index, value) {
                            tempRow = "";

                            var amtBal = parseFloat(value.Amount);

                            if (value.AmountTypeListId == 1)
                                credits += amtBal;
                            else if (value.AmountTypeListId == 2)
                                debits += amtBal;

                            // wrap calculation in parseFloat(x.toFixed(2)) to eliminate float precision error
                            vBalamt = parseFloat((vBalamt + (value.AmountTypeListId == 2 ? parseFloat(value.Amount) : (-parseFloat(value.Amount)))).toFixed(2));

                            //var Number = (value.Number != null ? (value.TransactionTypeId == 1 || value.TransactionTypeId == 3 ? value.Number : value.TransactionNumber) : value.TransactionNumber);
                            //var Number = (value.Number != null ? (value.TransactionTypeId == 1 || value.TransactionTypeId == 3 || value.TransactionTypeId == 5 ? value.Number : value.TransactionNumber) : value.TransactionNumber);
                            var Number = (value.Number != null ? value.Number : '');
                            tempRow += '<tr>';
                            tempRow += '<td style="text-align: center;font-size: 12px;">' + value.TransactionTypeName + '</td>';
                            tempRow += '<td style="text-align: center;font-size: 12px;">' + moment(new Date(parseInt(value.TransactionDate.substr(6)))).format("MM/DD/YYYY") + '</td>'
                            tempRow += '<td style="text-align: center;font-size: 12px;"><a onclick="showInvoiceDetail(' + value.RefId + ')">' + Number + '</a></td>';
                            tempRow += '<td style="text-align: center;font-size: 12px;">' + value.Description + '</td>';
                            tempRow += '<td style="text-align: right;font-size: 12px;">' + ((value.AmountTypeListId == 2) ? formatCurrency(value.Amount, true) : "&nbsp;") + '</td>';
                            tempRow += '<td style="text-align: right;font-size: 12px;">' + ((value.AmountTypeListId == 1) ? formatCurrency(value.Amount, true) : "&nbsp;") + '</td>';
                            tempRow += '<td style="text-align: right;font-size: 12px;' + ((vBalamt < 0 && showAllTransactions) ? 'color:red' : '') + '">' + formatCurrency(showAllTransactions ? vBalamt : value.Amount, true) + '</td>';
                            tempRow += '</tr>';

                            $(elem).append(tempRow);
                        });

                        if (isForStatements) {
                            $("#spnStatements_PreviousBalance").text(formatCurrency(-res.StartingBalance, true));
                            $("#spnStatements_Credits").text(formatCurrency(credits, true));
                            $("#spnStatements_Debits").text(formatCurrency(debits, true));
                            $("#spnStatements_NewBalance").text(formatCurrency(-res.StartingBalance + credits - debits, true));
                        }
                    },
                    error: function () { }
                });
            }
        }
        function SearchAccountOffer(_id) {
            $('#_div_AccountOffringResult').html('');
            if ($('#txtAccountOfferingDistance').val() == '') {
                $('#txtAccountOfferingDistance').addClass("has-error");
                return;
            }
            else {
                $('#txtAccountOfferingDistance').removeClass("has-error");
            }


            //$("#modal_AccountOffringResult").modal("show");
            //var _id = @Model.CustomerDetail.CustomerId;
            var _frt = $('#select_AOFranchiseeTypeList').val()
            var _dis = $('#txtAccountOfferingDistance').val()
            //var _eDate = select_timedurationAccountOffering
            var _sDate = $('#sDateAccountOffering').val()
            var _eDate = $('#eDateAccountOffering').val()

            var sURL = '@Url.Action("GetAccountOffringResult", "Customer", new { area = "Portal" })?id=' + _id+'&frt=' + _frt+'&dis=' + _dis+'&sdate=' + _sDate+'&edate=' + _eDate;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#_div_AccountOffringResult').html('');
                    $('#_div_AccountOffringResult').html(data);
                    $("#modal_AccountOffringResult").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
            //

        }
    </script>

    @********************************* Start New Code  **********************************@
    <script type="text/javascript">
        var invoiceList;
        var saveAction;
        var saveInProgress = false;
        var currentPromptedInvoice = "";
        var promptedInvoices = [];
        var isLastPrompt = true;

        var Mxmarchant = false;
        function CCPAY() {
            var sURL = '@Url.Action("PayWithCC", "Customer", new { area = "Portal" })?CardNumber=' + $("#txtCard").val().replace(/ /g, '') + '&CardHolderName=' + $("#txtCCName").val() + '&CardExpiry=' + $("#txtCCExpiry").val() + '&CardCVC=' + $("#txtCCcvc").val() + '&Amount=' + $("#txtAmountToBePay").val() + '&ClassID=' + $("#hdfCustomerId").val() + '&IsProfile=' + true + '&CustomerNo=' + $("#CustomerNo").val() + '&IsCheckedPrevCard=' + $("#ChkCustomerProfile").prop("checked") + '&PaymentProfileID=' + $("#PaymentProfileID").val();
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    if (data.aadata != null) {

                        if (data.aadata.messages != null && data.aadata.messages.message[0].code == "I00001") {
                            $("#paymentAmtMP").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#balanceMP").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#referenceNo").val(data.aadata.transactionResponse.authCode);
                            $("#txtNotes").val(data.aadata.transactionResponse.transId);
                            $("#Last4CC").val(data.aadata.transactionResponse.accountNumber);
                            $("#slPaymentType").prop("readonly", true);
                            $("#referenceNo").prop("readonly", true);
                            $("#txtNotes").prop("readonly", true);
                            $("#paymentAmtMP").prop("readonly", true);
                            $("#paymentDate").prop("readonly", true);
                            $("#btnCCCancle").trigger("click");
                            if (!$("#ChkCustomerProfile").prop("checked")) {
                                $("#swtModel").show();
                            }
                            else {
                                $("#swtModel").remove();
                                swal(
                                    'Payment Approved!',
                                    'Transaction ID: ' + data.aadata.transactionResponse.transId,
                                    'success'
                                )
                            }
                        }
                        else if (data.aadata.Status != null && data.aadata.Status == "Approved") {
                            $("#paymentAmtMP").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#balanceMP").val(commaSeparateNumber($("#txtAmountToBePay").val()));
                            $("#referenceNo").val(data.aadata.AuthCode);
                            $("#txtNotes").val(data.aadata.BatchId);
                            $("#Last4CC").val(data.aadata.CardAccount.Last4);
                            $("#slPaymentType").prop("readonly", true);
                            $("#referenceNo").prop("readonly", true);
                            $("#txtNotes").prop("readonly", true);
                            $("#paymentAmtMP").prop("readonly", true);
                            $("#paymentDate").prop("readonly", true);
                            $("#btnCCCancle").trigger("click");
                            if (!$("#ChkCustomerProfile").prop("checked")) {
                                $("#swtModel").show();
                                Mxmarchant = true;
                            }
                            else {
                                $("#swtModel").remove();
                                swal(
                                    'Payment Approved!',
                                    'Transaction ID: ' + data.aadata.BatchId,
                                    'success'
                                )
                            }
                        }
                        else {
                            $("#btnCCCancle").trigger("click");
                            alert("Credit Card decline, please check Credit Card number or enter new Credit Card.", function (ctl) {
                                if (ctl) {
                                    location.reload();
                                }
                            });
                        }

                    }
                    else {
                        $("#btnCCCancle").trigger("click");
                        alert("Credit Card decline, please check Credit Card number or enter new Credit Card.", function (ctl) {
                            if (ctl) {
                                location.reload();
                            }
                        });
                    }
                },
                error: function () {
                    alert("Credit Card decline, please check Credit Card number or enter new Credit Card.");
                }
            });
            $("#input_Search").val($("#csearch-box").val());
            $("#input_Search").trigger("keyup");
        }
        function NextStepPayment() {
            var sURL = '@Url.Action("GetBillingAddress", "Customer", new { area = "Portal" })?Id=' + $("#hdfCustomerId").val();
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    console.log(data.aadata);
                    if (data.aadata != null) {
                        if (data.aadata.AccountNumber != null) {
                            $("#DivCustomerProfile").show();
                            $("#DivCustomer").hide();
                            $(".demo-container").show();
                            $("#lblAccount").text(data.aadata.AccountNumber);
                            $("#PaymentProfileID").val(data.aadata.Id);

                        }
                        else {
                            $(".demo-container").show();
                            $("#DivCustomer").hide();

                        }
                    }
                    else {
                        $(".demo-container").show();
                        $("#DivCustomer").hide();


                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function calculateBalance() {
            var paymentAmount = parseFloat(removeFormatting($("#paymentAmtMP").val()));
            var creditAmount = parseFloat($("#customerCreditAmtMP").val());

            var allocatedPayments = 0;
            $("[id$=totalPayment]").each(function () {
                var amt = parseFloat(removeFormatting($(this).val()));
                if ($.isNumeric(amt))
                    allocatedPayments += amt;
            });

            var balance = paymentAmount + creditAmount - allocatedPayments; // todo: subtract all allocated payments

            setAmount(paymentAmount);
            setBalance(balance);
        }
        function setAmount(amt) {
            var txt = '';
            if (amt > 0)
                txt = commaSeparateNumber((amt).toFixed(2));
            $("#paymentAmtMP").val(txt);
        }

        function setBalance(amt) {
            var txt = commaSeparateNumber((amt).toFixed(2));
            $("#balanceMP").val(txt);
        }

        function selectInvoice(inv) {
            var invPrefix = "#" + getInvoicePrefix(inv);
            var balance = parseFloat(removeFormatting($("#balanceMP").val()));
            var invAmount = parseFloat(removeFormatting($(invPrefix + "amount").val()));

            var payment = 0.00;
            var isChecked = $(invPrefix + "chk").prop("checked");

            if (!isChecked) // currently selected, so deselect
                setInvoicePayment(invPrefix, 0);
            else {
                payment = Math.min(balance, invAmount); // get either the full invoice amount, or what's left in the balance
                console.log(payment)
                console.log(balance)
                console.log(invAmount)
                setInvoicePayment(invPrefix, payment);
            }

            setInvoiceBalance(invPrefix, invAmount - payment);

            calculateBalance();
        }

        $(document).on('change', ".payment-checkbox", function () {
            var inv = getInvoiceIdChunk(this);
            selectInvoice(inv);
        });

        function getInvoiceIdChunk(elem) {
            return $(elem).attr("id").split('_')[0];
        }

        function getInvoiceFilter(inv) {
            return "[id^=" + getInvoicePrefix(inv) + "]";
        }

        function getInvoicePrefix(inv) {
            return inv + "_";
        }

        function getInvoiceParentFormFilter(inv) {
            return "#" + getInvoicePrefix(inv) + "modal_applypaymentform ";
        }

        function commaSeparateNumber(val) {
            if (val != "") {
                val = parseFloat(val).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()

                //while (/(\d+)(\d{3})/.test(val.toString())) {
                //    val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
                //}
            }
            return val;
        }

        function removeFormatting(i) {
            return typeof i === 'string' ?
                i.replace(/[\$,]/g, '') * 1 :
                typeof i === 'number' ?
                i : 0;
        }

        function setInvoicePayment(invPrefix, amt) {
            var txt = '';
            if (amt > 0)
                txt = commaSeparateNumber((amt).toFixed(2));
            $(invPrefix + "totalPayment").val(txt);
        }

        function onClickYesApplyPayment() {
            $("#modal_applypaymentprompt").modal('hide');

        }

        function setInvoiceBalance(invPrefix, amt) {
            $(invPrefix + "balance").val(commaSeparateNumber((amt).toFixed(2)));
        }

        function onClickNoApplyPayment() {
            saveInProgress = false;
            currentPromptedInvoice = "";
            $("#modal_applypaymentprompt").modal('hide');
        }
        function CreateProfile() {
            $.ajax({
                type: "GET",
                url: '@Url.Action("CreateProfile", "Customer", new { area = "Portal" })',
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                }
            });
        }

        function printCustomerStatement(data) {

            var afterPrint = function () {

            }

            var sURL = data;
            $('#iframe_statement').attr('src', document.location.origin + sURL);
            $('#iframe_statement').load(function () {

                // for ie and firefox
                window.onafterprint = afterPrint();

                // for chrome
                if (window.matchMedia) {
                    var mediaQueryList = window.matchMedia('print');
                    mediaQueryList.addListener(function (mql) {
                        if (mql.matches) {
                        } else {
                            afterPrint();
                        }
                    });
                }

                frames['iframe_statement'].print();
            });

        }

        jQuery(document).ready(function () {


            if ($("#hdnARStatusId").val() != "" && $("#hdnARStatusId").val() != "0" && $("#hdnARStatusId").val() != undefined)
            {
                $("#ArStatusList").val($("#hdnARStatusId").val());
            }
            $(".input-group-btn").click(function () {
                $(".input-group-btn").prev().trigger("focus");
                $(".input-group-btn").prev().trigger("focus");
            });

            $('#btnCloseStatements').click(function () {
                $('#modal_showStatements').modal('hide');
            })

            $('#btnPrintStatement').click(function () {
                printCustomerStatement('@Url.Action("CustomerStatementPrint", "Customer", new { area = "Portal" })?customerId=@(Html.DisplayFor(one => one.CustomerDetail.CustomerId))&start=' + $('#spnStartDateStatements').text() + '&end=' + $('#spnEndtDateStatements').text());
            });

            $('#btnExportStatement').click(function () {
                window.location.href = '@Url.Action("CustomerStatementExportToPDF", "Customer", new { area = "Portal" })?customerId=@(Html.DisplayFor(one => one.CustomerDetail.CustomerId))&start=' + $('#spnStartDateStatements').text() + '&end=' + $('#spnEndtDateStatements').text();
            });

            $("#slPaymentType").change(function () {
                if ($(this).val() == "2") {
                    var data = $(".payment-checkbox")
                    if (data.length >= 1) {
                        $('#myModal').modal('show');
                        $("#txtAmountToBePay").val($("#paymentAmtMP").val().replace(',', ''));
                    }
                    else {
                        alert("You Don't have invoice.");
                    }
                }
                else
                    $('#myModal').modal('hide');

            });

            $(document).on("change",
                "input[type='radio'][name='rdApplyAmtType']",
                function () {
                    toggleApplyAmtField();
                }
            );

            $("#BtnCCPay").click(function () {
                if ($("#DivCustomer").css("display") != "block") {
                    CCPAY();
                }
                else
                    NextStepPayment();
            });

            $("#btnSuccessPopUp").click(function () {
                $("#swtModel").remove();

                if (!Mxmarchant) {
                    swal({
                        title: "Do you want to save CC in your profile?",
                        text: "For Future Transaction You will be able to make payment without entering the CC Details.",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: '#DD6B55',
                        confirmButtonText: 'Yes',
                        cancelButtonText: "No",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    },
                        function (isConfirm) {
                            if (isConfirm) {

                                CreateProfile();
                                swal(
                                    'CC Saved in Profile.',
                                    '',
                                    'success'
                                )
                            }
                            else {
                                swal(
                                    'Cancelled.',
                                    '',
                                    'error'
                                )
                            }
                        });
                }

            });

            $("#paymentAmtMP").change(function () {
                calculateBalance();
            });







        });

        function showAddFee() {
            $('#modal_AddFee').modal('show');
        }

        function onClickSaveAndCloseMP() {
            $("#modal_ManualPayment").modal("hide");
            $("#SaveMethod").val("SaveClose");
            continueSaveProcessfrm();
            // go back to customer page?
        }

        function onClickSaveAndNewMP() {
            $("#modal_ManualPayment").modal("hide");
            $("#SaveMethod").val("SaveNew");
            continueSaveProcessfrm();
            // refresh to allow new payment entry?
        }

        function continueSaveProcessfrm() {

            saveInProgress = true;
            isLastPrompt = true;
            var nextPrompt = "";

            $("[id$=totalPayment]").each(function () {

                if (!isLastPrompt)
                    return;

                var inv = getInvoiceIdChunk(this);
                var invId = inv.substr(3);

                if (promptedInvoices.indexOf(invId) == -1) { // invoice not checked yet

                    var invPrefix = getInvoicePrefix(inv);

                    var isChecked = $("#" + invPrefix + "chk").prop("checked");
                    var newInvBalance = parseFloat($("#" + invPrefix + "balance").val());
                    var shouldPrompt = $.isNumeric(newInvBalance) && newInvBalance > 0 && isChecked;

                    if (shouldPrompt) { // invoice needs to be prompted
                        if (nextPrompt != "") {
                            isLastPrompt = false;
                            return;
                        }
                        else {
                            nextPrompt = invId;
                        }
                    }
                }
            });

            if (nextPrompt != "")
                promptApplyPaymentFormMP(nextPrompt);
            else
                finishSaveProcessfrm();
        }

        function finishSaveProcessfrm() {

            // disable fields for non-selected invoice to keep them out of the POST

            $(".payment-checkbox").each(function () {
                if (!$(this).prop("checked")) { // invoice checkbox is not checked, so disable fields
                    var inv = getInvoiceIdChunk(this);
                    var invFilter = getInvoiceFilter(inv);
                    $(invFilter).attr("disabled", "disabled");
                }
            });

            $("#form_applypayment").submit();
        }
        $('#modal_applypaymentprompt').on('hidden.bs.modal', function () {
            if (saveInProgress) {
                var invId = currentPromptedInvoice;
                var inv = "inv" + invId;
                var invPrefix = getInvoicePrefix(inv);
                var hasMultipleItems = $("#" + invPrefix + "hasMultipleItems").val() == "true";

                if (hasMultipleItems)
                    openApplyPaymentForm(currentPromptedInvoice);
                else
                    continueToNextInvoice(invId);
            }
        });
        function promptApplyPaymentFormMP(invId) {
            currentPromptedInvoice = invId;

            var inv = "inv" + invId;
            var invPrefix = getInvoicePrefix(inv);

            var invoiceNo = $("#" + invPrefix + "invoiceNo").val();

            $("#lblPromptInvoiceNo").text(invoiceNo.trim());
            $("#modal_applypaymentprompt").modal({ backdrop: 'static' });
        }

        function getInvoiceIdChunk(elem) {
            return $(elem).attr("id").split('_')[0];
        }

        function getInvoiceFilter(inv) {
            return "[id^=" + getInvoicePrefix(inv) + "]";
        }

        function getInvoicePrefix(inv) {
            return inv + "_";
        }

        function initPaymentForm(inv) {

            var invPrefix = getInvoicePrefix(inv);

            var totalPayment = parseFloat($("#" + invPrefix + "totalPayment").val());
            if ($.isNumeric(totalPayment)) {
                $("#" + invPrefix + "paymentAmt").val(totalPayment.toFixed(2));
            }

            refreshPaymentForm(inv);
            showFranchiseesForLineNumber(inv, 1);
            togglePaymentUnitColumns(inv);
        }



        function showApplyPaymentForm(inv) {

            var invPrefix = getInvoicePrefix(inv);

            var form = $("#" + invPrefix + "modal_applypaymentform");

            $("#" + invPrefix + "btnContinue").hide();
            $("#" + invPrefix + "btnFinish").hide();

            if (saveInProgress) {
                if (isLastPrompt)
                    $("#" + invPrefix + "btnFinish").show();
                else
                    $("#" + invPrefix + "btnContinue").show();
            }

            $(form).modal({ backdrop: 'static' });
        }

        function continueToNextInvoice(invId) {
            var invStr = invId.toString();

            if (saveInProgress) { // in the middle of save process, so continue to next invoice

                if (promptedInvoices.indexOf(invStr) == -1)
                    promptedInvoices.push(invStr);

                var form = $("#inv" + invStr + "_modal_applypaymentform");
                $(form).modal('hide');

                setTimeout(continueSaveProcessfrm);
            }
        }

        function showFranchiseesForLineNumber(inv, lineNo) {
            var invFormFilter = getInvoiceParentFormFilter(inv);
            $(invFormFilter + ".franchisee-row").hide();
            $(invFormFilter + ".franchisee-row-line" + lineNo).show();
        }

        function togglePaymentUnitColumns(inv, paymentUnit) {
            var invFilter = getInvoiceFilter(inv);
            var invFormFilter = getInvoiceParentFormFilter(inv);
            var paymentUnit = $("input[type=radio]" + invFilter + "[name=rdPaymentUnit]:checked").val();
            $(invFormFilter + ".franchisee-amt-col").hide();
            $(invFormFilter + ".franchisee-pct-col").hide();
            $(invFormFilter + ".franchisee-" + paymentUnit + "-col").show();
        }

        function refreshPaymentForm(inv) {
            updateLineItemData(inv);
            updateFranchiseeData(inv);
        }

        function getInvoiceParentFormFilter(inv) {
            return "#" + getInvoicePrefix(inv) + "modal_applypaymentform ";
        }

        function commaSeparateNumber(val) {
            if (val != "") {
                val = parseFloat(val).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()

                //while (/(\d+)(\d{3})/.test(val.toString())) {
                //    val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
                //}
            }
            return val;
        }

        function removeFormatting(i) {
            return typeof i === 'string' ?
                i.replace(/[\$,]/g, '') * 1 :
                typeof i === 'number' ?
                i : 0;
        }

        function formatJSONDate(jsonDate) {
            if (jsonDate != "") {
                var dateString = jsonDate.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var month = currentTime.getMonth() + 1;
                var day = currentTime.getDate();
                var year = currentTime.getFullYear();
                var date = month+ "/" + day + "/" + year;
                return date;
            }
            else
                return '';
        }

        function formatJSONTime(jsonTime) {
            if (jsonTime != "") {
                var dateString = jsonTime.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var hour = currentTime.getHours();
                var min = currentTime.getMinutes();
                var sec = currentTime.getSeconds();
                var time = hour + ":" + min + ":" + sec;
                return time;
            }
            else
                return '';
        }

        function getTableURL(id) {

            var _regionId = '@Model.CustomerDetail.RegionId';
            var _fromDateVal = $('#dtpfromCT').val();
            var _toDateVal = $('#dtptoCT').val();
            var _searchtextVal = "";
            //var _consolidated = $('#chkConsolidatedCT').prop("checked");
            var _open =$('#chkOpenMP').prop("checked");
            var _close =$('#chkCloseMP').prop("checked");
            //var sURL = '@Url.Action("GetCreditResultData", "Customer", new { area = "Portal" })?CustomerId=' + id
            var sURL = '@Url.Action("InvoicesSearchForCreditResultData", "AccountReceivable", new { area = "Portal" })?rgId=' + _regionId + '&fd=' + _fromDateVal + '&td=' + _toDateVal + '&st=' + _searchtextVal + '&consolidated=' + _open + '&closed=' + _close + '&customerId=' + id
            return sURL;
        }
        $(".search-field").change(function () {
            refreshCreditTransaction($("#hdfCustomerId").val());
        });
        function refreshTable() {
            var url = getManualPaymentTableURL($("#hdfCustomerId").val());
            ManualPaymentList.ajax.url(url).load();
        }
        function refreshCreditTransaction(id) {
            var sURL = getTableURL(id);
            console.log(sURL);
            invoiceList.ajax.url(sURL).load();
        }



        function applyDurationFilter(v) {
            $('#spnStartDate').html('');
            $('#spnEndtDate').html('');
            $('.divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();
            $('#divmonth').hide();
            $('#divyear').hide();
            $('#spnStartDate').html('');
            $('#spnEndtDate').html('');
            $('#monthlist').val('');
            $('#yearlist').val('');
            switch (v) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().toString();
                    lastDay = moment().toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 14:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 15:
                    //code block
                    $('.divspandate').hide();
                    $('#divSD').show();
                    $('#divED').show();
                    $('#txtStartDate').val('');
                    $('#txtEndtDate').val('')
                    break;
                case 16:
                    $('.divspandate').hide();
                    $('#divSD').hide();
                    $('#divED').hide();
                    $('#divmonth').show();
                    $('#divyear').show();
                    break
                default:
                    //code block
            }
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));
        }


        function setSearchTime(value) {
            value = parseInt(value);
            $("#select_dateRangeMP").val(value.toString());
            var custom_enabled = false;
            var firstDay;
            var lastDay;

            switch (parseInt(value)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    custom_enabled = true;
                    //code block
                    $('#dtpfromMP').html(moment(firstDay).format('L'));
                    $('#dtptoMP').html(moment(lastDay).format('L'));
                    break;
                default:
                    //code block
            }
            $('#dtpfromMP').val(moment(firstDay).format('L'));
            $('#dtptoMP').val(moment(lastDay).format('L'));

            $(".search-date-field").prop('disabled', !custom_enabled);
        };

        //Search Time Credit Transaction
        function setCTSearchTime(value) {
            value = parseInt(value);
            $("#select_dateRangeCT").val(value.toString());
            var custom_enabled = false;
            var firstDay;
            var lastDay;

            $("#dtpfromCT").removeClass("date-picker");
            $("#dtptoCT").removeClass("date-picker");

            switch (parseInt(value)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    custom_enabled = true;
                    //code block
                    $('#dtpfromCT').html(moment(firstDay).format('L'));
                    $('#dtptoCT').html(moment(lastDay).format('L'));
                    $("#dtpfromCT").addClass("date-picker");
                    $("#dtptoCT").addClass("date-picker");
                    break;
                default:
                    //code block
            }
            $('#dtpfromCT').val(moment(firstDay).format('L'));
            $('#dtptoCT').val(moment(lastDay).format('L'));

            $(".search-date-field").prop('disabled', !custom_enabled);
        };

        $(document).ready(function () {

            $('#ddlEmailNotesTo').chosen();
            $('#ddlEmailNotesTo2').chosen();

            $("#btnAddFee").click(function () {
                $('#modal_AddFee').modal('hide');
                $('#modal_SaveAddFee').modal('show');
            });

            //Credit Transaction Date Change
            $("#select_dateRangeCT").change(function () {
                var value = this.value;
                setCTSearchTime(value);
                refreshCreditTransaction($("#CTMC").val());
            });

            //Manual Payment Date Change
            $("#select_dateRangeMP").change(function () {
                var value = this.value;
                setSearchMPTime(value);
                refreshTable();
            });
            //Manual Payment
            setSearchMPTime(7);

            //Credit Transaction
            setCTSearchTime(3);

            $.validator.messages.required = '';
            $("#input_Search").autocomplete({
                appendTo: $("#container"),
                source: function (request, response) {
                    $.ajax({
                        url: "/Portal/Customer/CustomerAutoCompleteList",
                        type: "POST",
                        dataType: "json",
                        data: { namePrefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item.Name, value: item.CustomerId };
                            }))
                        },
                        error: function (result) {

                        }
                    })
                }
            });

            $("#rdoDistance").prop("checked", true);
            $("#divShortBy").hide();
            $("#rdoDistance").change(function () {
                if (this.value == 1) {
                    $("#rdoDistance").prop("checked", true);
                    $("#rdoObligation").prop("checked", false);
                    $("#divShortBy").hide();
                    $("#divDistance").show();
                }
            });

            $("#rdoObligation").change(function () {
                if (this.value == 0) {
                    $("#rdoDistance").prop("checked", false);
                    $("#rdoObligation").prop("checked", true);
                    $("#divShortBy").show();
                    $("#divDistance").hide();
                }
            });



            function applyAutoSeacrh() {

                $.ajax({
                    type: "GET",
                    url: '@Url.Action("GetAllCustomer", "Customer", new { area = "Portal" })',
                    data: {},
                    success: function (data) {

                        var typeaheadSource = [];
                        $.each(data, function (key, value) {
                            typeaheadSource.push({ id: value.CustomerId, name: value.CustomerNo + ' ' + $.trim(value.Name) })
                        });
                        var box = $('#csearch-box').data('typeahead');
                        if (box != null) {

                            console.log('csearch source change');
                            box.source = typeaheadSource;
                        }
                        else {
                            console.log('csearch initiated');
                            $('#csearch-box').typeahead({
                                source: typeaheadSource,
                                updater: function (item) {
                                    console.log(item);
                                    redirect(item.id);
                                    return item;
                                },
                                minLength: 1
                            }).focus();
                        }
                    }
                });
            }

            $("#input_SearchCT").keyup(function () {
                var table = $("#tblCustomerCreditsList").DataTable();
                table.search($(this).val()).draw();
            });

            $("#input_SearchMP").on('keyup', function () {
                var table = $("#ManualPaymentList").DataTable();
                table.search($(this).val()).draw();
            });

            applyAutoSeacrh();
            //applyAutoInvoicePaymentSearch();
            $('#divspandateStatements').show();
            $('#divSDStatements').hide();
            $('#divEDStatements').hide();

            //$('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();

            firstDay = moment().subtract(0, 'month').startOf('month').toString();
            lastDay = moment().subtract(0, 'month').endOf('month').toString();

            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));

            $('#spnStartDateStatements').html(moment(firstDay).format('L'));
            $('#spnEndtDateStatements').html(moment(lastDay).format('L'));


            settimeduration_select(3);
            settimedurationStatements_select(3);

            //$('#txtStartDate').inputmask("mm/dd/yyyy", {});
            //$('#txtEndtDate').inputmask("mm/dd/yyyy", {});

            $("#txtFrom").val(moment(firstDay).format('L'));
            $("#txtTo").val(moment(lastDay).format('L'));
            $("#txtFrom").prop("disabled", true);
            $("#txtTo").prop("disabled", true);

            $('#txtStartDateStatements').inputmask("mm/dd/yyyy", {});
            $('#txtEndtDateStatements').inputmask("mm/dd/yyyy", {});

            $("#txtFromStatements").val(moment(firstDay).format('L'));
            $("#txtToStatements").val(moment(lastDay).format('L'));
            $("#txtFromStatements").prop("disabled", true);
            $("#txtToStatements").prop("disabled", true);

            $("#lblamount").inputmask("numeric", {
                decimal: ".",
                negative: false,
                scale: 2,
                groupSeparator: ",",
                digits: 2,
                autoGroup: true,
                prefix: "$",
                rightAlign: false,
                autoUnmask: true,
                removeMaskOnSubmit: true,
            });

            typeaheadSourceF = [];
            @*$.ajax({
                type: "GET",
                url: '@Url.Action("GetAllFranchisees", "Franchise", new { area = "Portal" })',
                success: function (data) {
                    custlist = data;

                    $.each(custlist, function (key, value) {
                        typeaheadSourceF.push({ value: value.FranchiseeId, label: value.FranchiseeNo + ' ' + $.trim(value.Name) })
                    });

                }
            });*@
            $('#MainPhone_Phone1').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });
            $('#MainPhone_Fax').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });


            $('#MainPhone2_Phone1').inputmask("mask", {
                "mask": "(999) 999-9999"
            });
            $('#MainPhone2_Fax').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });
            $('#MainPhone2_Cell').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });


            $('#BillingPhone_Phone1').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });
            $('#BillingPhone_Fax').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });
            $('#BillingPhone_Cell').inputmask("mask", {
                "mask": "(999) 999-9999", removeMaskOnSubmit: true,
            });


            $('#chkbillingsameas').click(function () {
                var checked = $('#chkbillingsameas').is(':checked');

                var MainAddress_Name = $('#BillingContact_Name'),
                    MainAddress_Address1 = $('#BillingAddress_Address1'),
                    MainAddress_City = $('#BillingAddress_City'),
                    MainAddress_State = $('#BillingStatesList'),
                    MainAddress_PostalCode = $('#BillingAddress_PostalCode');

                if (checked) {
                    MainAddress_Name.val($('#CustomerViewModel_Name').val());
                    MainAddress_Address1.val($('#MainAddress_Address1').val());
                    MainAddress_City.val($('#MainAddress_City').val());
                    MainAddress_State.val($('#MainStatesList').val());
                    MainAddress_PostalCode.val($('#MainAddress_PostalCode').val());

                    MainAddress_Name.attr("readonly", "readonly");
                    MainAddress_Address1.attr("readonly", "readonly");
                    MainAddress_City.attr("readonly", "readonly");
                    MainAddress_State.attr("readonly", "readonly");
                    MainAddress_PostalCode.attr("readonly", "readonly");

                }
                else {
                    MainAddress_Name.val('');
                    MainAddress_Address1.val('');
                    MainAddress_City.val('');
                    MainAddress_State.val('');
                    MainAddress_PostalCode.val('');

                    MainAddress_Name.removeAttr("readonly");
                    MainAddress_Address1.removeAttr("readonly");
                    MainAddress_City.removeAttr("readonly");
                    MainAddress_State.removeAttr("readonly");
                    MainAddress_PostalCode.removeAttr("readonly");
                }
            });
            $('#chkbillingcontactsameas').click(function () {
                var MainContactAddress_FName = $('#BillingContactInformation2_Name'),
                    //MainContactAddress_LastName = $('#BillingContact_LastName'),
                    MainContactAddress_Title = $('#BillingContactInformation2_Title'),
                    MainContactAddress_Phone = $('#BillingPhone_Phone1'),
                    MainContactAddress_PhoneExt = $('#BillingPhone_PhoneExt'),
                    MainContactAddress_Cell = $('#BillingPhone_Cell'),
                    MainContactAddress_Fax = $('#BillingPhone_Fax'),
                    MainContactAddress_Email = $('#BillingEmail_EmailAddress');
                if ($(this).prop('checked')) {
                    MainContactAddress_FName.val($('#MainContact_Name').val());
                    // MainContactAddress_LastName.val($('#ContactInformation_LastName').val());
                    MainContactAddress_Title.val($('#MainContact_Title').val());
                    MainContactAddress_Phone.val($('#MainPhone2_Phone1').val());
                    MainContactAddress_PhoneExt.val($('#MainPhone2_PhoneExt').val());
                    MainContactAddress_Cell.val($('#MainPhone2_Cell').val());
                    MainContactAddress_Fax.val($('#MainPhone2_Fax').val());
                    MainContactAddress_Email.val($('#MainEmail_EmailAddress').val());

                    MainContactAddress_FName.attr("readonly", "readonly");
                    //MainContactAddress_LastName.attr("readonly", "readonly");
                    MainContactAddress_Title.attr("readonly", "readonly");
                    MainContactAddress_Phone.attr("readonly", "readonly");
                    MainContactAddress_PhoneExt.attr("readonly", "readonly");
                    MainContactAddress_Cell.attr("readonly", "readonly");
                    MainContactAddress_Fax.attr("readonly", "readonly");
                    MainContactAddress_Email.attr("readonly", "readonly");
                }
                else {
                    MainContactAddress_FName.val('');
                    //MainContactAddress_LastName.val('');
                    MainContactAddress_Title.val('');
                    MainContactAddress_Phone.val('');
                    MainContactAddress_PhoneExt.val('');
                    MainContactAddress_Cell.val('');
                    MainContactAddress_Fax.val('');
                    MainContactAddress_Email.val('');

                    MainContactAddress_FName.removeAttr("readonly");
                    //MainContactAddress_LastName.removeAttr("readonly");
                    MainContactAddress_Title.removeAttr("readonly");
                    MainContactAddress_Phone.removeAttr("readonly");
                    MainContactAddress_PhoneExt.removeAttr("readonly");
                    MainContactAddress_Cell.removeAttr("readonly");
                    MainContactAddress_Fax.removeAttr("readonly");
                    MainContactAddress_Email.removeAttr("readonly");
                }
            });

            if(@ViewBag.CustomerID > 0)
                _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());

            $('.modal-dialog').draggable();


            $(document).on("click", ".submit-button", function () {
                var flg = true;
                if ($("#select_ReasonList").val() == "") {
                    flg = false;
                    $("#select_ReasonList").css("border-color", "red");
                }
                else {
                    $("#select_ReasonList").css("border-color", "#c2cad8")
                }
                if ($("#creditDesc").val() == "") {
                    flg = false;
                    $("#creditDesc").css("border-color", "red");
                }
                else {
                    if (flg)
                        flg = true;
                    else
                        flg = false;
                    $("#creditDesc").css("border-color", "#c2cad8");
                }

                var _customerLineAmount = 0.00;
                var _franchiseeLineAmount = 0.00;
                $(".credit-line-item-total-field").each(function () {
                    _customerLineAmount = _customerLineAmount + parseFloat($(this).val());
                });
                $(".credit-franchisee-field").each(function () {
                    _franchiseeLineAmount = _franchiseeLineAmount + parseFloat($(this).val());
                });


                if (_franchiseeLineAmount != _customerLineAmount) {
                    flg = false;
                    alert('Please enter franchisee distribution amount equal line amount total.')
                } else {
                    if (flg)
                        flg = true;
                    else
                        flg = false;
                }

                var CCflg = validateCreditAmount();

                if (flg && CCflg) {
                    var balance = parseFloat($("#newBalance").val());
                    var buttonName = $(this).attr("name");

                    saveAction = buttonName;
                    if (balance >= 0) // no customer credit necessary
                        submitForm();
                    else
                        promptCustomerCredit();
                }
            });

        });
        function submitForm() {

            $('.creditfieldcurrency').each(function () {
                $('#' + this.id).inputmask('remove');
            });
            $.ajax({
                type: "POST",
                url: '@Url.Action("ApplyCredit","AccountReceivable","Portal")',
                data: $("#form_applycreditform").serialize() + "&action=" + saveAction,
                dataType: 'json',
                success: function (data) {
                    if (saveAction != "SaveContinue")
                        document.location.reload();
                    else
                        continueCancellationProcess();
                }
            });
        }
        function promptCustomerCredit() {

            var creditAmt = parseFloat(removeFormatting($("#newBalance").val()));
            if (creditAmt < 0)
                creditAmt = -creditAmt;

            var customerName = $("#lblCustomerName").text();

            $("#lblPromptCreditAmt").text("$" + formatCurrency(creditAmt));
            $("#lblPromptCreditCustomerName").text(customerName.trim());
            $("#modal_customercreditprompt").modal({ backdrop: 'static' });
        }
        function onClickYesApplyCustomerCredit() {
            $("#modal_customercreditprompt").modal('hide');
            submitForm();
        }

        function onClickNoApplyCustomerCredit() {
            $("#modal_customercreditprompt").modal('hide');
        }

        var typeaheadSourceF = [];
        $(document).on('click', '#btnClosemodel', function () {
            $("#modal_invoicedetail").modal('hide');
        });

        @*function redirect(id) {
            var url = '@Url.Action("CustomerDetail", "Customer",new { area = "Portal", id =  -1})';
            var path = url.replace("-1", id);
            location.href = path;
        }*@

        function setSearchMPTime(value) {

            value = parseInt(value);
            $("#select_dateRangeMP").val(value.toString());
            var custom_enabled = false;
            var firstDay;
            var lastDay;

            switch (parseInt(value)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    custom_enabled = true;
                    //code block
                    $('#dtpfrom').html(moment(firstDay).format('L'));
                    $('#dtpto').html(moment(lastDay).format('L'));
                    break;
                default:
                    //code block
            }
            $('#dtpfromMP').val(moment(firstDay).format('L'));
            $('#dtptoMP').val(moment(lastDay).format('L'));

            $(".search-date-field").prop('disabled', !custom_enabled);
        };

        var GetCustomerId = function () {
            var postData = {
                "parentname": $("#input_parentnamemodel").val(),
            };
            $.ajax({
                url: "/Portal/Customer/GetCustomerId",
                type: "POST",
                data: postData,
                dataType: "json",
                cache: false,
                success: function (response) {
                    if (response.success == true) {
                        var url = '@Url.Action("CustomerDetail", "Customer",new { area = "Portal", id =  -1})';
                        var path = url.replace("-1", response.id);
                        location.href = path;
                    }

                },
                error: function (error) {

                }
            });
        }

        function showInvoiceDetail(id) {

            var sURL = '@Url.Action("InvoiceDetail", "AccountReceivable", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_invoicedetail').html(data);
                    $("#modal_invoicedetail").modal({ backdrop: 'static' });
                    //$("#modal_invoicedetail").modal('show');
                    $('.modal-dialog').draggable();
                    //$("#modal_showStatements").modal('hide');
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function OpenPaymentDetail(strNo) {
            $.blockUI();

            var sURL = '@Url.Action("PaymentDetailPopup", "AccountReceivable", new { area = "Portal" })?paymentId=' + strNo;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_paymentlist').html(data);
                    $("#modal_paymentdetail").modal({ backdrop: 'static' });
                    //$("#modal_paymentdetail").modal('show');
                    $('.modal-dialog').draggable();

                    $.unblockUI();
                },
                error: function (err) {
                    $.unblockUI();
                    console.log(err);
                }
            });
        }

        function OpenCustomerCreditDetail(id) {
            $.blockUI();
            var sURL = '@Url.Action("CustomerCreditDetailPopup", "AccountReceivable", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_CusCreditDetails').html(data);
                    $("#modal_CusCreditDetail").modal({ backdrop: 'static' });
                    //$("#modal_CusCreditDetail").modal('show');
                    $('.modal-dialog').draggable();
                    $.unblockUI();
                },
                error: function (err) {
                    $.unblockUI();
                    console.log(err);
                }
            });
        };

        function ShowAddNEwFeeFinder() {
            var id = 272;
            $('#div_FeeFinderdetailResultData').html('');
            var sURL = '@Url.Action("GetFeeFinderDetail", "Customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#div_FeeFinderdetailResultData').html(data);
                    $('.date-picker').datepicker({ autoclose: true ,dateFormat: 'mm/dd/yyyy'});
                    $('.date-picker').attr("placeholder","mm/dd/yyyy");
                    $('.edit-txtbx').prop("readonly", true);
                    $("#modal_FeeFinderdetailResult").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function showBillsetting() {
            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $("#btnSave").prop("disabled", "false");
            $("#btnSave").prop("readonly", "true");
            $("#btnCancel").prop("disabled", "false");
            $("#btnCancel").prop("readonly", "true");
            $("#btnSave").hide();
            $("#btnCancel").hide();

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");
            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");
            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#modal_Billingsetting").modal({ backdrop: 'static' });


            $("#BillSetting_EffectiveDate").val('@Convert.ToDateTime(Model.BillSetting?.EffectiveDate).ToString("MM/dd/yyyy")');


        }



        @*function ShowFranchiseeCall() {
            var sURL = '@Url.Action("GetFranchiseeCall", "Customer", new { area = "Portal" })';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_FranchiseeCall').html(data);
                    $("#modal_FranchiseeCall").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }*@

        function ShowLogCall()
        {
            var sURL = '@Url.Action("GetLogCall", "Customer", new { area = "Portal" })';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_LogCall').html(data);
                    $("#modal_LogCall").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Error occured!!")
                }
            });
        }

        function btncloseFranchiseecall() {
            $("#modal_FranchiseeCall").modal('hide');
        }

        function btnlogcallClose() {
            $("#modal_LogCall").modal('hide');
        }

        function showCollectionLog(Id) {
            var sURL = '@Url.Action("CustomerCollectionLogPopup", "Customer", new { area = "Portal" })?id=' + Id; +
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_CollectionCallLogDetails').html(data);
                    $("#strCallBack").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#modal_CollectionCallLog").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function showCreditTransaction(id) {
            var sURL = getTableURL(id);

            invoiceList = $('#tblCustomerCreditsList').DataTable({
                //"bProcessing": true,
                "bServerSide": false,
                "bDestroy": true,
                "sAjaxSource": sURL,
                "bLengthChange": false, //thought this line could hide the LengthMenu
                "bInfo": false,
                "bPaginate": false,

                "dom": '<"top">rt<"bottom"lp><"clear">'
                //"dom": "<'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'<'table-group-actions pull-right'>>r><'table-responsive't><'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'>>", // datatable layout
                ,
                columnDefs: [
                    {
                        targets: "tblInvoice_invoiceNo",
                        data: "InvoiceNo",
                        render: function (data, type, row, meta) {
                            return '<a href="javascript:void(0);" onclick="btnOpenApplyCreditForm(' + row.InvoiceId + ')">' + data + '</a>';
                        }
                    },
                    {
                        targets: "tblInvoice_invoiceDate",
                        data: "InvoiceDate",
                        type: "date",
                        render: function (data, type, row, meta) {
                            return moment(new Date(parseInt(data.substr(6)))).format("MM/DD/YYYY");
                        }
                    },
                    { targets: "tblInvoice_customerNo", data: "CustomerNo" },
                    { targets: "tblInvoice_customerName", data: "CustomerName" },
                    { targets: "tblInvoice_invoiceDesc", data: "Description" },
                    {
                        targets: "tblInvoice_invoiceAmt",
                        data: "Amount",
                        sClass: "txtright",
                        render: function (data, type, row, meta) {
                            return '$' + parseFloat(data, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()
                            //return '$' + parseFloat(data).toFixed(2);
                        }
                    },
                    {
                        targets: "tblInvoice_balance",
                        data: "Balance",
                        sClass: "txtright",
                        render: function (data, type, row, meta) {
                            return '$' + parseFloat(data, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString()
                            //return '$' + parseFloat(data).toFixed(2);
                        }
                    },
                ]
            });

            $("#modal_CreditTransaction").modal('show');
        }

        var lstContractDetailServiceTypeList = [];
        var lineNo = 0;
        var flineNo = 0;

        var app = {};

        (function (app) {

            var _id;

            app.init = function (id) {
                if (id != '') {
                    _id = id;
                    $("#hdfCustomerId").val(_id);
                    bindcustomerdetail(_id);
                }
            }

        })(app);

        function bindcustomerdetail(customerid) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("CustomerDetaildata", "AccountReceivable", new { area = "Portal" })',
                data: 'customerid=' + customerid,
                success: function (data) {
                    //document.getElementById("chkTaxExcempt1").checked = false;
                    $("#spncustomerno").text($.trim(data.CustomerNo));
                    $("#spncustomername").text($.trim(data.Name));
                    $("#spncustomeraddress").text($.trim(data.Address1));
                    $("#spncustomercity").text($.trim(data.City))
                    $("#spncustomerstate").text($.trim(data.StateName));
                    $("#spncustomerpincode").text($.trim(data.PostalCode));


                    $("#spncustomerbname").text($.trim(data.BName));
                    $("#spncustomerbattname").text($.trim(data.Attention));
                    $("#spncustomeraddress1").text($.trim(data.BAddress1));
                    $("#spncustomercity1").text($.trim(data.BCity))
                    $("#spncustomerstate1").text($.trim(data.BStateName));
                    $("#spncustomerpincode1").text($.trim(data.PostalCode));

                    $("#hdfTaxRateId").val(data.TaxRateId);
                    $("#hdfContractTaxRate").val(data.ContractTaxRate);
                    $("#hdfLeaseTaxRate").val(data.LeaseTaxRate);
                    $("#hdfSupplyTaxRate").val(data.SupplyTaxRate);
                    $("#hdfcusisTaxExcempt").val((data.TaxExcempt == true?true:false));

                    //if (data.TaxExcempt == true)
                    //    document.getElementById("chkTaxExcempt1").checked = true;
                    bindcCustomerDistributionDetailFranchiseedetail(customerid);
                }
            });
        }
        function bindcCustomerDistributionDetailFranchiseedetail(customerid) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("CustomerDistributionDetailFranchiseedata", "AccountReceivable", new { area = "Portal" })',
                data: 'customerid=' + customerid,
                success: function (data) {
                    $.each(data, function () {
                        bindfranchiseedetailUpdated(this.FranchiseeId, this.FranchiseeNo, this.Name);
                    });

                }
            });
        }

        function showTransfer(id) {
            $.blockUI();
            typeaheadSourceF = [];
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetAllFranchisees", "Franchise", new { area = "Portal" })',
                success: function (data) {
                    custlist = data;

                    $.each(custlist, function (key, value) {
                        typeaheadSourceF.push({ value: value.FranchiseeId, label: value.FranchiseeNo + ' ' + $.trim(value.Name) })
                    });

                    $('#form_CustomerTransfer').html("");
                    var sURL = '@Url.Action("CustomerDetailTransferDistribution", "Customer", new { area = "Portal" })?Id=' + id;
                    $.ajax({
                        type: "GET",
                        url: sURL,
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (data) {
                            $('#form_CustomerTransfer').html(data);

                            $(".editvalue").removeClass("editvaluetext");
                            $(".editvalue").addClass("editmode");
                            $(".editvalue").attr("readonly", "readonly");
                            $(".editcheck").attr("disabled", "disabled");
                            $(".editcheck").attr("readonly", "readonly");

                            CFranchiseeDistributionData(id);
                            $(".date-picker").datepicker({ autoclose: true });
                            $('.modal-dialog').draggable();
                            $('#trans_ddlTransferEffectiveDate').datepicker("setDate", new Date());

                            $('#btncust_trans').prop('disabled', false);
                            $.unblockUI();
                        },
                        error: function (err) {
                            console.log(err);

                            $.unblockUI();
                        }
                    });

                }
                ,
                error: function () {

                    $.unblockUI();
                }
            });

        }



        function showIncreaseDescrease(Id) {

            var sURL = '@Url.Action("CustomerDetailIncrease", "Customer", new { area = "Portal" })?id=' + Id;

            $.blockUI();//$.blockUI({ message: $('#throbberBlock'), theme: true, baseZ: 12000 });

            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#modal_IncreaseDecreaseDIV').html(data);

                    //$('#CustomerIncreaseDecreaseDetail_EffectiveDate').inputmask("mm/dd/yyyy", {});
                    //$('#CustomerIncreaseDecreaseDetail_StartDate').inputmask("mm/dd/yyyy", {});
                    //$('#CustomerIncreaseDecreaseDetail_StartDate').inputmask("mm/dd/yyyy", {});
                    //$('#CustomerIncreaseDecreaseDetail_SignDate').inputmask("mm/dd/yyyy", {});
                    //$('#CustomerIncreaseDecreaseDetail_StatusDate').inputmask("mm/dd/yyyy", {});
                    //$('#CustomerIncreaseDecreaseDetail_ExpirationDate').inputmask("mm/dd/yyyy", {});
                    //$('#CustomerIncreaseDecreaseDetail_ResumeDate').inputmask("mm/dd/yyyy", {});
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });

                    IDFrmInIt();

                    $('#btncust_increase').prop('disabled', false);

                    $.unblockUI();

                    $("#modal_IncreaseDecrease").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);

                    $.unblockUI();
                }
            });
        }


        function showManualInvoice(id, callFrom) {
            $.blockUI({
                theme: true,
                baseZ: 9000
            });
            lstContractDetailServiceTypeList = [];
            lineNo = 0;
            flineNo = 0;
            var sURL = '@Url.Action("RenderCustomerDetailManualInvoicePopup", "Customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_modal_customermanualinvoice').html(data);
                    $("#hdfCFCallFrom").val(callFrom);
                    onlyDecimal("#txtCommissionAmount");
                    $("#hdftotallineno").val(lineNo);
                    $("#hdfftotallineno").val(flineNo);
                    $("#txtInvoicedate").datepicker();
                    $("#txtInvoicedate").datepicker("option", "dateFormat", "mm/dd/yy");
                    $('#txtInvoicedate').datepicker('setDate', new Date());
                    var month = parseInt('@JKApi.Core.Common.ClaimView.Instance.GetCLAIM_PeriodAccess().Where(x=>x.PeriodId== JKApi.Core.Common.ClaimView.Instance.GetCLAIM_SELECTED_PERIOD_ID()).FirstOrDefault().Month');
                    var year = parseInt('@JKApi.Core.Common.ClaimView.Instance.GetCLAIM_PeriodAccess().Where(x=>x.PeriodId== JKApi.Core.Common.ClaimView.Instance.GetCLAIM_SELECTED_PERIOD_ID()).FirstOrDefault().Year');
                    $('#txtInvoicedate').datepicker("option", {
                        minDate: new Date(year, month - 1, 1),
                        maxDate: new Date(year, month, 0)
                    });

                    $.ajax({
                        type: "GET",
                        url: '@Url.Action("CustomerDetaildata", "AccountReceivable", new { area = "Portal" })',
                        data: 'customerid=' + $("#CustomerViewModel_CustomerId").val(),
                        success: function (data) {
                            //document.getElementById("chkTaxExcempt1").checked = false;
                            $("#spncustomerno").text($.trim(data.CustomerNo));
                            $("#spncustomername").text($.trim(data.Name));
                            $("#spncustomeraddress").text($.trim(data.Address1));
                            $("#spncustomercity").text($.trim(data.City))
                            $("#spncustomerstate").text($.trim(data.StateName));
                            $("#spncustomerpincode").text($.trim(data.PostalCode));


                            $("#spncustomerbname").text($.trim(data.BName));
                            $("#spncustomerbattname").text($.trim(data.Attention));
                            $("#spncustomeraddress1").text($.trim(data.BAddress1));
                            $("#spncustomercity1").text($.trim(data.BCity))
                            $("#spncustomerstate1").text($.trim(data.BStateName));
                            $("#spncustomerpincode1").text($.trim(data.PostalCode));

                            $("#hdfTaxRateId").val(data.TaxRateId);
                            $("#hdfContractTaxRate").val(data.ContractTaxRate);
                            $("#hdfLeaseTaxRate").val(data.LeaseTaxRate);
                            $("#hdfSupplyTaxRate").val(data.SupplyTaxRate);
                            $("#hdfcusisTaxExcempt").val((data.TaxExcempt == true?true:false));

                            //if (data.TaxExcempt == true)
                            //    document.getElementById("chkTaxExcempt1").checked = true;
                            bindcCustomerDistributionDetailFranchiseedetail($("#CustomerViewModel_CustomerId").val());

                            $.ajax({
                                type: "GET",
                                url: '@Url.Action("GetServiceTypeListManualInvoice", "Customer", new { area = "Portal" })',
                                success: function (data) {
                                    lstContractDetailServiceTypeList = data;
                                    if (callFrom == "Increase") {
                                        var amtDeffAmount = (parseFloat($("#lstContractDetail_0__Amount").val()) - parseFloat($("#lstContractDetail_0__OAmount").val())).toFixed(2)
                                        $.blockUI({
                                            theme: true,
                                            baseZ: 9000
                                        });
                                        $('#txtInvoiceDescription').val('Customer Increase $ ' + amtDeffAmount + ' Effective Date: ' + $('#CustomerIncreaseDecreaseDetail_EffectiveDate').val())
                                        $.ajax({
                                            url: '@Url.Action("GetCustomerIncreaseInvoice", "Customer",new { area = "Portal" })?customerid=' + id + '&effectivedate=' + $('#CustomerIncreaseDecreaseDetail_EffectiveDate').val() + '&applyamount=' + amtDeffAmount,
                                            success: function (res) {
                                                console.log(res)
                                                if (res.length > 0) {
                                                    $.each(res, function (index, value) {
                                                        addNewEntry(function () {
                                                            //console.log('T-' + $("#hdfcusisTaxExcempt").val())
                                                            document.getElementById("chkTaxExcempt" + lineNo).checked = ($("#hdfcusisTaxExcempt").val() == 'true' ? true : false);
                                                            $('#ContractDetailServiceTypeList' + lineNo).val(value.ServiceListId)
                                                            $('#txtdescription' + lineNo).val(value.ItemDescription)
                                                            $('#hdfunitprice' + lineNo).val(value.ItemAmount.toFixed(2));
                                                            CalculateAmount(lineNo);
                                                            $('#ddldetaillinenumber1').val(-1);
                                                            $('#ddldetaillinenumber1').trigger("change");
                                                        });
                                                    });
                                                } else {
                                                    addNewEntry();
                                                }


                                            },
                                            error: function () { }
                                        });

                                        $("#btnCManualInvoiceSaveClose").hide();
                                        $("#btnCManualInvoiceSaveCloseIncrease").show();
                                        $("#form_manualinvoice_submitForm").submit(function (event) {
                                            $('#btnCManualInvoiceSaveCloseIncrease').prop("disabled", true);
                                            $.blockUI({
                                                theme: true,
                                                baseZ: 9000
                                            });
                                            var dataString;
                                            event.preventDefault();
                                            event.stopImmediatePropagation();
                                            var action = '/Portal/Customer/ManualInvoiceIncrease'; //$("#form_manualinvoice_submitForm").attr("action");
                                            // Setting.
                                            dataString = new FormData($("#form_manualinvoice_submitForm").get(0));
                                            contentType = false;
                                            processData = false;
                                            $.ajax({
                                                type: "POST",
                                                url: action,
                                                data: dataString,
                                                dataType: "json",
                                                contentType: contentType,
                                                processData: processData,
                                                success: function (result) {
                                                    $.blockUI({
                                                        theme: true,
                                                        baseZ: 9000
                                                    });
                                                    $('#frm_CustomerDetailIncrease').submit();
                                                },
                                                error: function (jqXHR, textStatus, errorThrown) {
                                                    //do your own thing
                                                    alert("fail");
                                                    $.unblockUI();
                                                }
                                            });
                                        }); //end .submit()

                                        $("#btnCManualInvoiceSaveCloseIncrease").click(function (e) {
                                            $('#form_manualinvoice_submitForm').submit();
                                            event.preventDefault();
                                        });
                                    }
                                    else {

                                        $('select [relddldetaillinenum=ddldetaillinenumber]').each(function (item) {
                                            console.log(this);

                                        });


                                        //$("#form_manualinvoice_submitForm").submit(function (event) {
                                        //    $.blockUI();
                                        //    var dataString;
                                        //    event.preventDefault();
                                        //    event.stopImmediatePropagation();
                                        //    var action = '/Portal/Customer/ManualInvoice'; //$("#form_manualinvoice_submitForm").attr("action");
                                        //    // Setting.
                                        //    dataString = new FormData($("#form_manualinvoice_submitForm").get(0));
                                        //    contentType = false;
                                        //    processData = false;
                                        //    $.ajax({
                                        //        type: "POST",
                                        //        url: action,
                                        //        data: dataString,
                                        //        dataType: "json",
                                        //        contentType: contentType,
                                        //        processData: processData,
                                        //        success: function (result) {
                                        //            $.blockUI();
                                        //            $('#form_modal_customermanualinvoice').html('');
                                        //            $("#modal_CustomerManualInvoice").modal('hide');
                                        //        },
                                        //        error: function (jqXHR, textStatus, errorThrown) {
                                        //            //do your own thing
                                        //            alert("fail");
                                        //            $.unblockUI();
                                        //        }
                                        //    });
                                        //}); //end .submit()

                                        $("#btnCManualInvoiceSaveClose").click(function (e) {
                                            $('#form_manualinvoice_submitForm').submit();
                                            event.preventDefault();
                                        });

                                        addNewEntry();
                                    }

                                    $.unblockUI();
                                }
                            });
                        }
                    });


                    //bindcustomerdetail($("#CustomerViewModel_CustomerId").val());

                    $.unblockUI();
                    $("#modal_CustomerManualInvoice").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);

                    $.unblockUI();
                }
            });
            //$.unblockUI();
        }

        //function showManualPayment_CalculateAmountAppyly(res,ln) {

        //    if (res.length > 0) {
        //        var iT = 1;
        //        $.each(res, function (index, value) {

        //                $('#ContractDetailServiceTypeList' + iT).val(value.ServiceListId)
        //                $('#txtdescription' + iT).val(value.ItemDescription)
        //            $('#hdfunitprice' + iT).val(value.ItemAmount.toFixed(2));
        //                CalculateAmount(iT);
        //                $('#ddldetaillinenumber' + iT).val(-1);
        //                $('#ddldetaillinenumber' + iT).trigger("change");
        //            iT++;
        //        });
        //    }
        //    //for (var iT = 1; iT <= totalLine; iT++) {
        //    //    CalculateAmount(iT)
        //    //    $('#ddldetaillinenumber' + iT).val(-1);
        //    //    $('#ddldetaillinenumber' + iT).trigger("change");
        //    //}
        //}


        /*Manual Payment */
        function showManualPayment(id) {

            var currenturl = '@Url.Action("ManualPaymentPopup", "Customer",new { area="Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: currenturl,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#divmodal_ManualPayment').html(data);
                    manualPaymentInIt(id);
                    $('#modal_ManualPayment').modal('show');
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        var ManualPaymentList;

        function getManualPaymentTableURL(id) {

            var _fromDateVal = $('#dtpfromMP').val();
            var _toDateVal = $('#dtptoMP').val();
            var _searchtextVal = "";
            var _incClosed = "false";
            var _open = $('#chkOpenMP').prop("checked");
            var _closed = $('#chkCloseMP').prop("checked");

            var sURL = '@Url.Action("InvoicesSearchForPaymentResultData", "Customer", new { area = "Portal" })?customerId=' + id

            return sURL;
        }

        function btnOpenApplyPaymentForm(id) {
            openApplyPaymentForm(id);
        }



        function btnOpenApplyCreditForm(id) {

            var sURL = '@Url.Action("ApplyCreditForm", "AccountReceivable", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_applycreditformDiv').html(data);
                    $(".date-picker").datepicker();
                    $("#creditDate").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#modal_applycreditform").modal({ backdrop: 'static' });
                    initCreditForm();
                    $('.creditfieldcurrency').each(function () {
                        applyMaskCurrency('#' + this.id);
                    });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        //For Manual PopUp Open with Apply credit checkbok
        $("#chkApplyCredit").change(function () {
            var val = this.checked ? this.value : '';
            if (val == "on")
            {
                $(".manualpayment").click();
                setTimeout(function () {
                    $("#chkApplyCreditMP").prop("checked", true);
                    $("#chkApplyCreditMP").trigger("change");
                }, 2000);
            }
            else { $(".manualpayment").click();}



        });
        function openApplyCreditFormForCancellation(info,MaintenancetempId) {

            var id = info.InvoiceId;
            var lastServiceDate = $('#LastServiceDate').val();
            var sURL = '@Url.Action("ApplyCreditFormForCancellation", "AccountReceivable", new { area = "Portal" })?Id=' + id + '&lastServiceDate=' + lastServiceDate;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_applycreditformDiv').html(data);
                    $(".date-picker").datepicker();
                    $("#creditDate").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    initCreditForm();
                    $('.creditfieldcurrency').each(function () {
                        applyMaskCurrency('#' + this.id);
                    });

                    //workingdays calculation

                    var sURL1 = '@Url.Action("ApplyCreditFormForCancellationWorkingDays", "AccountReceivable", new { area = "Portal" })?Id=' + id + '&lastServiceDate=' + lastServiceDate;
                    $.ajax({
                        type: "GET",
                        url: sURL1,
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (data1) {

                            var defDays = data1.workingDays;
                            var workDays = data1.monthDays;

                            //var crAmt = (removeFormatting($("#invAmt").val()) / workDays) * defDays;
                            var crAmt = parseFloat(((removeFormatting($("#invAmt").val()) / workDays) * defDays).toFixed(2));

                            setCreditAmt(crAmt);
                            $("#creditDate").val($("#StatusDate").val())


                            //$('#form_applycreditform').html(data);
                            //$(".date-picker").datepicker();
                            //$("#creditDate").datepicker();
                            //$(".input-group-btn").click(function () {
                            //    $(this).prev().trigger("focus");
                            //    $(this).prev().trigger("focus");
                            //});
                            //initCreditForm();
                            //$('.creditfieldcurrency').each(function () {
                            //    applyMaskCurrency('#' + this.id);
                            //});
                            //setCreditAmt(removeFormatting($("#invAmt").val()) * info.CreditPercent);
                            //$("#select_ReasonList").val("1");

                            //$('#isForCancellationMaintenancetempId').val(MaintenancetempId);
                            //$("#modal_applycreditform").modal({ backdrop: 'static' });
                        },
                        error: function (err) {
                            console.log(err);
                        }
                    });


                    //end workingdays



                    //setCreditAmt(removeFormatting($("#invAmt").val()) * info.CreditPercent);
                    $("#select_ReasonList").val("1");

                    $('#isForCancellationMaintenancetempId').val(MaintenancetempId);
                    $("#modal_applycreditform").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function formatCurrency(total, dollar) {
            dollar = (dollar == true ? true : false);
            var neg = false;
            if (total < 0) {
                neg = true;
                total = Math.abs(total);
            }
            return (neg ? "-" : '') + (dollar ? "$" : "") + parseFloat(total, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString();
        }


        function removeFormatting(i) {
            return typeof i === 'string' ?
                i.replace(/[\$,]/g, '') * 1 :
                typeof i === 'number' ?
                i : 0;
        }


        function showFranchiseesForLineNumber(lineNo) {
            $(".franchisee-row").hide();
            $(".franchisee-row-line" + lineNo).show();
        }

        function toggleCreditUnitColumns(creditUnit) {
            var creditUnit = $("input[type=radio][name=rdCreditUnit]:checked").val();
            $(".franchisee-amt-col").hide();
            $(".franchisee-pct-col").hide();
            $(".franchisee-" + creditUnit + "-col").show();
        }


        function getstatus(id) {
            var sURL = '@Url.Action("GetStatus", "Customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    return data.response;
                },

            })
        }

        function OpenCustomerContractPopup(Id) {

            var sURL = '@Url.Action("RenderCustomerContractDetails", "Customer", new { area = "Portal" })?id=' + Id +"&callfrom=1"; //disable edit info
            //var sURL = '@Url.Action("RenderCustomerContractDetails", "Customer", new { area = "Portal" })?id=' + Id +"&callfrom=0";  //enable edit info
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerContractDetails').html(data);
                    //$('#Contract_StartDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_StartDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_SignDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_StatusDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_ExpirationDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_ResumeDate').inputmask("mm/dd/yyyy", {});
                    $(".date-picker").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#modal_CustomerContractPopup").modal({ backdrop: 'static' });

                    $("#btnContractSave").hide();
                    $("#btnContractCancel").hide();
                    $("#btnEditContract").show();
                    $("#btnSubmit").hide();
                    $(".subsectionBtn").hide();
                    $(".clsContractview").attr("disabled", "disabled");
                },
                error: function (err) {
                    console.log(err);
                }
            });

            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }
        var editFranchiseeDistribution = function () {

            $(".editvalue").addClass("editvaluetext");
            $(".editvalue").removeClass("editmode");
            //$("#btnSaveDistribution").show();
            //$("#btnEditDistribution").hide();
            $(".editvalue").removeAttr("disabled").removeAttr("readonly");
            $(".editcheck").removeAttr("disabled").removeAttr("readonly");
        };

        function FranchiseeDistribution(id) {
            var sURL = '@Url.Action("CustomerDetailFranchiseeDistribution", "Customer", new { area = "Portal" })?Id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_FranchiseeDistribution').html(data);

                    $(".editvalue").removeClass("editvaluetext");
                    $(".editvalue").addClass("editmode");
                    $(".editvalue").attr("readonly", "readonly");
                    //$("#btnSaveDistribution").hide();
                    //$("#btnEditDistribution").show();
                    $(".editcheck").attr("disabled", "disabled");
                    $(".editcheck").attr("readonly", "readonly");

                    FranchiseeDistributionData(id);
                    bindcustomerDetailDisLoad(id);
                    $('.modal-dialog').draggable();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        // Franchisee Customer Distribution new code
        function BindFranchiseeCustomerDistribution(cid, fid) {

            $("#ModalFranchiseDistribution_CustomerPopup").modal("hide");

            //var sURL = '@Url.Action("RenderFranchiseCustomerDistributionPopup", "Customer", new { area = "Portal" })?cid=' + cid + '&fid=' + fid + '&callfrom=' + $('#hdfCustomerDetailCallFrom').val();
            var sURL = '@Url.Action("RenderFranchiseCustomerOnlyDistributionPopup", "Customer", new { area = "Portal" })?cid=' + cid + '&fid=' + fid + '&callfrom=CD';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    $('#form_FranchiseCustomersDistributionPopup').html(data);
                    $("#CustomerDetail_EffectiveDate").datepicker("setDate", new Date());
                    //$("#modal_CIDFranchiseeDistribution").modal({ backdrop: 'static' });
                    //$("#FD_modal_FranchiseeDistribution").modal({ backdrop: 'static' });

                    $("#btnFDSaveDistribution").hide();
                    //$("#btnTransDistributionFeeSave").hide();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function ShowCustomerSuggetionBox() {

            $('#fcsearch-box').val('');
            $('#hdfsearch_franchiseeid').val('');
            var box = $('#fcsearch-box').data('typeahead');
            if (box != null) {
                box.source = c_typeaheadSource;
            }
            else {
                $('#fcsearch-box').typeahead({
                    source: c_typeaheadSource,
                    updater: function (item) {
                        $('#hdfsearch_franchiseeid').val(item.id);
                        BindFranchiseeCustomerDistribution('@(Model.CustomerDetail != null? ViewBag.CustId : "0")',$('#hdfsearch_franchiseeid').val());
                        return item;
                    },
                    minLength: 1
                }).focus();
            }

            $("#ModalFranchiseDistribution_CustomerPopup").modal({ backdrop: 'static' });
        }



        function bindcustomerDetailDisLoad(customerid) {

        }

        function viewDistributionFee() {
            $("#modal_Distribution").modal({ backdrop: 'static' });
        }
        function Franchiseeservice(mo, tu, we, th, fr, sa, su) {


            $("#chkScheduleMonday").prop('checked', false);
            $("#chkScheduleTuesday").prop('checked', false);
            $("#chkScheduleWednesday").prop('checked', false);
            $("#chkScheduleThursday").prop('checked', false);
            $("#chkScheduleFriday").prop('checked', false);
            $("#chkScheduleSaturday").prop('checked', false);
            $("#chkScheduleSunday").prop('checked', false);


            if (mo == 1)
                $("#chkScheduleMonday").prop('checked', true);
            if (tu == 1)
                $("#chkScheduleTuesday").prop('checked', true);
            if (we == 1)
                $("#chkScheduleWednesday").prop('checked', true);
            if (th == 1)
                $("#chkScheduleThursday").prop('checked', true);
            if (fr == 1)
                $("#chkScheduleFriday").prop('checked', true);
            if (sa == 1)
                $("#chkScheduleSaturday").prop('checked', true);
            if (su == 1)
                $("#chkScheduleSunday").prop('checked', true);




            $("#modal_service").modal({ backdrop: 'static' });
        }
        //function FranchiseeserviceDestribution() {
        //    $("#modal_Distribution").modal({ backdrop: 'static' });
        //}
        var FeeDataForDistribution = [];
        function FranchiseeserviceAddDestribution() {

            $.ajax({
                url: '@Url.Action("GetFeeData", "Customer","Portal")',
                success: function (res) {
                    console.log(res);
                    FeeDataForDistribution = res;
                    var tempRow = "";
                    $('#feeListAdd tbody').html('');
                    $.each(res, function (index, value) {
                        tempRow = "";
                        tempRow += '<tr>';
                        tempRow += '    <td><input type="checkbox" rel="feeid_distribution" value="' + value.FeeId + '" /></td>';
                        tempRow += '    <td>' + value.FeeName + '</td>';
                        tempRow += '    <td>' + value.FeeRateTypeName + '</td>';
                        tempRow += '    <td style="text-align: right;">' + (value.FeeRateTypeListId == 1 ? (value.Amount + '%') : ('$ ' + value.Amount)) + '</td>';
                        tempRow += '</tr>';
                        $('#feeListAdd tbody').append(tempRow);
                    });

                    $("#modal_AddDistribution").modal({ backdrop: 'static' });
                },
                error: function () { }
            });
        }



        function Editfunction() {
            $(".edit").removeAttr("disabled").removeAttr("readonly");
            $("#btnSave").removeAttr("disabled");
            $("#btnCancel").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBSetting").hide();
            $("#btnSave").show();
            $("#btnCancel").show();


            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

        }

        function EditContactfunction1() {
            $(".editmain1").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave1").removeAttr("disabled");
            $("#btnContactCancel1").removeAttr("disabled");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact1").hide();
            $("#btnContactSave1").show();
            $("#btnContactCancel1").show();


            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function EditContactfunction() {

            $(".editmain").removeAttr("disabled").removeAttr("readonly");
            $("#btnContactSave").removeAttr("disabled");
            $("#btnContactCancel").removeAttr("disabled");
            //$(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditContact").hide();
            $("#btnContactSave").show();
            $("#btnContactCancel").show();

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");
        }

        function EditBContactfunction1() {
            $(".editbill1").removeAttr("disabled").removeAttr("readonly");
            $("#btnBContactSave1").removeAttr("disabled");
            $("#btnBContactCancel1").removeAttr("disabled");
            //$(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBContact1").hide();
            $("#btnBContactSave1").show();
            $("#btnBContactCancel1").show();


            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");
        }
        function EditBContactfunction() {
            $(".editbill").removeAttr("disabled").removeAttr("readonly");
            $("#btnBContactSave").removeAttr("disabled");
            $("#btnBContactCancel").removeAttr("disabled");
            // $(".edit").removeAttr("disabled").removeAttr("readonly");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

            $("#EditBContact").hide();
            $("#btnBContactSave").show();
            $("#btnBContactCancel").show();


            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");

            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");
        }


        function _bindTransactionsForCustomerTransaction(typeid, sdate, edate) {

            //$('.datatableClass').show();
            //$('#customerTransList').show();
            var customerId = $('#CustomerID').val();
            if (customerId) {
                $('#totalAmount').text('');
                $('#totalTax').text('');
                $('#totalDebit').text('');
                $('#totalCredit').text('');
                $('#totalBalance').text('');

                var elem = $('#customerTransList tbody');
                var masterTrxTypeId = $("#CustomerTransactionType").val();
                var spnStartDate = $("#spnStartDate").text();
                var spnEndDate = $("#spnEndtDate").text();
                var _monthVal = $('#monthlist').val();
                var _yearVal = $('#yearlist').val();
                $.ajax({
                    url: '@Url.Action("GetAllCustomerTransactions", "Customer", new { area = "Portal" })?CustomerId='+customerId+'&TypeId=' + typeid + '&StartDate=' + sdate + '&EndDate=' + edate + '&month=' + _monthVal + '&year=' + _yearVal,
                    success: function (res) {

                        var tempRow = "";
                        $(elem).html('');
                        //var vBalamt = -parseFloat(res.StartingBalance);
                        var vBalamt = 0; // temporary until balance is fixed

                        var showAllTransactions = parseInt(masterTrxTypeId) == 0;

                        /*tempRow += '<tr>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">' + spnStartDate + '</td>'
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">Previous Balance (as of ' + spnStartDate + ')</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;border-right: 2px solid blue;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;border-right: 2px solid blue;">&nbsp;</td>';
                        tempRow += '<td style="float: right;font-size: 12px;">' + formatCurrency(vBalamt, true) + '</td>';
                        tempRow += '<td style="text-align: center;font-size: 12px;">&nbsp;</td>';
                        tempRow += '</tr>';
                        $(elem).append(tempRow);*/

                        var totalCredit = 0.0;
                        var totaldebit = 0.0;
                        var totalAmount = 0.0;
                        var totalTax = 0.0;
                        var totalBalance = parseFloat(vBalamt);

                        $.each(res.Transactions, function (index, value) {

                            tempRow = "";

                            totalBalance=totalBalance+parseFloat(value.CreditAmount)-parseFloat(value.DebitAmount);
                            totalAmount=totalAmount+parseFloat(value.Amount);
                            totalTax=totalTax+parseFloat(value.TotalTax);
                            totaldebit=totaldebit+parseFloat(value.DebitAmount);
                            totalCredit=totalCredit+parseFloat(value.CreditAmount);

                            // wrap calculation in parseFloat(x.toFixed(2)) to eliminate float precision error

                            var Number = (value.Number != null ? (value.TransactionTypeId == 1 || value.TransactionTypeId == 3 ? value.Number : value.TransactionNumber) : value.TransactionNumber);

                            tempRow += '<tr>';
                            tempRow += '<td colspan="2" style="text-align: center;font-size: 12px;">' + value.TransactionTypeName + '</td>';
                            tempRow += '<td style="text-align: center;font-size: 12px;">' + formatJSONDateUtc(value.TransactionDate)  + '</td>'
                            if (value.TransactionTypeId == 2)
                            {
                                tempRow += '<td style="text-align: center;font-size: 12px;"><a onclick="OpenPaymentDetail(' + value.RefId + ')">' + Number + '</a></td>';
                            }

                            else if (value.TransactionTypeId == 3)
                            {
                                tempRow += '<td style="text-align: center;font-size: 12px;"><a onclick="OpenCustomerCreditDetail(' + value.RefId + ')">' + Number + '</a></td>';
                            }
                            else if (value.TransactionTypeId == 1 || value.TransactionTypeId == 5)
                            {
                                tempRow += '<td style="text-align: center;font-size: 12px;"><a onclick="showInvoiceDetail(' + value.RefId + ')">' + Number + '</a></td>';
                            }
                            else
                            {
                                tempRow += '<td style="text-align: center;font-size: 12px;">' + Number + '</td>';
                            }
                            tempRow += '<td style="text-align: left;font-size: 12px;">' + value.Description + '</td>';

                            tempRow += '<td style="text-align: right;font-size: 12px;">' + formatCurrency(value.Amount, true) + '</td>';
                            tempRow += '<td style="text-align: right;font-size: 12px; border-right: 2px solid blue;">' + formatCurrency(value.TotalTax, true) + '</td>';

                            tempRow += '<td style="text-align: right;font-size: 12px; border-left: 2px solid blue;">' +  formatCurrency(value.DebitAmount, true)  + '</td>';
                            tempRow += '<td style="text-align: right;font-size: 12px; border-right: 2px solid blue;">' + formatCurrency(value.CreditAmount, true) + '</td>';
                            //tempRow += '<td style="text-align: right;font-size: 12px; border-left: 2px solid blue;">' + formatCurrency(totalBalance, true) + '</td>';

                            tempRow += '<td style="text-align: center;font-size: 12px;">' + value.StatusName + '</td>';
                            tempRow += '</tr>';

                            $(elem).append(tempRow);
                        });

                        $('#totalAmount').text(formatCurrency(totalAmount,true));
                        $('#totalTax').text(formatCurrency(totalTax,true));
                        $('#totalDebit').text(formatCurrency(totaldebit,true));
                        $('#totalCredit').text(formatCurrency(totalCredit,true));
                        $('#totalBalance').text(formatCurrency(totalBalance,true));

                    },
                    error: function () { }
                });
            }
        }

        function formatJSONDateUtc(jsonDate) {
            if (jsonDate != null) {
                var dtstr = jsonDate.substr(6);
                var dateString = dtstr.substring(0, dtstr.length - 2);
                var currentTime = new Date(parseInt(dateString));
                var date = moment.utc(currentTime).format("MM/DD/YYYY");
                return date;
            }
            return null;
        }


        $('#select_transactionstype').change(function () {
            _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());
        });

        var firstDay;
        var lastDay;


        $('#txtStartDate').change(function () {
            $('#spnStartDate').html($(this).val());
            if( $('#txtStartDate').val()!='' &&  $('#txtEndtDate').val()!='' && @ViewBag.CustomerID > 0)
                _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());
        });
        $('#txtEndtDate').change(function () {
            $('#spnEndtDate').html($(this).val());
            if( $('#txtStartDate').val()!='' &&  $('#txtEndtDate').val()!='' && @ViewBag.CustomerID > 0)
                _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());
        });

        $('#monthlist').change(function () {
            $('#spnStartDate').html('');
            if ($('#monthlist').val() != '' && $('#yearlist').val() != '')
                _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());
        });
        $('#yearlist').change(function () {
            $('#spnEndtDate').html('');
            if ($('#monthlist').val() != '' && $('#yearlist').val() != '')
                _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), $('#spnStartDate').text(), $('#spnEndtDate').text());
        });

        $('#select_timeduration').change(function () {
            $('#spnStartDate').html('');
            $('#spnEndtDate').html('');
            $('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();
            $('#divmonth').hide();
            $('#divyear').hide();
            $('#monthlist').val('');
            $('#yearlist').val('');
            switch (parseInt($(this).val())) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().toString();
                    lastDay = moment().toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 14:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 15:
                    //code block
                    $('#divspandate').hide();
                    $('#divSD').show();
                    $('#divED').show();
                    $('#txtStartDate').val('');
                    $('#txtEndtDate').val('')
                    break;
                case 16:
                    //code block
                    $('#divspandate').hide();
                    $('#divSD').hide();
                    $('#divED').hide();
                    $('#divmonth').show();
                    $('#divyear').show();
                    break;
                default:
                    //code block
            }
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));
            //alert(firstDay)
            //alert(lastDay)
            if(parseInt($(this).val())!=15 && parseInt($(this).val())!=16)
                _bindTransactionsForCustomerTransaction($('#select_transactionstype').val(), moment(firstDay).format('L'), moment(lastDay).format('L'));
        });

        $('#txtStartDateStatements').change(function () {
            $('#spnStartDateStatements').html($(this).val());
        });
        $('#txtEndtDateStatements').change(function () {
            $('#spnEndtDateStatements').html($(this).val());
        });

        $('#select_timedurationStatements').change(function () {
            $('#spnStartDateStatements').html('');
            $('#spnEndtDateStatements').html('');
            $('#divspandateStatements').show();
            $('#divSDStatements').hide();
            $('#divEDStatements').hide();
            switch (parseInt($(this).val())) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    //code block
                    $('#divspandateStatements').hide();
                    $('#divSDStatements').show();
                    $('#divEDStatements').show();
                    break;
                default:
                    //code block
            }
            $('#spnStartDateStatements').html(moment(firstDay).format('L'));
            $('#spnEndtDateStatements').html(moment(lastDay).format('L'));

            _bindTransactions($('#tbl_statementTransactions tbody'), 0, $('#spnStartDateStatements').text(), $('#spnEndtDateStatements').text(), true);
        });

        function settimeduration_select(id) {
            $('#select_timeduration').val(id)
            $('#spnStartDate').html('');
            $('#spnEndtDate').html('');
            $('#divspandate').show();
            $('#divSD').hide();
            $('#divED').hide();
            $('#divmonth').hide();
            $('#divyear').hide();
            $('#monthlist').val('');
            $('#yearlist').val('');
            switch (parseInt(id)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().toString();
                    lastDay = moment().toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 14:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 15:
                    //code block
                    $('#divspandate').hide();
                    $('#divSD').show();
                    $('#divED').show();
                    $('#txtStartDate').val('');
                    $('#txtEndtDate').val('')
                    break;
                default:
                    //code block
            }
            $('#spnStartDate').html(moment(firstDay).format('L'));
            $('#spnEndtDate').html(moment(lastDay).format('L'));
        }

        function settimedurationStatements_select(id) {
            $('#select_timedurationStatements').val(id)
            $('#spnStartDateStatements').html('');
            $('#spnEndtDateStatements').html('');
            $('#divspandateStatements').show();
            $('#divSDStatements').hide();
            $('#divEDStatements').hide();
            switch (parseInt(id)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    //code block
                    $('#divspandateStatements').hide();
                    $('#divSDStatements').show();
                    $('#divEDStatements').show();
                    break;
                default:
                    //code block
            }
            $('#spnStartDateStatements').html(moment(firstDay).format('L'));
            $('#spnEndtDateStatements').html(moment(lastDay).format('L'));
        }
        $('#select_timedurationAccountOffering').change(function () {
            //alert($(this).val());
            $("#sDateAccountOffering").prop("disabled", true);
            $("#eDateAccountOffering").prop("disabled", true);
            switch (parseInt($(this).val())) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    //code block
                    $("#sDateAccountOffering").prop("disabled", false);
                    $("#eDateAccountOffering").prop("disabled", false);

                    break;
                default:
                    //code block
            }
            $('#sDateAccountOffering').val(moment(firstDay).format('L'));
            $('#eDateAccountOffering').val(moment(lastDay).format('L'));
        });

        function deleteFrenchisee(linenumber, flineNo) {
            $("tr[id=row_" + flineNo + "]").remove();
        }

        function bindfranchiseedetail(linenumber, franchiseeid, franchiseename) {
            flineNo++;


            //var txtmarkup = parseFloat($('#txtmarkup' + linenumber).val() == '' ? 0 : $('#txtmarkup' + linenumber).val())
            var txtqty = parseFloat($('#txtqty' + linenumber).val() == '' ? 0 : $('#txtqty' + linenumber).val())
            var txtunitprice = parseFloat($('#txtunitprice' + linenumber).inputmask('unmaskedvalue') == '' ? 0 : $('#txtunitprice' + linenumber).inputmask('unmaskedvalue'))
            var txttotal = (txtqty * txtunitprice)

            var lineTotalAmount = 0;
            $('input[relLinea="' + linenumber + '"]').each(function (el) {
                lineTotalAmount += parseFloat(this.defaultValue);
            });

            if (lineTotalAmount + txttotal > txttotal) {
                if (lineTotalAmount < txttotal) {
                    txttotal = txttotal - lineTotalAmount;
                }
                else {
                    txttotal = 0;
                }
            }



            //var tempRow = '<tr id=row_' + flineNo + '><td><input type="hidden" relLine="' + linenumber + '" id="hdfFrenchiseeId' + flineNo + '_' + linenumber + '" name="hdfFrenchiseeId' + flineNo + '_' + linenumber + '" value="' + franchiseeid + '" /><input type="text" readonly id="frlinenumber' + flineNo + '_' + linenumber + '" name="frlinenumber' + flineNo + '_' + linenumber + '" value="' + linenumber + '" class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            //tempRow = tempRow + '<td><input type="text" required relLine="' + linenumber + '" readonly id="frfranchiseeno' + flineNo + '_' + linenumber + '" name="frfranchiseeno' + flineNo + '_' + linenumber + '" value="' + $.trim(franchiseename.split('   ')[0]) + '" class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            //tempRow = tempRow + '<td><input type="text" required relLine="' + linenumber + '" readonly id="frfranchiseename' + flineNo + '_' + linenumber + '" name="frfranchiseename' + flineNo + '_' + linenumber + '" value="' + $.trim(franchiseename.split('   ')[1]) + '" class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            //tempRow = tempRow + '<td><input type="text" required relLine="' + linenumber + '"  relLinea="' + linenumber + '" id="frfranchiseeamount' + flineNo + '_' + linenumber + '" name="frfranchiseeamount' + flineNo + '_' + linenumber + '" value="' + txttotal + '" class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>';
            //tempRow = tempRow + '<td><a style="font-size: 16px;padding: 3px;color: mediumvioletred;" href="javascript:deleteFrenchisee(' + linenumber + ',' + flineNo + ');"><i class="fa fa-trash" aria-hidden="true"></i></a></td></tr>';
            console.log(franchiseename);
            var tempRow = '<tr id=row_' + flineNo + '><td>'
            tempRow = tempRow + '<input relLine="' + flineNo + '" type="hidden" id="hdfFrenchiseeId' + flineNo + '" name="hdfFrenchiseeId' + flineNo + '" value="' + franchiseeid + '" />'
            tempRow = tempRow + '<select relLine="' + flineNo + '"  relddldetaillinenum="ddldetaillinenumber" class="form-control input-sm ddldetaillinenumber" style="border-radius: 0px;" id="ddldetaillinenumber' + flineNo + '" name="ddldetaillinenumber' + flineNo + '"></select>';
            tempRow = tempRow + '</td>'
            tempRow = tempRow + '<td><input type="text" required relLine="' + flineNo + '" id="frfranchiseeno' + flineNo + '" name="frfranchiseeno' + flineNo + '" value="' + $.trim(franchiseename.split('   ')[0]) + '" readonly class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            tempRow = tempRow + '<td><input type="text" required relLine="' + flineNo + '" id="frfranchiseename' + flineNo + '" name="frfranchiseename' + flineNo + '" value="' + $.trim(franchiseename.split('   ')[1]) + '" readonly class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            tempRow = tempRow + '<td><input type="text" relLine="' + flineNo + '" id="frfranchiseeamount' + flineNo + '" name="frfranchiseeamount' + flineNo + '" value="' + txttotal + '" class="form-control input-sm cnumeric requiredValidation frfranchiseeamount" style="padding: 5px;border-radius: 0px;" /></td>';
            tempRow = tempRow + '<td><a style="font-size: 16px;padding: 3px;color: mediumvioletred;" href="javascript:deleteFrenchisee(' + flineNo + ');"><i class="fa fa-trash" aria-hidden="true"></i></a></td></tr>';


            $('#frdestributionTable tbody').append(tempRow);
            applyMaskCurrency('#frfranchiseeamount' + flineNo + '_' + linenumber);
            $("#hdfftotallineno").val(flineNo);


            setTimeout(function () {
                $("#hdfFrenchiseeId").val(0);
                //document.getElementById('ddldetaillinenumber').selectedIndex = 0;
                $('#fsearch-box').val('');
            }, 500);

        }
        $('#fsearch-box').keypress(function (event) {
            //var keycode = (event.keyCode ? event.keyCode : event.which);
            //if (keycode == '13') {
            //    $(this).typeahead('val', '');
            //    $("#ddldetaillinenumber").val('')
            //}
            $.ajax({
                type: "GET",
                url: '@Url.Action("Frenchiseedata", "AccountReceivable", new { area = "Portal" })',
                data: 'keyword=' + $(this).val(),
                success: function (data) {
                    custlist = data;
                    var typeaheadSource = [];
                    $.each(custlist, function (key, value) {
                        typeaheadSource.push({ id: value.FranchiseeId, name: value.FranchiseeNo + '   ' + $.trim(value.Name) })
                    });

                    $('#fsearch-box').typeahead({
                        source: typeaheadSource,
                        updater: function (item) {
                            $("#hdfFrenchiseeId").val(item.id);
                            console.log(item.name);
                            bindfranchiseedetailUpdated(item.id, $.trim(item.name.split('   ')[0]), $.trim(item.name.split('   ')[1]));

                            return item;
                        }
                    });
                }
            });
        });
        function bindfranchiseedetailUpdated(franchiseeid, franchiseeno, franchiseename) {

            flineNo++;



            var linenumber = 0;
            var txttotal = ''
            var lineTotalAmount = 0;

            var tempRow = '<tr id=row_' + flineNo + '><td>'
            tempRow = tempRow + '<input relLine="' + flineNo + '" type="hidden" id="hdfFrenchiseeId' + flineNo + '" name="hdfFrenchiseeId' + flineNo + '" value="' + franchiseeid + '" />'
            tempRow = tempRow + '<select relLine="' + flineNo + '"  relddldetaillinenum="ddldetaillinenumber" class="form-control input-sm ddldetaillinenumber" style="border-radius: 0px;" id="ddldetaillinenumber' + flineNo + '" name="ddldetaillinenumber' + flineNo + '"></select>';
            tempRow = tempRow + '</td>'
            tempRow = tempRow + '<td><input type="text" required relLine="' + flineNo + '" id="frfranchiseeno' + flineNo + '" name="frfranchiseeno' + flineNo + '" value="' + $.trim(franchiseeno) + '" readonly class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            tempRow = tempRow + '<td><input type="text" required relLine="' + flineNo + '" id="frfranchiseename' + flineNo + '" name="frfranchiseename' + flineNo + '" value="' + $.trim(franchiseename) + '" readonly class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            tempRow = tempRow + '<td><input type="text" relLine="' + flineNo + '" id="frfranchiseeamount' + flineNo + '" name="frfranchiseeamount' + flineNo + '" value="' + txttotal + '" class="form-control input-sm cnumeric requiredValidation frfranchiseeamount" style="padding: 5px;border-radius: 0px;" /></td>';
            tempRow = tempRow + '<td><a style="font-size: 16px;padding: 3px;color: mediumvioletred;" href="javascript:deleteFrenchisee(' + flineNo + ');"><i class="fa fa-trash" aria-hidden="true"></i></a></td></tr>';


            $('#frdestributionTable tbody').append(tempRow);
            applyMaskCurrency('#frfranchiseeamount' + flineNo);
            $("#hdfftotallineno").val(flineNo);

            var lineitems = []; lineitems.push("<option value=''>Select</option>");
            for (var i = 1; i <= lineNo; i++) { lineitems.push("<option value=" + i + ">" + i + "</option>"); }
            if (flineNo == 1) {
                lineitems.push("<option value='-1'>All</option>");
            }else if (flineNo > 1 && $('#ddldetaillinenumber1').val() == '-1') {

                $('#ddldetaillinenumber' + 1).html('');
                $('#ddldetaillinenumber' + 1).html(lineitems.join(' '));
                $("#frfranchiseeamount" + 1).val(0);
            }

            $('#ddldetaillinenumber' + flineNo).html('');
            $('#ddldetaillinenumber' + flineNo).html(lineitems.join(' '));


            $('#ddldetaillinenumber' + flineNo).change(function (event) {
                var _valAMT = $(this).val();
                var fln = $(this).attr("relLine");
                if ($(this).attr("relLine") != "Select") {

                    $('#frfranchiseeamount' + fln).prop("required", true);
                }
                else {
                    $('#frfranchiseeamount' + fln).prop("required", false);
                }
                if (_valAMT == "-1") {
                    UnitData = $("#txtsubtotal").val();
                    $("#frfranchiseeamount" + fln).val(UnitData);
                }
                else if ($("#frfranchiseeamount" + fln).val() != "" && $("txtExtendedPrice" + fln).val() != "") {
                    var UnitData;
                    var FrData;
                    //if ($("#txtExtendedPrice" + fln).val().indexOf(",") > 0)
                    //    UnitData = $("#txtExtendedPrice" + fln).val().replace("$ ", "").replace(",", "");
                    //else
                    UnitData = $("#txtExtendedPrice" + fln).val();
                    $("#frfranchiseeamount" + fln).val(UnitData);

                    if ($("#frfranchiseeamount" + fln).val().indexOf(",") > 0)
                        FrData = $("#frfranchiseeamount" + fln).val().replace("$ ", "").replace(",", "");
                    else
                        FrData = $("#frfranchiseeamount" + fln).val().replace("$ ", "");


                    if (parseFloat(FrData) > parseFloat(UnitData)) {
                        {
                            alert("Franchisee amount should not be greater than Extended Price.");
                            $("#frfranchiseeamount" + fln).focus();
                            $("#frfranchiseeamount" + fln).select();
                        }
                    }
                }
                else if ($("#frfranchiseeamount" + fln).val() == "" && $("txtExtendedPrice" + fln).val() != "")
                {
                    UnitData = $("#txtExtendedPrice" + fln).val();
                    $("#frfranchiseeamount" + fln).val(UnitData);
                }

            });
            $("#frfranchiseeamount" + flineNo).change(function () {
                var ddlLine = $(this).parent().parent().find("td")[0];
                var Line_No = $(ddlLine).find("select option:selected").val();
                if ($("#txtExtendedPrice" + Line_No).val() != "" && $(this).val() != "") {
                    var UnitData;
                    var FrData;
                    //if ($("#txtExtendedPrice" + Line_No).val().indexOf(",") > 0)
                    //    UnitData = $("#txtExtendedPrice" + Line_No).val().replace("$ ", "").replace(",", "");
                    //else
                    UnitData = $("#txtExtendedPrice" + Line_No).val();
                    if ($(this).val().indexOf(",") > 0)
                        FrData = $(this).val().replace("$ ", "").replace(",", "");
                    else
                        FrData = $(this).val().replace("$ ", "");
                    if (parseFloat(UnitData) < parseFloat(FrData)) {
                        alert("Frenchisee amount should not grater than Extended Price.");
                        $(this).focus();
                        $(this).select();
                    }
                }
            });

            setTimeout(function () {
                $("#hdfFrenchiseeId").val(0);
                $('#fsearch-box').val('');
            }, 500);

        }


        function addNewEntry(cbFn) {


            lineNo++;
            //<label for="chkPrintInvoice' + lineNo + '" style="padding-left: 0px;float: right;">Print Invoice</label><input style="float: right;" type="checkbox" id="chkPrintInvoice' + lineNo + '" name="chkPrintInvoice' + lineNo + '">
            var tr = "";
            tr = tr + '<tr relline="S' + lineNo + '" style="background-color:#eef1f5;border-right: 1px solid #eef1f5;">';
            tr = tr + '<td colspan="9" style="padding:0!important;">';
            tr = tr + '<table class="col-md-12" style="margin: 0px!important;">';
            tr = tr + '<tr class="theadRow">';
            tr = tr + '<td style="width:72px;padding: 0px !important;text-align:center;">Line No</td>';
            tr = tr + '<td style="padding: 0px !important;text-align:right;"></td>';
            tr = tr + '<td style="padding: 0px !important;text-align:right;"><label for="chkPrintInvoice' + lineNo + '" style="padding-left: 0px;float: right;"></td>';
            tr = tr + '<td style="width: 110px;"></td>';
            tr = tr + '<td style="width: 110px;padding: 0 0px !important;"></td>';
            tr = tr + '<td style="width: 159px;"><label class="check-inline" style="margin-right: 5px;" ><input type="radio" name="tablerdo' + lineNo + '" value="1" class="i-checks" id = "rdoAdditional' + lineNo + '" checked /><span>Additional Billing Office</span></label ></td>';
            tr = tr + '<td style="width: 60px;padding: 0 0px !important;"><input type="text" id="txtCommissionAmount' + lineNo + '" name="txtCommissionAmount' + lineNo + '" value="0" maxlength="10" class="form-control input-sm" /></td>';
            tr = tr + '<td><span id="spnPer' + lineNo + '">%</span></td>';
            tr = tr + '<td><div class="icheck-inline" style="margin-top: 0px;"><label class="check-inline" style="margin-right: 5px;" ><input type = "radio" name="tablerdo' + lineNo + '" value = "2" class="i-checks" id = "rdoExtraWork' + lineNo + '" checked /><span>ExtraWork</span></label ><label class="check-inline"><input type="radio" name="tablerdo' + lineNo + '" value="3" class="i-checks" id="rdoRegularBilling' + lineNo + '" /><span>Regular Billing</span></label>'
            tr = tr + '<label class="check-inline"><input type="radio" name="tablerdo' + lineNo + '" value="4" class="i-checks" id="rdoclientsupplies' + lineNo + '" /><span>Client Supplies</span></label></div ></td>';
            tr = tr + '<td><input type="checkbox" id="chkTaxExcempt' + lineNo + '" name="chkTaxExcempt' + lineNo + '"><label for="chkTaxExcempt' + lineNo + '" style="padding-left: 0px;">Tax Exempt</label> </td>';
            tr = tr + '</tr>';
            tr = tr + '</table>';
            tr = tr + '</td>';
            tr = tr + '</tr>';


            $('#tblcontractdetailrows>tbody').append(tr);
            tr = "";
            tr = tr + '<tr relline="S' + lineNo + '" class="theadRowH" style="background-color:#eef1f5;">';
            tr = tr + '<td style="text-align:center;width:60px;padding: 0px !important;"><input type="text" readonly="" id="txtlinenumber' + lineNo + '" name="txtlinenumber' + lineNo + '" value="' + lineNo + '" class="form-control input-sm cnumeric" style="text-align:center;"></td>';
            tr = tr + '<td style="text-align:center;width:150px;">Service</td>';
            tr = tr + '<td style="text-align:center;">Detail Description</td>';
            tr = tr + '<td style="width:60px;text-align:center;">MarkUp</td>';
            tr = tr + '<td style="width:60px;text-align:center;">Qty</td>';
            tr = tr + '<td style="width:100px;text-align:center;">Unit Price</td>';
            tr = tr + '<td style="width:100px;text-align:center;">Extended Price</td>';
            tr = tr + '<td style="width:90px;text-align:center;">Tax</td>';
            tr = tr + '<td style="width:100px;text-align:center;">Total</td>';
            tr = tr + '</tr>';


            $('#tblcontractdetailrows>tbody').append(tr);
            tr = "";
            tr = tr + '<tr relline="S' + lineNo + '" class="theadRowH remove-padding">';
            tr = tr + '<td style="background-color:#eef1f5;"></td>';
            tr = tr + '<td  style="width: 200px;"><select class="form-control input-sm" id="ContractDetailServiceTypeList' + lineNo + '" name="ContractDetailServiceTypeList' + lineNo + '" ></select></td>';
            tr = tr + '<td><textarea required="" id="txtdescription' + lineNo + '" name="txtdescription' + lineNo + '" class="form-control input-sm" row="1" style="padding: 5px;border-radius: 0px;resize:vertical;max-height:100px;min-height:30px;"></textarea></td>';

            tr = tr + '<td><input type="text" required="" onchange="CalculateAmount(' + lineNo + ')" id="txtmarkup' + lineNo + '" name="txtmarkup' + lineNo + '" value="0" class="form-control input-sm" style="padding: 5px;border-radius: 0px;" ></td>';
            tr = tr + '<td><input type="text" required="" onchange="CalculateAmount(' + lineNo + ')" id="txtqty' + lineNo + '" name="txtqty' + lineNo + '" value="1" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="hidden" id="hdfunitprice' + lineNo + '" name="hdfunitprice' + lineNo + '"/>'
            tr = tr + '<input type="text" required="" onblur="CalculateAmount(' + lineNo + ')" id="txtunitprice' + lineNo + '" name="txtunitprice' + lineNo + '" value="" class="form-control input-sm requiredValidation unitPrice" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="text" required="" readonly="" onchange="CalculateAmount(' + lineNo + ')" id="txtExtendedPrice' + lineNo + '" name="txtExtendedPrice' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="text" required="" readonly="" onchange="CalculateAmount(' + lineNo + ')" id="txttax' + lineNo + '" name="txttax' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="text" required="" readonly="" onchange="CalculateAmount(' + lineNo + ')" id="txttotal' + lineNo + '" name="txttotal' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '</tr>';

            $('#tblcontractdetailrows>tbody').append(tr);
            applyMaskCurrency('#txtExtendedPrice' + lineNo);
            applyMaskCurrency('#txtunitprice' + lineNo);
            applyMaskCurrency('#txttax' + lineNo);
            applyMaskCurrency('#txttotal' + lineNo);
            applyMaskNumber('#txtqty' + lineNo);
            applyTaxExcempt(lineNo)
            applyCommission(lineNo)

            var items = [];
            items.push("<option>Select</option>");
            $.each(lstContractDetailServiceTypeList, function () {
                items.push("<option value=" + this.ServiceTypeListid + ">" + this.name + "</option>");
            });
            $('#ContractDetailServiceTypeList' + lineNo).html(items.join(' '));


            ContractDetailServiceTypeListOnChange('ContractDetailServiceTypeList' + lineNo, lineNo);

            //$('#txtunitprice' + lineNo).keyup(function () {
            //    $('#hdfunitprice' + lineNo).val($('#txtunitprice' + lineNo).val());
            //});

            $('.unitPrice').keyup(function () {
                var fieldId = $(this).attr('id');
                fieldId = fieldId.replace('txtunitprice', '');
                //unitPrice
                $('#hdfunitprice' + fieldId).val($('#txtunitprice' + fieldId).val());
            });


            //$('#ddldetaillinenumber').html('');
            var lineitems = []; lineitems.push("<option value=''>Select</option>");
            for (var i = 1; i <= lineNo; i++) { lineitems.push("<option value=" + i + ">" + i + "</option>"); }

            if (flineNo == 1) {
                lineitems.push("<option value='-1'>All</option>");
            }
            //$('#ddldetaillinenumber').html(lineitems.join(' '));


            $('select[relddldetaillinenum="ddldetaillinenumber" ]').each(function (item) {

                $(this).html('');
                $(this).html(lineitems.join(' '));

            });


            $("#hdftotallineno").val(lineNo);
            OnlyNumber('#txtmarkup' + lineNo)
            OnlyNumber('#txtqtycc' + lineNo)
            onlyDecimal('#txtunitprice' + lineNo)


            if (cbFn != undefined) {
                cbFn();
            }
        }
        function DeleteEntry() {
            lineNo;
            if (lineNo > 1) {
                $("#tblcontractdetailrows tbody tr[relline='S" + lineNo + "']").remove();
                lineNo--;

                CalculateAmount(lineNo);

                $('.unitPrice').keyup(function () {
                    var fieldId = $(this).attr('id');
                    fieldId = fieldId.replace('txtunitprice', '');
                    //unitPrice
                    $('#hdfunitprice' + fieldId).val($('#txtunitprice' + fieldId).val());
                });


                $('#ddldetaillinenumber').html('');
                var lineitems = []; lineitems.push("<option value=''>Select</option>");
                for (var i = 1; i <= lineNo; i++) { lineitems.push("<option value=" + i + ">" + i + "</option>"); }
                //$('#ddldetaillinenumber').html(lineitems.join(' '));


                $('select[relddldetaillinenum="ddldetaillinenumber" ]').each(function (item) {

                    $(this).html('');
                    $(this).html(lineitems.join(' '));

                });
            }

        }
        function CalculateAmount(ln) {

            if ($("#hdfContractTaxRate").val() == undefined)
                $("#hdfContractTaxRate").val("0.0");
            var temptax = parseFloat($("#hdfContractTaxRate").val());

            var txtmarkup = parseFloat($('#txtmarkup' + ln).val() == '' ? 0 : $('#txtmarkup' + ln).val())

            var txtunitpriceT = parseFloat($('#hdfunitprice' + ln).inputmask('unmaskedvalue').replace('$', '').replace(' ', '').replace(',', '') == '' ? 0 : $('#hdfunitprice' + ln).inputmask('unmaskedvalue').replace('$', '').replace(' ', '').replace(',', ''));

            var txtqty = parseFloat($('#txtqty' + ln).val() == '' ? 0 : $('#txtqty' + ln).val())
            var txtunitprice = (txtunitpriceT + (txtunitpriceT * txtmarkup / 100));
            var txttax = $('#txttax' + ln)
            var txttotal = $('#txttotal' + ln)
            var txtExtetotal = 0;

            $('#txtunitprice' + ln).val(txtunitprice);
            txtExtetotal = (txtunitprice * txtqty);
            //txtExtetotal = ((txtunitprice + (txtunitprice * txtmarkup / 100)) * txtqty);
            $('#txtExtendedPrice' + ln).val(txtExtetotal);
            if ($('#chkTaxExcempt' + ln).is(":checked")) {
                txttax.val(0);
            }
            else {
                txttax.val((txtunitprice * txtqty) * temptax / 100)
            }

            txttotal.val((txtqty * txtunitprice) + parseFloat(txttax.inputmask('unmaskedvalue')))

            var toAmt = 0;
            var toTaxAmt = 0;
            for (var i = 1; i <= lineNo; i++) {

                toTaxAmt = toTaxAmt + parseFloat($('#txttax' + i).inputmask('unmaskedvalue') == '' ? 0 : $('#txttax' + i).inputmask('unmaskedvalue'));
                toAmt = toAmt + parseFloat($('#txttotal' + i).inputmask('unmaskedvalue') == '' ? 0 : $('#txttotal' + i).inputmask('unmaskedvalue'));
            }
            $('#txtsubtotal').val(toAmt - toTaxAmt)
            $('#txttaxamount').val(toTaxAmt)
            $('#txttotalamount').val(toAmt)

            applyMaskCurrency('#txtsubtotal');
            applyMaskCurrency('#txttaxamount');
            applyMaskCurrency('#txttotalamount');
        };

        function applyCommission(id) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetAdditionalBilling", "AccountReceivable", new { area = "Portal" })',
                data: {},
                success: function (data) {

                    $('#txtCommissionAmount' + id).hide();
                    $('#spnPer' + id).hide();
                    $('#rdoAdditional' + id).change(function () {
                        if ($(this).is(":checked")) {
                            $('#txtCommissionAmount' + id).show();
                            $('#txtCommissionAmount' + id).val(data);
                            $('#spnPer' + id).show();
                        }
                        else {
                            $('#txtCommissionAmount' + id).val("0");
                            $('#txtCommissionAmount' + id).hide();
                            $('#spnPer' + id).hide();
                        }
                    });
                    $('#rdoRegularBilling' + id).change(function () {
                        if ($(this).is(":checked")) {
                            $('#txtCommissionAmount' + id).val("0");
                            $('#txtCommissionAmount' + id).hide();
                            $('#spnPer' + id).hide();
                        }
                    });
                    $('#rdoExtraWork' + id).change(function () {
                        if ($(this).is(":checked")) {
                            $('#txtCommissionAmount' + id).val("0");
                            $('#txtCommissionAmount' + id).hide();
                            $('#spnPer' + id).hide();
                        }
                    });
                    $('#rdoclientsupplies' + id).change(function () {
                        if ($(this).is(":checked")) {
                            $('#txtCommissionAmount' + id).val("0");
                            $('#txtCommissionAmount' + id).hide();
                            $('#spnPer' + id).hide();
                        }
                    });


                }
            });
        }

        function ContractDetailServiceTypeListOnChange(id, line) {
            $('#' + id).change(function () {

                if (this.value == 5) {
                    $('#txtmarkup' + line).prop("readonly", false);
                    $('#txtmarkup' + line).val(0);
                }
                else {
                    $('#txtmarkup' + line).prop("readonly", true);
                    $('#txtmarkup' + line).val(0);
                }
                CalculateAmount(line);
            });
        }

        function applyTaxExcempt(id) {
            $('#chkTaxExcempt' + id).change(function () { CalculateAmount(id); });
        }
        function onlyDecimal(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) { }
                else { event.preventDefault(); }
                if ($(this).val().toString().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110)) event.preventDefault();
            });
        }
        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }
        function applyMaskCurrency(id) {
            $(id).inputmask("currency", {
                alias: 'currency',
                prefix: '$ ',
                digits: 2,
                autoUnmask: true,
                removeMaskOnSubmit: true,
                unmaskAsNumber: true,
                allowPlus: false,
                allowMinus: false,
                autoGroup: true,
                groupSeparator: ",",
            });
        }
        //function applyMaskCurrency(id) {

        //    $(id).inputmask('decimal', {
        //        allowMinus: false,
        //        allowPlus: false,
        //        autoGroup: true,
        //        groupSeparator: ',',
        //        rightAlign: true,
        //        digits: 2,
        //        autoUnmask: true,
        //        removeMaskOnSubmit: true,
        //    });
        //    //$(id).inputmask("currency", {
        //    //    radixPoint: ".",
        //    //    groupSeparator: ",",
        //    //    digits: 2,
        //    //    autoGroup: true,
        //    //    prefix: '$ ', //Space after $, this will not truncate the first character.
        //    //    rightAlign: true,
        //    //    autoUnmask: true,
        //    //    removeMaskOnSubmit: true,
        //    //    oncleared: function () { self.Value(''); }
        //    //});
        //}

        function applyMaskNumber(id) {
            $(id).inputmask("numeric", {
                autoUnmask: true,
                removeMaskOnSubmit: true,
                oncleared: function () { self.Value(''); }
            });
        }

    </script>
    <script>
        $("#btnSave").click(function () {

            var isvalid = true;

            if ($('#BillSetting_EffectiveDate').val().trim() == '')
            {
                $('#BillSetting_EffectiveDate').css('border-color', 'red');
                if (isvalid == true) { isvalid = false; }
            }
            else {
                $('#BillSetting_EffectiveDate').css('border-color', '');
            }

            if ($("#BillSetting_PrintInvoice").is(':checked')) {
                if($("#BillSetting_EBill").is(':checked') == false && $("#BillSetting_PBill").is(':checked') == false)
                {
                    if (isvalid == true) { isvalid = false; }
                    $("#Errmsg").show();
                }
                else{
                    $("#Errmsg").hide();
                }
                //if (!$("#BillSetting_EBill").is(':checked')) {
                //    if (isvalid == true) { isvalid = false; }
                //    $('#lblEBill').css('color', 'red');
                //}
                //else
                //{
                //    $('#lblEBill').css('color', '');
                //}
                //if (!$("#BillSetting_PBill").is(':checked')) {
                //    if (isvalid == true) { isvalid = false; }
                //    $('#lblPBill').css('color', 'red');
                //}
                //else
                //{
                //    $('#lblPBill').css('color', '');
                //}
            }
            else
            {
                //$('#lblEBill').css('color', '');
                //$('#lblPBill').css('color', '');
                $("#Errmsg").hide();
            }

            if (isvalid == true) {

                var BillSettingsId = 0;
                var EBill = 0;
                var CreateInvoice = 0;
                var PrintPastDue = 0;
                var TaxExcempt = 0;
                var ConsolidatedInvoice = 0;
                var EffectiveDate= '';
                var PBill = 0;

                if ($("#BillSetting_BillSettingsId").val() != undefined && $("#BillSetting_BillSettingsId").val() != "") {
                    BillSettingsId = $("#BillSetting_BillSettingsId").val();
                }
                if ($("#BillSetting_EBill").is(':checked')) {
                    EBill = 1;
                }
                if ($("#BillSetting_PBill").is(':checked')) {
                    PBill = 1;
                }
                if ($("#BillSetting_CreateInvoice").is(':checked')) {
                    CreateInvoice = 1;
                }
                if ($("#BillSetting_PrintPastDue").is(':checked')) {
                    PrintPastDue = 1;
                }
                if ($("#BillSetting_TaxExcempt").is(':checked')) {
                    TaxExcempt = 1;
                }
                if ($("#BillSetting_ConsolidatedInvoice").is(':checked')) {
                    ConsolidatedInvoice = 1;
                }
                if($("#BillSetting_EffectiveDate").val() != ''&& $("#BillSetting_EffectiveDate").val() != null)
                {
                    EffectiveDate = $("#BillSetting_EffectiveDate").val();
                }

                var CustBillSettings = { CustomerId: $("#CustomerViewModel_CustomerId").val(), BillSettingsId: BillSettingsId, ArStatus: $(".ddlArStatus").val(), EffectiveDate: EffectiveDate, InvoiceDateListId: $(".ddlInvoiceDate").val(), InvoiceTermListId: $(".ddlTermDate").val(), EBill: EBill,  PrintPastDue: PrintPastDue, TaxExcempt: TaxExcempt, ConsolidatedInvoice: ConsolidatedInvoice, Note: $("#BillSetting_Notes").val(), EBillEmails: $("#hdfEBill_Emails").val(), PBill: PBill, CreateInvoice : CreateInvoice };
                $(".SaveBtn").hide();
                $.ajax({
                    url: '@Url.Action("SaveBillSettings", "Customer")',
                    dataType: "json",
                    data: CustBillSettings,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data != null) {
                            $("#BillSetting_BillSettingsId").val(data.BillSettingsId);
                        }
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();
                        $("#EditBSetting").show();
                        $(".edit").attr("disabled", "disabled");
                        $(".edit").attr("readonly", "readonly");
                    },
                    error: function () { }
                });
                //window.location.href = window.location.href;
            }

        });

        $('#btnCancel').click(function () {

            $(".edit").attr("disabled", "disabled");
            $(".edit").attr("readonly", "readonly");
            $("#btnSave").prop("disabled", "false");
            $("#btnSave").prop("readonly", "true");

            $("#btnCancel").prop("disabled", "false");
            $("#btnCancel").prop("readonly", "true");

            $("#EditBSetting").show();
            $("#btnSave").hide();
            $("#btnCancel").hide();

            //$('#modal_Billingsetting').hide();
            //$("#modal_Billingsetting").close();
            //$('.modal-backdrop').remove();
            // $('#modal_Billingsetting').dismiss('Cancel');

        });

        $('#btnContactSave1').click(function () {

            var isvalid = true;

            if ($('#CustomerViewModel_Name').val().trim() == '') { $('#CustomerViewModel_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#CustomerViewModel_Name').css('border-color', ''); }
            //if ($('#MainContact_FirstName').val().trim() == '') { $('#MainContact_FirstName').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainContact_FirstName').css('border-color', ''); }
            if ($('#MainAddress_Address1').val().trim() == '') { $('#MainAddress_Address1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_Address1').css('border-color', ''); }
            if ($('#MainAddress_City').val().trim() == '') { $('#MainAddress_City').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_City').css('border-color', ''); }
            if ($('#MainStatesList').val().trim() == '') { $('#MainStatesList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainStatesList').css('border-color', ''); }
            if ($('#MainAddress_PostalCode').val().trim() == '') { $('#MainAddress_PostalCode').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainAddress_PostalCode').css('border-color', ''); }

            if ($('#MainPhone_Phone1').val().trim() == '' || $('#MainPhone_Phone1').val() == NaN || parseInt($("#MainPhone_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#MainPhone_Phone1').css('border-color', 'red');
                if (isvalid == true) {
                    isvalid = false;
                }
            }
            else {
                $('#MainPhone_Phone1').css('border-color', '');
            }

            if (isvalid == true) {

                var AddressId = 0;
                var PhoneId = 0;

                if ($("#MainAddress_AddressId").val() != undefined && $("#MainAddress_AddressId").val() != "") {
                    AddressId = $("#MainAddress_AddressId").val();
                }
                if ($("#MainPhone_PhoneId").val() != undefined && $("#MainPhone_PhoneId").val() != "") {
                    PhoneId = $("#MainPhone_PhoneId").val();
                }

                var EditCustM1data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), AddressId: AddressId, Address1: $("#MainAddress_Address1").val(), Address2: $("#MainAddress_Address2").val(), City: $("#MainAddress_City").val(), StateId: $("#MainStatesList").val(), PostalCode: $("#MainAddress_PostalCode").val(), PhoneId: PhoneId, Phone1: $("#MainPhone_Phone1").val(), Fax: $("#MainPhone_Fax").val(),CustName:$('#CustomerViewModel_Name').val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupMainContactTab1", "Customer")',
                    dataType: "json",
                    data: EditCustM1data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data != null) {
                            $("#MainAddress_AddressId").val(data.AddressId);
                            $("#MainPhone_PhoneId").val(data.PhoneId)
                        }
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();
                        $("#EditContact1").show();
                        $(".editmain1").attr("disabled", "disabled");
                        $(".editmain1").attr("readonly", "readonly");
                    },
                    error: function () { }
                });
                //window.location.href = window.location.href;
            }
        });

        $('#btnContactCancel1').click(function () {
            $(".editmain1").attr("disabled", "disabled");
            $(".editmain1").attr("readonly", "readonly");

            $("#btnContactSave1").prop("disabled", "false");
            $("#btnContactSave1").prop("readonly", "true");

            $("#btnContactCancel1").prop("disabled", "false");
            $("#btnContactCancel1").prop("readonly", "true");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();
        });

        $('#btnContactSave').click(function () {

            var isvalid = true;

            if ($('#MainContact_Name').val().trim() == '') { $('#MainContact_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#MainContact_Name').css('border-color', ''); }
            if ($('#MainPhone2_Phone1').val().trim() == '' || $('#MainPhone2_Phone1').val() == NaN || parseInt($("#MainPhone2_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#MainPhone2_Phone1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
            } else { $('#MainPhone2_Phone1').css('border-color', ''); }

            if ($('#MainEmail_EmailAddress').val().trim() != '') {
                if (!ValidateEmail($('#MainEmail_EmailAddress').val())) {
                    if (isvalid == true) { isvalid = false; }
                    $('#MainEmail_EmailAddress').css('border-color', 'red');
                } else { $('#MainEmail_EmailAddress').css('border-color', ''); }
            }
            if ($('#MainPhone2_Cell').val().trim() != '') {
                if (parseInt($("#MainPhone2_Cell").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                    $('#MainPhone2_Cell').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
                    $('#MainPhone2_Cell').css('border-color', 'red');
                } else { $('#MainPhone2_Cell').css('border-color', ''); }
            }


            if (isvalid == true) {

                var ContactId = 0;
                var PhoneId = 0;
                var EmailId = 0;

                if ($("#MainContact_ContactId").val() != undefined && $("#MainContact_ContactId").val() != "") {
                    ContactId = $("#MainContact_ContactId").val();
                }
                if ($("#MainPhone2_PhoneId").val() != undefined && $("#MainPhone2_PhoneId").val() != "") {
                    PhoneId = $("#MainPhone2_PhoneId").val();
                }
                if ($("#MainEmail_EmailId").val() != undefined && $("#MainEmail_EmailId").val() != "") {
                    EmailId = $("#MainEmail_EmailId").val();
                }

                var EditCustM2data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#MainContact_Name").val(), Title: $("#MainContact_Title").val(), PhoneId: PhoneId, Phone1: $("#MainPhone2_Phone1").val(), PhoneExt: $("#MainPhone2_PhoneExt").val(), Cell: $("#MainPhone2_Cell").val(), Fax: $("#MainPhone2_Fax").val(), EmailId: EmailId, EmailAddress: $("#MainEmail_EmailAddress").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupMainContactTab2", "Customer")',
                    dataType: "json",
                    data: EditCustM2data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data != null) {
                            $("#MainContact_ContactId").val(data.ContactId);
                            $("#MainEmail_EmailId").val(data.EmailId);
                            $("#MainPhone2_PhoneId").val(data.PhoneId)

                        }
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();
                        $("#EditContact").show();
                        $(".editmain").attr("disabled", "disabled");
                        $(".editmain").attr("readonly", "readonly");
                    },
                    error: function () { }
                });
                //window.location.href = window.location.href;
            }


        });
        $('#btnContactCancel').click(function () {
            $(".editmain").attr("disabled", "disabled");
            $(".editmain").attr("readonly", "readonly");

            $("#btnContactSave").prop("disabled", "false");
            $("#btnContactSave").prop("readonly", "true");

            $("#btnContactCancel").prop("disabled", "false");
            $("#btnContactCancel").prop("readonly", "true");


            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();
        });

        $('#btnBContactSave1').click(function () {

            var isvalid = true;
            if ($('#BillingContact_Name').val().trim() == '') { $('#BillingContact_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingContact_Name').css('border-color', ''); }
            if ($('#BillingAddress_Address1').val().trim() == '') { $('#BillingAddress_Address1').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_Address1').css('border-color', ''); }
            if ($('#BillingAddress_City').val().trim() == '') { $('#BillingAddress_City').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_City').css('border-color', ''); }
            if ($('#BillingStatesList').val().trim() == '') { $('#BillingStatesList').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingStatesList').css('border-color', ''); }
            if ($('#BillingAddress_PostalCode').val().trim() == '') { $('#BillingAddress_PostalCode').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingAddress_PostalCode').css('border-color', ''); }

            if (isvalid == true) {

                var ContactId = 0;
                var BAddressId = 0;

                if ($("#BillingContact_ContactId").val() != undefined && $("#BillingContact_ContactId").val() != "") {
                    ContactId = $("#BillingContact_ContactId").val();
                }
                if ($("#BillingAddress_AddressId").val() != undefined && $("#BillingAddress_AddressId").val() != "") {
                    BAddressId = $("#BillingAddress_AddressId").val();
                }

                var EditCustB1data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#BillingContact_Name").val(), Attention: $("#BillingContact_Attention").val(), AddressId: BAddressId, Address1: $("#BillingAddress_Address1").val(), Address2: $("#BillingAddress_Address2").val(), City: $("#BillingAddress_City").val(), StateId: $("#BillingStatesList").val(), PostalCode: $("#BillingAddress_PostalCode").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupBillingTab1", "Customer")',
                    dataType: "json",
                    data: EditCustB1data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data != null) {
                            $("#BillingContact_ContactId").val(data.ContactId);
                            $("#BillingAddress_AddressId").val(data.AddressId);
                        }
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();
                        $("#EditBContact1").show();
                        $(".editbill1").attr("disabled", "disabled");
                        $(".editbill1").attr("readonly", "readonly");
                    },
                    error: function () { }
                });
                //window.location.href = window.location.href;
            }
        });
        $('#btnBContactCancel1').click(function () {
            $(".editbill1").attr("disabled", "disabled");
            $(".editbill1").attr("readonly", "readonly");

            $("#btnBContactSave1").prop("disabled", "false");
            $("#btnBContactSave1").prop("readonly", "true");

            $("#btnBContactCancel1").prop("disabled", "false");
            $("#btnBContactCancel1").prop("readonly", "true");

            $(".EditBtn").show();
            $(".SaveBtn").hide();
            $(".CancelBtn").hide();

        });

        $('#btnBContactSave').click(function () {

            //var data = $("form").serialize();
            //alert(data);

            var isvalid = true;

            if ($('#BillingContactInformation2_Name').val().trim() == '') { $('#BillingContactInformation2_Name').css('border-color', 'red'); if (isvalid == true) { isvalid = false; } } else { $('#BillingContactInformation2_Name').css('border-color', ''); }
            if ($('#BillingPhone_Phone1').val().trim() == '' || $('#BillingPhone_Phone1').val() == NaN || parseInt($("#BillingPhone_Phone1").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                $('#BillingPhone_Phone1').css('border-color', 'red');
                if (isvalid == true) { isvalid = false; }
            }
            else {
                $('#BillingPhone_Phone1').css('border-color', '');
            }
            if ($('#BillingEmail_EmailAddress').val().trim() != '') {
                if (!ValidateEmail($('#BillingEmail_EmailAddress').val())) {
                    if (isvalid == true) { isvalid = false; }
                    $('#BillingEmail_EmailAddress').css('border-color', 'red');
                } else { $('#BillingEmail_EmailAddress').css('border-color', ''); }
            }
            if ($('#BillingPhone_Cell').val().trim() != '') {
                if (parseInt($("#BillingPhone_Cell").val().replace(/[^0-9\.]/g, ''), 10).toString().length < 10) {
                    $('#BillingPhone_Cell').css('border-color', 'red'); if (isvalid == true) { isvalid = false; }
                    $('#BillingPhone_Cell').css('border-color', 'red');
                } else { $('#BillingPhone_Cell').css('border-color', ''); }
            }

            if (isvalid == true) {

                var ContactId = 0;
                var BPhoneId = 0;
                var BEmailId = 0;

                if ($("#BillingContactInformation2_ContactId").val() != undefined && $("#BillingContactInformation2_ContactId").val() != "") {
                    ContactId = $("#BillingContactInformation2_ContactId").val();
                }
                if ($("#BillingPhone_PhoneId").val() != undefined && $("#BillingPhone_PhoneId").val() != "") {
                    BPhoneId = $("#BillingPhone_PhoneId").val();
                }
                if ($("#BillingEmail_EmailId").val() != undefined && $("#BillingEmail_EmailId").val() != "") {
                    BEmailId = $("#BillingEmail_EmailId").val();
                }

                var EditCustB2data = { CustomerId: $("#CustomerViewModel_CustomerId").val(), ContactId: ContactId, Name: $("#BillingContactInformation2_Name").val(), Title: $("#BillingContactInformation2_Title").val(), PhoneId: BPhoneId, Phone1: $("#BillingPhone_Phone1").val(), PhoneExt: $("#BillingPhone_PhoneExt").val(), Cell: $("#BillingPhone_Cell").val(), Fax: $("#BillingPhone_Fax").val(), EmailId: BEmailId, EmailAddress: $("#BillingEmail_EmailAddress").val() };

                $.ajax({
                    url: '@Url.Action("EditCustomerPopupBillingTab2", "Customer")',
                    dataType: "json",
                    data: EditCustB2data,
                    traditional: true,
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data != null) {
                            $("#BillingContactInformation2_ContactId").val(data.ContactId);
                            $("#BillingPhone_PhoneId").val(data.PhoneId);
                            $("#BillingEmail_EmailId").val(data.EmailId);
                        }
                        $(".SaveBtn").hide();
                        $(".CancelBtn").hide();
                        $("#EditBContact").show();
                        $(".editbill").attr("disabled", "disabled");
                        $(".editbill").attr("readonly", "readonly");
                    },
                    error: function () { }
                });
                //window.location.href = window.location.href;

            }
        });
        $('#btnBContactCancel').click(function () {
            $(".editbill").attr("disabled", "disabled");
            $(".editbill").attr("readonly", "readonly");

            $("#btnBContactSave").prop("disabled", "false");
            $("#btnBContactSave").prop("readonly", "true");

            $("#btnBContactCancel").prop("disabled", "false");
            $("#btnBContactCancel").prop("readonly", "true");

            $("#EditBContact").show();
            $("#btnBContactSave").hide();
            $("#btnBContactCancel").hide();
        });


        $("#btnEditDistribution").click(function () {

            $(".editvalue").addClass("editvaluetext");
            $(".editvalue").removeClass("editmode");
            //$("#btnSaveDistribution").show();
            //$("#btnEditDistribution").hide();
            $(".editvalue").removeAttr("disabled").removeAttr("readonly");
            $(".editcheck").removeAttr("disabled").removeAttr("readonly");
        });

        $("#btnSaveDistribution").click(function () {

            if (tempFRowLineNo > 0) {
                alert('save')
            }
            $(".editvalue").removeClass("editvaluetext");
            $(".editvalue").addClass("editmode");
            //$("#btnSaveDistribution").hide();
            //$("#btnEditDistribution").show();
            $(".editvalue").attr("readonly", "readonly");
            $(".editcheck").attr("disabled", "disabled");
            $(".editcheck").attr("readonly", "readonly");
        });

        function onlyDecimal(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) { }
                else { event.preventDefault(); }
                if ($(this).val().toString().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110)) event.preventDefault();
            });
        }
        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }

        function OnClickContractDetailCancel() {
            $('#modal_CustomerContractPopup').modal("hide");
        }
        function ValidateEmail(email) {
            // Validate email format
            var expr = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
            return expr.test(email);
        };
    </script>
    <script>


        function checkExistManintenance() {
            var retV = true;
            if ($('#hdfCustomerMaintenanceId').val() != 0)
            {
                retV = false;
                $("#spnExistsMaintenancePromptMsg").html('This customer currently pending approve for  "' + $('#hdfCustomerMaintenanceTypeName').val() + '", Please check with system admin.');
                $("#modal_ExistsMaintenancePrompt").modal({ backdrop: 'static' });
                //swal('This customer currently pending approve for  "' + $('#hdfCustomerMaintenanceTypeName').val() + '", Please check with system admin')
                //swal({ title: "Hooray", text: "You did it!", type: "success" });
            }

            return retV;
        }

        function hasExistManintenance(cid, callType) {
            if (callType == 'transfer') {
                $.blockUI()
                $('#btncust_trans').prop('disabled', true);
            } else if (callType == 'increase') {
                $.blockUI()
                $('#btncust_increase').prop('disabled', true);
            } else if (callType == 'cancel') {
                $.blockUI()
                $('#btncust_cancel').prop('disabled', true);
            }


            var sURL = '@Url.Action("hasExistManintenance", "customer", new { area = "Portal" })?cid=' + cid;
            var retV = true;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    //$("#spnExistsMaintenancePromptMsg").html('This customer currently pending approve for  "' + data.MaintenanceTypeName + '", Please check with system admin.');
                    //$("#modal_ExistsMaintenancePrompt").modal({ backdrop: 'static' });
                    if (data.MaintenanceTypeName != "") {
                        alert('This customer currently pending approve for  "' + data.MaintenanceTypeName + '", Please check with system admin.');
                        retV = false;
                        $('#btncust_trans').prop('disabled', false);
                        $('#btncust_increase').prop('disabled', false);
                        $('#btncust_cancel').prop('disabled', false);
                        $.unblockUI()

                    } else {
                        if (callType == "cancel") {
                            showCustomerMaintenance(cid)
                        } else if (callType == "transfer") {
                            $.unblockUI()
                            showTransfer(cid)
                        } else if (callType == "increase") {
                            showIncreaseDescrease(cid)
                        }
                    }

                },
                error: function (err) {
                    console.log(err);
                }
            });
            return retV;
        }

        function showCustomerMaintenance(id) {



            var sURL = '@Url.Action("CustomerMaintenancePartial", "customer", new { area = "Portal" })?id=' + id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_customermaintenancem').html(data);

                    $('#form_customermaintenance').validate({ // initialize the plugin
                        // your rules and options,
                        errorPlacement: function () {
                            return false;  // suppresses error message text
                        }
                    });
                    /*$("#manediv").hide();
                    $("#divresumedate").hide();
                    $('#divlastservicedate').hide();
                    $("#divtable").hide();

                    $("#ddlStatus").prop('required', true);
                    $("#StatusDate").prop('required', true);

                    if ($("#ddlStatus").val() > 0) {
                        bindCustomerMaintenanceLoad_popup($("#ddlStatus").val());
                    }
                    $(".date-picker").datepicker();

                    $('#tblMaintance').dataTable({
                        "bProcessing": true,
                        "aLengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                        "pageLength": 200, // default records per page
                        "dom": "<'table-responsive't>"
                    });*/

                    getCancellationInvoiceData();
                    $('#btncust_trans').prop('disabled', false);
                    $("#modal_customermaintenanceDetail").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


        function bindCustomerMaintenanceLoad_popup(id) {
            var value = id;
            if (value == 1 || value == 4 || value == 0) {
                $("#manediv").hide();

                $("#ResumeDate").prop('required', false);
                $("#LastServiceDate").prop('required', false);
                $("#ddlReason").prop('required', false);
                $("#StatusNotes").prop('required', false);
            }
            else if (value == 3) {
                $("#manediv").show();
                $("#divtable").hide();
                $('#divlastservicedate').hide();
                $("#divresumedate").show();

                $("#ResumeDate").prop('required', true);
                $("#LastServiceDate").prop('required', false);
                $("#ddlReason").prop('required', true);
                $("#StatusNotes").prop('required', true);
            }
            else if (value == 2) {
                $("#manediv").show();
                $("#divresumedate").hide();
                $('#divlastservicedate').show();
                $("#divtable").show();

                $("#ResumeDate").prop('required', false);
                $("#LastServiceDate").prop('required', true);
                $("#ddlReason").prop('required', true);
                $("#StatusNotes").prop('required', true);
            }
        }


        function saveCustomerMaintenance() {
            var isValid = $('#form_customermaintenance').valid();
            if (!isValid || parseInt($('#hdfCustomerId').val()) == 0) {
                e.preventDefault(); //prevent the default action
            }
            else {
                $.ajax({
                    url: '@Url.Action("CustomerMaintenancePartial", "Customer",new { area = "Portal" })',
                    type: "POST",
                    data: $('#form_customermaintenance').serialize(),
                    success: function (res) {
                        $('#modal_customermaintenanceDetail').modal('hide');
                        $('#modal_applycreditform').modal('hide');

                        if($("#ddlStatus").val()==1)
                        {
                            location.reload();
                        }
                    },
                    error: function () { }
                });
            }
        }

        function continueCustomerMaintenanceToCancellationCredits() {
            var isValid = $('#form_customermaintenance').valid();
            if (!isValid || parseInt($('#hdfCustomerId').val()) == 0) {
                //e.preventDefault(); //prevent the default action
            }
            else {

                $.ajax({
                    url: '@Url.Action("CustomerMaintenancePartialJson", "Customer",new { area = "Portal" })',
                    type: "POST",
                    data: $('#form_customermaintenance').serialize(),
                    success: function (res) {
                        var MaintenancetempId = res;
                        var info = getNextCancellationInvoiceInfo();
                        if (info != null)
                            openApplyCreditFormForCancellation(info, MaintenancetempId);
                    },
                    error: function () { }
                });
            }
        }

        function continueCancellationProcess() {

            $('#modal_applycreditform').modal('hide');
            cancellationInvoiceData.shift();

            var info = getNextCancellationInvoiceInfo();
            if (info != null)
                openApplyCreditFormForCancellation(info, $('#isForCancellationMaintenancetempId').val());
            else {
                //saveCustomerMaintenance();
                $('#modal_customermaintenanceDetail').modal('hide');
                $('#modal_applycreditform').modal('hide');
            }
        }

        var cancellationInvoiceData = null;

        function getCancellationInvoiceData() {
            var date = $('#LastServiceDate').val();
            var sURL = '@Url.Action("GetCustomerMaintenanceCancellationInvoiceDetails", "customer", new { area = "Portal" })?customerId=' + parseInt($('#hdfCustomerId').val()) + '&date=' + date;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    cancellationInvoiceData = data;
                    toggleSubmitButton();
                },
                error: function () {
                }
            });
        }

        function getNextCancellationInvoiceInfo() {
            if (cancellationInvoiceData == null || cancellationInvoiceData.length == 0) return null;
            return cancellationInvoiceData[0];
        }

        function ValidateEmail(email) {
            var expr = /^([\w-\.]+@@([\w-]+\.)+[\w-]{2,4})?$/;
            return expr.test(email);
        };
        $('#BillSetting_EBill').click(function () {
            var checkvalue = $('#BillSetting_EBill').prop('checked')
            if (checkvalue) {
                $('#btnshowbillingcontactemail').show();
            }
            else {
                $('#btnshowbillingcontactemail').hide();
            }

        });
        $('#btnshowbillingcontactemail').click(function () {

            bindEBillEmails();
            $('#divEBill_Emails').html('');
            $('#txtemailaddress_ebill').val('')
            var strEmail = '';
            $.each(ebill_email, function (index, value) {
                $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + value + '</span><br />');
                strEmail += (strEmail != "" ? "," : "") + value;
            });
            $('#mdlAppendemail').modal({ backdrop: 'static' });

        });

        $('#btnaddemailaddress_ebill').click(function () {

            if (!ValidateEmail($("#txtemailaddress_ebill").val())) {
                alert("Invalid email address.");
            }
            else {
                var strEmail = $('#hdfEBill_Emails').val();
                ebill_email.push($('#txtemailaddress_ebill').val());
                $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + $('#txtemailaddress_ebill').val() + '</span><br />');
                strEmail += (strEmail != "" ? "," : "") + $('#txtemailaddress_ebill').val();
                $('#hdfEBill_Emails').val(strEmail);
                $('#txtemailaddress_ebill').val('')
            }
        });


        function bindEBillEmails() {
            ebill_email = [];
            var strEma = $('#hdfEBill_Emails').val();
            $('#divEBill_Emails').html('');
            if (strEma.length > 0) {
                $.each(strEma.split(','), function (index, value) {
                    console.log(value);
                    ebill_email.push(value);
                });
            }
            else {
                if ($('#BillingEmail_EmailAddress').val() != '') {
                    $('#divEBill_Emails').append('<span style="padding:3px;float:left;width:100%">' + $('#BillingEmail_EmailAddress').val() + '</span><br />');
                    ebill_email.push($('#txtemailaddress_ebill').val());
                }
            }
        }
        function showAccountHistoryPopup(Id)
        {
            var sURL = '@Url.Action("CustomerAccountHistoryPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_CustomerAccountHistoryPopup').html(data);
                    $("#modal_CustomerAccountHistoryPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function showIncreaseDecreasePopup(Id)
        {
            var sURL = '@Url.Action("IncreaseDecreaseReportPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#Render_IncreaseDecreaseReportPopup').html(data);
                    $("#modal_IncreaseDecreaseReportPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function getAccountHistoryDetails(Id)
        {
            var numMonths = $("#txtAccountHistoryMonths").val();

            var sURL = '@Url.Action("CustomerAccountHistoryPopupDetails", "Customer", new { area = "Portal" })?customerId=' + Id + '&numberOfMonths=' + numMonths;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#divAccountHistoryDetails').html(data);
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function btnInvoiceWinClose() {
            $("#modal_invoicedetail").modal('hide');
        }
        function btnInvoicePopupClose() {
            $("#modal_invoicedetail").modal('hide');
        }
        function btnInvoiceBillClose() {
            $("#form_FranchiseeBillingDetail").modal('hide');
        }
        function getAccountHistoryExportPdf(Id)
        {
            var numMonths = $("#txtAccountHistoryMonths").val();
            window.location.href = '@Url.Action("CustomerAccountHistoryExportPdf", "Customer", new { area = "Portal" })?customerId=' + Id + '&numberOfMonths=' + numMonths;
        }
        function getAccountHistoryPrints(Id)
        {
            var numMonths = $("#txtAccountHistoryMonths").val();
            //window.location.href = '@Url.Action("CustomerAccountHistoryDetailsPrint", "Customer", new { area = "Portal" })?customerId=' + Id + '&numberOfMonths=' + numMonths;

            if (Id != "") {
                var sURL = '@Url.Action("CustomerAccountHistoryDetailsPrint", "Customer", new { area = "Portal" })?customerId=' + Id + '&numberOfMonths=' + numMonths;
                $.ajax({
                    type: "GET",
                    url: sURL,
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        var tUrl = data;
                        printJS({ printable: document.location.origin + tUrl, type: 'pdf', showModal: false });
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            }
            else {
                alert('Please select payment no to print.')
            }
        }
    </script>
    <script>
        $('#CCForm').card({
            // a selector or DOM element for the container
            // where you want the card to appear
            container: '.card-wrapper', // *required*

            // all of the other options from above
        });
        $(function () {
            $("#myModal").draggable();
        });



        function OpenCustomerUploadDocumentPopup(Id) {

            var sURL = '@Url.Action("CustomerUploadDocumentPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerUploadDocumentPopup').html(data);
                    $("#ModelCustomerUploadDocumentPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function invdetail_sendemail() {

            var txFromEmail = $("#invdetail_txtfromemail").val();
            var txToEmail = $("#invdetail_txttoemail").val();
            var txCCEmail = $("#invdetail_txtccemail").val();
            var txSubjectEmail = $("#invdetail_txtsubjectemail").val();
            var txBodyEmail = $("#invdetail_txtemailbodyemail").val();

            var sURL = '@Url.Action("CustomerStatementSendEmailPopup", "Customer", new { area = "Portal" })?FromEmail=' + txFromEmail+'&ToEmail=' + txToEmail+'&CCEmail=' + txCCEmail+'&SubjectEmail=' + txSubjectEmail+'&BodyEmail=' + txBodyEmail +'&customerId=@(Html.DisplayFor(one => one.CustomerDetail.CustomerId))&start=' + $('#spnStartDateStatements').text() + '&end=' + $('#spnEndtDateStatements').text();
            $.ajax({
                type: "GET",
                url: encodeURI(sURL),
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {

                    $("#modal_invoicedetailEmail").modal('hide');
                },
                error: function (err) {
                    console.log(err);
                }
            });

            //$("#invdetail_txtfromemail").val('');
            //$("#invdetail_txttoemail").val('');
            $("#invdetail_txtccemail").val('');
            //$("#invdetail_txtsubjectemail").val('');
            $("#invdetail_txtemailbodyemail").val('');
            $("#modal_invoicedetailEmail").modal('hide');
        }
        function DetailInvoiceListSendEmail(Id) {
            var sURL = '@Url.Action("GetEmailsforSendEmail", "AccountReceivable", new { area = "Portal" })?CustomerId=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    var obj = $.parseJSON(data);
                    console.log(obj);
                    $("#invdetail_txtfromemail").val(obj.FromEmail);
                    $("#invdetail_txtccemail").val(obj.CCEmail);
                    $("#modal_invoicedetailEmail").modal('show');
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function closeFranchiseeCallPopup() {
            $("#modal_FranchiseeCall").modal("hide");
            //$('.modal-backdrop').remove();
        }
    </script>

    @*********************************  End New Code  **********************************@
    <script type="text/javascript">
        $(document).ready(function () {
            $("#tblServiceCall > tbody > tr").click(function () {
                if ('@ViewBag.CallFromCustomer' == "1") {
                    window.location.href = '/Portal/Customer/ServiceCallList/' + $(this).find("[id=tdClassId]").val();
                }
                else {
                    window.location.href = '/Portal/Customer/CustomerServiceCallList/' + $(this).find("[id=tdClassId]").val();
                }
            })


        })
    </script>
}

