
<style type="text/css">
    .input-sm.pp {
        margin-top: 0;
        margin-bottom: 0;
        text-align: right;
        padding: 3px;
        border-radius: 0;
    }

    .has-error {
        border-color: red;
    }
</style>
<form class="form-horizontal" action="@Url.Action("CustomerDetailTransferDistribution", "Customer", new { area = "Portal" })" id="submit_form_Transdistributioncustomer" method="POST">

    <div class="modal fade custom-model custom-form-design" id="modal_CustomerTransferFranchiseeDistribution" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" style="width:1000px">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        CUSTOMER TRANSFER
                    </h4>
                </div>
                <div class="modal-body" style="padding: 5px;padding-top:0px;">
                    <input type="hidden" id="hdftransfer_customerid" name="hdftransfer_customerid" value="" />
                    <input type="hidden" id="hdftransfercontractdetail_linecount" name="hdftransfercontractdetail_linecount" value="" />
                    <input type="hidden" id="hdftransferfrenchiseedetail_linecount" name="hdftransferfrenchiseedetail_linecount" value="" />

                    <div class="row">
                        <div style="max-width: 98%;margin: 0px auto;">
                            <div class="custom-form portlet light">
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-md-1 control-label">
                                            Status:
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-control input-sm" id="trans_ddlTransferStatus" name="statusList">
                                                <option value="17">Transfer</option>
                                            </select>
                                            @*@Html.DropDownList("statusList", null, new { @class = "form-control input-sm", @id = "trans_ddlTransferStatus", @name = "trans_ddlTransferStatus" })*@
                                        </div>
                                        <div class="col-md-1 control-label">
                                            Reason:
                                        </div>
                                        <div class="col-md-3">
                                            @Html.DropDownList("statusreasonlist", null, "Select", new { @class = "form-control input-sm", @id = "trans_ddlTransferReason", @name = "trans_ddlTransferReason" })
                                        </div>
                                        <div class="col-md-2 control-label">
                                            Effective Date:
                                        </div>
                                        <div class="col-md-2">
                                            <input type="text" id="trans_ddlTransferEffectiveDate" name="trans_ddlTransferEffectiveDate" class="form-control input-sm date-picker" />
                                        </div>
                                    </div>
                                </div>
                                <div class="portlet-body form">
                                    <div style="width: 100%; margin: 0em auto;">
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="tb_fr_page1">
                                                <div class="form-group">
                                                    <div class="col-md-8">
                                                        <b>Customer Name: <span id="spnTransCustomerName"></span></b>
                                                    </div>
                                                    <div class="col-md-4 text-right">
                                                        <b>Customer No: <span id="spnTransCustomerNo"></span></b>
                                                    </div>
                                                </div>
                                                <hr style="margin-top: 1px;margin-bottom: 1px;" />
                                                <div style="margin-bottom: 20px;">
                                                    <div class="table-responsive">
                                                        <table class="table" id="tblTransFranchiseeDistributionList">
                                                            <thead>
                                                                <tr>
                                                                    <th style="width:20px;text-align:center;">
                                                                        PO No.
                                                                    </th>
                                                                    <th style="width:140px;text-align:center;">
                                                                        Account Type
                                                                    </th>
                                                                    <th style="width:30px;text-align:center;">
                                                                        Term (m)
                                                                    </th>
                                                                    <th style="text-align:center;width:50px;">
                                                                        Start Date
                                                                    </th>
                                                                    <th style="text-align:center;width:30px;">
                                                                        Expiration Date
                                                                    </th>
                                                                    <th style="text-align:center;width:30px;">
                                                                        Total Amount
                                                                    </th>
                                                                    <th style="text-align:center;width:30px;">
                                                                        Status
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>

                                                </div>
                                                <hr />
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <table class="table table-striped table-bordered table-hover order-column" style="border:1px solid #e8e8e8" id="frTransdestributionTable">
                                                            <thead>
                                                                <tr>
                                                                    <th style="width:130px;padding:3px;margin: 0px;">Contract Detail Line</th>
                                                                    <th style="width:100px;padding:3px;margin: 0px;text-align:center;">Franchisee No.</th>
                                                                    <th style="width:300px;padding:3px;text-align:center;">Franchisee Name</th>
                                                                    <th style="width:130px;padding:3px;">Distribution Amount</th>
                                                                    <th style="width:25px;padding:3px;">Fees</th>
                                                                    <th style="width:25px;padding:3px;"></th>
                                                                    <th style="width:100px;padding:3px;"></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>

                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <button type="button" id="btnTransferAppendDistributionTransNew" onclick="showAddTransferAppendDistribution()" class="btn btn-primary" style="margin-left: 10px;display:none;">Add New Franchisee</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-actions">
                                        <div class="col-md-12" style="padding-right: 28px;">
                                            <button type="button" id="btnTransferDistributionContinue" onclick="showStopfindersfee()" class="btn btn-primary pull-right" style="margin-left: 10px;display:none;">Continue</button>
                                        </div>
                                    </div>
                                    <div class="modal fade custom-model custom-form-design" id="modalData" tabindex="-1" role="basic" aria-hidden="true" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade custom-model custom-form-design" id="modal_customercontractdetailschedule" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Contract Detail Service
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                    <section>
                        <div class="row">
                            <div style="max-width: 98%;margin: 0px auto;">
                                <div class="custom-form portlet light">
                                    <div class="portlet-body form">

                                        <div class="form-body-outer" style="padding: 0px;">
                                            <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleMonday" class="i-checks editcheck">Monday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleTuesday" class="i-checks editcheck">Tuesday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleWednesday" class="i-checks editcheck">Wednesday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleThursday" class="i-checks editcheck">Thursday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleFriday" class="i-checks editcheck">Friday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleSaturday" class="i-checks editcheck">Saturday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            <input type="checkbox" id="chkTRScheduleSunday" class="i-checks editcheck">Sunday
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>

                    </section>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>

    <div class="modal fade custom-model custom-form-design" id="modal_CTDistribution" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm" style="width: 400px;">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Fee
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px">
                    <section>
                        <div class="row">
                            <div style="max-width: 98%;margin: 0px auto;">
                                <div class="custom-form portlet light">
                                    <div class="portlet-body form">
                                        <input type="hidden" name="hdfDestributionFee_FranchiseeId" id="hdfCTDestributionFee_FranchiseeId" value="" />
                                        <input type="hidden" name="hdfDestributionFee_ContractDetailId" id="hdfCTDestributionFee_ContractDetailId" value="" />
                                        <input type="hidden" name="hdfDestributionFee_DestributionId" id="hdfCTDestributionFee_DestributionId" value="" />
                                        <input type="hidden" name="hdfDestributionFee_Linenumber" id="hdfCTDestributionFee_Linenumber" value="" />
                                        <div class="form-body-outer" style="padding: 0px;">
                                            <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                                <div class="form-group">
                                                    <table class="table table-striped table-bordered table-hover order-column" id="CTfeelist">
                                                        <thead>
                                                            <tr style="background-color: #e8e8e8;font-weight: bold;">
                                                                <td>
                                                                    Fee Name
                                                                </td>
                                                                <td>
                                                                    Type
                                                                </td>
                                                                <td style="width:50px;">
                                                                    Amount
                                                                </td>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>

                                                </div>
                                                <div class="form-group">
                                                    <a href="javascript:void(0);" id="btnTransDistributionFeeAddLink" onclick="TransFranchiseeserviceAddDestribution()">Include Another Fee</a>
                                                </div>
                                                <div class="form-group">
                                                    <input type="button" id="btnTransDistributionFeeSave" name="btnTransDistributionFeeSave" onclick="btnTransDistributionFeeSaveOnClick()" value="Save" class="btn btn-primary input-sm pull-right" />

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </section>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>
    <div class="modal fade custom-model custom-form-design" id="modal_CDAddDistribution" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm" style="width: 400px;">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Fee
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px">
                    <section>
                        <div class="row">
                            <div style="max-width: 98%;margin: 0px auto;">
                                <div class="custom-form portlet light">
                                    <div class="portlet-body form">

                                        <div class="form-body-outer" style="padding: 0px;">
                                            <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                                <div class="form-group">
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-bordered table-hover order-column" id="CTfeeListAdd">
                                                            <thead>
                                                                <tr style="background-color: #e8e8e8;font-weight: bold;">
                                                                    <td></td>
                                                                    <td>
                                                                        Fee Name
                                                                    </td>
                                                                    <td>
                                                                        Type
                                                                    </td>
                                                                    <td style="width:50px;">
                                                                        Amount
                                                                    </td>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input type="button" name="btnAddDistributionFeeSave" onclick="btnAddDistributionFeeSaveOnClick()" value="Add" class="btn btn-primary input-sm pull-right" />

                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>

                    </section>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>
    <div class="modal fade custom-model custom-form-design" id="modal_SearchFranchiseeforTransfer" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm" style="width: 400px;">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                        Choose Franchisee
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px">
                    <section>
                        <div class="row">
                            <div style="max-width: 98%;margin: 0px auto;">
                                <div class="custom-form portlet light">
                                    <div class="portlet-body form">
                                        <div class="form-body-outer" style="padding: 0px;">
                                            <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                                <div class="form-group" id="fsearch-box-div">
                                                    <input type="text" id="fsearch-boxI" autocomplete="off" name="name" value="" placeholder="Search Pay To by Number or Name" class="form-control input-sm typeahead" style="padding: 5px;border-radius: 0px;margin: 0px;" />
                                                </div>
                                                <div class="form-group">
                                                    <input type="button" name="btnAddDistributionFeeSave" onclick="btnAddDistributionFeeSaveOnClick()" value="Add" class="btn btn-primary input-sm pull-right" />
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>

                    </section>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade custom-model custom-form-design" id="modal_stopfindersfee" tabindex="-1" role="basic" aria-hidden="true" style="display: none;padding-right: 35px;">
        <div class="modal-dialog" style="width: 1000px;">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                        STOP FINDER'S FEE & TROUBLE TRANSFER FEE
                    </h4>
                </div>
                <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                    <div class="form-body">
                        <div class="form-group" style="margin-right: 0px !important;">
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="col-md-5">
                                        <b>Customer Name: <span id="spnTransCustomerNameTT"></span></b>
                                    </div>
                                    <div class="col-md-3">
                                        <b>Transfer Effective Date: <span id="spnTransEffectiveDate"></span></b>
                                    </div>
                                    <div class="col-md-4 text-right">
                                        <b>Customer No: <span id="spnTransCustomerNoTT"></span></b>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6" style="padding-top: 0px;">
                                        @*<span><b>Bill Month/Year: 11/2017</b></span>*@
                                    </div>
                                    <div class="col-md-6" style="padding-top: 0px;text-align:right;">
                                        <span><b>Trouble Transfer Fee: $<span id="spncancelationFee">0.00</span></b></span>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered table-hover order-column" id="tblstopfindersfee">
                                            <thead>
                                                <tr>

                                                    <td class="text-center"><b>Type</b></td>

                                                    <td class="text-center">Regular Billing</td>

                                                    <td class="text-center"></td>

                                                    <td class="text-center"></td>

                                                    <td class="text-center"></td>

                                                    <td class="text-center"></td>

                                                    <td class="text-center"></td>

                                                </tr>
                                                <tr>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;width: 85px;">Franchisee No</th>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;width: 220px;">Franchisee Name</th>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;width: 130px;">Finders Fee Stop Date</th>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;">Note</th>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;width:100px;">Trouble With Fee</th>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;width:100px;">Trouble Without Fee</th>
                                                    <th class="text-center" style="vertical-align:middle;background: lightgray;width:100px;">Not a Trouble Account</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions" style="padding: 10px;">
                        <div class="col-md-12" style="padding-right: 28px;">
                            <button type="button" id="btnTransferDistributionTransferfeeContinue" onclick="saveCustomerDetailTransferDistribution()" class="btn btn-primary pull-right" style="margin-left: 10px;">Continue</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="hdfFranchiseeDistFeeCount" name="hdfFranchiseeDistFeeCount" value="" />
    <table style="display:none;width:100%" id="tbfranchiseedistributionfeelisthidden">
        <thead><tr><th>T</th></tr></thead>
        <tbody></tbody>
    </table>
    <div class="form-horizontal" id="form_revenuedistribution"></div>
    <div id="modal_transferFinderFeeDIV"></div>
</form>


<!--Schedule Modal-->
<form class="form-horizontal" action="" id="form_service" method="POST">
    <div class="modal fade custom-model custom-form-design" id="modal_CTcustomercontractdetailschedule" tabindex="-1" role="basic" aria-hidden="true" style="display: none;margin-top: 100px;">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" style="border-radius: 8px;">
                <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                    <h4 class="modal-title" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                        Contract Detail Service
                    </h4>
                </div>
                <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                    <section>
                        <div class="row">
                            <div style="max-width: 98%;margin: 0px auto;">
                                <div class="custom-form portlet light " id="form_wizard_1">
                                    <div class="portlet-body form">
                                        <form class="form-horizontal" action="#" id="submit_form" method="POST">
                                            <div class="form-body-outer" style="padding: 0px;">
                                                <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRMonday" class="i-checks editcheck">Monday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRTuesday" class="i-checks editcheck">Tuesday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRWednesday" class="i-checks editcheck">Wednesday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRThursday" class="i-checks editcheck">Thursday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRFriday" class="i-checks editcheck">Friday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRSaturday" class="i-checks editcheck">Saturday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                                <input type="checkbox" id="TRSunday" class="i-checks editcheck">Sunday
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- /.modal-content -->
            </div>
        </div>
    </div>



    
    


</form>



<script>
    var lstContractDetailServiceTypeList = [];
    var lineNo = 0;
    var flineNo = 0;
    var _yearList = [];

    var app = {};
    $(document).ready(function () {

        $('#spnTransEffectiveDateR').html($('#trans_ddlTransferEffectiveDate').val())
        $('#spnTransEffectiveDate').html($('#trans_ddlTransferEffectiveDate').val())
        _yearList = JSON.parse('@Html.Raw(Json.Encode(ViewBag.YearList))');

    });

    $('#trans_ddlTransferEffectiveDate').change(function () {
        $('#spnTransEffectiveDateR').html($(this).val())
        $('#spnTransEffectiveDate').html($(this).val())
    })

    function deleteFrenchiseeInner(linenumber, flineNo) {

        $("tr[id=row_" + linenumber + "]").remove();
    }

    function bindfranchiseedetail(linenumber, franchiseeid, franchiseename, ln) {
        flineNo++;

        FDistributionFinal.push({ FranchiseeId: franchiseeid, })
        //var txtmarkup = parseFloat($('#txtmarkup' + linenumber).val() == '' ? 0 : $('#txtmarkup' + linenumber).val())
        var txtqty = parseFloat($('#txtqty' + linenumber).val() == '' ? 0 : $('#txtqty' + linenumber).val())
        var txtunitprice = parseFloat($('#txtunitprice' + linenumber).inputmask('unmaskedvalue') == '' ? 0 : $('#txtunitprice' + linenumber).inputmask('unmaskedvalue'))
        var txttotal = (txtqty * txtunitprice)

        var lineTotalAmount = 0;
        $('input[relLinea="' + linenumber + '"]').each(function (el) {
            lineTotalAmount += parseFloat(this.defaultValue);
        });

        if (lineTotalAmount + txttotal > txttotal) {
            if (lineTotalAmount < txttotal) {
                txttotal = txttotal - lineTotalAmount;
            }
            else {
                txttotal = 0;
            }
        }

        var someString = franchiseename;
        var index = someString.indexOf(" ");  // Gets the first index where a space occours
        var FranchiseeNo = someString.substr(0, index); // Gets the first part
        var franchiseename = someString.substr(index + 1);

        CTAppendDistribution(ln, franchiseeid, FranchiseeNo, franchiseename, txttotal, linenumber, 0);

        setTimeout(function () {
            $("#hdfFrenchiseeId").val(0);
            document.getElementById('ddldetaillinenumber').selectedIndex = 0;
            $('#fsearch-boxI').val('');
        }, 500);

    }



    function viewDestribution() {
        $("#modal_view").modal({ backdrop: 'static' });
    }

    function ValidatefrenchiseeData() {
        var isNotValidForm = true;


        if ($('input[relcdamt="cd_relcdamt"]').length > 0) {
            var cdlinenumber = 0;
            var cdamount = 0;
            var fbamount = 0;
            $('input[relcdamt="cd_relcdamt"]').each(function (index, value) {
                cdamount = $(this).val();
                cdlinenumber = $(this)[index].id.toString().replace('cd_relcdamt', '');
                fbamount = 0.00;
                $('input[relfbamt="fb_amt' + cdlinenumber + '"]').each(function (index1, value1) {
                    fbamount += parseFloat($(this).val());
                    if (parseFloat(this.value) == 0) {
                        this.style.border = "1px solid red";
                        isNotValidForm = false;
                    }
                    else
                        this.style.border = "1px solid #c2cad8";
                });
                var isNotValid = true;
                if (fbamount != parseFloat(cdamount)) {
                    isNotValid = false;
                    //alert('Please enter distribution amount equals contract detail amount!');

                }

                $('input[relfbamt="fb_amt' + cdlinenumber + '"]').each(function (index1, value1) {
                    if (!isNotValid || parseFloat(this.value) == 0) {
                        this.style.border = "1px solid red";
                        isNotValidForm = false;
                        isNotValid = false;
                    }
                    else
                        this.style.border = "1px solid #c2cad8";
                });

            });
            return isNotValidForm;
        }
        return false;
    }




    var DistributionfeeList = [];
    var DistributionfeeListFinal = [];

    function TransferDistributionfee(fid, ContractDetailId, DistributionId, ln, isReadonly) {
        $('#hdfCTDestributionFee_FranchiseeId').val(fid);
        $('#hdfCTDestributionFee_ContractDetailId').val(ContractDetailId);
        $('#hdfCTDestributionFee_DestributionId').val(DistributionId);
        $('#hdfCTDestributionFee_Linenumber').val($('#fdt_ddldetaillinenumber' + ln).val());

        var new_arr = $.grep(DistributionfeeListFinal, function (n, i) { return (n.ContractDetailId == ContractDetailId && n.FranchiseeId == fid) });
        if (new_arr.length > 0) {
            DistributionfeeBindData(new_arr);
            DistributionfeeList = new_arr;
            if (isReadonly == 1) {
                $('#btnTransDistributionFeeSave').hide();
                $('#btnTransDistributionFeeAddLink').hide();

            }
            else {
                $('#btnTransDistributionFeeSave').show();
                $('#btnTransDistributionFeeAddLink').show();
            }


            $("#modal_CTDistribution").modal({ backdrop: 'static' });
        }
        else {
            var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + fid + '&ContractDetailId=' + ContractDetailId + '&DistributionId=' + DistributionId;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#CTfeelist>tbody').html('');
                    DistributionfeeList = data;
                    DistributionfeeBindData(DistributionfeeList);

                    if (DistributionfeeList.ContractDetailId != undefined) {
                        DistributionfeeList.push({
                            DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                            FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                        });
                    }

                    if (isReadonly == 1) {
                        $('#btnTransDistributionFeeSave').hide();
                        $('#btnTransDistributionFeeAddLink').hide();

                    }
                    else {
                        $('#btnTransDistributionFeeSave').show();
                        $('#btnTransDistributionFeeAddLink').show();
                    }


                    $("#modal_CTDistribution").modal({ backdrop: 'static' });

                }
            });
        }
    }
    function SortByName(a, b) {

        var aName = a.Amount;
        var bName = b.Amount;
        return ((aName > bName) ? -1 : ((aName < bName) ? 1 : 0));

    }
    function DistributionfeeBindData(DistributionfeeList) {
        var _DistributionfeeList = DistributionfeeList.sort(SortByName);
        $('#CTfeelist>tbody').html('');
        $.each(_DistributionfeeList, function (index, value) {

            tempRow = "";
            tempRow += '<tr relDistributionFeeId="' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId + '">';
            tempRow += '<td style="vertical-align: middle;">' + value.FeeName + '</td>';
            tempRow += '<td style="vertical-align: middle;">' + value.FeeRateTypeName + '</td>';
            tempRow += '<td><input type="text" id="DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId + '" class="form-control input-sm pp" value="' + value.Amount + '" /></td>';
            tempRow += '</tr>';
            $('#CTfeelist>tbody').append(tempRow);

            $('#DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId).change(function () {
                var new_arr = $.grep(DistributionfeeList, function (n, i) { return (n.FranchiseeId == value.FranchiseeId && n.ContractDetailId == value.ContractDetailId && n.FeeId == value.FeeId); });
                if (new_arr.length > 0) {
                    var amt = parseFloat($(this).val());
                    new_arr[0].Amount = amt;
                }
            });
        });
    }


    var FDistributionFinal = [];

    var tempRowDistribution = "";
    var tempRowLineNo = 0;
    var tempFRowLineNo = 0;
    var Translineitems = [];
    function CFranchiseeDistributionData(id) {
        var sURL = '@Url.Action("GetCustomerFranchiseeDistributionData", "Customer", new { area = "Portal" })?Id=' + id;
        $.ajax({
            type: "GET",
            url: sURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {

                $('#hdftransfer_customerid').val(data.CustomerId);
                $('#spnTransCustomerName').html(data.CustomerName);
                $('#spnTransCustomerNo').html(data.CustomerNo);
                $('#spnTransCustomerNameTT').html(data.CustomerName);
                $('#spnTransCustomerNoTT').html(data.CustomerNo);
                $('#tblTransFranchiseeDistributionList>tbody').html('');
                tempRow = "";
                tempRow += '<tr><td style="width:100px;text-align:center;">' + data.PONumber + '</td>';
                tempRow += '<td style="text-align:center;width:140px;">' + data.AccountTypeName + '</td>';
                tempRow += '<td style="text-align:center;width:30px;">' + data.Term + '</td>';
                tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDate(data.StartDate) + '</td>';
                tempRow += '<td style="text-align:center;width:50px;">' + formatJSONDate(data.ExpirationDate) + '</td>';
                tempRow += '<td style="text-align:right;width:30px;">$ <span id="contractAmountCT">' + formatMoney(data.TotalAmount) + '</span></td>';
                tempRow += '<td style="text-align:center;width:30px;">' + data.Status + '</td>';

                tempRow += '<tr><td colspan="7" style="padding:5px;"><div class="table-responsive">';
                tempRow += '<table class="table table-striped table-bordered table-hover order-column" id="TransFranchiseeDistributionDetailList">';
                tempRow += '<thead>';
                tempRow += '<tr><th style="width:150px;text-align:center;">Contract Detail Line</th>';
                tempRow += '<th style="text-align:center;"> Service Description</th>';
                tempRow += '<th style="width:120px;text-align:center;">Amount</th>';
                tempRow += '<th style="width:100px;text-align:center;">Frequency</th>';
                tempRow += '<th style="width:50px;text-align:center;">Schedule</th>';
                tempRow += '</tr></thead><tbody></tbody></table></div></td></tr>';


                $('#tblTransFranchiseeDistributionList>tbody').append(tempRow);
                $('#ddldetaillinenumber').html('');
                Translineitems.push("<option value='0'>Select</option>");

                $.each(data.listContractDetail, function (index, value) {
                    tempRowLineNo = value.LineNumber;
                    tempRowDistribution = "";
                    tempRowDistribution += '<tr>'
                    tempRowDistribution += '<td style="text-align:center;">'
                    tempRowDistribution += '<input type="hidden" relcdamt="cd_relcdamt" id="cd_relcdamt' + tempRowLineNo + '" value="' + value.Amount + '" />'
                    tempRowDistribution += '<input type="hidden" id="tcd_contractdetailId' + tempRowLineNo + '" value="' + value.Amount + '" />'
                    tempRowDistribution += value.LineNumber + '</td>';
                    tempRowDistribution += '<td style="text-align:center;">' + value.ServiceTypeName + '</td>';
                    tempRowDistribution += '<td style="text-align:right;"><input type="text" id="tcd_contractdetailId_amount' + tempRowLineNo + '" value="' + value.Amount + '" class="form-control input-sm editvalue" style="text-align:right;" readonly="readonly"/></td>';
                    tempRowDistribution += '<td style="text-align:center;">' + value.CleanFrequencyName + '</td>';
                    tempRowDistribution += '<td style="text-align:center;"><a href="javascript:void(0);" onclick="showContractDetailSchedule(' + value.Mon + ',' + value.Tues + ',' + value.Wed + ',' + value.Thur + ',' + value.Fri + ',' + value.Sat + ',' + value.Sun + ')">View</a></td>'
                    tempRowDistribution += '</tr>'

                    $('#TransFranchiseeDistributionDetailList>tbody').append(tempRowDistribution);
                    applyMaskCurrency('#tcd_contractdetailId_amount' + tempRowLineNo);
                    Translineitems.push("<option value=" + value.ContractDetailId + ">" + value.LineNumber + "</option>");
                });

                $('#frTransdestributionTable>tbody').html('');
                var flineNo = 0;
                $.each(data.listFranchiseeDistribution, function (index, value) {
                    CTAppendDistribution(value.DetailLineNumber, value.FranchiseeId, value.FranchiseeNo, value.FranchiseeName, value.Amount, value.ContractDetailId, value.DistributionId, true);
                });

                $('#ddldetaillinenumber').html(Translineitems.join(' '));

                $("#hdftransfercontractdetail_linecount").val(tempRowLineNo);
                $("#hdftransferfrenchiseedetail_linecount").val(tempFRowLineNo);



                $("#modal_CustomerTransferFranchiseeDistribution").modal({ backdrop: 'static' });
            },
            error: function (err) {
                console.log(err);
            }
        });
    }

    function TransFranchiseeserviceAddDestribution() {

        $.ajax({
            url: '@Url.Action("GetFeeData", "Customer","Portal")',
            success: function (res) {
                console.log(res);
                FeeDataForDistribution = res;
                var tempRow = "";
                $('#CTfeeListAdd tbody').html('');
                $.each(res, function (index, value) {
                    tempRow = "";
                    tempRow += '<tr>';
                    tempRow += '    <td><input type="checkbox" rel="feeid_distribution" value="' + value.FeeId + '" /></td>';
                    tempRow += '    <td>' + value.FeeName + '</td>';
                    tempRow += '    <td>' + value.FeeRateTypeName + '</td>';
                    tempRow += '    <td style="text-align: right;">' + (value.FeeRateTypeListId == 1 ? (value.Amount + '%') : ('$ ' + value.Amount)) + '</td>';
                    tempRow += '</tr>';
                    $('#CTfeeListAdd tbody').append(tempRow);
                });

                $("#modal_CDAddDistribution").modal({ backdrop: 'static' });
            },
            error: function () { }
        });
    }
    function btnAddDistributionFeeSaveOnClick() {

        $('input[rel="feeid_distribution"]').each(function (item) {
            if ($(this).is(":checked")) {

                var _FeeId = $(this).val();
                var new_arr = $.grep(FeeDataForDistribution, function (n, i) { return n.FeeId == _FeeId; })[0];

                var new_arrF = $.grep(DistributionfeeListFinal, function (n, i) {
                    return (n.ContractDetailId == $('#hdfCTDestributionFee_ContractDetailId').val() && n.FranchiseeId == $('#hdfCTDestributionFee_FranchiseeId').val()
                        && n.FeeId == _FeeId);
                });
                if (new_arrF.length == 0) {

                    DistributionfeeList.push({
                        DistributionFeesId: 0,
                        DistributionId: $('#hdfCTDestributionFee_DestributionId').val(),
                        CustomerId: $('#lblCustomerID').val(),
                        ContractDetailId: $('#hdfCTDestributionFee_ContractDetailId').val(),
                        FranchiseeId: $('#hdfCTDestributionFee_FranchiseeId').val(),
                        DetailLineNumber: $('#hdfCTDestributionFee_Linenumber').val(),
                        FeeId: _FeeId,
                        FeeName: new_arr.FeeName,
                        FeeRateTypeListId: new_arr.FeeRateTypeListId,
                        FeeRateTypeName: new_arr.FeeRateTypeName,
                        Amount: new_arr.Amount
                    });
                }

            }
        });
        DistributionfeeBindData(DistributionfeeList);

        $("#modal_CDAddDistribution").modal('hide');

    }
    function btnTransDistributionFeeSaveOnClick() {
        $.each(DistributionfeeList, function (index, value) {
            var new_arr = $.grep(DistributionfeeListFinal, function (n, i) { return (n.ContractDetailId == value.ContractDetailId && n.FranchiseeId == value.FranchiseeId && n.FeeId == value.FeeId); });
            if (new_arr.length > 0) {
                var amt = parseFloat($('#DistributionFeeAmount_' + value.FranchiseeId + '_' + value.ContractDetailId + '_' + value.FeeId).val());
                new_arr[0].Amount = amt;
            }
            else {
                DistributionfeeListFinal.push(value);
            }
            for (var i = 1; i <= parseInt($("#hdftransfercontractdetail_linecount").val()) ; i++) {
                var new_arr1 = $.grep(DistributionfeeList, function (n, i) { return (n.ContractDetailId == parseInt($("#fdt_hdfcontractdetailid" + i).val()) && n.FranchiseeId == parseInt($("#fdt_hdfFrenchiseeId" + i).val())); });
                if (new_arr1.length > 0)
                    $("#fdt_lnkAppendDistributionFee" + i).text('View/Edit');

            }


        });
        DistributionfeeList = [];
        $("#modal_CTDistribution").modal('hide');
    }

    var lnFranchiseeDistribution = 0;
    function CTAppendDistribution(ln, fid, fnumber, fname, amt, contractdetailid, distributionid, isTrans) {

        lnFranchiseeDistribution++;
        var tempRow = '';
        tempRow = tempRow + '<tr id=row_' + lnFranchiseeDistribution + '>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="hidden" relLine="' + lnFranchiseeDistribution + '" id="fdt_hdfdistributionid' + lnFranchiseeDistribution + '" name="fdt_hdfdistributionid' + lnFranchiseeDistribution + '" value="' + distributionid + '" />'
        tempRow = tempRow + '   <input type="hidden" relLine="' + lnFranchiseeDistribution + '" id="fdt_hdfcontractdetailid' + lnFranchiseeDistribution + '" name="fdt_hdfcontractdetailid' + lnFranchiseeDistribution + '" value="' + contractdetailid + '" />'
        tempRow = tempRow + '   <input type="hidden" relLine="' + lnFranchiseeDistribution + '" id="fdt_hdfFrenchiseeId' + lnFranchiseeDistribution + '" name="fdt_hdfFrenchiseeId' + lnFranchiseeDistribution + '" value="' + fid + '" />'
        tempRow = tempRow + '   <input relLine="' + lnFranchiseeDistribution + '" type="hidden" id="hdfFrenchiseeId' + lnFranchiseeDistribution + '" name="hdfFrenchiseeId' + lnFranchiseeDistribution + '" value="' + fid + '" />'

        if (distributionid > 0)
            tempRow = tempRow + '   <input type="text"   relLine="' + lnFranchiseeDistribution + '" id="fdt_txtlinenumber' + lnFranchiseeDistribution + '" name="fdt_txtlinenumber' + lnFranchiseeDistribution + '" required readonly value="' + ln + '" class="form-control input-sm cnumeric" style="text-align:center;padding: 5px;border-radius: 0px;" />'
        else
            tempRow = tempRow + '   <select relLine="' + lnFranchiseeDistribution + '"  relddldetaillinenum="fdt_ddldetaillinenumber" class="form-control input-sm" style="border-radius: 0px;" id="fdt_ddldetaillinenumber' + lnFranchiseeDistribution + '" name="fdt_ddldetaillinenumber' + lnFranchiseeDistribution + '"></select>';

        tempRow = tempRow + '</td>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="text" relLine="' + lnFranchiseeDistribution + '" id="fdt_txtfranchiseeno' + lnFranchiseeDistribution + '" name="fdt_txtfranchiseeno' + lnFranchiseeDistribution + '" required readonly   value="' + $.trim(fnumber) + '" class="form-control input-sm cnumeric" style="text-align:center;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="text" relLine="' + lnFranchiseeDistribution + '" id="fdt_txtfranchiseename' + lnFranchiseeDistribution + '" name="fdt_txtfranchiseename' + lnFranchiseeDistribution + '" required readonly  value="' + $.trim(fname) + '" class="form-control input-sm cnumeric" style="text-align:center;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>'
        tempRow = tempRow + '<td>'
        tempRow = tempRow + '   <input type="text" relfbamt="fb_amt' + lnFranchiseeDistribution + '" relLine="' + lnFranchiseeDistribution + '" id="fdt_txtfranchiseeamount' + lnFranchiseeDistribution + '" name="fdt_txtfranchiseeamount' + lnFranchiseeDistribution + '" required ' + (distributionid > 0 ? 'readonly' : '') + ' value="' + amt + '" class="form-control input-sm cnumeric" style="text-align:right;padding: 5px;border-radius: 0px;" />'
        tempRow = tempRow + '</td>';
        tempRow = tempRow + '<td style="padding: 9px!important;text-align:center;" id="trans_dfeeLink' + lnFranchiseeDistribution + '">'
        if (distributionid > 0)
            tempRow = tempRow + '   <a href="javascript:void(0);" id="fdt_lnkAppendDistributionFee' + lnFranchiseeDistribution + '" onclick="TransferDistributionfee(' + fid + ',' + $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val() + ',' + distributionid + ',' + lnFranchiseeDistribution + ')">View/Edit</a>'
        else
            tempRow = tempRow + '   <a href="javascript:void(0);" id="fdt_lnkAppendDistributionFee' + lnFranchiseeDistribution + '" onclick="TransferDistributionfee(' + fid + ',' + $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val() + ',' + distributionid + ',' + lnFranchiseeDistribution + ')">Add</a>'
        tempRow = tempRow + '</td>';
        tempRow = tempRow + '<td style="padding: 6px!important;text-align:center;" id="trans_dfeeLinkdelete' + lnFranchiseeDistribution + '">'
        if (isTrans != true) {
            tempRow = tempRow + '   <a style="font-size: 16px;padding: 3px;color: mediumvioletred;" onclick="deleteFrenchiseeInner(' + lnFranchiseeDistribution + ',\'' + fnumber + '\')" href="javascript:void();"><i class="fa fa-trash" aria-hidden="true"></i></a>'
        }
        tempRow = tempRow + '</td>';
        tempRow = tempRow + '<td>'
        if (isTrans == true) {
            tempRow = tempRow + '<button type="button" id="btnTransferAppendDistributionTrans' + lnFranchiseeDistribution + '" class="btn btn-primary" style="margin-left: 10px;" onclick="TransferAppendDistribution(' + ln + ',' + fid + ',' + fnumber + ',\'' + remove_quotes(fname) + '\',' + amt + ')">Transfer</button>'
        }
        tempRow = tempRow + '</td></tr>';

        $('#frTransdestributionTable tbody').append(tempRow);
        $('#hdftransferfrenchiseedetail_linecount').val(lnFranchiseeDistribution);


        applyMaskCurrency('#fdt_txtfranchiseeamount' + lnFranchiseeDistribution);
        if (ln > 0) {
            if (distributionid > 0)
                $('#trans_dfeeLink' + lnFranchiseeDistribution).html('<a href="javascript:void(0);" id="fdt_lnkAppendDistributionFee' + lnFranchiseeDistribution + '" onclick="TransferDistributionfee(' + fid + ',' + $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val() + ',' + distributionid + ',' + lnFranchiseeDistribution + ')">View/Edit</a>');
            else
                $('#trans_dfeeLink' + lnFranchiseeDistribution).html('<a href="javascript:void(0);" id="fdt_lnkAppendDistributionFee' + lnFranchiseeDistribution + '" onclick="TransferDistributionfee(' + fid + ',' + $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val() + ',' + distributionid + ',' + lnFranchiseeDistribution + ')">Add</a>');

        } else {
            $('#trans_dfeeLink' + lnFranchiseeDistribution).html('');
        }

        //var lineitems = []; lineitems.push("<option>Select</option>");
        //for (var i = 1; i <= tempRowLineNo; i++) { lineitems.push("<option " + (ln == i ? "Selected" : "") + " value=" + i + ">" + i + "</option>"); }

        $('#fdt_ddldetaillinenumber' + lnFranchiseeDistribution).html('');
        $('#fdt_ddldetaillinenumber' + lnFranchiseeDistribution).html(Translineitems.join(' '));
        $('#fdt_ddldetaillinenumber' + lnFranchiseeDistribution).val(contractdetailid);

        $('#fdt_ddldetaillinenumber' + lnFranchiseeDistribution).change(function () {
            if ($(this).val() != 'Select' && $(this).val() != '0') {
                $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val($(this).val());
                if (distributionid > 0)
                    $('#trans_dfeeLink' + lnFranchiseeDistribution).html('<a href="javascript:void(0);" id="fdt_lnkAppendDistributionFee' + lnFranchiseeDistribution + '" onclick="TransferDistributionfee(' + fid + ',' + $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val() + ',' + distributionid + ',' + lnFranchiseeDistribution + ')">View/Edit</a>');
                else {
                    $('#trans_dfeeLink' + lnFranchiseeDistribution).html('<a href="javascript:void(0);" id="fdt_lnkAppendDistributionFee' + lnFranchiseeDistribution + '" onclick="TransferDistributionfee(' + fid + ',' + $('#fdt_hdfcontractdetailid' + lnFranchiseeDistribution).val() + ',' + 0 + ',' + lnFranchiseeDistribution + ')">View/Edit</a>');
                }

            }
            else {
                $('#trans_dfeeLink' + lnFranchiseeDistribution).html('');
            }
        });

        var lenCount = $('select[relddldetaillinenum="fdt_ddldetaillinenumber"]').length;
        if (lenCount > 1) {

            for (var i = 1; i <= lenCount; i++) {
                $('#fdt_txtfranchiseeamount' + i).val(0);
            }
        }
    }

    function remove_quotes(values1) {
        var values = values1.toString();
        var str = "";
        var blockList = ['"', '\'', '\\']; // This is the list of key words to be escaped
        var flag = 0;
        for (var i = 0; i < values.length; i++) {
            for (var j = 0; j < blockList.length; j++) {
                if (values[i] == blockList[j]) {
                    flag = 1;
                    break;
                }
            }
            if (flag == 0)
                str += values[i];
            else {
                str += '\\';
                str += values[i];
                flag = 0;
            }
        }
        return str;

    }
    function btnInvoicePopupClose(invId) {
        $("#modal_partialrevenueinvoicedetail_" + invId).modal('hide');
    }

    function TransferValidateStepFirst() {

        var retVal = true;
        if ($('#trans_ddlTransferStatus').val() == '0' || $('#trans_ddlTransferStatus').val() == '') {
            $('#trans_ddlTransferStatus').addClass("has-error");
            retVal = false;
        }
        else {
            $('#trans_ddlTransferStatus').removeClass("has-error");
        }

        if ($('#trans_ddlTransferReason').val() == '0' || $('#trans_ddlTransferReason').val() == '') {
            $('#trans_ddlTransferReason').addClass("has-error");
            retVal = false;
        }
        else {
            $('#trans_ddlTransferReason').removeClass("has-error");
        }


        if ($('#trans_ddlTransferEffectiveDate').val().trim() == '') {
            $('#trans_ddlTransferEffectiveDate').addClass("has-error");
            retVal = false;
        } else {
            $('#trans_ddlTransferEffectiveDate').removeClass("has-error");
        }


        return retVal;
    }

    function TransferValidateStepSecond() {

        var retVal = true;
        $.each(lstDistributionFranchiseeList, function (index, value) {

          if ($('#trans_ddlTransferDistributionFranchiseeStopDate' + index).val() == '')
          {
                $('#trans_ddlTransferDistributionFranchiseeStopDate' + index).addClass("has-error");
                retVal = false;
          }
          else if (isValidDate($('#trans_ddlTransferDistributionFranchiseeStopDate' + index).val()) === false) {
                $('#trans_ddlTransferDistributionFranchiseeStopDate' + index).addClass("has-error");
                retVal = false;
          }
          else {
                $('#trans_ddlTransferDistributionFranchiseeStopDate' + index).removeClass("has-error");
          }

            //if ($('#trans_ddlTransferDistributionFranchiseeNote' + index).val() == '') {
            //    $('#trans_ddlTransferDistributionFranchiseeNote' + index).addClass("has-error");
            //    retVal = false;
            //}
            //else {
            //    $('#trans_ddlTransferDistributionFranchiseeNote' + index).removeClass("has-error");
            //}
        });
        return retVal;
    }

    function TransferAppendDistribution(ln, fid, fnumber, fname, amt, isBlack) {
        if (!TransferValidateStepFirst()) {
            return;
        }

        $("#modal_SearchFranchiseeforTransfer").modal({ backdrop: 'static' });


        var _contDet = $("#fdt_hdfcontractdetailid" + ln).val();
        lstDistributionFranchiseeList.push({ LineNo: ln, FranchiseeId: fid, FranchiseeNumber: fnumber, FranchiseeName: fname, Amount: amt, ContractDetailId: _contDet });

        $("#fsearch-boxI").autocomplete({
            source: typeaheadSourceF,
            appendTo: $("#fsearch-box-div"),
            select: function (event, ui) {
                event.preventDefault();

                var vFid = ui.item.value;
                var vFnumber = ui.item.label.split(' ')[0].trim();
                var vFname = ui.item.label.replace(ui.item.label.split(' ')[0], "").trim();

                if (isBlack != true) {
                    $("#fdt_txtfranchiseeamount" + ln).val("$0.00");
                    $("#fdt_txtfranchiseeamount" + ln).prop("readonly", true);
                    $("#btnTransferAppendDistributionTrans" + ln).hide();
                }

                var FraExists = false;
                for (var ik = 0; ik <= lnFranchiseeDistribution; ik++) {
                    if (parseInt($('#fdt_hdfFrenchiseeId' + ik).val()) == vFid)
                        FraExists = true;
                }

                if (!FraExists) {
                    var _contDet = $("#fdt_hdfcontractdetailid" + ln).val();
                    CTAppendDistribution(ln, vFid, vFnumber, vFname, amt, _contDet, 0);
                    var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + vFid + '&ContractDetailId=' + _contDet + '&DistributionId=' + 0;
                    $.ajax({
                        type: "GET",
                        url: sURL,
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (data) {
                            $('#CTfeelist>tbody').html('');
                            DistributionfeeList = data;
                            DistributionfeeBindData(DistributionfeeList);

                            if (DistributionfeeList.ContractDetailId != undefined) {
                                DistributionfeeList.push({
                                    DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                                    FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                                });
                            }

                            $.each(DistributionfeeList, function (index, value) {
                                DistributionfeeListFinal.push(value);
                                for (var i = 1; i <= parseInt($("#hdftransferfrenchiseedetail_linecount").val()); i++) {
                                    var new_arr1 = $.grep(DistributionfeeList, function (n, i) { return (n.ContractDetailId == parseInt($("#fdt_hdfcontractdetailid" + i).val()) && n.FranchiseeId == parseInt($("#fdt_hdfFrenchiseeId" + i).val())); });
                                    if (new_arr1.length > 0)
                                        $("#fdt_lnkAppendDistributionFee" + i).text('View/Edit');
                                }
                            });
                            DistributionfeeList = [];
                        }
                    });
                    //$("#trans_dfeeLink" + ln).html('');
                    $("#trans_dfeeLinkdelete" + ln).html('');

                    $("#fsearch-boxI").val('');
                    $("#btnTransferAppendDistributionTransNew").show();
                    $("#btnTransferDistributionContinue").show();
                    $("#modal_SearchFranchiseeforTransfer").modal('hide');

                }
                else {
                    //$("#fsearch-boxI").val('');
                    //swal('Oops...!', 'Franchisee already selected, Please selecet another Franchisee', 'info');
                    alert('Franchisee already selected, Please selecet another Franchisee')
                }
            }

        });
    }

    function showAddTransferAppendDistribution() {
        $("#modal_SearchFranchiseeforTransfer").modal({ backdrop: 'static' });
        $("#fsearch-boxI").autocomplete({
            source: typeaheadSourceF,
            appendTo: $("#fsearch-box-div"),
            select: function (event, ui) {
                event.preventDefault();

                var vFid = ui.item.value;
                var vFnumber = ui.item.label.split(' ')[0].trim();
                var vFname = ui.item.label.replace(ui.item.label.split(' ')[0], "").trim();

                var FraExists = false;
                for (var ik = 0; ik <= lnFranchiseeDistribution; ik++) {
                    if (parseInt($('#fdt_hdfFrenchiseeId' + ik).val()) == vFid)
                        FraExists = true;
                }

                if (!FraExists) {
                    if (parseInt($('#hdftransfercontractdetail_linecount').val()) == 1) {
                        CTAppendDistribution(1, vFid, vFnumber, vFname, $('#tcd_contractdetailId_amount' + 1).val(), $("#fdt_hdfcontractdetailid" + 1).val(), 0);
                        //CTAppendDistribution(1, vFid, vFnumber, vFname, $('#tcd_contractdetailId_amount' + 1).val(), $("#fdt_hdfcontractdetailid" + 1).val(), 0);

                        var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + vFid + '&ContractDetailId=' + $("#fdt_hdfcontractdetailid" + 1).val() + '&DistributionId=' + 0;
                        $.ajax({
                            type: "GET",
                            url: sURL,
                            contentType: "application/json; charset=utf-8",
                            datatype: "json",
                            success: function (data) {
                                $('#CTfeelist>tbody').html('');
                                DistributionfeeList = data;
                                DistributionfeeBindData(DistributionfeeList);

                                if (DistributionfeeList.ContractDetailId != undefined) {
                                    DistributionfeeList.push({
                                        DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                                        FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                                    });
                                }

                                $.each(DistributionfeeList, function (index, value) {
                                    DistributionfeeListFinal.push(value);
                                    for (var i = 1; i <= parseInt($("#hdftransferfrenchiseedetail_linecount").val()); i++) {
                                        var new_arr1 = $.grep(DistributionfeeList, function (n, i) { return (n.ContractDetailId == parseInt($("#fdt_hdfcontractdetailid" + i).val()) && n.FranchiseeId == parseInt($("#fdt_hdfFrenchiseeId" + i).val())); });
                                        if (new_arr1.length > 0)
                                            $("#fdt_lnkAppendDistributionFee" + i).text('View/Edit');
                                    }
                                });
                                DistributionfeeList = [];
                            }
                        });
                    }
                    else {
                        CTAppendDistribution(0, vFid, vFnumber, vFname, 00, 0, 0);
                    }

                    $("#fsearch-boxI").val('');
                    $("#modal_SearchFranchiseeforTransfer").modal('hide');
                }
            }
        });
    }
    @*function showAddTransferAppendDistribution() {
        $("#modal_SearchFranchiseeforTransfer").modal({ backdrop: 'static' });
        $("#fsearch-boxI").autocomplete({
            source: typeaheadSourceF,
            appendTo: $("#fsearch-box-div"),
            select: function (event, ui) {
                event.preventDefault();

                var vFid = ui.item.value;
                var vFnumber = ui.item.label.split(' ')[0].trim();
                var vFname = ui.item.label.replace(ui.item.label.split(' ')[0], "").trim();


                var FraExists = false;
                for (var ik = 0; ik <= lnFranchiseeDistribution; ik++) {
                    if (parseInt($('#fdt_hdfFrenchiseeId' + ik).val()) == vFid)
                        FraExists = true;
                }
                if (!FraExists) {

                    if (parseInt($('#hdftransferfrenchiseedetail_linecount').val()) == 1) {
                        CTAppendDistribution(1, vFid, vFnumber, vFname, $('#tcd_contractdetailId_amount').val(),$("#fdt_hdfcontractdetailid" + 1).val(), 0);
                    }
                    var sURL = '@Url.Action("FranchiseeDistributionFeeData", "Customer", new { area = "Portal" })?FranchiseeId=' + vFid + '&ContractDetailId=' + $("#fdt_hdfcontractdetailid" + 1).val() + '&DistributionId=' + 0;
                    $.ajax({
                        type: "GET",
                        url: sURL,
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        success: function (data) {
                            $('#CTfeelist>tbody').html('');
                            DistributionfeeList = data;
                            DistributionfeeBindData(DistributionfeeList);

                            if (DistributionfeeList.ContractDetailId != undefined) {
                                DistributionfeeList.push({
                                    DistributionFeesId: DistributionfeeList.DistributionFeesId, DistributionId: DistributionfeeList.DistributionId, CustomerId: $('#hdftransfer_customerid').val(), ContractDetailId: DistributionfeeList.ContractDetailId,
                                    FranchiseeId: DistributionfeeList.FranchiseeId, DetailLineNumber: DistributionfeeList.DetailLineNumber, FeeId: DistributionfeeList.FeeId, Amount: DistributionfeeList.Amount
                                });
                            }

                            $.each(DistributionfeeList, function (index, value) {
                                DistributionfeeListFinal.push(value);
                                for (var i = 1; i <= parseInt($("#hdftransferfrenchiseedetail_linecount").val()); i++) {
                                    var new_arr1 = $.grep(DistributionfeeList, function (n, i) { return (n.ContractDetailId == parseInt($("#fdt_hdfcontractdetailid" + i).val()) && n.FranchiseeId == parseInt($("#fdt_hdfFrenchiseeId" + i).val())); });
                                    if (new_arr1.length > 0)
                                        $("#fdt_lnkAppendDistributionFee" + i).text('View/Edit');
                                }
                            });
                            DistributionfeeList = [];
                        }
                    });

                    $("#fsearch-boxI").val('');
                    $("#btnTransferAppendDistributionTransNew").show();
                    $("#btnTransferDistributionContinue").show();
                    $("#modal_SearchFranchiseeforTransfer").modal('hide');
                    $("#fsearch-boxI").val('');
                    $("#modal_SearchFranchiseeforTransfer").modal('hide');
                }
                else {
                    //$("#fsearch-boxI").val('');
                    alert('Franchisee already selected, Please selecet another Franchisee')
                }

            }
        });
    }*@

    function TransferValidateStepContinue() {

        var retVal = true;
        var conAmount = parseFloat(UnformatMoney($('#contractAmountCT').html()));
        var conDAAmount = 0;
        for (var i = 1; i <= lnFranchiseeDistribution; i++) {
            var cdAmt = parseFloat($('#fdt_txtfranchiseeamount' + i).val());
            conDAAmount = conDAAmount + cdAmt;

        }
        if (conDAAmount != conAmount) {
            retVal = false;
            alert("Total Distribution must be same as Contract Amount.")
        }

        return retVal;
    }
    var lstDistributionFranchiseeList = [];
    function showStopfindersfee() {

        if (!TransferValidateStepContinue()) {
            return;
        }


        $("#tblstopfindersfee>tbody").html('');
        $.each(lstDistributionFranchiseeList, function (index, value) {
            trRow = "";
            trRow += '<tr>';
            trRow += '    <td class="text-center">' + value.FranchiseeNumber;
            trRow += '      <input type="hidden" relTRFR="' + value.FranchiseeId + '" id="trans_txtTransferDistributionContractDetailId' + index + '" name="trans_txtTransferDistributionContractDetailId' + index + '" value="' + value.ContractDetailId + '" />'
            trRow += '      <input type="hidden" relTRFR="' + value.FranchiseeId + '" id="trans_txtTransferDistributionFranchiseeId' + index + '" name="trans_txtTransferDistributionFranchiseeId' + index + '" value="' + value.FranchiseeId + '" />'
            trRow += '    </td>';
            trRow += '    <td class="text-center">' + value.FranchiseeName + '</td>';
            trRow += '    <td class="text-center">';
            trRow += '    <input style="display:none;" type="text" relTRFR="' + value.FranchiseeId + '" id="trans_ddlTransferDistributionFranchiseeStopDate' + index + '" name="trans_ddlTransferDistributionFranchiseeStopDate' + index + '" class="form-control input-sm date-picker" />';

            trRow += '    <select style="width:45px;padding:3px;float:left;" class="form-control input-sm" relTRFR="' + value.FranchiseeId + '" ';
            trRow += '          id="trans_ddlTransferDistributionFranchiseeStopDateMonth' + index + '" name="trans_ddlTransferDistributionFranchiseeStopDateMonth' + index + '" > ';
            trRow += '          <option value="01">01</option>';
            trRow += '          <option value="02">02</option>';
            trRow += '          <option value="03">03</option>';
            trRow += '          <option value="04">04</option>';
            trRow += '          <option value="05">05</option>';
            trRow += '          <option value="06">06</option>';
            trRow += '          <option value="07">07</option>';
            trRow += '          <option value="08">08</option>';
            trRow += '          <option value="09">09</option>';
            trRow += '          <option value="10">10</option>';
            trRow += '          <option value="11">11</option>';
            trRow += '          <option value="12">12</option>';
            trRow += '    </select>';

            trRow += '    <select style="width:60px;padding:3px;float: left;" class="form-control input-sm" relTRFR="' + value.FranchiseeId + '" ';
            trRow += '          id="trans_ddlTransferDistributionFranchiseeStopDateYear' + index + '" name="trans_ddlTransferDistributionFranchiseeStopDateYear' + index + '" > ';
            for (var i = 0; i < _yearList.length; i++) {
                
                trRow += '          <option value="' + _yearList[i] + '">' + _yearList[i] +'</option>';
            }
           
            //trRow += '          <option value="2017">2017</option>';
            //trRow += '          <option value="2016">2016</option>';
            //trRow += '          <option value="2015">2015</option>';
            //trRow += '          <option value="2014">2014</option>';
            //trRow += '          <option value="2013">2013</option>';
            //trRow += '          <option value="2012">2012</option>';
            //trRow += '          <option value="2011">2011</option>';
            //trRow += '          <option value="2010">2010</option>';
            //trRow += '          <option value="2009">2009</option>';
            //trRow += '          <option value="2008">2008</option>';
            //trRow += '          <option value="2007">2007</option>';
            trRow += '    </select>';

            trRow += '    </td>';
            trRow += '    <td class="text-center"><input type="text" relTRFR="' + value.FranchiseeId + '" id="trans_ddlTransferDistributionFranchiseeNote' + index + '" name="trans_ddlTransferDistributionFranchiseeNote' + index + '" class="form-control input-sm" /></td>';
            trRow += '    <td class="text-center"><input type="radio" name="TroubleTransferFee" value="TroubleWithFee" onchange="fnApplyTroubleWithFee(this)"></td>';
            trRow += '    <td class="text-center"><input type="radio" name="TroubleTransferFee" value="TroubleWithoutFee" onchange="fnApplyTroubleWithFee(this)"></td>';
            trRow += '    <td class="text-center"><input type="radio" name="TroubleTransferFee" value="NotATroubleAccount" onchange="fnApplyTroubleWithFee(this)"></td>';
            trRow += '</tr>';
            $("#tblstopfindersfee>tbody").append(trRow);

            $("#trans_ddlTransferDistributionFranchiseeStopDate" + index).datepicker({ autoclose: true });
        });

        $('#spnTransEffectiveDate').html($('#trans_ddlTransferEffectiveDate').val())

        $("#modal_stopfindersfee").modal({ backdrop: 'static' });
    }

    function fnApplyTroubleWithFee(item) {

        if ($(item).is(":checked") && $(item).val() == "TroubleWithFee") {
            $('#spncancelationFee').html(50.00);
        }
        else
            $('#spncancelationFee').html(0.00);

    }


    function showContractDetailSchedule(mo, tu, we, th, fr, sa, su) {


        $("#TRMonday").prop("checked", false);
        $("#TRTuesday").prop('checked', false);
        $("#TRWednesday").prop('checked', false);
        $("#TRThursday").prop('checked', false);
        $("#TRFriday").prop('checked', false);
        $("#TRSaturday").prop('checked', false);
        $("#TRSunday").prop('checked', false);


        if (mo == 1)
            $("#TRMonday").prop('checked', true);
        if (tu == 1)
            $("#TRTuesday").prop('checked', true);
        if (we == 1)
            $("#TRWednesday").prop('checked', true);
        if (th == 1)
            $("#TRThursday").prop('checked', true);
        if (fr == 1)
            $("#TRFriday").prop('checked', true);
        if (sa == 1)
            $("#TRSaturday").prop('checked', true);
        if (su == 1)
            $("#TRSunday").prop('checked', true);

        $("#modal_CTcustomercontractdetailschedule").modal({ backdrop: 'static' });
    }

    var saveCustomerDetailTransferDistribution = function () {

        if (!TransferValidateStepSecond()) {
            return;
        }
        $('#form_revenuedistribution').html('')

        $.each(lstDistributionFranchiseeList, function (index, value) {
            var id = value.ContractDetailId;
            CheckInvoiceForRevnueDistribution(id, lstDistributionFranchiseeList.length, index);
        });

    };

    function CheckInvoiceForRevnueDistribution(ContractDetailId, Invlength,index) {
        var sURL = '@Url.Action("GetTransferRevenueDistributionInvoice", "Customer", new { area = "Portal" })?CustomerId=' + $('#hdfCustomerId').val() + '&ContractDetailId=' + ContractDetailId + '&EffectiveDate=' + $('#trans_ddlTransferEffectiveDate').val();
        $.ajax({
            type: "GET",
            url: sURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {

                $('#spnTransEffectiveDateR').html($('#trans_ddlTransferEffectiveDate').val())

                if (data.length > 0) {



                    var tInvoiceId = 0;


                    var lenInvoicesforReve = data.length;
                    var invId = 0; var invIdNext = 0;





                    $.each(data, function (index, value) {

                        if (data[index + 1] != undefined) { invIdNext = data[index + 1].InvoiceId; }
                        else { invIdNext = value.InvoiceId; }

                        if (index == 0) { tInvoiceId = value.InvoiceId; }





                        invId = value.InvoiceId;
                        $('#spnTransEffectiveDateR_' + invId).html($('#trans_ddlTransferEffectiveDate').val())
                        $('#form_revenuedistribution').append('<div id="form_revenuedistribution_' + invId + '"></div>')
                        CheckInvoiceForRevnueDistributionBind(invId, invIdNext, tInvoiceId, function () {
                            console.log(invId)
                        });
                    });


                    if (data.length > 0) {
                        $("#tbfranchiseedistributionfeelisthidden>tbody").html("");
                        $("#hdfFranchiseeDistFeeCount").val(DistributionfeeListFinal.length);
                        $.each(DistributionfeeListFinal, function (index, value) {
                            trRow = "";
                            trRow += '<tr>';
                            trRow += '    <td class="text-center">'
                            trRow += '      <input type="hidden" id="hdfFranchiseeDistFee_CustomerId' + index + '" name="hdfFranchiseeDistFee_CustomerId' + index + '" value="' + value.CustomerId + '" />'
                            trRow += '      <input type="hidden" id="hdfFranchiseeDistFee_ContractDetailId' + index + '" name="hdfFranchiseeDistFee_ContractDetailId' + index + '" value="' + value.ContractDetailId + '" />'
                            trRow += '      <input type="hidden" id="hdfFranchiseeDistFee_FranchiseeId' + index + '" name="hdfFranchiseeDistFee_FranchiseeId' + index + '" value="' + value.FranchiseeId + '" />'
                            trRow += '      <input type="hidden" id="hdfFranchiseeDistFee_FeeId' + index + '" name="hdfFranchiseeDistFee_FeeId' + index + '" value="' + value.FeeId + '" />'
                            trRow += '      <input type="hidden" id="hdfFranchiseeDistFee_FeeAmount' + index + '" name="hdfFranchiseeDistFee_FeeAmount' + index + '" value="' + value.Amount + '" />'
                            trRow += '      <input type="hidden" id="hdfFranchiseeDistFee_DetailLineNumber' + index + '" name="hdfFranchiseeDistFee_DetailLineNumber' + index + '" value="' + value.DetailLineNumber + '" />'
                            trRow += '    </td>';
                            trRow += '</tr>';
                            $("#tbfranchiseedistributionfeelisthidden>tbody").append(trRow);
                        });


                        if (tInvoiceId == 0) {
                            $("#submit_form_Transdistributioncustomer").submit();

                        }

                    }

                }
                else {

                    alert("There are no Invoice base in effective date");
                    showIncreaseDescreaseTR($('#hdftransfer_customerid').val(), $('#hdfFrenchiseeId2').val());
                }

                //else {
                //    alert("There are no Invoice base in effective date");
                //}
            },
            error: function (err) {
                console.log(err);
            }
        });

  }

    function isValidDate(dateString)
    {
        // First check for the pattern
        if(!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString))
          return false;

        // Parse the date parts to integers
        var parts = dateString.split("/");
        var day = parseInt(parts[1], 10);
        var month = parseInt(parts[0], 10);
        var year = parseInt(parts[2], 10);

        // Check the ranges of month and year
        if(year < 1000 || year > 3000 || month == 0 || month > 12)
          return false;

        var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];

        // Adjust for leap years
        if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))
          monthLength[1] = 29;

        // Check the range of the day
        return day > 0 && day <= monthLength[month - 1];
    };


    function CheckInvoiceForRevnueDistributionBind(invId, invIdNext, tInvoiceId,callbackmethord) {

        $.ajax({
            type: "GET",
            url: '@Url.Action("TransferRevenueDistribution", "Customer", new { area = "Portal" })?Id=' + invId+ "&EffectiveDate=" + $('#trans_ddlTransferEffectiveDate').val(),
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {

                $('#form_revenuedistribution_' + invId).html(data);
                debugger;
                for (var i = 1; i <= parseInt($('#hdftransferfrenchiseedetail_linecount').val()) ; i++) {

                    var exist = $.grep(lstDistributionFranchiseeList, function (obj) { return (obj.FranchiseeId === parseInt($('#fdt_hdfFrenchiseeId' + i).val()) && obj.LineNo === parseInt($('#fdt_txtlinenumber' + i).val())); });
                    if (exist.length === 0) {
                        var lnRFranchiseeDistribution = parseInt($('#hdfInvoiceDetail_FranchiseeDistributionCount_' + invId).val());

                        var lnFranchiseeDistribution = lnRFranchiseeDistribution + 1; //$('#fdt_txtfranchiseeamount' + i).attr('relLine');

                        $('#hdfInvoiceDetail_FranchiseeDistributionCount_' + invId).val(lnFranchiseeDistribution);

                        var rowNum = parseInt($('#fdt_ddldetaillinenumber' + i + ' option[value="' + $('#fdt_ddldetaillinenumber' + i).val() + '"]').text());
                        //var amtFA = parseFloat($('#fdt_txtfranchiseeamount' + i).val());
                        var amtFA = parseFloat($('#hdfInvoiceDetailItemsExtendedPrice_' + invId + '_' + rowNum).val());
                        var amtFAFEE = 0.00;
                        var ct_totDays = $('#hdfInvoiceDetail_InvoiceAllDay_' + invId).val(); // new Date(new Date($('#trans_ddlTransferEffectiveDate').val()).getYear(), new Date($('#trans_ddlTransferEffectiveDate').val()).getMonth(), 0).getDate();
                        var ct_days = $('#hdfInvoiceDetail_InvoiceWorkingDay_' + invId).val(); //(new Date($('#trans_ddlTransferEffectiveDate').val()) - new Date($('#hdfInvoiceDetail_InvoiceDate').val())) / 1000 / 60 / 60 / 24;

                        var amtFAFF = (amtFA / ct_totDays) * ct_days; //(ct_totDays - ct_days-1);


                        $.each(DistributionfeeListFinal, function (index1, value1) {
                            if (value1.FranchiseeId == parseInt($('#fdt_hdfFrenchiseeId' + i).val()) && value1.ContractDetailId == parseInt($('#fdt_hdfcontractdetailid' + i).val()))
                                amtFAFEE += (amtFAFF * value1.Amount / 100);
                        });

                        trRow = "";
                        trRow += '<tr>';
                        trRow += '   <td style="text-align:center">'
                        trRow += '   <input type="hidden" reltfline="' + lnFranchiseeDistribution + '" id="fdt_INV_hdfcontractdetailid_' + invId + '_' + lnFranchiseeDistribution + '" name="fdt_INV_hdfcontractdetailid_' + invId + '_' +lnFranchiseeDistribution + '" value="' + $('#fdt_hdfcontractdetailid' + i).val() + '" />'
                        trRow += '   <input type="hidden" reltfline="' + lnFranchiseeDistribution + '" id="fdt_INV_hdfFrenchiseeId_' + invId + '_' + lnFranchiseeDistribution + '" name="fdt_INV_hdfFrenchiseeId_' + invId + '_' + lnFranchiseeDistribution + '" value="' + $('#fdt_hdfFrenchiseeId' + i).val() + '" />'

                        trRow += '   <input type="hidden" reltfline="' + lnFranchiseeDistribution + '" id="fdt_INV_hdfdetaillinenumber_' + invId + '_' + lnFranchiseeDistribution + '" name="fdt_INV_hdfdetaillinenumber_' + invId + '_' + lnFranchiseeDistribution + '" value="' + $('#fdt_ddldetaillinenumber' + i + ' option[value="' + $('#fdt_ddldetaillinenumber' + i).val() + '"]').text() + '" />'

                        trRow += $('#fdt_ddldetaillinenumber' + i + ' option[value="' + $('#fdt_ddldetaillinenumber' + i).val() + '"]').text() + '</td>';
                        trRow += '   <td style="text-align:center;">' + $('#fdt_txtfranchiseeno' + i).val() + '</td>';
                        trRow += '   <td style="white-space:pre-line;text-align:center;">' + $('#fdt_txtfranchiseename' + i).val() + '</td>';
                        trRow += '   <td style="white-space:pre-line;text-align:center;display:none;">' + $('#trans_ddlTransferEffectiveDate').val()+'</td>';
                        trRow += '   <td style="text-align:right;"><input type="text" reltfline="' + lnFranchiseeDistribution + '" relseqnumber="' + i + '" relfdt_invamt="relfdt_invamt' + lnFranchiseeDistribution + '" relinvline="' + lnFranchiseeDistribution + '" id="fdt_inv_txtfranchiseeamount_' + invId + '_' + lnFranchiseeDistribution + '" name="fdt_inv_txtfranchiseeamount_' + invId + '_' +lnFranchiseeDistribution + '" required="" value="' + amtFAFF.toFixed(2) + '" class="form-control input-sm cnumeric" style="text-align:right;padding: 5px;border-radius: 0px;"></td>';
                        trRow += '   <td style="text-align:right"><input type="text" reltfline="' + lnFranchiseeDistribution + '" relseqnumber="' + i + '"relfdt_invamt="relfdt_invamtfee' + lnFranchiseeDistribution + '" relinvline="' + lnFranchiseeDistribution + '" id="fdt_inv_txtfranchiseeamountfee_' + invId + '_' + lnFranchiseeDistribution + '" name="fdt_inv_txtfranchiseeamountfee_' + invId + '_' +lnFranchiseeDistribution + '" required="" readonly value="' + amtFAFEE.toFixed(2) + '" class="form-control input-sm cnumeric" style="text-align:right;padding: 5px;border-radius: 0px;"></td>';
                        trRow += '   <td style="text-align:right;"><input type="text" reltfline="' + lnFranchiseeDistribution + '" relseqnumber="' + i + '" relfdt_invamt="relfdt_invamt' + lnFranchiseeDistribution + '" relinvline="' + lnFranchiseeDistribution + '" id="fdt_inv_txtfranchiseeamounttotal_' + invId + '_' + lnFranchiseeDistribution + '" name="fdt_inv_txtfranchiseeamounttotal_' + invId + '_' +lnFranchiseeDistribution + '" required="" readonly value="' + (parseFloat(amtFAFF) - parseFloat(amtFAFEE)).toFixed(2) + '" class="form-control input-sm cnumeric" style="text-align:right;padding: 5px;border-radius: 0px;"></td>';
                        trRow += '</tr>';

                        $("#tblRevenueDistributionInvoiceDetail_" + invId+">tbody").append(trRow);


                        applyMaskCurrency("#fdt_inv_txtfranchiseeamount_" + invId + '_' +lnFranchiseeDistribution)
                        applyMaskCurrency("#fdt_inv_txtfranchiseeamountfee_" + invId + '_' +lnFranchiseeDistribution)
                        applyMaskCurrency("#fdt_inv_txtfranchiseeamounttotal_" + invId + '_' +lnFranchiseeDistribution)


                        $('#fdt_inv_txtfranchiseeamount_' + invId + '_' + lnFranchiseeDistribution).change(function () {
                            var _this = $(this);
                            if (_this.val() != '' && _this.val() != '0') {
                                var tempamtFAFEE = 0.00;
                                $.each(DistributionfeeListFinal, function (index1, value1) {
                                    if (value1.FranchiseeId == parseInt($('#fdt_INV_hdfFrenchiseeId' + _this.attr('reltfline')).val()) && value1.ContractDetailId == parseInt($('#fdt_INV_hdfcontractdetailid' + _this.attr('reltfline')).val()))
                                        tempamtFAFEE += (parseFloat(_this.val()) * value1.Amount / 100);
                                });
                                $('#fdt_inv_txtfranchiseeamountfee_' + invId + '_' +lnFranchiseeDistribution).val((parseFloat(tempamtFAFEE)).toFixed(2))
                                $('#fdt_inv_txtfranchiseeamounttotal_' + invId + '_' +lnFranchiseeDistribution).val((parseFloat(_this.val()) - parseFloat(tempamtFAFEE)).toFixed(2))
                            }
                            else {
                                $('#trans_dfeeLink' + lnFranchiseeDistribution).html('');
                            }
                        });
                    }
                }

                $('#spnTransEffectiveDateR_' + invId).html($('#trans_ddlTransferEffectiveDate').val())

                if (invIdNext == invId) {

                    $('#btnRevenueDistributionInvoiceDetail_OnSkip' + invId).val("Skip and Save")
                    $('#btnRevenueDistributionInvoiceDetail_OnSave' + invId).val("Save")
                }
                else {
                    $('#btnRevenueDistributionInvoiceDetail_OnSave' + invId).val("Continue")
                    $('#spnTransEffectiveDateR_' + invId).html($('#trans_ddlTransferEffectiveDate').val())
                }

                $('#hdfInvoiceDetailNext_InvoiceId_' + invId).val(invIdNext);


                if (tInvoiceId > 0) {

                    $("#modal_partialrevenueinvoicedetail_" + tInvoiceId).modal({ backdrop: 'static' });
                }

                callbackmethord;

            },
            error: function (err) {
                console.log(err);
            }
        });
    }


    function btnRevenueDistributionInvoiceDetail_OnClickSave(invId,Skip) {
        var invIdNext = $('#hdfInvoiceDetailNext_InvoiceId_' + invId).val();

        $("#hdfRevenueDistributionInvoiceDetail_Skip" + invId).val(Skip);

        if (invIdNext != invId) {
            $('#spnTransEffectiveDateR_' + invIdNext).html($('#trans_ddlTransferEffectiveDate').val())
            $("#modal_partialrevenueinvoicedetail_" + invIdNext).modal({ backdrop: 'static' });
        }
        else {
            showIncreaseDescreaseTR($('#hdftransfer_customerid').val(), $('#hdfFrenchiseeId2').val());
            //$("#submit_form_Transdistributioncustomer").submit();
        }
    }
    function applyMaskCurrency(id) {
        $(id).inputmask("currency", {
            alias: 'currency',
            prefix: '$ ',
            digits: 2,
            autoUnmask: true,
            removeMaskOnSubmit: true,
            unmaskAsNumber: true,
            allowPlus: false,
            allowMinus: false,
            autoGroup: true,
            groupSeparator: ",",
        });
    }

    function formatMoney(amount) {
      return amount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
    };
    function UnformatMoney(amount) {
        return amount.replace(',', '').replace('$', '').replace(' ', '');
    };

    function applyMaskNumber(id) {
        $(id).inputmask("numeric", {
            autoUnmask: true,
            removeMaskOnSubmit: true,
            oncleared: function () { self.Value(''); }
        });
    }


        function showIncreaseDescreaseTR(Id,fid) {

            var sURL = '@Url.Action("CustomerTransferFindersFee", "Customer", new { area = "Portal" })?cid=' + Id + '&fid=' + fid;

            $.blockUI(); //$.blockUI({ message: $('#throbberBlock'), theme: true, baseZ: 12000 });

            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#modal_transferFinderFeeDIV').html(data);
                    GetFindersFeeScheduleList();
                    //$(".input-group-btn").click(function () {
                    //    $(this).prev().trigger("focus");
                    //    $(this).prev().trigger("focus");
                    //});

                    //IDFrmInIt();
                    $("#FindersFee_FindersFeeTypeListId").val(1)

                    var _FindersFeeTypeListId = $("#FindersFee_FindersFeeTypeListId").val();
                    $('#FindersFee_StartDate').val($('#trans_ddlTransferEffectiveDate').val());
                    $('#FindersFee_ContractBillingAmount').val($('#tcd_contractdetailId_amount1').val());



                    $('#FindersFee_MultiTenantOccupancyAmount').prop('readonly', true);
                    if (_FindersFeeTypeListId == 9 ||_FindersFeeTypeListId == 2 || _FindersFeeTypeListId == 7 || _FindersFeeTypeListId == 3 || _FindersFeeTypeListId == 4) {
                        $('#FindersFee_MultiTenantOccupancyAmount').prop('readonly', false);
                    }

                    InItFindersFee()
                    $("#modal_FeeFinderdetailResult").modal({ backdrop: 'static' });

                    $.unblockUI();


                },
                error: function (err) {
                    console.log(err);
                    $.unblockUI();
                }
            });
        }


</script>


