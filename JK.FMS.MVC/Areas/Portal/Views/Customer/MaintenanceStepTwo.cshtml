@model JKViewModels.Customer.FullCustomerViewModel
@{
    ViewBag.Title = "MaintenanceStepTwo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <style type="text/css">
        .portlet.light .portlet-body {
            padding-top: 0px;
        }
    </style>

    <link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css")" rel="stylesheet" type="text/css" />
}

<div class="col-md-12 page-custom-header"><h5>Franchise Maintenance</h5></div>
@using (Html.BeginForm("MaintenanceStepTwo", "Customer", FormMethod.Post, new { @id = "form_wizard_1", @role = "form", @class = "form form-horizontal" }))
{
    @Html.HiddenFor(one => one.ButtonType)
    @Html.HiddenFor(one => one.CustomerViewModel.CustomerId)
    @Html.HiddenFor(one => one.CustomerViewModel.CreatedBy)
    @Html.HiddenFor(one => one.CustomerViewModel.CreatedDate)
    @Html.HiddenFor(one => one.CustomerViewModel.CustomerNo)
    @Html.HiddenFor(one => one.MainContact.ContactId)
    @Html.HiddenFor(one => one.MainContact.IsActive)
    @Html.HiddenFor(one => one.MainContact.CreatedBy)
    @Html.HiddenFor(one => one.MainContact.CreatedDate)
    @Html.HiddenFor(one => one.MainAddress.AddressId)
    @Html.HiddenFor(one => one.MainAddress.IsActive)
    @Html.HiddenFor(one => one.MainAddress.CreatedBy)
    @Html.HiddenFor(one => one.MainAddress.CreatedDate)
    @Html.HiddenFor(one => one.MainEmail.EmailId)
    @Html.HiddenFor(one => one.MainEmail.IsActive)
    @Html.HiddenFor(one => one.MainEmail.CreatedBy)
    @Html.HiddenFor(one => one.MainEmail.CreatedDate)
    @Html.HiddenFor(one => one.MainPhone.PhoneId)
    @Html.HiddenFor(one => one.MainPhone.IsActive)
    @Html.HiddenFor(one => one.MainPhone.CreatedBy)
    @Html.HiddenFor(one => one.MainPhone.CreatedDate)

    @Html.HiddenFor(one => one.BillingContact.ContactId)
    @Html.HiddenFor(one => one.BillingContact.IsActive)
    @Html.HiddenFor(one => one.BillingContact.CreatedBy)
    @Html.HiddenFor(one => one.BillingContact.CreatedDate)
    @Html.HiddenFor(one => one.BillingAddress.AddressId)
    @Html.HiddenFor(one => one.BillingAddress.IsActive)
    @Html.HiddenFor(one => one.BillingAddress.CreatedBy)
    @Html.HiddenFor(one => one.BillingAddress.CreatedDate)

    @Html.HiddenFor(one => one.ContactInformation.ContactId)
    @Html.HiddenFor(one => one.ContactInformation.IsActive)
    @Html.HiddenFor(one => one.ContactInformation.CreatedDate)

    @Html.HiddenFor(one => one.ContactInformationAddress.AddressId)
    @Html.HiddenFor(one => one.ContactInformationAddress.CreatedBy)
    @Html.HiddenFor(one => one.ContactInformationAddress.CreatedDate)

    @Html.HiddenFor(one => one.ContactInformationEmail.EmailId)
    @Html.HiddenFor(one => one.ContactInformationEmail.IsActive)
    @Html.HiddenFor(one => one.ContactInformationEmail.CreatedBy)
    @Html.HiddenFor(one => one.ContactInformationEmail.CreatedDate)
    @Html.HiddenFor(one => one.ContactInformationPhone.PhoneId)
    @Html.HiddenFor(one => one.ContactInformationPhone.IsActive)
    @Html.HiddenFor(one => one.ContactInformationPhone.CreatedBy)
    @Html.HiddenFor(one => one.ContactInformationPhone.CreatedDate)
    @Html.HiddenFor(one => one.BillingInformation.IsActive)
    @Html.HiddenFor(one => one.BillingInformation.CreatedBy)
    @Html.HiddenFor(one => one.BillingInformation.CreatedDate)
    @Html.HiddenFor(one => one.BillingInformationAddress.AddressId)
    @Html.HiddenFor(one => one.BillingInformationAddress.IsActive)
    @Html.HiddenFor(one => one.BillingInformationAddress.CreatedBy)
    @Html.HiddenFor(one => one.BillingInformationAddress.CreatedDate)
    @Html.HiddenFor(one => one.BillingInformationEmail.EmailId)
    @Html.HiddenFor(one => one.BillingInformationEmail.IsActive)
    @Html.HiddenFor(one => one.BillingInformationEmail.CreatedBy)
    @Html.HiddenFor(one => one.BillingInformationEmail.CreatedDate)
    @Html.HiddenFor(one => one.BillingInformationPhone.PhoneId)
    @Html.HiddenFor(one => one.BillingInformationPhone.IsActive)
    @Html.HiddenFor(one => one.BillingInformationPhone.CreatedBy)
    @Html.HiddenFor(one => one.BillingInformationPhone.CreatedDate)


    @Html.HiddenFor(one => one.BillSetting.CustomerId)
    @Html.HiddenFor(one => one.BillSetting.BillSettingsId) 

    <section>
        <div class="row">
            <div style="max-width: 98%;margin: 0px auto;">
                <div class="custom-form portlet light " id="form_wizard_1">
                    <div class="portlet-body form">
                        <form class="form-horizontal" action="#" id="submit_form" method="POST">
                            <div class="form-wizard">
                                <div class="form-body-outer" style="padding: 0px;">
                                    <div style="overflow:auto;width: 100%; margin: 0em auto;">
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="tb_fr_page1">
                                                <h4 class="blocktop">Customer Bill Settings</h4>
                                                <div class="form-group">
                                                    <label class="control-label col-md-2" style="font-weight:600;">
                                                        Customer No.
                                                    </label>
                                                    <div class="col-md-4">
                                                        <label class="control-label col-md-4" style="width:auto;">
                                                            @Html.DisplayFor(one => one.CustomerViewModel.CustomerNo)
                                                        </label>
                                                    </div>
                                                    <div class="col-md-1 col-md-offset-1" >
                                                        <label style="margin-bottom: 8px;margin:8px;font-weight:600;">
                                                            Address
                                                        </label>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="control-label col-md-11" style="width:auto;">
                                                            @Html.Raw(ViewBag.Address)
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-2" style="font-weight:600;">
                                                        Customer Name
                                                    </label>
                                                    <div class="col-md-4">
                                                        <label class="control-label col-md-9" style="width:auto;">
                                                            @Html.DisplayFor(one => one.CustomerViewModel.Name)
                                                        </label>
                                                    </div>

                                                </div>
                                                <div class="form-group">
                                                    <div class="col-md-12">
                                                        <hr />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        AR Status
                                                    </label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("ArStatus", null, new { @class = "form-control input-sm", @id = "statusList" })
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        Effective Date
                                                    </label>
                                                    <div class="col-md-3">
                                                        <div class="input-group date" data-date-format="mm/dd/yyyy">
                                                            @Html.TextBoxFor(one => one.BillSetting.EffectiveDate, new { @class = "form-control input-sm date-picker RemovePeriodvalidation" } )
                                                            <span class="input-group-btn cal-btn">
                                                                <button class="btn default cal-btn" type="button">
                                                                    <i class="fa fa-calendar"></i>
                                                                </button>
                                                            </span>
                                                        </div> 
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        Invoice Date
                                                    </label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("InvoiceDate", null, new { @class = "form-control input-sm", required = "required", @id = "statusList" })
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        Term
                                                    </label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("TermDate", null, new { @class = "form-control input-sm", required = "required", @id = "statusList" })
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            @Html.CheckBoxFor(one => one.BillSetting.EBill, new { @class = "i-checks", @checked = "true" }) E-Bill
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            @Html.CheckBoxFor(one => one.BillSetting.PBill, new { @class = "i-checks", @checked = "true" }) Print Invoice
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-3">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            @Html.CheckBoxFor(one => one.BillSetting.PrintPastDue, new { @class = "i-checks", @checked = "true" }) Print Past Due
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-5">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            @Html.CheckBoxFor(one => one.BillSetting.TaxExcempt, new { @class = "i-checks", @checked = "true" }) Tax Exempt @*(Applies to manual transactions only.)*@
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                    </label>
                                                    <div class="col-md-5">
                                                        <label class="mt-checkbox" style="margin-bottom: 8px;">
                                                            @Html.CheckBoxFor(one => one.BillSetting.ConsolidatedInvoice, new { @class = "i-checks", @checked = "true" }) Consolidated Invoice
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                @*<div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        Tax Authority
                                                    </label>
                                                    <div class="col-md-3">
                                                        @Html.DropDownList("TaxAuthority", null, new { @class = "form-control input-sm", required = "required", @id = "statusList" })
                                                    </div>
                                                </div>*@ 
                                                @*<div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        InvoiceMessage
                                                    </label>
                                                    <div class="col-md-5">
                                                        @Html.TextAreaFor(one => one.BillSetting.InvoiceMessage, new { @class = "form-control input-sm", row = 2 })
                                                    </div>
                                                </div>*@
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">
                                                        Notes
                                                    </label>
                                                    <div class="col-md-5">
                                                        @Html.TextAreaFor(one => one.BillSetting.Notes, new { @class = "form-control input-sm", row = 2 })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-actions">
                                        <div class="col-md-12" style="padding-right: 28px;">

                                            <button type="submit" class="btn btn-primary button-next  pull-right" id="btnContinue" style="margin-left: 10px;">
                                                Continue
                                                <i class="fa fa-angle-right"></i>
                                            </button>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <button type="submit" class="btn btn-primary  pull-right" id="btnSave" style="margin-left: 10px;">
                                                Save
                                                <i class="fa fa-check"></i>
                                            </button>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <button type="submit" class="btn btn-primary button-next  pull-right" id="btnBack" style="margin-left: 10px;">
                                                Back
                                                <i class="fa fa-angle-right"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="modal fade custom-model custom-form-design" id="modalData" tabindex="-1" role="basic" aria-hidden="true" style="display: none;"></div>

                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
}



@section pageplugins{
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/select2/js/select2.full.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/additional-methods.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>   
}
@section scripts{

    <script src="@Url.Content("~/Content/admin/assets/global/plugins/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/app.min.js")" type="text/javascript" )"></script>
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script>
        var MaintenanceFormWizard = function () {


            return {
                //main function to initiate the module
                init: function () {
                    if (!jQuery().bootstrapWizard) {
                        //return;
                    }

                    function format(state) {
                        if (!state.id) return state.text; // optgroup
                        return "<img class='flag' src='../../assets/global/img/flags/" + state.id.toLowerCase() + ".png'/>&nbsp;&nbsp;" + state.text;
                    }

                    //$("#country_list").select2({
                    //    placeholder: "Select",
                    //    allowClear: true,
                    //    formatResult: format,
                    //    width: 'auto',
                    //    formatSelection: format,
                    //    escapeMarkup: function (m) {
                    //        return m;
                    //    }
                    //});

                    var form = $('#submit_form');
                    var error = $('.alert-danger', form);
                    var success = $('.alert-success', form);

                    form.validate({
                        doNotHideMessage: true, //this option enables to show the error/success messages on tab switch.
                        errorElement: 'span', //default input error message container
                        errorClass: 'help-block help-block-error', // default input error message class
                        focusInvalid: false, // do not focus the last invalid input
                        rules: {},
                        messages: { // custom messages for radio buttons and checkboxes
                            'payment[]': {
                                required: "Please select at least one option",
                                minlength: jQuery.validator.format("Please select at least one option")
                            }
                        },

                        errorPlacement: function (error, element) { // render error placement for each input type
                        },

                        invalidHandler: function (event, validator) { //display error alert on form submit
                            success.hide();
                            error.show();
                            App.scrollTo(error, -200);
                        },

                        highlight: function (element) { // hightlight error inputs
                            $(element)
                                .closest('.form-group').removeClass('has-success').addClass('has-error'); // set error class to the control group
                        },

                        unhighlight: function (element) { // revert the change done by hightlight
                            $(element)
                                .closest('.form-group').removeClass('has-error'); // set error class to the control group
                        },

                        success: function (label) {
                            if (label.attr("for") == "gender" || label.attr("for") == "payment[]") { // for checkboxes and radio buttons, no need to show OK icon
                                label
                                    .closest('.form-group').removeClass('has-error').addClass('has-success');
                                label.remove(); // remove error label here
                            } else { // display success icon for other inputs
                                label
                                    .addClass('valid') // mark the current input as valid and display OK icon
                                .closest('.form-group').removeClass('has-error').addClass('has-success'); // set success class to the control group
                            }
                        },

                        submitHandler: function (form) {
                            success.show();
                            error.hide();
                            $('#form_wizard_1')[0].submit();
                            //add here some ajax code to submit your form or just call form.submit() if you want to submit the form without ajax
                        }

                    });



                    $('#divachsubsection').hide();
                    
                    function saveFranchiseeData(inputData) {
                        
                        var sURL = '@Url.Action("Maintenance", "Franchise", new { area = "Portal" })'
                        var dataString = new FormData(formData);
                        $.ajax({
                            type: "POST",
                            url: sURL,
                            data: $("form").serialize(),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (data, status) {
                                alert(data);
                            },
                            error: function (e) {
                                alert(e);
                            }
                        });
                    }

                    


                }

            };

        }();
        jQuery(document).ready(function () {
            $(".input-group-btn").click(function () {
                $(this).prev().trigger("focus");
                $(this).prev().trigger("focus");
            });

            MaintenanceFormWizard.init();
            // MaintenanceFormWizardOwner.init();


            $('.date-picker').datepicker({ autoclose: true, dateFormat: 'mm/dd/yy' });
            $('.date-picker').attr("placeholder", "mm/dd/yyyy");

            $('#generalFranchiseeOwner').DataTable({
                "paging": true,
                "ordering": false,
                "info": false,
                "bProcessing": true,
                "pageLength": 25,
                "dom": "<'table-responsive't><'bottom'ip><'clear'>"
            });
            $('#PayeeIdentification_IdentifierNumer').inputmask("mask", {
                "mask": "99-99-9999"
            });

            $('#checkbox1_8').change(function () {
                if ($(this).prop('checked')) {
                    $('#PayeeIdentification_IdentifierNumer').inputmask("mask", {
                        "mask": "99-9999"
                    });
                    $('#PayeeIdentification_IdentifierTypeListId').val(@Convert.ToInt32(JKApi.Business.Enumeration.IdentifierTypeList.EIN));
                }

            });

            $('#checkbox1_9').change(function () {
                if ($(this).prop('checked')) {
                    $('#PayeeIdentification_IdentifierNumer').inputmask("mask", {
                        "mask": "99-99-9999"
                    });
                    $('#PayeeIdentification_IdentifierTypeListId').val(@Convert.ToInt32(JKApi.Business.Enumeration.IdentifierTypeList.SSN));
                }

            });




            $('#PayeeInfo_Chargeback').change(function () {
                if ($(this).prop('checked')) {
                    $('#PayeeInfo_Chargeback').val(true);
                }
                else {
                    $('#PayeeInfo_Chargeback').val(false);
                }

            });


            $('#PayeeInfo_BBPAdministrationFee').change(function () {
                if ($(this).prop('checked')) {
                    $('#PayeeInfo_BBPAdministrationFee').val(true);
                }
                else {
                    $('#PayeeInfo_BBPAdministrationFee').val(false);
                }

            });

            $('#PayeeInfo_AccountRebate').change(function () {
                if ($(this).prop('checked')) {
                    $('#PayeeInfo_AccountRebate').val(true);
                }
                else {
                    $('#PayeeInfo_AccountRebate').val(false);
                }

            });

            $('#PayeeInfo_Chargeback').change(function () {
                if ($(this).prop('checked')) {
                    $('#PayeeInfo_GenerateReport').val(true);
                }
                else {
                    $('#PayeeInfo_GenerateReport').val(false);
                }

            });

        });



        // Prevent the form to be submitted on ENTER
        $('#form_wizard_1').submit(function (e) {
            e.preventDefault();
        });

        // Controll data
        $('#btnContinue').click(function () {
            
            var btnCount = @Convert.ToInt32(JKApi.Business.Enumeration.ButtonType.Continue)
            $("#ButtonType").val(btnCount);
            checkMandatoryFields(btnCount);
        });

        // Controll data
        $('#btnSave').click(function () {
            
            var btnCount = @Convert.ToInt32(JKApi.Business.Enumeration.ButtonType.Save)

            $("#ButtonType").val(btnCount);
            checkMandatoryFields(btnCount);
        });

        $('#btnBack').click(function () {
            
            var btnCount = @Convert.ToInt32(JKApi.Business.Enumeration.ButtonType.Back)

            $("#ButtonType").val(btnCount);
            checkMandatoryFields(btnCount);
        });



        // Check mandatory fields before subitting:
        function checkMandatoryFields(count) {
            var form = $('#form_wizard_1');
            var error = $('.alert-danger', form);
            var success = $('.alert-success', form);

            form.validate({
                doNotHideMessage: true, //this option enables to show the error/success messages on tab switch.
                errorElement: 'span', //default input error message container
                errorClass: 'help-block help-block-error', // default input error message class
                focusInvalid: false, // do not focus the last invalid input
                rules: {},
                messages: { // custom messages for radio buttons and checkboxes
                    'payment[]': {
                        required: "Please select at least one option",
                        minlength: jQuery.validator.format("Please select at least one option")
                    }
                },

                errorPlacement: function (error, element) { // render error placement for each input type
                },

                invalidHandler: function (event, validator) { //display error alert on form submit
                    success.hide();
                    error.show();
                    App.scrollTo(error, -200);
                },

                highlight: function (element) { // hightlight error inputs
                    $(element)
                        .closest('.form-group').removeClass('has-success').addClass('has-error'); // set error class to the control group
                },

                unhighlight: function (element) { // revert the change done by hightlight
                    $(element)
                        .closest('.form-group').removeClass('has-error'); // set error class to the control group
                },

                success: function (label) {
                    if (label.attr("for") == "gender" || label.attr("for") == "payment[]") { // for checkboxes and radio buttons, no need to show OK icon
                        label
                            .closest('.form-group').removeClass('has-error').addClass('has-success');
                        label.remove(); // remove error label here
                    } else { // display success icon for other inputs
                        label
                            .addClass('valid') // mark the current input as valid and display OK icon
                        .closest('.form-group').removeClass('has-error').addClass('has-success'); // set success class to the control group
                    }
                },

                submitHandler: function (form) {
                    success.show();
                    error.hide();
                    if (count > 0) {
                        $('#form_wizard_1')[0].submit();
                        //$('#form_wizard_1').submit();
                    }
                    //add here some ajax code to submit your form or just call form.submit() if you want to submit the form without ajax
                }

            });
        }




        $(function () {
            window.addEditOwner = function (id) {
                $.blockUI({
                    baseZ: 99999,
                    message: '<center><img height: src="/Images/loading_icon.gif" /><h3> <b>Processing....</br> Please wait! and do not refresh page.</b></h3></center>',
                    css: { backgroundColor: 'rgb{0,0,0}', border: '0', color: '#fff', "z-index": 99999 }
                });
                @*var url = '/Portal/Franchise/AddEditOwner/?id=' + @Model.BusinessInfo.FranchiseeId + '&OwnerId=' + id
                $.get(url, function (data) {
                    $('#modalData').html(data);
                    $('#modalData').modal();
                });*@
                $.unblockUI();
            }
        });


    </script>
}