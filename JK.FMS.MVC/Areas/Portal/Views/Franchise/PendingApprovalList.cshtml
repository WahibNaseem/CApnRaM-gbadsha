@model IEnumerable<JKViewModels.Franchise.FranchiseSearch>

@{
    ViewBag.Title = "Pending Approval List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    tr > td {
        font-size: 12px !important;
        padding: 4px !important;
    }

    /*tr > th {
        font-size: 11px !important;
        text-transform: uppercase;
    }*/

    .row {
        margin: 0;
        padding: 3px 0;
    }

    .right {
        text-align: right;
    }

    .personlink {
        text-align: center;
    }

    .close {
        background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
        height: 12px !important;
        width: 12px !important;
        margin-top: 0px !important;
    }

    .page-size {
        padding-left: 0;
        padding-right: 0;
        width: 62px;
    }

    .topheader {
        font-size: 14px;
        font-weight: bold;
        color: #FFF !important;
        text-transform: uppercase;
        margin-top: 3px;
    }

    .alignRight {
        text-align: right;
    }

    #ui-datepicker-div {
        z-index: 99999 !important;
    }

    .alignCenter {
        text-align: center;
    }

    #franchiseList th {
        vertical-align: middle;
    }

    .no-padding {
        padding: 0;
    }

    .no-margin {
        margin: 0;
    }

    .padding-tb1 {
        padding-top: 1px;
        padding-bottom: 1px;
    }

    .margin-tb1 {
        margin-top: 1px;
        margin-bottom: 1px;
    }

    .custom-listbox .headerbox {
        padding: 3px 0px 3px 5px;
    }

    .custom-listbox {
        margin-top: 4px;
        margin-bottom: 0px;
    }

    .btn.multiselect {
        text-align: left;
        padding-top: 4px;
        padding-bottom: 4px;
        font-size: 11px;
        color: #555;
    }

    .multiselect .caret {
        right: 0;
        position: absolute;
        margin-top: 8px;
        margin-right: 8px;
    }

    .multiselect-container.dropdown-menu {
        text-transform: none;
        font-size: 14px;
    }

    .table-responsive {
        min-height: 600px;
    }
</style>
@section styles{
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css")" rel="stylesheet" />
}

<div class="headerbox">
    <div class="row" style="background-color: #3598DC;color: #fff;">
        <div class="col-md-12 no-padding">
            <div class="alignCenter">
                <div class="col-md-4" style="text-align:right;">
                </div>
                <div class="col-md-4 topheader">
                    Pending Approval List
                </div>
                <div class="col-md-4" style="padding-right:5px;">
                    <div class="col-md-7 pull-right no-padding">
                        <div style="display:table-cell;padding-right: 5px;">
                            Region
                        </div>
                        <div style="display:table-cell;width:100%;">
                            @if (ViewBag.regionlist != null)
                            {
                                <select class="form-control input-sm" multiple="multiple" id="regionlist" style="display:none;">
                                    @foreach (var item in (SelectList)ViewBag.regionlist)
                                    {
                                        <option @(item.Selected ? "selected" : "") value="@item.Value">@item.Text</option>
                                    }
                                </select>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="custom-listbox">
    <div class="headerbox">
        <div class="row no-padding">
            <div class="col-md-1 page-size">
                <select class="form-control input-sm" id="pageSize" style="padding-left:6px;">
                    <option value="-1">All</option>
                    <option value="100" selected>100</option>
                    <option value="50">50</option>
                    <option value="25">25</option>
                </select>
            </div>
            <div class="col-md-3">
                <div class="input-icon">
                    <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                    <input id="input_Search" type="text" required name="customernumber" autocomplete="off" placeholder="Search..." value="" class="form-control input-sm typeahead" />
                </div>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-4 pull-right" style="padding-right:5px;">
                @*@if (ViewBag.StatusList != null)
                    {
                        <div class="col-md-12 pull-right no-padding">
                            <div class="col-md-6 no-padding" style="text-transform:none;font-weight:normal;text-align: right;margin-top: 3px;">
                                Franchise Status
                            </div>
                            <div class="col-md-6 no-padding" style="padding-left: 6px;">
                                <select id="ddlStatus" multiple="multiple" style="display:none;">
                                    @foreach (var item in (MultiSelectList)ViewBag.StatusList)
                                    {
                                        <option @(item.Selected ? "selected" : "") value="@item.Value">@item.Text</option>
                                    }
                                </select>
                            </div>
                        </div>
                    }*@
            </div>
        </div>
    </div>
</div>

<div class="tablebox">
    <div class="table-responsive" id="divfranchiseList" style="display:none;">
        <table class="table table-striped table-bordered table-hover order-column" id="franchiseList" style="margin-top:0 !important;">
            <thead>
                <tr>
                    <th style="width:60px;text-align:center;">
                        Region
                    </th>
                    @*<th style="width:60px;text-align:center;">
                        Franchise ID
                    </th>*@
                    <th style="text-align:center;">
                        Franchise Name
                    </th>
                    <th style="text-align:center;">
                        Full Address
                    </th>
                    <th style="text-align:center;width:80px;">
                        Phone
                    </th>
                    <th style="text-align:center;width:120px;">
                        Status
                    </th>
                    <th style="text-align:center;width:122px;">
                        Distribution Amount
                    </th>
                    <th style="text-align:center;width:20px;">
                        Action
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="modal fade custom-model custom-form-design" id="ModalFranchiseDistributionPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:645px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderFranchiseDistribution">
        </div>
    </div>
</div>


<!--Finder Fee Detail Modal-->

<div class="modal fade custom-model custom-form-design" id="modal_FeeReport" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width: 1400px;">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;border-radius: 8px 8px 0 0;text-transform: uppercase;">
                    Finder Fee Detail
                </h4>
            </div>
            <div class="modal-body" style="padding: 0px 30px 15px 30px;">
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <input type="hidden" name="hddFF_FranchiseeId" id="hddFF_FranchiseeId" value="0" />
                                <table class="table table-striped table-bordered order-column" id="tblFFDetailListheader">
                                    <thead>
                                        <tr style="background-color: #e8e8e8;">
                                            <th style="width:100px;text-align:center;font-size: 12px;">
                                                Franchisee No.
                                            </th>
                                            <th colspan="6" style="text-align:center;font-size: 12px;">
                                                Franchisee Name
                                            </th>
                                            <td style="text-align:center;width:140px;">
                                                Total FinderFee
                                            </td>
                                            <td style="text-align:center;width:140px;">
                                                Total DownPayment
                                            </td>
                                            <td style="text-align:center;width:140px;">
                                                Total Monthly Payment
                                            </td>
                                            <td style="text-align:center;width:80px;">
                                                Total Paid
                                            </td>
                                            <td style="text-align:center;width:80px;">
                                                Balance
                                            </td>
                                        </tr>

                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="text-align:center;"><span id="spnFF_FranchiseeNo">701241</span> </td>
                                            <td colspan="6" style="text-align:center;"><span id="spnFF_FranchiseeName">VINNY PHAM NGUYEN, INC</span></td>
                                            <td style="text-align:center;">$<span id="spnFF_TotalFinderFee">5,200.00</span></td>
                                            <td style="text-align:center;">$<span id="spnFF_TotalDownPayment">0.00</span></td>
                                            <td style="text-align:center;">$<span id="spnFF_TotalMonthlyPayment">6,000.00</span></td>
                                            <td style="text-align:center;">$<span id="spnFF_TotalPaid">0.00</span></td>
                                            <td style="text-align:center;">$<span id="spnFF_Balance">0.00</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered order-column" id="tblFFDetailList">
                                    <thead>
                                        <tr style="background-color: #e8e8e8;">
                                            <th style="width:100px;text-align:center;font-size: 12px;">
                                                Customer No
                                            </th>
                                            <th style="text-align:center;font-size: 12px;">
                                                Customer Name
                                            </th>
                                            <td style="text-align:center;">
                                                FF Type
                                            </td>
                                            <td style="text-align:center;">
                                                Contract Billing
                                            </td>
                                            <td style="text-align:center;">
                                                FF Started
                                            </td>
                                            <td style="text-align:center;">
                                                Payment #
                                            </td>
                                            <td style="text-align:center;">
                                                No of Payment
                                            </td>
                                            <td style="text-align:center;width:140px;">
                                                Total FinderFee
                                            </td>
                                            <td style="text-align:center;width:140px;">
                                                Total DownPayment
                                            </td>
                                            <td style="text-align:center;width:140px;">
                                                Total Monthly Payment
                                            </td>
                                            <td style="text-align:center;width:80px;">
                                                Total Paid
                                            </td>
                                            <td style="text-align:center;width:80px;">
                                                Balance
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="col-md-12">
                    &nbsp;<button type="button" class="btn btn-primary button-next pull-right" style="margin-left:10px;" onclick="DetailListPrint()">Print</button>
                    &nbsp;<button type="submit" class="btn btn-primary button-next pull-right" onclick="DetailListExportPDF()">Export</button>
                </div>
                <div style="clear:both"></div>
            </div>

        </div>

    </div>
</div>

<div class="modal fade in" id="modal_FranchiseDetailPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 8px;" id="RenderFranchiseDetailPopup">
        </div>
    </div>
</div>

<div class="modal fade custom-model custom-form-design" id="ModalEditFranchisePopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:645px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderEditFranchiseDetails">
        </div>
    </div>
</div>

<div class="modal fade custom-model custom-form-design" id="ModalEditFranchisePlanInfoPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:520px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderEditFranchisePlanInfoPopup">
        </div>
    </div>
</div>

<div class="modal fade custom-model custom-form-design" id="ModalEditFranchiseUploadDocumentPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:700px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderEditFranchiseUploadDocumentPopup">
        </div>
    </div>
</div>
<div id="form_FranchiseeCustomerMaintenanceApproval"></div>

<div class="modal fade custom-model custom-form-design" id="ModalFranchiseeLegalCompliancePopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:700px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderFranchiseeLegalCompliancePopup">
        </div>
    </div>
</div>

@section pageplugins{
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/app.min.js")" type="text/javascript" )"></script>
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js")" type="text/javascript"></script>
}

@section scripts{
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/components-date-time-pickers.min.js")" type="text/javascript"></script>

    <script type="text/javascript">
        var flagForCreatedUser = '@Convert.ToString(JKApi.Core.Common.ClaimView.Instance.GetCLAIM_ROLE_TYPE() == "Accounting-User" || JKApi.Core.Common.ClaimView.Instance.GetCLAIM_ROLE_TYPE() == "Marketing" ? true : false)'
        var FranchiseeID = parseInt(@TempData["FranchiseeID"])

        function getCurrentUrl() {
            var s = "12,36,37"; // pending, rejected, legal compliance pending
            var r = $('#regionlist').val();
            return '@Url.Action("FranchiseDataTable", "Franchise", new { area = "Portal" })?status=' + (s == null ? '0' : s) + '&rId=' + r;
        }

        $(document).ready(function () {
            if (!isNaN(FranchiseeID)) {
                showDetail(FranchiseeID);
            }
        });

        var dtable;
        $(function () {
            $("#regionlist").multiselect({
                includeSelectAllOption: true,
                selectAllText: 'Select all',
                buttonWidth: '100%',
                nonSelectedText: 'Select region..',
                dropRight: true,
                numberDisplayed: 2
            });
            //$("#ddlStatus").multiselect({
            //    includeSelectAllOption: true,
            //    selectAllText: 'Select all',
            //    buttonWidth: '100%',
            //    nonSelectedText: 'Select status..',
            //    dropRight: true,
            //    numberDisplayed: 2,
            //    onChange: function (event) {
            //        if (dtable) {
            //            dtable.api().ajax.url(encodeURI(getCurrentUrl())).load();
            //        }
            //    },
            //    onSelectAll: function (event) {
            //        if (dtable) {
            //            dtable.api().ajax.url(encodeURI(getCurrentUrl())).load();
            //        }
            //    },
            //    onDeselectAll: function (event) {
            //        if (dtable) {
            //            dtable.api().ajax.url(encodeURI(getCurrentUrl())).load();
            //        }
            //    }
            //});
            $(document).on('init.dt', function (e, settings) {
                var api = new $.fn.dataTable.Api(settings);
                if ($(api.table().node()).attr('id') == 'franchiseList') {
                    setPaging();
                }
            });
            var ps = $('#pageSize').val();
            dtable = $('#franchiseList').dataTable({
                "bAutoWidth": false,
                cache: false,
                "iDisplayLength": ps == '-1' ? 25 : ps,
                "bDestroy": true,
                "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                //"dom": "<'headerbox list'<'row'<'col-md-1'l><'col-md-4'f><'#divrightckbox.col-md-5 pull-right text-center'>>><'table-responsive't><'bottom'ip><'clear'>",
                "dom": "<'table-responsive't><'bottom'ip><'clear'>",
                "aaSorting": [[0, "desc"]],
                "sAjaxSource": getCurrentUrl(),
                "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
                "rowCallback": function (nRow, data) {

                },

                "aoColumns": [
                    {
                        "sName": "region",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            return '<span>' + full.RegionName + '</span>';
                        }
                    },
                    //{
                    //    "sName": "Number",
                    //    "bSortable": true,
                    //    "sClass": "alignCenter",
                    //    "mRender": function (data, type, full) {
                    //        return '<span>' + full.Number + '</span>';
                    //    }
                    //},
                    {
                        "sName": "Name",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            if (full.IsTemp == 1) {
                                return "<a href='javascript:void(0)' onclick='showDetail_Temp(" + full.ID + ")'>" + full.Name + "</a>";
                            }
                            else {
                                return "<a href='javascript:void(0)' onclick='showDetail(" + full.ID + ")'>" + full.Name + "</a>";
                            }
                        }
                    },
                    {
                        "sName": "Address",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            return full.Address;
                        }
                    },
                    {
                        "sName": "Phone",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.Phone;

                        }
                    },
                    {
                        "sName": "StatusName",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.StatusName;

                        }
                    },
                    {
                        "sName": "DistributionAmount",
                        "bSortable": true,
                        "sClass": "right",
                        "mRender": function (data, type, full) {
                            //return full.DistributionAmount;
                            return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    },
                    {
                        "sName": "Action",
                        "bSortable": true,
                        "sClass": "personlink",
                        "mRender": function (data, type, full) {
                            //return "<a href='@Url.Action("MaintenanceStepOne", "Franchise", new { @area = "Portal" })?id=" + full.ID + "' target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            //return "<a target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            var action = "<div class='btn-group dropdown'>";
                            action += "<a target='_blank'  dropdown-toggle' data-toggle='dropdown'>";
                            action += "<i class='fa fa-hand-o-right' aria-hidden='true'></i>";
                            action += "</a>";
                            action += "<ul class='dropdown-menu pull-right'>";

                            action += "<li><a href='#' onclick='OpenEditFranchisePopup(" + full.ID + ")'><i class='fa fa-plus'></i> Edit Franchisee Info </a></li>";
                            action += "<li><a href='#' onclick='OpenEditFranchisePlanInfoPopup(" + full.ID + ")'><i class='fa fa-plus'></i> Plan Information </a></li>";
                            action += "<li><a href='#' onclick='OpenEditFranchiseUploadDocumentPopup(" + full.ID + ")'><i class='fa fa-plus'></i>Documents </a></li>";

                            action += "<li><a href='#'><i class='fa fa-plus'></i>Maintenance </a></li>";
                            action += "<li><a href='#'><i class='fa fa-plus'></i>Lease </a></li>";
                            action += "<li><a href='#'><i class='fa fa-plus'></i>Account Offering</a></li>";


                            //action += "<li><a href='#' onclick='btnOpenDetail(" + full.ID + ")'><i class='fa fa-plus'></i> Fee Finder </a></li>";
                            //action += "<li><a href='#' onclick='btnManualTranscation(" + full.ID + ")'><i class='fa fa-plus'></i> Manual Transactions </a></li>";
                            //action += "<li><a href='#' onclick='btnAddTranscation(" + full.ID + ")'><i class='fa fa-plus'></i> Add Transactions </a></li>";

                            action += "</ul></div>&nbsp;&nbsp;&nbsp;";
                            action += "<a href='#' onclick='DeleteCustomerRecord(" + full.ID + ")' style='font-size;12px'><i class='fa fa-trash'></i></a>";
                            return action;
                        }
                    }
                ]
            });

            $("#divrightckbox").append('<label class="mt-checkbox" style="margin: 4px 20px 0 0;padding-left: 25px;"><input type="checkbox" id="chkActive" checked><span></span> Active</label><label class="mt-checkbox" style="margin: 4px 20px 0 0;padding-left: 25px;"><input id="chkInActive" type="checkbox"><span></span> Inactive</label><label class="mt-checkbox" style="margin: 4px 20px 0 0;padding-left: 25px;"><input type="checkbox" id="chkPending"><span></span> Pending</label>');

            $('.modal-dialog').draggable();

            $("#input_Search").keyup(function () {
                var table = $("#franchiseList").DataTable();
                table.search($(this).val()).draw();
            });

            $('#regionlist').change(function () {
                _bindFranchise();
            });

            $("#pageSize").change(function () {
                setPaging();
            });
            $('#divfranchiseList').show();
        });

        function showDetail(Id) {
            var sURL = '@Url.Action("PendingApprovalListFranchiseDetailPopup", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderFranchiseDetailPopup').html(data);
                    $("#modal_FranchiseDetailPopup").modal({ backdrop: 'static' });
                    if (flagForCreatedUser != null && flagForCreatedUser != undefined && flagForCreatedUser != "") {
                        if (flagForCreatedUser == "True") {
                            $(".MainAdmins").hide();
                        }

                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function setPaging() {
            var z = $("#pageSize").val();
            var table = $("#franchiseList").DataTable();
            if (z > 0) {
                table.page.len(z).draw();
            }
            else if (z == -1) {
                table.page.len(table.rows().count()).draw();
            }
            else {
                table.page.page.len(25).draw();
            }
        }

        function OpenEditFranchisePopup(Id) {

            var sURL = '@Url.Action("PendingApprovalListEditFranchiseDetailsPopup", "Franchise", new { area = "Portal" })?id=' + Id;

            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderEditFranchiseDetails').html(data);
                    $("#ModalEditFranchisePopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });

            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }

        function OpenEditFranchisePopupTemp(Id) {

            var sURL = '@Url.Action("PendingApprovalListEditFranchiseDetailsPopupTemp", "Franchise", new { area = "Portal" })?id=' + Id;

            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderEditFranchiseDetails').html(data);
                    $("#ModalEditFranchisePopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });

            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }

        function OpenEditFranchisePlanInfoPopup(Id) {

            var sURL = '@Url.Action("RenderEditFranchisePlanInfoPopup", "Franchise", new { area = "Portal" })?id=' + Id;

            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderEditFranchisePlanInfoPopup').html(data);
                    $(".date-picker").datepicker();
                    $("#ContractInfo_StartDate").datepicker();
                    $("#ContractInfo_LegalObligationStartDate").datepicker();
                    $("#ContractInfo_LegalObligationEndDate").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#ModalEditFranchisePlanInfoPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function OpenEditFranchisePlanInfoPopupTemp(Id) {

            var sURL = '@Url.Action("RenderEditFranchisePlanInfoPopupTemp", "Franchise", new { area = "Portal" })?id=' + Id;

            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderEditFranchisePlanInfoPopup').html(data);
                    $(".date-picker").datepicker();
                    $("#ContractInfo_StartDate").datepicker();
                    $("#ContractInfo_LegalObligationStartDate").datepicker();
                    $("#ContractInfo_LegalObligationEndDate").datepicker();
                    $("#ContractInfo_LastRenewedContractDate").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#ModalEditFranchisePlanInfoPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function OpenEditFranchiseUploadDocumentPopup(Id) {
            var sURL = '@Url.Action("PendingApprovalListFranchiseeUploadDocumentPopup", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderEditFranchiseUploadDocumentPopup').html(data);
                    $("#ModalEditFranchiseUploadDocumentPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function OpenEditFranchiseUploadDocumentPopupTemp(Id) {
            var sURL = '@Url.Action("PendingApprovalListFranchiseeUploadDocumentPopupTemp", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderEditFranchiseUploadDocumentPopup').html(data);
                    $("#ModalEditFranchiseUploadDocumentPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


        function _bindFranchise() {

            dtable = $('#franchiseList').dataTable({
                "bAutoWidth": false,
                cache: false,
                "bDestroy": true,
                "iDisplayLength": $('#pageSize').val() == -1 ? 25 : $('#pageSize').val(),
                "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                //"dom": "<'headerbox list'<'row'<'col-md-1'l><'col-md-4'f><'#divrightckbox.col-md-5 pull-right text-center'>>><'table-responsive't><'bottom'ip><'clear'>",
                "dom": "<'table-responsive't><'bottom'ip><'clear'>",
                "aaSorting": [[0, "desc"]],
                "sAjaxSource": getCurrentUrl(),
                "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
                "rowCallback": function (nRow, data) {

                },

                "aoColumns": [
                    {
                        "sName": "region",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            return '<span>' + full.RegionName + '</span>';
                        }
                    },
                    {
                        "sName": "Number",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            return '<span>' + full.Number + '</span>';
                            @*return "<a href='@Url.Action("Franchiseedetail", "Franchise", new { @area = "Portal" })?id=" + full.ID + "'  style='color:#0c9cff' id=" + full.ID + "><span style=padding-left:15px>" + full.Number + "</span></a>";*@
                        }
                    },
                    {
                        "sName": "Name",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            // return full.Name;
                            return "<a href='@Url.Action("Franchiseedetail", "Franchise", new { @area = "Portal" })?id=" + full.ID + "'  style='color:#0c9cff' id=" + full.ID + ">" + full.Name + "</a>";
                        }
                    },
                    {
                        "sName": "Address",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            return full.Address;
                        }
                    },
                    {
                        "sName": "Phone",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.Phone;

                        }
                    },
                    {
                        "sName": "StatusName",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.StatusName;

                        }
                    },
                    {
                        "sName": "DistributionAmount",
                        "bSortable": true,
                        "sClass": "right",
                        "mRender": function (data, type, full) {
                            //return full.DistributionAmount;
                            return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    },
                    {
                        "sName": "Action",
                        "bSortable": true,
                        "sClass": "personlink",
                        "mRender": function (data, type, full) {
                            //return "<a href='@Url.Action("MaintenanceStepOne", "Franchise", new { @area = "Portal" })?id=" + full.ID + "' target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            //return "<a target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            var action = "<div class='btn-group dropdown'>";
                            action += "<a target='_blank'  dropdown-toggle' data-toggle='dropdown'>";
                            action += "<i class='fa fa-caret-down' aria-hidden='true'></i>";
                            action += "</a>";
                            action += "<ul class='dropdown-menu pull-right'>";
                            action += "<li><a href='#' onclick='btnOpenDetail(" + full.ID + ")'><i class='fa fa-plus'></i> FindersFee </a></li>";
                            action += "<li><a href='#'><i class='fa fa-plus'></i> Customer Sales</a></li>";
                            action += "</ul></div>";
                            return action;
                        }
                    }
                ]
            });
        }

        function OpenFranchiseDistributionPopup(Id) {
            var sURL = '@Url.Action("RenderFranchiseDistributionDetailPopup", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderFranchiseDistribution').html(data);
                    $("#ModalFranchiseDistributionPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }
        function OpenFranchiseeLegalCompliancePopup(Id) {
            var sURL = '@Url.Action("FranchiseeLegalCompliancePopup", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderFranchiseeLegalCompliancePopup').html(data);
                    $("#ModalFranchiseeLegalCompliancePopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function OpenFranchiseeLegalCompliancePopupTemp(Id) {
            var sURL = '@Url.Action("FranchiseeLegalCompliancePopupTemp", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderFranchiseeLegalCompliancePopup').html(data);
                    $("#ModalFranchiseeLegalCompliancePopup").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }

        var btnOpenDetail = function (id) {
            $.blockUI();
            $('#tblFFDetailList tbody').html('');
            $.ajax({
                type: "GET",
                url: '@Url.Action("FinderFeeDetailListData", "Franchise", new { area = "Portal" })?frenchiseid=' + id,
                success: function (data) {
                    console.log(data);


                    var spnFF_TotalFinderFee = 0.00;
                    var spnFF_TotalDownPayment = 0.00;
                    var spnFF_TotalMonthlyPayment = 0.00;
                    var spnFF_TotalPaid = 0.00;
                    var spnFF_Balance = 0.00;


                    data.forEach(function (item) {

                        $('#spnFF_FranchiseeNo').html(item.FranchiseeNo);
                        $('#spnFF_FranchiseeName').html(item.FranchiseeName);

                        $('#hddFF_FranchiseeId').val(item.FranchiseeId);


                        spnFF_TotalFinderFee += parseFloat(item.TotalFinderFee);
                        spnFF_TotalDownPayment += parseFloat(item.TotalDownPayment);
                        spnFF_TotalMonthlyPayment += parseFloat(item.MonthlyPaymentAmount);
                        spnFF_TotalPaid += parseFloat(item.PaidAmount);
                        spnFF_Balance += parseFloat(item.TotalBalance);
                        trInvoicelist = "";
                        //trInvoicelist += '<td style="text-align:left;">' + item.FranchiseeId + '</td>';
                        //trInvoicelist += '<td style="text-align:left;">' + item.FranchiseeNo + '</td>';
                        //trInvoicelist += '<td style="text-align:left;">' + item.FranchiseeName + '</td>';
                        //trInvoicelist += '<td style="text-align:left;">' + item.CustomerId + '</td>';
                        //trInvoicelist += '<td style="text-align:left;">' + item.FindersFeeTypeListId + '</td>';
                        //trInvoicelist += '<td style="text-align:left;">' + item.RegionId + '</td>';
                        trInvoicelist += '<tr><td style="text-align:center;">' + item.CustomerNo + '</td>';
                        trInvoicelist += '<td style="text-align:left;">' + item.CustomerName + '</td>';
                        trInvoicelist += '<td style="text-align:left;">' + item.FindersFeeTypeListName + '</td>';
                        trInvoicelist += '<td style="text-align:center;">' + moment(new Date(parseInt(item.StartTime.substr(6)))).format("MM/DD/YYYY") + '</td>';
                        trInvoicelist += '<td style="text-align:center;">' + moment(new Date(parseInt(item.StartDate.substr(6)))).format("MM/DD/YYYY") + '</td>';
                        trInvoicelist += '<td style="text-align:center;">' + item.TotalNumOfpayments + '</td>';
                        trInvoicelist += '<td style="text-align:center;">' + item.NumOfPaymentsPaid + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$' + parseFloat(item.TotalFinderFee, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$' + parseFloat(item.TotalDownPayment, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$' + parseFloat(item.MonthlyPaymentAmount, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$' + parseFloat(item.PaidAmount, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td>';
                        trInvoicelist += '<td style="text-align:right;">$' + parseFloat(item.TotalBalance, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString() + '</td></tr>';

                        $('#tblFFDetailList tbody').append(trInvoicelist);
                    });


                    $('#spnFF_TotalFinderFee').html(spnFF_TotalFinderFee.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString())
                    $('#spnFF_TotalDownPayment').html(spnFF_TotalDownPayment.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString())
                    $('#spnFF_TotalMonthlyPayment').html(spnFF_TotalMonthlyPayment.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString())
                    $('#spnFF_TotalPaid').html(spnFF_TotalPaid.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString())
                    $('#spnFF_Balance').html(spnFF_Balance.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString())



                    $("#modal_FeeReport").modal('show');
                    $.unblockUI();
                }
            });


        }
        var btnManualTranscation = function (id) {
            location.href = "@Url.Action("ManualInvoice", "AccountReceivable", new { area = "Portal", id = ViewBag.FranchiseeID })";
        }
        var btnAddTranscation = function (id) {
            location.href = "@Url.Action("AddNewTransaction", "Franchise", new { area = "Portal", id = ViewBag.FranchiseeID })";
        }
        var DeleteCustomerRecord = function DeleteCustomerRecord(Id) {

            var sURL = '@Url.Action("DeleteCustomerRecord", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    _binslistdata();
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function _binslistdata() {
            var ps = $('#pageSize').val();
            dtable = $('#franchiseList').dataTable({
                "bAutoWidth": false,
                cache: false,
                "iDisplayLength": ps == '-1' ? 25 : ps,
                "bDestroy": true,
                "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                //"dom": "<'headerbox list'<'row'<'col-md-1'l><'col-md-4'f><'#divrightckbox.col-md-5 pull-right text-center'>>><'table-responsive't><'bottom'ip><'clear'>",
                "dom": "<'table-responsive't><'bottom'ip><'clear'>",
                "aaSorting": [[0, "desc"]],
                "sAjaxSource": getCurrentUrl(),
                "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
                "rowCallback": function (nRow, data) {

                },

                "aoColumns": [
                    {
                        "sName": "region",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            return '<span>' + full.RegionName + '</span>';
                        }
                    },
                    {
                        "sName": "Number",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            return '<span>' + full.Number + '</span>';
                            @*return "<a href='@Url.Action("Franchiseedetail", "Franchise", new { @area = "Portal" })?id=" + full.ID + "'  style='color:#0c9cff' id=" + full.ID + "><span style=padding-left:15px>" + full.Number + "</span></a>";*@
                        }
                    },
                    {
                        "sName": "Name",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            // return full.Name;
                            @*return "<a href='@Url.Action("Franchiseedetail", "Franchise", new { @area = "Portal" })?id=" + full.ID + "'  style='color:#0c9cff' id=" + full.ID + ">" + full.Name + "</a>";*@
                            return "<a href='javascript:void(0)' onclick='showDetail(" + full.ID + ")'>" + full.Name + "</a>";
                        }
                    },
                    {
                        "sName": "Address",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            return full.Address;
                        }
                    },
                    {
                        "sName": "Phone",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.Phone;

                        }
                    },
                    {
                        "sName": "StatusName",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.StatusName;

                        }
                    },
                    {
                        "sName": "DistributionAmount",
                        "bSortable": true,
                        "sClass": "right",
                        "mRender": function (data, type, full) {
                            //return full.DistributionAmount;
                            return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    },
                    {
                        "sName": "Action",
                        "bSortable": true,
                        "sClass": "personlink",
                        "mRender": function (data, type, full) {
                            //return "<a href='@Url.Action("MaintenanceStepOne", "Franchise", new { @area = "Portal" })?id=" + full.ID + "' target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            //return "<a target='_blank' style='color:#0c9cff' id=" + full.ID + "><i class='fa fa-user' style='color:#0c9cff'></i> </a>";
                            var action = "<div class='btn-group dropdown'>";
                            action += "<a target='_blank'  dropdown-toggle' data-toggle='dropdown'>";
                            action += "<i class='fa fa-hand-o-right' aria-hidden='true'></i>";
                            action += "</a>";
                            action += "<ul class='dropdown-menu pull-right'>";

                            action += "<li><a href='#' onclick='OpenEditFranchisePopup(" + full.ID + ")'><i class='fa fa-plus'></i> Edit Franchisee Info </a></li>";
                            action += "<li><a href='#' onclick='OpenEditFranchisePlanInfoPopup(" + full.ID + ")'><i class='fa fa-plus'></i> Plan Information </a></li>";
                            action += "<li><a href='#' onclick='OpenEditFranchiseUploadDocumentPopup(" + full.ID + ")'><i class='fa fa-plus'></i>Documents </a></li>";

                            action += "<li><a href='#'><i class='fa fa-plus'></i>Maintenance </a></li>";
                            action += "<li><a href='#'><i class='fa fa-plus'></i>Lease </a></li>";
                            action += "<li><a href='#'><i class='fa fa-plus'></i>Account Offering</a></li>";


                            //action += "<li><a href='#' onclick='btnOpenDetail(" + full.ID + ")'><i class='fa fa-plus'></i> Fee Finder </a></li>";
                            //action += "<li><a href='#' onclick='btnManualTranscation(" + full.ID + ")'><i class='fa fa-plus'></i> Manual Transactions </a></li>";
                            //action += "<li><a href='#' onclick='btnAddTranscation(" + full.ID + ")'><i class='fa fa-plus'></i> Add Transactions </a></li>";

                            action += "</ul></div>&nbsp;&nbsp;&nbsp;";
                            action += "<a href='#' onclick='DeleteCustomerRecord(" + full.ID + ")' style='font-size;12px'><i class='fa fa-trash'></i></a>";
                            return action;
                        }
                    }
                ]
            });
        }

        function showDetail_Temp(Id) {
            var sURL = '@Url.Action("PendingApprovalListFranchiseDetailPopupTemp", "Franchise", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderFranchiseDetailPopup').html(data);
                    $("#modal_FranchiseDetailPopup").modal({ backdrop: 'static' });
                    if (flagForCreatedUser != null && flagForCreatedUser != undefined && flagForCreatedUser != "") {
                        if (flagForCreatedUser == "True") {
                            $(".MainAdmins").hide();
                        }

                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    </script>
}
