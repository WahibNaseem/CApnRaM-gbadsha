@model JKViewModels.Customer.CollectionsCallLogModel

<div class="modal-content" style="border-radius: 8px;">
    <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
        <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
            COLLECTION CALL LOG
        </h4>
    </div>
    <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
        <div class="form-body" style="padding-top: 0px;">
                         
            <div class="form-group">
                <div class="col-md-12">
                    <div class="col-md-5 control-label">
                        <span>Select Customer:<span style="color:#000000;">&nbsp;:</span></span>
                    </div>
                    <div class="col-md-4" style="padding-top: 8px;">
                        @Html.DropDownListFor(x => x.CustomerNo, (IEnumerable<SelectListItem>)ViewBag.CustomerList, new { @class = "form-control input-sm ddlCustomer", required = "required", onchange = "OnchangeCustomerDetails()" })
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12" style="padding-left:0px;padding-right:0px;">
                    <hr style="margin-top: 5px;margin-bottom: 5px;" />
                </div>
            </div>

            @using (Html.BeginForm("CollectionCallLog", "Franchise", FormMethod.Post, new { @id = "frmCollectionCallLog", @role = "form" }))
            {
                @*if (ViewBag.CustomerDetail != null)
                {
                    @Html.HiddenFor(x => x.ClassId, new { @Value = ViewBag.CustomerDetail.CustomerId })
                    @Html.HiddenFor(x => x.TypeListId, new { @Value = "1" })
                    @Html.HiddenFor(x => x.RegionId, new { @Value = ViewBag.CustomerDetail.RegionId })*@
                    <input type="hidden" id="hdnCustomerId" value="0" />
                    <input type="hidden" id="ClassId" name="ClassId" value="0" />

                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3 control-label" style="padding-top: 0px;">
                                    <span>Customer No.<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-2">
                                    <b><span id="spnCustomerNo"> </span></b>
                                </div>
                                <div class="col-md-2">
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;">
                                    <span>Contact<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-3">
                                    <b><span id="spnContactName"> </span></b>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3 control-label" style="padding-top: 0px;">
                                    <span>Customer Name<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-4">
                                    <b><span id="spnCustomerName"> </span></b>
                                </div>
                                <div class="col-md-2 control-label" style="padding-top: 0px;padding-bottom: 12px;">
                                    <span>Phone No.<span style="color:#000000;">&nbsp;:</span></span>
                                </div>
                                <div class="col-md-3">
                                    <b><span id="spnPhone"> </span></b>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12" style="padding-left:0px;padding-right:0px;">
                            <hr style="margin-top: 5px;margin-bottom: 10px;" />
                        </div>
                    </div>
                @*}*@
                <div class="form-group">
                    <div class="row" style="padding-left:25px;padding-right:25px;">
                        <div class="col-md-12" style="border: 1px solid #b1acac;">
                            <div class="col-md-12" style="padding-top: 0px;padding-bottom: 12px;">
                                <center>AR Status Effective: 12/08/2017</center>
                            </div>
                            <div class="col-md-12" style="padding-top: 0px;padding-bottom: 12px;">
                                <div class="col-md-3">Aging Current: $0.00</div>
                                <div class="col-md-2">30 Days: $0.00</div>
                                <div class="col-md-2">60 Days: $0.00</div>
                                <div class="col-md-2">90 Days: $0.00</div>
                                <div class="col-md-3">120 Days: $0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-12">
                        <div class="col-md-2 control-label">
                            Call Date/Time<span style="color:#000000;">&nbsp;:</span>
                        </div>
                        <div class="col-md-3 control-label" style="text-align:left;">
                            @DateTime.Now.ToString("MM/dd/yyyy hh:mm tt")
                        </div>
                        <div class="col-md-3 control-label">
                            @*<input type="checkbox" name="InternalNote" value="true" class="checkbox-inline" />&nbsp;Internal Note*@
                            @Html.CheckBoxFor(x => x.boolInternal, new { @class = "checkbox-inline", @value = "True" }) &nbsp; Internal
                        </div>
                        <div class="col-md-2 control-label">Staus<span style="color:#000000;">&nbsp;:</span></div>
                        <div class="col-md-2">
                            @Html.DropDownListFor(x => x.StatusResultListId, (IEnumerable<SelectListItem>)ViewBag.StatusResultList, new { @class = "form-control input-sm ddl", required = "required" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-12">
                        <div class="col-md-2 control-label">
                            Spoke With<span style="color:#000000;">&nbsp;:</span>
                        </div>
                        <div class="col-md-2">
                            @Html.TextBoxFor(x => x.SpokeWith, new { @class = "input-sm form-control" })
                        </div>
                        <div class="col-md-2 control-label" style="padding: 5px 27px 0px 0px;">
                            Action<span style="color:#000000;">&nbsp;:</span>
                        </div>
                        <div class="col-md-2" style="padding:0px;">
                            @Html.TextBoxFor(x => x.Action, new { @class = "input-sm form-control" })
                        </div>
                        <div class="col-md-2 control-label">
                            Followup By<span style="color:#000000;">&nbsp;:</span>
                        </div>
                        <div class="col-md-2">
                            <select class="input-sm form-control dropdown">
                                <option>Option1</option>
                                <option>Option2</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-12">
                        <div class="col-md-2 control-label">
                            Comments<span style="color:#000000;">&nbsp;:</span>
                        </div>
                        <div class="col-md-10">
                            @Html.TextAreaFor(x => x.Comments, new { @class = "input-sm form-control", @rows = "5", @style = "min-width: 545px;" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-12">
                        <div class="col-md-4">
                            Followup By@*style="margin:0 88px 0px -20px!important"*@
                            Call Back<span style="color:#000000;">&nbsp;:</span>
                            <div class="input-group input-medium date date-picker" data-date-format="dd-mm-yyyy" data-date-start-date="+0d">
                                @Html.TextBoxFor(x => x.strCallBack, new { @class = "form-control input-sm" })
                                <span class="input-group-btn">
                                    <button class="btn default" type="button">
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            Email Comment to<span style="color:#000000;">&nbsp;:</span>
                            @*@Html.DropDownListFor(x => x.EmailNotesTo, new SelectList(ViewBag.Franchisees, "Key", "Value"), new { @class = "form-control input-sm", required = "required", @multiple = "multiple" })*@
                            <select class="form-control input-sm ddl" multiple>
                                <option value="Maria">Maria</option>
                                <option value="Stacy">Stacy</option>
                                <option value="Andrea">Andrea</option>
                                <option value="Andrea">Bob Miller</option>
                                <option value="Andrea"></option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            Relate To Franchise<span style="color:#000000;">&nbsp;:</span>
                            @Html.DropDownListFor(x => x.arrFranchiseIds, new SelectList(ViewBag.Franchisees, "Key", "Value"), new { @class = "form-control input-sm ddl", @multiple = "multiple" })
                        </div>
                    </div>
                </div>
                <hr />
                <div class="form-group">
                    <div class="col-md-12 text-right" style="padding-right:30px;">
                        <input type="button" class="btn btn-primary btn-default" id="SaveForm" value="Save" onclick="return checkMandatoryFields();" />
                        <input type="button" class="btn btn-primary btn-default" value="Cancel" onclick="onclickCollectionsCallLogCancel()" />
                    </div>
                </div>
            }

            <div class="row" style="margin-top:5px">
                <div class="col-md-12">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="tblCollectionCall">
                            <thead>
                                <tr>
                                    <th style="width:70px;text-align:center;background-color: #4b85cc;color:white" class="tblServiceCall_CustNo">
                                        Date/Time
                                    </th>
                                    <th style="text-align:center;width:30px;background-color: #4b85cc;color:white" class="tblServiceCall_Status">
                                        Status
                                    </th>
                                    <th style="text-align:center;width:60px;background-color: #4b85cc;color:white" class="tblServiceCall_Spoke">
                                        Spoke With
                                    </th>
                                    <th style="text-align:center;width:60px;background-color: #4b85cc;color:white" class="tblServiceCall_Action">
                                        Action
                                    </th>
                                    <th style="text-align:center;width:70px;background-color: #4b85cc;color:white" class="tblServiceCall_CallBack">
                                        Call Back
                                    </th>
                                    <th style="text-align:center;width:200px;background-color: #4b85cc;color:white" class="tblServiceCall_Comment">
                                        Comment
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @*
                                    <tr>
                                    <td style="text-align:center;">10/26/2017<br />5:55:24 AM</td>
                                    <td style="text-align:center;">Other</td>
                                    <td style="text-align:center;"></td>
                                    <td style="text-align:center;">Email Invoice</td>
                                    <td style="text-align:center;"></td>
                                    <td>System emailed invoice 101702016 to EGARD@PAULTBIDDLEMD.COM via eBill function --> jillbean</td>
                                    </tr>
                                    <tr>
                                    <td style="text-align:center;">9/21/2017<br />2:04:15 AM</td>
                                    <td style="text-align:center;">Other</td>
                                    <td style="text-align:center;"></td>
                                    <td style="text-align:center;">Email Invoice</td>
                                    <td style="text-align:center;"></td>
                                    <td>System emailed invoice 101702015 to EGARD@PAULTBIDDLEMD.COM via eBill function --> jillbean</td>
                                    </tr>*@
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        //Datepicker set
        $('.date-picker').datepicker({ autoclose: true, dateFormat: 'mm/dd/yy' });
        $('.date-picker').attr("placeholder", "mm/dd/yyyy");

        //List data load
        LoadCollectionsCallLogList();
    });

    //Load list data
    function LoadCollectionsCallLogList() {
        var CurrentLink = '@Url.Action("GetCollectionLog", "Customer", new { area = "Portal" })?id=' + $("#hdnCustomerId").val();
            var dtable = $('#tblCollectionCall').dataTable({
                "bAutoWidth": false,
                cache: false,
                "order": false,
                "bDestroy": true,
                "bLengthMenu": false,
                "dom": '<"top">rt<"bottom"lp><"clear">',
                "aaSorting": [[0, "desc"]],
                "sAjaxSource": CurrentLink,
                "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
                "rowCallback": function (nRow, data) {
                },

                "aoColumns": [
                    {
                        "sName": "Date/Time",
                        "bSortable": true,
                        "sClass": "alignleft",
                        "mRender": function (data, type, full) {
                            //var datetime = "<span>" + moment(new Date(parseInt(full.CallDate.substr(6)))).format("MM/DD/YYYY") + "<br />" + formatJSONTime(full.CallTime) + "</span>";
                            var datetime = "<span>" + moment(new Date(parseInt(full.CallDate.substr(6)))).format("MM/DD/YYYY") + "<br />" + full.CallTime + "</span>";
                            return datetime;
                        }
                    },
                    {
                        "sName": "Status",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            return full.Status;
                        }
                    },
                    {
                        "sName": "SpokeWith",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            return full.SpokeWith;
                        }
                    },
                    {
                        "sName": "Action",
                        "bSortable": true,
                        "sClass": "alignCenter",
                        "mRender": function (data, type, full) {
                            return full.Action;
                        }
                    },
                    {
                        "sName": "CallBack",
                        "bSortable": true,
                        "mRender": function (data, type, full) {
                            if (full.CallBack != null && full.CallBack != "") {
                                return moment(new Date(parseInt(full.CallBack.substr(6)))).format("MM/DD/YYYY");
                            }
                            return "";

                        }
                    },
                    {
                        "sName": "Comments",
                        "bSortable": true,
                        "sClass": "alignleft",
                        "mRender": function (data, type, full) {
                            return full.Comments;
                        }
                    },
                ],
            });
    }

    function checkMandatoryFields() {

        if ($("#hdnCustomerId").val() != "" && $("#hdnCustomerId").val() != "0") {
            $('.ddlCustomer').css('border-color', '');

            var Validation = false;

            if ($('#SpokeWith').val() == "") {
                $('#SpokeWith').css('border-color', 'red');
                Validation = false;
            } else { $('#SpokeWith').css('border-color', ''); Validation = true }

            if ($('#StatusResultListId').val() == 0) {
                $('#StatusResultListId').css('border-color', 'red');
                Validation = false;
            } else { $('#StatusResultListId').css('border-color', ''); Validation = true }
            //if ($('#StatusResultListId').val() == 1) {
            //    $('#SpokeWith').css('border-color', 'red');
            //    Validation = false;
            //}
            if ($('#StatusResultListId').val() == 1 && $('#SpokeWith').val() == "") {
                $('#SpokeWith').css('border-color', 'red'); Validation = false
            }
            else if ($('#StatusResultListId').val() == 1 && $('#SpokeWith').val() != "") {
                $('#SpokeWith').removeAttr('style', ''); Validation = true
            }
            if ($('#Action').val() == "") {
                $('#Action').css('border-color', 'red');
                Validation = false;
            } else { $('#Action').css('border-color', ''); Validation = true }
            if ($('#Comments').val() == "") {
                $('#Comments').css('border-color', 'red');
                Validation = false;
            } else { $('#Comments').css('border-color', ''); Validation = true }

            if (Validation == true) {
                $.ajax({
                    url: '@Url.Action("SaveCollectionCallLogDetails", "Franchise", new { area = "Portal" })',
                    type: "POST",
                    data: $('#frmCollectionCallLog').serialize(),
                    success: function (res) {
                        $('input[type=text]').val("");
                        $('.ddl').val("0");
                        $('#Comments').val("");
                        $('#boolInternal').prop("checked",false)
                        LoadCollectionsCallLogList()
                    },
                    error: function () { }
                });
            }
            return Validation;
        }
        else {
            $('.ddlCustomer').css('border-color', 'red');
            return false;
        }
    }
    function onclickCollectionsCallLogCancel() {
        $("#modal_CollectionsCallLog").modal('hide');
    }
    function OnchangeCustomerDetails() {

        var CustomerId = $(".ddlCustomer").val();
        if (CustomerId != null && CustomerId != "") {
            var Odata = { CustomerId: CustomerId };
            $.ajax({
                url: '@Url.Action("GetCustomerDetails", "Franchise")',
                dataType: "json",
                data: Odata,
                traditional: true,
                contentType: "application/json; charset=utf-8",
                success: function (Data) {
                    if (Data != null) {
                        $("#hdnCustomerId").val(Data.CustomerId)
                        $("#ClassId").val(Data.CustomerId)                         
                        $("#spnCustomerNo").html(Data.CustomerNo)
                        $("#spnCustomerName").html(Data.Name)
                        $("#spnContactName").html(Data.ContactName)
                        $("#spnPhone").html(Data.Phone)
                        LoadCollectionsCallLogList();
                    }
                },
                error: function () { }
            });
        }
    }
</script>