@{
    ViewBag.Title = "Customer Pending List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <link href='@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.css")' rel="stylesheet" type="text/css" />
    <link href='@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css")' rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css")" rel="stylesheet" type="text/css" />
}
<style>
    .close {
        background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
        height: 12px !important;
        width: 12px !important;
        margin-top: 0px !important;
    }

    .btn.multiselect {
        text-align: left;
    }

    .multiselect .caret {
        right: 0;
        position: absolute;
        margin-top: 8px;
        margin-right: 8px;
    }

    #ui-datepicker-div {
        z-index: 99999 !important;
    }

    .row {
        margin: 0;
        padding: 3px 0;
    }

    .page-size {
        padding-left: 0;
        padding-right: 0;
        width: 62px;
    }

    .topheader {
        font-size: 14px;
        font-weight: bold;
        color: #FFF !important;
        text-transform: uppercase;
        margin-top: 3px;
    }

    .alignRight {
        text-align: right;
    }

    .alignCenter {
        text-align: center;
    }

    #CustomerList th {
        vertical-align: middle;
    }

    .no-padding {
        padding: 0;
    }

    .no-margin {
        margin: 0;
    }

    .padding-tb1 {
        padding-top: 1px;
        padding-bottom: 1px;
    }

    .margin-tb1 {
        margin-top: 1px;
        margin-bottom: 1px;
    }

    .custom-listbox .headerbox {
        padding: 3px 0px 3px 5px;
    }

    .custom-listbox {
        margin-top: 4px;
        margin-bottom: 0px;
    }

    .btn.multiselect {
        text-align: left;
        padding-top: 4px;
        padding-bottom: 4px;
        font-size: 11px;
        color: #555;
    }

    .multiselect .caret {
        right: 0;
        position: absolute;
        margin-top: 8px;
        margin-right: 8px;
    }

    .multiselect-container.dropdown-menu {
        text-transform: none;
        font-size: 14px;
    }

    .contract {
        text-align: right;
    }

    .tablebox .table-responsive {
        min-height: 600px;
    }
</style>


@section pageplugins{
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-typeahead/bootstrap3-typeahead.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js")" type="text/javascript"></script>
    @*<link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/chosen.css")" />
        <script src="@Url.Content("~/Scripts/chosen.jquery.min.js")" type="text/javascript"></script>
        <script src="~/Scripts/jquery.uniform.min.js"></script>*@
    @if (Request.IsSecureConnection)
    {
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
    }
    else
    {
        <script src="http://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
    }
}

<div class="headerbox">
    <div class="row" style="background-color: #3598DC;color: #fff;">
        <div class="col-md-12 no-padding">
            <div class="alignCenter">
                <div class="col-md-4" style="text-align:right;">
                </div>
                <div class="col-md-4 topheader">
                    Pending Approval LIST
                </div>
                <div class="col-md-4" style="padding-right:5px;">
                    <div class="col-md-7 pull-right no-padding">
                        <div style="display:table-cell;padding-right: 5px;">
                            Region
                        </div>
                        <div style="display:table-cell;width:100%;">
                            @if (ViewBag.regionlist != null)
                            {
                                <select class="form-control input-sm" id="regionlist" multiple="multiple" style="display:none;">
                                    @foreach (var item in (SelectList)ViewBag.regionlist)
                                    {
                                        <option @( item.Selected ? "selected" : "" ) value="@item.Value">@item.Text</option>
                                    }
                                </select>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*Search Header Customer Pending list*@
<div class="custom-listbox">
    <div class="headerbox">
        <div class="row no-padding">
            <div class="col-md-1 page-size">
                <select class="form-control input-sm" id="pageSize" style="padding-left:6px;">
                    <option value="-1">All</option>
                    <option value="100" selected>100</option>
                    <option value="50">50</option>
                    <option value="25">25</option>
                </select>
            </div>
            <div class="col-md-3">
                <div class="input-icon">
                    <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                    <input id="input_Search" type="text" required name="customernumber" autocomplete="off" placeholder="Search..." value="" class="form-control input-sm typeahead" />
                </div>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-4 pull-right" style="padding-right:5px;">
                @*@if (ViewBag.StatusList != null)
                    {
                    <div class="col-md-12 pull-right no-padding">
                    <div class="col-md-6 no-padding" style="text-transform:none;font-weight:normal;text-align: right;margin-top: 3px;">
                    Customer Status
                    </div>
                    <div class="col-md-6 no-padding" style="padding-left: 6px;">
                    <select id="ddlStatus" multiple="multiple" style="display:none;">
                    @foreach (var item in (MultiSelectList)ViewBag.StatusList)
                    {
                    <option @(item.Selected ? "selected" : "") value="@item.Value">@item.Text</option>
                    }
                    </select>
                    </div>
                    </div>
                    }*@
            </div>
        </div>
    </div>
</div>

@*Customer Pending list Table*@
<div class="tablebox">
    <div class="table-responsive" id="divcustomerList" style="display:none;">
        <table class="table table-striped table-bordered table-hover order-column" id="CustomerList" style="display:none;margin-top:0 !important;">
            <thead>
                <tr>
                    <th style="width:25px;text-align:center;">
                        Region
                    </th>
                    <th style="width:7px;text-align:center;">
                        Customer ID
                    </th>
                    <th style="text-align:center;width:150px;">
                        Customer Name
                    </th>
                    <th style="text-align:center;width:210px;">
                        Full Address
                    </th>
                    <th style="text-align:center;width:40px;">
                        Phone
                    </th>
                    <th style="text-align:center;width:70px;">
                        Account Type
                    </th>
                    <th style="text-align:center;width:62px;">
                        Status
                    </th>
                    <th style="text-align:center;width:10px;">
                        Contract Amount
                    </th>
                    <th style="text-align:center;width:10px;">
                        Created By
                    </th>
                    <th style="text-align:center;width:4px;">
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!--Region Modal-->
<div class="modal fade in" id="modal_RegionModel" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    Select Region
                </h4>
            </div>
            <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                <div class="form-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-md-12" style="text-align: center;padding: 5px;background-color: #e8e8e8;margin-bottom:5px;font-weight:bold;">Select Region</label>
                                @if (ViewBag.regionlist != null)
                                {
                                    <select class="form-control input-sm" id="selectregionlist">
                                        <option value="">Select Region</option>
                                        @foreach (var item in (SelectList)ViewBag.regionlist)
                                        {
                                            <option @( item.Selected ? "selected" : "" ) value="@item.Value">@item.Text</option>
                                        }
                                    </select>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <div class="col-md-12">
                        <button type="button" name="SaveNew" id="btnRegion" class="btn btn-primary button-next pull-right" onclick="" style="margin-right:0px;">Select Region</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




@*Customer Distribution Popup Modal*@
<div class="modal fade custom-model custom-form-design" id="ModalCustomerDistributionPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:645px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerDistribution">
        </div>
    </div>
</div>

<!--Customer Detail Popup-->
<div class="form-horizontal" action="" id="form_ModelCustomerDetailsPopup"></div>

<form class="form-horizontal" action="" id="form_Billingsetting" method="POST">
    @*<div class="modal fade custom-model custom-form-design" id="ModalEditCustomerInfo" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
            <div class="modal-dialog" style="width:869px" id="RenderEditCustomerInfoPopup">
            </div>
        </div>*@
</form>


<!--Customer Contract-->
<div class="modal fade custom-model custom-form-design" id="modal_CustomerContractPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:785px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerContractDetails">
        </div>
    </div>
</div>


<!--Document-->
<div class="modal fade in" id="ModelCustomerUploadDocumentPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:877px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerUploadDocumentPopup">
        </div>
    </div>
</div>


@*MANUAL INVOICE Modal *@
<div class="modal fade in" id="modal_ManualInvoice" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    MANUAL INVOICE
                </h4>
            </div>
            @using (Html.BeginForm("ManualInvoice", "AccountReceivable", FormMethod.Post, new { area = "Portal", id = "form_manualinvoice_submitForm", style = "margin-top: -20px;" }))
            {
                @*@Html.HiddenFor(m => m.CustomerDetail.CustomerId, new { id = "hdfCustomerId", name = "CustomerId", required = "required" })*@

                <input type="hidden" id="hdftotallineno" name="hdftotallineno" />
                <input type="hidden" id="hdfftotallineno" name="hdfftotallineno" />

                <input type="hidden" id="hdfTaxRateId" name="hdfTaxRateId" />
                <input type="hidden" id="hdfContractTaxRate" name="hdfContractTaxRate" />
                <input type="hidden" id="hdfLeaseTaxRate" name="hdfLeaseTaxRate" />
                <input type="hidden" id="hdfSupplyTaxRate" name="hdfSupplyTaxRate" />
                <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                    <div class="form-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="control-label col-md-12" style="text-align: center;padding: 5px;background-color: #e8e8e8;margin-bottom:5px;font-weight:bold;">Customer</label>
                                    <label class="col-md-12"><b><span id="spncustomerno"></span></b></label>
                                    <label class="col-md-12"><span id="spncustomername"></span></label>
                                    <label class="col-md-12"><span id="spncustomeraddress"></span></label>
                                    <label class="col-md-12"><span id="spncustomercity"></span>, <span id="spncustomerstate"></span>&nbsp;<span id="spncustomerpincode"></span></label>
                                </div>
                            </div>
                            <div class="col-md-6"></div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="control-label col-md-12" style="text-align: center;padding: 5px;background-color: #e8e8e8;margin-bottom:5px;font-weight:bold;">Billing</label>
                                    <label class="col-md-12"><b><span id="spncustomerbname"></span></b></label>
                                    <label class="col-md-12"><span id="spncustomeraddress1"></span></label>
                                    <label class="col-md-12"><span id="spncustomercity1"></span>, <span id="spncustomerstate1"></span>&nbsp;<span id="spncustomerpincode1"></span></label>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <div class="table-responsive">


                                        <table class="col-md-12 table" id="tblcontractdetailrows">
                                            <thead>
                                                <tr class="theadRow" style="background-color:#e8e8e8;">
                                                    <td style="padding: 3px!important;">Description</td>
                                                    <td colspan="5" style="padding: 0px!important;"><input type="text" id="txtInvoiceDescription" name="txtInvoiceDescription" value="" style="width:100%;width: 100%;padding: 4px;border-radius: 0px;" maxlength="150" /></td>
                                                    <td colspan="2" style="padding: 3px!important;text-align: right;padding-right: 10px!important;">Inv Date</td>
                                                    <td style="padding: 0px!important;"><input type="text" name="txtInvoicedate" placeholder="" value="@DateTime.Now.ToString(" MM/dd/yyyy")" class="form-control input-sm date-picker RemovePeriodvalidation" /></td>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                            <tfoot>
                                                <tr class="theadRowH remove-padding">
                                                    <td colspan="6" rowspan="3" style="text-align:left;vertical-align:top;padding:7px;"><a href="javascript:void(0);" onclick="addNewEntry()">+ Add</a>&nbsp;&nbsp;<a href="javascript:void(0);" style="color:red;" onclick="DeleteEntry()">- Delete</a></td>
                                                    <td colspan="2" style="padding:4px !important"><b>Sub Total</b></td>
                                                    <td colspan="1" style="padding:0 !important"><input readonly id="txtsubtotal" type="text" name="txtsubtotal" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;" /></td>
                                                </tr>
                                                <tr class="theadRowH remove-padding">
                                                    <td colspan="2" style="padding:4px !important"><b>Tax</b></td>
                                                    <td colspan="1" style="padding:0 !important"><input readonly id="txttaxamount" type="text" name="txttaxamount" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;" /></td>
                                                </tr>
                                                <tr class="theadRowH remove-padding">
                                                    <td colspan="2" style="padding:4px !important"><b>Total</b></td>
                                                    <td colspan="1" style="padding:0 !important"><input readonly id="txttotalamount" type="text" name="txttotalamount" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;" /></td>
                                                </tr>
                                            </tfoot>

                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <table class="col-md-12" style="border:1px solid #e8e8e8" id="frdestributionTable">
                                        <thead>
                                            <tr>
                                                @*<th colspan="2">
                                                        <select class="form-control input-sm" style="border-radius: 0px;margin: 0px;" id="ddldetaillinenumber">
                                                            <option value="">Select</option>
                                                            <option value="1">1</option>
                                                            <option value="2">2</option>
                                                        </select>
                                                    </th>*@
                                                <th colspan="5"><input type="text" id="fsearch-box" autocomplete="off" name="name" value="" placeholder="Search Pay To by Number or Name" class="form-control input-sm typeahead" style="padding: 5px;border-radius: 0px;margin: 0px;" /></th>
                                            </tr>
                                            <tr>
                                                <th style="width:60px;padding:3px;margin: 0px;">Line No</th>
                                                <th style="width:150px;padding:3px;margin: 0px;">Franchisee No.</th>
                                                <th style="padding:3px;">Name</th>
                                                <th style="width:100px;padding:3px;">Amount</th>
                                                <th style="width:25px;padding:3px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <div class="col-md-12">
                            @*<button type="submit" name="SaveNew" value="SaveNew" class="btn btn-primary button-next pull-right" onclick="" style="margin-right:0px;">Save & New</button>*@
                            <button type="submit" name="SaveClose1" value="SaveClose" class="btn btn-primary button-next pull-right" onclick="" style="margin-right:10px;">Save & Close</button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>


<div class="modal fade custom-model custom-form-design form-horizontal" id="modal_AccountOffringPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 8px;" id="RenderAccountOffringDetails">
        </div>
    </div>
</div>
<div id="_div_AccountOffringResult"></div>

@section scripts{
    <script type="text/javascript">

        function getCurrentUrl() {

            var r = $('#regionlist').val();
            return '@Url.Action("CustomerPendingList", "CRMCustomer", new { area = "CRM" })?rgId=' + (r == null ? '' : r);
        }

        $(document).ready(function () {

            $.fn.dataTableExt.afnFiltering.push(function (oSettings, aData, iDataIndex) {
                return true;
            });

            //Pagination setting
            $(document).on('init.dt', function (e, settings) {
                var api = new $.fn.dataTable.Api(settings);
                if ($(api.table().node()).attr('id') == 'CustomerList') {
                    setPaging();
                }
            });

            $("#btnRegion").click(function () {
                if ($("#selectregionlist").val() != "") {
                    $("#regionlist option[value='" + $("#selectregionlist").val() + "']").attr("selected", 1);
                    $("#regionlist").multiselect("refresh");
                    initTable();
                    $(".close").click();
                }
            });

            

            //$("#ddlStatus").multiselect({
            //    includeSelectAllOption: true,
            //    selectAllText: 'Select all',
            //    buttonWidth: '100%',
            //    nonSelectedText: 'Select status..',
            //    dropRight: true,
            //    numberDisplayed: 2,
            //    onChange: initTable,
            //    onSelectAll: initTable,
            //    onDeselectAll: initTable
            //});

            $("#regionlist").multiselect({
                includeSelectAllOption: false,
                selectAllText: 'Select all',
                buttonWidth: '100%',
                nonSelectedText: 'Select region..',
                dropRight: true,
                numberDisplayed: 2,
                onChange: initTable,
                onSelectAll: initTable,
                onDeselectAll: initTable
            });


            //Initialize DataTable
            function initTable() {
                var ps = $('#pageSize').val();
                var dtable = $('#CustomerList').dataTable({
                    "bAutoWidth": false,
                    cache: true,
                    "iDisplayLength": ps == '-1' ? 25 : ps,
                    "bDestroy": true,
                    "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                    //"dom": "<'headerbox list'<'row'<'col-md-1'l><'col-md-4'f><'#divrightckbox.col-md-5 pull-right text-center'>>><'table-responsive't><'bottom'ip><'clear'>",
                    "dom": "<'table-responsive't><'bottom'ip><'clear'>",
                    "aaSorting": [[0, "desc"]],
                    "sAjaxSource": getCurrentUrl(),
                    "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
                    "rowCallback": function (nRow, data) {
                    },
                    "aoColumns": [
                        {
                            "sName": "RegionName",
                            "sClass": "alignCenter",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return '<span>' + full.RegionName + '</span>';
                            }
                        },
                        {
                            "sName": "CustomerNo",
                            "sClass": "alignCenter",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return '<span>' + full.CustomerNo + '</span>';
                            }
                        },
                        {
                            "sName": "CustomerName",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return "<a href='javascript:void(0)' onclick='showDetailPopup(" + full.CustomerId + "," +@((int)JKApi.Business.Enumeration.CustomerStatusList.RegionOperation) +")'  style='color:#0c9cff' id=" + full.CustomerId + ">" + full.CustomerName + "</a>";
                            }
                        },
                        {
                            "sName": "Address",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                var add = '<span>' + full.Address + ',&nbsp;</span><span>' + full.City + ',&nbsp;</span><span>' + full.StateName + '&nbsp;</span>' +
                                    '<span>' + full.PostalCode + '</span>';
                                return add;
                            }
                        },
                        {
                            "sName": "Phone",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return full.Phone;
                            }
                        },
                        {
                            "sName": "AcTypeListName",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return full.AcTypeListName;
                            }
                        },
                        {
                            "sName": "StatusName",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return full.StatusName;
                            }
                        },
                        {
                            "sName": "Amount",
                            "bSortable": true,
                            "sClass": "alignRight contract",
                            "mRender": function (data, type, full) {
                                //return full.DistributionAmount;
                                return "<a href='javascript:void(0)'  onclick='OpenCustomerDistributionPopup("+ full.CustomerId +")' target='_blank' style='color:#0c9cff' id=" + full.CustomerId + ">" + full.Amount + "</a>";
                            }
                        },
                        {
                            "sName": "CreatedBy",
                            "bSortable": true,
                            "mRender": function (data, type, full) {
                                return full.CreatedBy;
                            }
                        },
                        {
                            "sName": "Action",
                            "bSortable": true,
                            "sClass": "personlink alignCenter",
                            "mRender": function (data, type, full) {
                                var action = "<div class='btn-group dropdown'>";
                                action += "<a target='_blank'  dropdown-toggle' data-toggle='dropdown'>";
                                action += "<i class='fa fa-hand-o-right' aria-hidden='true'></i>";
                                action += "</a>";
                                action += "<ul class='dropdown-menu pull-right'>";
                                action += "<li><a href='#' onclick='showEditCustomerInfo("+ full.CustomerId +")'><i class='fa fa-plus'></i> Edit Customer Info </a></li>";
                                action += "<li><a href='#' onclick='OpenCustomerContractPopup("+ full.CustomerId +")'><i class='fa fa-plus'></i> Customer Contract </a></li>";
                                action += "<li><a href='#' onclick='showManualInvoice("+ full.CustomerId +")'><i class='fa fa-plus'></i> Manual Invoice </a></li>";
                                action += "<li><a href='#' onclick='OpenCustomerUploadDocumentPopup("+ full.CustomerId +")'><i class='fa fa-plus'></i> Documents </a></li>";
                                action += "<li><a href='#' onclick='OpenCustomerDistributionPopup("+ full.CustomerId +")'><i class='fa fa-plus'></i> Distribution </a></li>";
                                action += "</ul></div>";
                                return action;
                            }
                        }
                    ]
                });
            }

            //Press key of Search
            $("#input_Search").keyup(function () {
                var table = $("#CustomerList").DataTable();
                table.search($(this).val()).draw();
            });


            //OnChange event of PageSize
            $("#pageSize").change(function () {
                setPaging();
            })

            //Set Selected Region
            if ('@ViewBag.selectedRegionId' > 0) {

                $("#regionlist option[value='" + '@ViewBag.selectedRegionId' + "']").attr("selected", 1);
                $("#regionlist").multiselect("refresh");
            }

            //Initialize the DataTable
            initTable();

            //Show Customer Table and Div
            $('#CustomerList').show();
            $('#divcustomerList').show();

            if (@ViewBag.CustomerId> 0) {
                showDetailPopup(@ViewBag.CustomerId, @((int)JKApi.Business.Enumeration.CustomerStatusList.RegionOperation))
                history.pushState(null, '', '/CRM/CRMRegionOperation/');
            }

        });

        function setPaging() {
            var z = $("#pageSize").val();
            var table = $("#CustomerList").DataTable();
            if (z > 0) {
                table.page.len(z).draw();
            }
            else if (z == -1) {
                table.page.len(table.rows().count()).draw();
            }
            else {
                table.page.page.len(25).draw();
            }
        }

        function OpenCustomerDistributionPopup(Id) {
            var sURL = '@Url.Action("RenderCustomerDistributionDetailPopup", "Customer", new { area = "Portal" })?id=' + Id +"&isCRM=true";
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerDistribution').html(data);
                    $("#ModalCustomerDistributionPopup").modal({ resizable: true, draggable: true });
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    function clickonyes(Id)
    {
        var status = @((int)JKApi.Business.Enumeration.CustomerStatusList.RegionOperation);

        $(".PendingMessage").remove();
        var sURL = '@Url.Action("CustomerDetailPopup", "CRMCustomer", new { area = "CRM" })?id=' + Id + "&status=" + status + "&callfrom=RO";
        $.ajax({
            type: "GET",
            url: sURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            async:false,
            success: function (data) {
                $('#form_ModelCustomerDetailsPopup').html(data);
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("GetAllFranchisees", "Franchise", new { area = "Portal" })',
                    data: {},
                    async:false,
                    success: function (data) {
                        c_typeaheadSource = [];
                        $.each(data, function (key, value) {
                            c_typeaheadSource.push({ id: value.FranchiseeId, name: value.FranchiseeNo + ' ' + value.Name })
                        });
                        ShowCustomerSuggetionBox();
                        $("#ModalCustomerDistributionPopup").modal("hide");
                    }
                });
                $("#ModelCustomerDetailsPopup").modal({ backdrop: 'static' });
            },
            error: function (err) {
                console.log(err);
            }
        });
    }


    </script>

    <script type="text/javascript">
        var c_typeaheadSource = [];
        function showDetailPopup(Id, status) {
            $(".PendingMessage").remove();
            var sURL = '@Url.Action("CustomerDetailPopup", "CRMCustomer", new { area = "CRM" })?id=' + Id + "&status=" + status + "&callfrom=RO";
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_ModelCustomerDetailsPopup').html(data);
                    $.ajax({
                        type: "GET",
                        url: '@Url.Action("GetAllFranchisees", "Franchise", new { area = "Portal" })',
                        data: {},
                        success: function (data) {
                            c_typeaheadSource = [];
                            $.each(data, function (key, value) {
                                c_typeaheadSource.push({ id: value.FranchiseeId, name: value.FranchiseeNo + ' ' + value.Name })
                            });
                        }
                    });
                    $("#ModelCustomerDetailsPopup").modal({ backdrop: 'static' });
                    //$("#btnEditCustomerInfo").addClass("AddBackground");
                    //$("#anhContractCA").addClass("AddBackground");
                    $("#anhUploadDocumentCA").addClass("AddBackground");
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
        function showEditCustomerInfo(Id) {

            var sURL = '@Url.Action("PendingApprovalListEditCustomerPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_Billingsetting').html(data);
                    $("#ModalEditCustomerInfo").modal({ backdrop: 'static' });
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $(".date-picker").datepicker();
                    $(".edit").attr("disabled", "disabled");
                    $(".edit").attr("readonly", "readonly");

                    $("#btnSave").prop("disabled", "false");
                    $("#btnSave").prop("readonly", "true");
                    $("#btnCancel").prop("disabled", "false");
                    $("#btnCancel").prop("readonly", "true");
                    $("#btnSave").hide();
                    $("#btnCancel").hide();

                    $(".editmain1").attr("disabled", "disabled");
                    $(".editmain1").attr("readonly", "readonly");
                    $(".editmain").attr("disabled", "disabled");
                    $(".editmain").attr("readonly", "readonly");

                    $(".editbill1").attr("disabled", "disabled");
                    $(".editbill1").attr("readonly", "readonly");
                    $(".editbill").attr("disabled", "disabled");
                    $(".editbill").attr("readonly", "readonly");

                    $(".EditBtn").show();
                    $(".SaveBtn").hide();
                    $(".CancelBtn").hide();
                    $("#btnEditCustomerInfo").removeClass("AddBackground");
                },
                error: function (err) {
                    console.log(err);
                }
            });

        }

        function OpenCustomerContractPopup(Id) {

            var sURL = '@Url.Action("RenderCustomerContractDetails", "Customer", new { area = "Portal" })?id=' + Id + '&callfrom=38';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerContractDetails').html(data);
                    $(".date-picker").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    contractDetailPopupInIt();
                    $("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
                    $("#anhContractCA").removeClass("AddBackground");
                },
                error: function (err) {
                    console.log(err);
                }
            });

            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }
        //Customer Contract Popup
        var OpenCustomerContractPopupOld = function (Id) {

            //$.blockUI();
            var sURL = '@Url.Action("PendingApprovalCustomerContractDetailPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerContractDetails').html(data);
                    $('#Contract_StartDate').inputmask("mm/dd/yyyy", {});
                    $('#Contract_StartDate').inputmask("mm/dd/yyyy", {});
                    $('#Contract_SignDate').inputmask("mm/dd/yyyy", {});
                    $('#Contract_StatusDate').inputmask("mm/dd/yyyy", {});
                    $('#Contract_ExpirationDate').inputmask("mm/dd/yyyy", {});
                    $('#Contract_ResumeDate').inputmask("mm/dd/yyyy", {});
                    //$.unblockUI();
                    $(".date-picker").datepicker();
                    //$("#Contract_ExpirationDate").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
                },
                error: function (err) {
                    console.log(err);
                }
            });

            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }

        function OpenCustomerUploadDocumentPopup(Id) {

            var sURL = '@Url.Action("CustomerUploadDocumentPopup", "Customer", new { area = "Portal" })?id=' + Id +'&isCRM=true';
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerUploadDocumentPopup').html(data);
                    $("#ModelCustomerUploadDocumentPopup").modal({ backdrop: 'static' });
                    $("#anhUploadDocumentCA").removeClass("AddBackground");
                },
                error: function (err) {
                    console.log(err);
                }
            });

        }

       

        function AccountOffringModel(Id) {

            var sURL = '@Url.Action("CustomerAccountOffringPopup", "CRMCustomer", new { area = "CRM" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderAccountOffringDetails').html(data);
                    $("#modal_AccountOffringPopup").modal({ backdrop: 'static' });
                    settimedurationAccountOffering_select(3);
                },
                error: function (err) {
                    console.log(err);
                }
            });
            //$("#modal_AccountOffringPopup").modal("show");
            OnlyNumber('#txtAccountOfferingDistance');
        }

        function showManualInvoice(id) {
            //  app.init('@ViewContext.RouteData.Values["id"]');

            onlyDecimal("#txtCommissionAmount");

            bindcustomerdetail(id);


            $("#hdftotallineno").val(lineNo);
            $("#hdfftotallineno").val(flineNo);
            $('#txtInvoicedate').inputmask("mm/dd/yyyy", {});
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetContractDetailServiceTypeList", "AccountReceivable", new { area = "Portal" })',
                success: function (data) {
                    lstContractDetailServiceTypeList = data;
                    addNewEntry();
                }
            })

            $("#modal_ManualInvoice").modal('show');
        }

        function bindcustomerdetail(customerid) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("CustomerDetaildata", "AccountReceivable", new { area = "Portal" })',
                data: 'customerid=' + customerid,
                success: function (data) {
                    $("#spncustomerno").text($.trim(data.CustomerNo));
                    $("#spncustomername").text($.trim(data.Name));
                    $("#spncustomeraddress").text($.trim(data.Address1));
                    $("#spncustomercity").text($.trim(data.City))
                    $("#spncustomerstate").text($.trim(data.StateName));
                    $("#spncustomerpincode").text($.trim(data.PostalCode));


                    $("#spncustomerbname").text($.trim(data.BName));
                    $("#spncustomerbattname").text($.trim(data.Attention));
                    $("#spncustomeraddress1").text($.trim(data.BAddress1));
                    $("#spncustomercity1").text($.trim(data.BCity))
                    $("#spncustomerstate1").text($.trim(data.BStateName));
                    $("#spncustomerpincode1").text($.trim(data.PostalCode));

                    $("#hdfTaxRateId").val(data.TaxRateId);
                    $("#hdfContractTaxRate").val(data.ContractTaxRate);
                    $("#hdfLeaseTaxRate").val(data.LeaseTaxRate);
                    $("#hdfSupplyTaxRate").val(data.SupplyTaxRate);
                    bindcCustomerDistributionDetailFranchiseedetail(customerid);
                }
            });
        }
        function bindcCustomerDistributionDetailFranchiseedetail(customerid) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("CustomerDistributionDetailFranchiseedata", "AccountReceivable", new { area = "Portal" })',
                data: 'customerid=' + customerid,
                success: function (data) {
                    $.each(data, function () {
                        bindfranchiseedetailUpdated(this.FranchiseeId, this.FranchiseeNo, this.Name);
                    });

                }
            });
        }

        var lstContractDetailServiceTypeList = [];
        var lineNo = 0;
        var flineNo = 0;

        var app = {};

        (function (app) {

            var _id;

            app.init = function (id) {
                if (id != '') {
                    _id = id;
                    $("#hdfCustomerId").val(_id);
                    bindcustomerdetail(_id);
                }
            }

        })(app);

        function bindfranchiseedetailUpdated(franchiseeid, franchiseeno, franchiseename) {
            flineNo++;

            var linenumber = 0;
            var txttotal = ''
            var lineTotalAmount = 0;

            var tempRow = '<tr id=row_' + flineNo + '><td>'
            tempRow = tempRow + '<input relLine="' + flineNo + '" type="hidden" id="hdfFrenchiseeId' + flineNo + '" name="hdfFrenchiseeId' + flineNo + '" value="' + franchiseeid + '" />'
            tempRow = tempRow + '<select relLine="' + flineNo + '"  relddldetaillinenum="ddldetaillinenumber" class="form-control input-sm ddldetaillinenumber" style="border-radius: 0px;" id="ddldetaillinenumber' + flineNo + '" name="ddldetaillinenumber' + flineNo + '"></select>';
            tempRow = tempRow + '</td>'
            tempRow = tempRow + '<td><input type="text" required relLine="' + flineNo + '" id="frfranchiseeno' + flineNo + '" name="frfranchiseeno' + flineNo + '" value="' + $.trim(franchiseeno) + '" readonly class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            tempRow = tempRow + '<td><input type="text" required relLine="' + flineNo + '" id="frfranchiseename' + flineNo + '" name="frfranchiseename' + flineNo + '" value="' + $.trim(franchiseename) + '" readonly class="form-control input-sm cnumeric" style="padding: 5px;border-radius: 0px;" /></td>'
            tempRow = tempRow + '<td><input type="text" relLine="' + flineNo + '" id="frfranchiseeamount' + flineNo + '" name="frfranchiseeamount' + flineNo + '" value="' + txttotal + '" class="form-control input-sm cnumeric requiredValidation frfranchiseeamount" style="padding: 5px;border-radius: 0px;" /></td>';
            tempRow = tempRow + '<td><a style="font-size: 16px;padding: 3px;color: mediumvioletred;" href="javascript:deleteFrenchisee(' + flineNo + ');"><i class="fa fa-trash" aria-hidden="true"></i></a></td></tr>';


            $('#frdestributionTable tbody').append(tempRow);
            applyMaskCurrency('#frfranchiseeamount' + flineNo);
            $("#hdfftotallineno").val(flineNo);

            var lineitems = []; lineitems.push("<option value=''>Select</option>");
            for (var i = 1; i <= lineNo; i++) { lineitems.push("<option value=" + i + ">" + i + "</option>"); }
            $('#ddldetaillinenumber' + flineNo).html('');
            $('#ddldetaillinenumber' + flineNo).html(lineitems.join(' '));


            $('#ddldetaillinenumber' + flineNo).change(function (event) {

                var fln = $(this).attr("relLine");
                if ($(this).attr("relLine") != "Select") {

                    $('#frfranchiseeamount' + fln).prop("required", true);
                }
                else {
                    $('#frfranchiseeamount' + fln).prop("required", false);
                }
                if ($("#frfranchiseeamount" + fln).val() != "" && $("txtExtendedPrice" + fln).val() != "") {
                    var UnitData;
                    var FrData;
                    //if ($("#txtExtendedPrice" + fln).val().indexOf(",") > 0)
                    //    UnitData = $("#txtExtendedPrice" + fln).val().replace("$ ", "").replace(",", "");
                    //else
                    UnitData = $("#txtExtendedPrice" + fln).val();
                    if ($("#frfranchiseeamount" + fln).val().indexOf(",") > 0)
                        FrData = $("#frfranchiseeamount" + fln).val().replace("$ ", "").replace(",", "");
                    else
                        FrData = $("#frfranchiseeamount" + fln).val().replace("$ ", "");

                    if (parseFloat(FrData) > parseFloat(UnitData)) {
                        alert("Frenchisee amount should not grater than Extended Price.");
                        $("#frfranchiseeamount" + fln).focus();
                        $("#frfranchiseeamount" + fln).select();
                    }
                }

            });
            $("#frfranchiseeamount" + flineNo).change(function () {
                var ddlLine = $(this).parent().parent().find("td")[0];
                var Line_No = $(ddlLine).find("select option:selected").val();
                if ($("#txtExtendedPrice" + Line_No).val() != "" && $(this).val() != "") {
                    var UnitData;
                    var FrData;
                    //if ($("#txtExtendedPrice" + Line_No).val().indexOf(",") > 0)
                    //    UnitData = $("#txtExtendedPrice" + Line_No).val().replace("$ ", "").replace(",", "");
                    //else
                    UnitData = $("#txtExtendedPrice" + Line_No).val();
                    if ($(this).val().indexOf(",") > 0)
                        FrData = $(this).val().replace("$ ", "").replace(",", "");
                    else
                        FrData = $(this).val().replace("$ ", "");
                    if (parseFloat(UnitData) < parseFloat(FrData)) {
                        alert("Frenchisee amount should not grater than Extended Price.");
                        $(this).focus();
                        $(this).select();
                    }
                }
            });

            setTimeout(function () {
                $("#hdfFrenchiseeId").val(0);
                $('#fsearch-box').val('');
            }, 500);

        }

        function onlyDecimal(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) { }
                else { event.preventDefault(); }
                if ($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110)) event.preventDefault();
            });
        }
        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }
        function addNewEntry() {
            lineNo++;

            var tr = "";
            tr = tr + '<tr relline="S' + lineNo + '" style="background-color:#eef1f5;border-right: 1px solid #eef1f5;">';
            tr = tr + '<td colspan="9" style="padding:0!important;">';
            tr = tr + '<table class="col-md-12" style="margin: 0px!important;">';
            tr = tr + '<tr class="theadRow">';
            tr = tr + '<td style="width:72px;padding: 0px !important;text-align:center;">Line No</td>';
            tr = tr + '<td></td>';
            tr = tr + '<td style="width: 110px;"><input type="checkbox" id="chkCommission' + lineNo + '" name="chkCommission' + lineNo + '"><label>Commission</label></td>';
            tr = tr + '<td style="width: 110px;padding: 0 0px !important;"><input type="text" id="txtCommissionAmount' + lineNo + '" name="txtCommissionAmount' + lineNo + '" value="0" maxlength="10" class="form-control input-sm" /></td>';
            tr = tr + '<td style="width: 105px;"><input type="checkbox" id="chkExtraWork' + lineNo + '" name="chkExtraWork' + lineNo + '"><label for="chkExtraWork' + lineNo + '" style="padding-left: 0px;">Extra Work</label></td>';
            tr = tr + '<td style="width: 115px;"><input type="checkbox" id="chkTaxExcempt' + lineNo + '" name="chkTaxExcempt' + lineNo + '"><label for="chkTaxExcempt' + lineNo + '" style="padding-left: 0px;">Tax Exempt</label></td>';
            tr = tr + '<td style="width: 105px;"><input type="checkbox" id="chkBPPAdmin' + lineNo + '" name="chkBPPAdmin' + lineNo + '"><label for="chkBPPAdmin' + lineNo + '" style="padding-left: 0px;">BPP Admin</label></td>';
            tr = tr + '<td style="width: 115px;"><input type="checkbox" id="chkAcctRebate' + lineNo + '" name="chkAcctRebate' + lineNo + '" /><label for="chkAcctRebate' + lineNo + '" style="padding-left: 0px;">Acct Rebate</label></td>';
            tr = tr + '</tr>';
            tr = tr + '</table>';
            tr = tr + '</td>';
            tr = tr + '</tr>';


            $('#tblcontractdetailrows>tbody').append(tr);
            tr = "";
            tr = tr + '<tr relline="S' + lineNo + '" class="theadRowH" style="background-color:#eef1f5;">';
            tr = tr + '<td style="text-align:center;width:60px;padding: 0px !important;"><input type="text" readonly="" id="txtlinenumber' + lineNo + '" name="txtlinenumber' + lineNo + '" value="' + lineNo + '" class="form-control input-sm cnumeric" style="text-align:center;"></td>';
            tr = tr + '<td style="text-align:center;width:150px;">Service</td>';
            tr = tr + '<td style="text-align:center;">Detail Description</td>';
            tr = tr + '<td style="width:60px;text-align:center;">MarkUp</td>';
            tr = tr + '<td style="width:60px;text-align:center;">Qty</td>';
            tr = tr + '<td style="width:100px;text-align:center;">Unit Price</td>';
            tr = tr + '<td style="width:100px;text-align:center;">Extended Price</td>';
            tr = tr + '<td style="width:50px;text-align:center;">Tax</td>';
            tr = tr + '<td style="width:100px;text-align:center;">Total</td>';
            tr = tr + '</tr>';


            $('#tblcontractdetailrows>tbody').append(tr);
            tr = "";
            tr = tr + '<tr relline="S' + lineNo + '" class="theadRowH remove-padding">';
            tr = tr + '<td style="background-color:#eef1f5;"></td>';
            tr = tr + '<td><select class="form-control input-sm" id="ContractDetailServiceTypeList' + lineNo + '" name="ContractDetailServiceTypeList' + lineNo + '" ></select></td>';
            tr = tr + '<td><textarea required="" id="txtdescription' + lineNo + '" name="txtdescription' + lineNo + '" class="form-control input-sm" row="1" style="padding: 5px;border-radius: 0px;resize:vertical;max-height:100px;min-height:30px;"></textarea></td>';

            tr = tr + '<td><input type="text" required="" onchange="CalculateAmount(' + lineNo + ')" id="txtmarkup' + lineNo + '" name="txtmarkup' + lineNo + '" value="0" class="form-control input-sm" style="padding: 5px;border-radius: 0px;" ></td>';
            tr = tr + '<td><input type="text" required="" onchange="CalculateAmount(' + lineNo + ')" id="txtqty' + lineNo + '" name="txtqty' + lineNo + '" value="1" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="hidden" id="hdfunitprice' + lineNo + '" name="hdfunitprice' + lineNo + '"/>'
            tr = tr + '<input type="text" required="" onblur="CalculateAmount(' + lineNo + ')" id="txtunitprice' + lineNo + '" name="txtunitprice' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="text" required="" readonly="" onchange="CalculateAmount(' + lineNo + ')" id="txtExtendedPrice' + lineNo + '" name="txtExtendedPrice' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="text" required="" readonly="" onchange="CalculateAmount(' + lineNo + ')" id="txttax' + lineNo + '" name="txttax' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '<td><input type="text" required="" readonly="" onchange="CalculateAmount(' + lineNo + ')" id="txttotal' + lineNo + '" name="txttotal' + lineNo + '" value="" class="form-control input-sm" style="padding: 5px;border-radius: 0px;"></td>';
            tr = tr + '</tr>';

            $('#tblcontractdetailrows>tbody').append(tr);
            applyMaskCurrency('#txtunitprice' + lineNo);
            applyMaskCurrency('#txttax' + lineNo);
            applyMaskCurrency('#txttotal' + lineNo);
            applyTaxExcempt(lineNo)
            applyCommission(lineNo)

            var items = [];
            items.push("<option>Select</option>");
            $.each(lstContractDetailServiceTypeList, function () {
                items.push("<option value=" + this.ContractDetailServiceTypeListId + ">" + this.Name + "</option>");
            });
            $('#ContractDetailServiceTypeList' + lineNo).html(items.join(' '));


            ContractDetailServiceTypeListOnChange('ContractDetailServiceTypeList' + lineNo, lineNo);

            $('#txtunitprice' + lineNo).keyup(function () {
                $('#hdfunitprice' + lineNo).val($('#txtunitprice' + lineNo).val());
            });


            $('#ddldetaillinenumber').html('');
            var lineitems = []; lineitems.push("<option>Select</option>");
            for (var i = 1; i <= lineNo; i++) { lineitems.push("<option value=" + i + ">" + i + "</option>"); }
            $('#ddldetaillinenumber').html(lineitems.join(' '));

            $("#hdftotallineno").val(lineNo);
            OnlyNumber('#txtmarkup' + lineNo)
            OnlyNumber('#txtqtycc' + lineNo)
            onlyDecimal('#txtunitprice' + lineNo)
        }
        function DeleteEntry() {
            lineNo;
            if (lineNo > 1) {
                $("#tblcontractdetailrows tbody tr[relline='S" + lineNo + "']").remove();
                lineNo--;

                CalculateAmount(lineNo);

                $('.unitPrice').keyup(function () {
                    var fieldId = $(this).attr('id');
                    fieldId = fieldId.replace('txtunitprice', '');
                    //unitPrice
                    $('#hdfunitprice' + fieldId).val($('#txtunitprice' + fieldId).val());
                });


                $('#ddldetaillinenumber').html('');
                var lineitems = []; lineitems.push("<option value=''>Select</option>");
                for (var i = 1; i <= lineNo; i++) { lineitems.push("<option value=" + i + ">" + i + "</option>"); }
                //$('#ddldetaillinenumber').html(lineitems.join(' '));


                $('select[relddldetaillinenum="ddldetaillinenumber" ]').each(function (item) {

                    $(this).html('');
                    $(this).html(lineitems.join(' '));

                });
            }
        }
        function applyMaskCurrency(id) {
            $(id).inputmask("currency", {
                alias: 'currency',
                prefix: '$ ',
                digits: 2,
                autoUnmask: true,
                removeMaskOnSubmit: true,
                unmaskAsNumber: true,
                allowPlus: false,
                allowMinus: false,
                autoGroup: true,
                groupSeparator: ",",
            });
        }
        function applyTaxExcempt(id) {
            $('#chkTaxExcempt' + id).change(function () { CalculateAmount(id); });
        }
        function applyCommission(id) {
            $('#txtCommissionAmount' + id).hide();
            $('#chkCommission' + id).change(function () {
                if ($(this).is(":checked")) {
                    $('#txtCommissionAmount' + id).show();
                }
                else {
                    $('#txtCommissionAmount' + id).val("0");
                    $('#txtCommissionAmount' + id).hide();
                }
            });
        }
        function CalculateAmount(ln) {
            if ($("#hdfContractTaxRate").val() == undefined)
                $("#hdfContractTaxRate").val("0.0");
            var temptax = parseFloat($("#hdfContractTaxRate").val());

            var txtmarkup = parseFloat($('#txtmarkup' + ln).val() == '' ? 0 : $('#txtmarkup' + ln).val())

            var txtunitpriceT = parseFloat($('#hdfunitprice' + ln).inputmask('unmaskedvalue').replace('$', '').replace(' ', '').replace(',', '') == '' ? 0 : $('#hdfunitprice' + ln).inputmask('unmaskedvalue').replace('$', '').replace(' ', '').replace(',', ''));

            var txtqty = parseFloat($('#txtqty' + ln).val() == '' ? 0 : $('#txtqty' + ln).val())
            var txtunitprice = (txtunitpriceT + (txtunitpriceT * txtmarkup / 100));
            var txttax = $('#txttax' + ln)
            var txttotal = $('#txttotal' + ln)
            var txtExtetotal = 0;

            $('#txtunitprice' + ln).val(txtunitprice);
            txtExtetotal = (txtunitprice * txtqty);
            //txtExtetotal = ((txtunitprice + (txtunitprice * txtmarkup / 100)) * txtqty);
            $('#txtExtendedPrice' + ln).val(txtExtetotal);
            if ($('#chkTaxExcempt' + ln).is(":checked")) {
                txttax.val(0);
            }
            else {
                txttax.val((txtunitprice * txtqty) * temptax / 100)
            }

            txttotal.val((txtqty * txtunitprice) + parseFloat(txttax.inputmask('unmaskedvalue')))

            var toAmt = 0;
            var toTaxAmt = 0;
            for (var i = 1; i <= lineNo; i++) {

                toTaxAmt = toTaxAmt + parseFloat($('#txttax' + i).inputmask('unmaskedvalue') == '' ? 0 : $('#txttax' + i).inputmask('unmaskedvalue'));
                toAmt = toAmt + parseFloat($('#txttotal' + i).inputmask('unmaskedvalue') == '' ? 0 : $('#txttotal' + i).inputmask('unmaskedvalue'));
            }
            $('#txtsubtotal').val(toAmt - toTaxAmt)
            $('#txttaxamount').val(toTaxAmt)
            $('#txttotalamount').val(toAmt)

            applyMaskCurrency('#txtsubtotal');
            applyMaskCurrency('#txttaxamount');
            applyMaskCurrency('#txttotalamount');
        };
        function ContractDetailServiceTypeListOnChange(id, line) {
            $('#' + id).change(function () {

                if (this.value == 5) {
                    $('#txtmarkup' + line).prop("readonly", false);
                    $('#txtmarkup' + line).val(0);
                }
                else {
                    $('#txtmarkup' + line).prop("readonly", true);
                    $('#txtmarkup' + line).val(0);
                }
                CalculateAmount(line);
            });
        }

        function settimedurationAccountOffering_select(id) {
            $('#select_timedurationAccountOffering').val(id)
            $("#sDateAccountOffering").prop("disabled", true);
            $("#eDateAccountOffering").prop("disabled", true);
            switch (parseInt(id)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    //code block
                    $("#sDateAccountOffering").prop("disabled", false);
                    $("#eDateAccountOffering").prop("disabled", false);
                    break;
                default:
                    //code block
            }
            $('#sDateAccountOffering').val(moment(firstDay).format('L'));
            $('#eDateAccountOffering').val(moment(lastDay).format('L'));
        }

        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }
    </script>
}
