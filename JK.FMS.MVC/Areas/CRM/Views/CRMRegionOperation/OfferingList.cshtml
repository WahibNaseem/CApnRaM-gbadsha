
@{
    ViewBag.Title = "OfferingList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles{
    <link href="~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css")" />

    <style type="text/css">
        .topheader {
            font-size: 14px;
            font-weight: bold;
            color: #FFF !important;
            text-transform: uppercase;
            margin-top: 3px;
        }


        .lbl-p5 {
            padding: 5px;
        }

            .lbl-p5.red {
                color: red;
            }


            .lbl-p5.green {
                color: lightgreen;
            }

        input[type="text"].txtcolon:before {
            content: ": ";
        }

        .credit-field {
            width: 80px !important;
        }

        .alignRight {
            text-align: right;
        }

        .alignCenter {
            text-align: center;
        }

        .close {
            background-image: url(/Content/admin/assets/global/img/stick_close.png) !important;
            height: 12px !important;
            width: 12px !important;
            margin-top: 0px !important;
        }

        .custom-listbox .headerbox {
            padding: 3px 0px 3px 5px;
            font-weight: normal;
        }

        .custom-listbox {
            margin-top: 4px;
            margin-bottom: 0px;
        }

        .row {
            margin: 0;
            padding: 3px 0;
        }

        .btn.multiselect {
            text-align: left;
            padding-top: 4px;
            padding-bottom: 4px;
            font-size: 11px;
            color: #555;
        }

        .multiselect .caret {
            right: 0;
            position: absolute;
            margin-top: 8px;
            margin-right: 8px;
        }

        .multiselect-container.dropdown-menu {
            text-transform: none;
            font-size: 14px;
        }

        .no-padding {
            padding: 0;
        }

        #modal_RegionModel .modal-content {
            width: 55% !important;
            margin-left: 30% !important;
        }

        .cls-center {
            text-align: center;
        }

        .cls-left {
            text-align: left;
        }

        .cls-right {
            text-align: right;
        }
    </style>

}
<div class="headerbox">
    <div class="row" style="background-color: #3598DC;color: #fff;">
        <div class="col-md-12 no-padding">
            <div class="alignCenter">
                <div class="col-md-4" style="text-align:right;">
                </div>
                <div class="col-md-4 topheader">
                    CLIENTS OFFER LIST
                </div>
                <div class="col-md-2 pull-right" style="padding-right:5px;">
                    <div style="display:table-cell;padding-right: 5px;">
                        Region
                    </div>
                    <div style="display:table-cell;width:100%;">
                        @if (ViewBag.regionlist != null)
                        {
                            <select class="form-control input-sm" multiple="multiple" id="regionlist" style="display:none;">
                                @foreach (var item in (SelectList)ViewBag.regionlist)
                                {
                                    <option @(item.Selected ? "selected" : "") value="@item.Value">@item.Text</option>
                                }
                            </select>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="custom-listbox" id="divClientsOfferList" style="margin-top:4px;margin-bottom:3px;">
    <div class="headerbox">
        <div class="row no-padding">
            <div class="col-sm-1 page-size">
                <select class="form-control input-sm" id="pageSize" style="padding-left:6px;">
                    <option value="-1">All</option>
                    <option value="100" selected>100</option>
                    <option value="50">50</option>
                    <option value="25">25</option>
                </select>
            </div>
            <div class="col-md-3">
                <div class="input-icon">
                    <i class="icon-magnifier icon-align-right" style="margin-top: 8px;"></i>
                    <input id="input_Search" type="text" required name="customernumber" autocomplete="off" placeholder="Search Customer Name" value="" class="form-control input-sm typeahead" />
                </div>
            </div>

            <div class="col-md-5 pull-right no-padding">
                <div class="col-md-4" style="padding-left: 60px;">

                </div>
                <div class="col-md-8 pull-right no-padding" style="text-align:center;">
                    @if (ViewBag.StatusList != null)
                    {
                        <div class="col-md-12 pull-right no-padding">
                            <div class="col-md-6 no-padding" style="text-transform:none;font-weight:normal;text-align: right;margin-top: 3px;">
                                Customer Status
                            </div>
                            <div class="col-md-6 no-padding" style="padding-left: 6px;">
                                <select id="ddlCStatus" multiple="multiple" style="display:none;">
                                    @foreach (var item in (MultiSelectList)ViewBag.StatusList)
                                    {
                                        <option @(item.Selected ? "selected" : "") value="@item.Value">@item.Text</option>
                                    }
                                </select>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
<div class="tablebox">
    <div class="row padding-tb1">
        <div class="row no-padding">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover" id="tblOfferingList">
                    <thead>
                        <tr>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:60px;padding: 5px !important;">
                                Region
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:80px;padding: 5px !important;">
                                Customer No
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;padding: 5px !important;">
                                Customer Name
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:130px;padding: 5px !important;">
                                Account Type
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:100px;padding: 5px !important;">
                                Contract Amt
                            </th>
                            <th style="text-align:center;;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:85px;padding: 5px !important;">
                                Franchisee No
                            </th>
                            <th style="text-align:center;;font-size: 11px !important;font-weight: normal;vertical-align:middle;padding: 5px !important;">
                                Franchisee Name
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:70px;padding: 5px !important;">
                                Distance
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width: 65px;padding: 5px !important;">
                                Offer Date
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:80px;padding: 5px !important;">
                                Status
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:80px;padding: 5px !important;">
                                Status Date
                            </th>
                            <th style="text-align:center;font-size: 11px !important;font-weight: normal;vertical-align:middle;width:0px;padding: 5px !important;">
                                Note
                            </th>
                            <th style="text-align:center;width:4px;">
                            </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<div class="modal fade in" id="modal_RegionModel" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    Select Region
                </h4>
            </div>
            <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                <div class="form-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-md-12" style="text-align: center;padding: 5px;background-color: #e8e8e8;margin-bottom:5px;font-weight:bold;">Select Region</label>
                                @if (ViewBag.regionlist != null)
                                {
                                <select class="form-control input-sm" id="selectregionlist">
                                    <option value="">Select Region</option>
                                    @foreach (var item in (SelectList)ViewBag.regionlist)
                                        {
                                        <option @(item.Selected ? "selected" : "") value="@item.Value">@item.Text</option>
                                        }
                                </select>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <div class="col-md-12">
                        <button type="button" name="SaveNew" id="btnRegion" class="btn btn-primary button-next pull-right" onclick="" style="margin-right:0px;">Select Region</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="modal_Note" tabindex="-1" role="basic" aria-hidden="true" style="display: none; padding-right: 17px;">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 8px;">
            <div class="modal-header headerbox list" style="padding:0px!important;border-bottom: none;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top: 12px !important;margin-right: 12px !important;"></button>
                <h4 class="modal-title text-center" style="margin-top: 0px; margin-bottom: 4px;  padding: 7px!important;font-size: 12px;font-weight: bold;background: #3598DC !important;color: #FFF !important;border: 1px solid #3598DC !important;padding: 0px;text-transform: uppercase;">
                    Note
                </h4>
            </div>
            <div class="modal-body form form-horizontal" style="padding-top: 1px;margin-top: -5px;">
                <div class="form-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-md-2" style="padding: 5px;font-weight:bold;">Special Note</label>
                                <div class="col-md-10">
                                    <textarea class="form-control input-sm" rows="3" id="SpNote" readonly></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-md-2" style="padding: 5px;font-weight:bold;">Remark</label>
                                <div class="col-md-10">
                                    <textarea class="form-control input-sm" rows="3" id="Note" readonly></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*Customer Distribution Popup Modal*@
<div class="modal fade custom-model custom-form-design" id="ModalCustomerDistributionPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:645px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerDistribution">
        </div>
    </div>
</div>

<div class="form-horizontal" action="" id="form_ModelCustomerDetailsPopup"></div>

<form class="form-horizontal" action="" id="form_Billingsetting" method="POST">
    @*<div class="modal fade custom-model custom-form-design" id="ModalEditCustomerInfo" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
            <div class="modal-dialog" style="width:869px" id="RenderEditCustomerInfoPopup">
            </div>
        </div>*@
</form>

<div class="modal fade custom-model custom-form-design" id="modal_CustomerContractPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:785px">
        <div class="modal-content" style="border-radius: 8px;" id="RenderCustomerContractDetails">
        </div>
    </div>
</div>
<div class="modal fade custom-model custom-form-design form-horizontal" id="modal_AccountOffringPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 8px;" id="RenderAccountOffringDetails">
        </div>
    </div>
</div>
<div id="_div_AccountOffringResult"></div>
 
<div class="modal fade custom-model custom-form-design form-horizontal" id="modal_ManualEnterOffringStatusPopup" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 8px;" id="RenderManualEnterOffringStatusPopup">
            
        </div>
    </div>
</div>

@section pageplugins{
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-ui/jquery-ui.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-validation/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/scripts/datatable.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/datatables.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/pages/scripts/table-datatables-managed.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-typeahead/bootstrap3-typeahead.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/admin/assets/global/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js")" type="text/javascript"></script>
    @*<link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/chosen.css")" />
        <script src="@Url.Content("~/Scripts/chosen.jquery.min.js")" type="text/javascript"></script>
        <script src="~/Scripts/jquery.uniform.min.js"></script>*@
    @if (Request.IsSecureConnection)
    {
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
    }
    else
    {
        <script src="http://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
    }
}

@section scripts{
    <script type="text/javascript">
        $(window).load(function () {
            if ('@ViewBag.selectedRegionId' == 0) {
                $("#modal_RegionModel").modal({ backdrop: 'static' });
            }
            else {
                _bindOfferingList();
            }
        });
        function setPaging() {
            var z = $("#pageSize").val();
            var table = $("#tblOfferingList").DataTable();
            if (z > 0) {
                table.page.len(z).draw();
            }
            else if (z == -1) {
                table.page.len(table.rows().count()).draw();
            }
            else {
                table.page.page.len(25).draw();
            }
        }


        $(document).ready(function () {

            $("#btnRegion").click(function () {
                if ($("#selectregionlist").val() != "") {
                    $("#regionlist option[value='" + $("#selectregionlist").val() + "']").attr("selected", 1);
                    $("#regionlist").multiselect("refresh");
                    _bindOfferingList();
                    $(".close").click();
                }
            });

            $("#regionlist").multiselect({
                includeSelectAllOption: true,
                selectAllText: 'Select all',
                buttonWidth: '100%',
                nonSelectedText: 'Select region..',
                dropRight: true,
                numberDisplayed: 2,
                onChange: _bindOfferingList,
                onSelectAll: _bindOfferingList,
                onDeselectAll: _bindOfferingList
            });

            $("#input_Search").keyup(function () {
                var table = $("#tblOfferingList").DataTable();
                table.search($(this).val()).draw();
            });

            $("#ddlCStatus").multiselect({
                includeSelectAllOption: true,
                selectAllText: 'Select all',
                buttonWidth: '100%',
                nonSelectedText: 'Select status..',
                dropRight: true,
                numberDisplayed: 2,
                onChange: _bindOfferingList,
                onSelectAll: _bindOfferingList,
                onDeselectAll: _bindOfferingList
            }).multiselect('selectAll', false);


            $("#pageSize").change(function () {
                setPaging();
            });

        });
        function getCurrentUrl() {

            var s = $("#ddlCStatus").val();
            var r = $('#regionlist').val();
            return '@Url.Action("OfferingListData", "CRMRegionOperation", new { area = "CRM" })?status=' + (s == null ? '0' : s) + '&rgId=' + (r == null ? '' : r);
        }
        function _bindOfferingList() {
            var ps = $('#pageSize').val();
            dtable = $('#tblOfferingList').dataTable({
                "bAutoWidth": false,
                cache: false,
                "bDestroy": true,
                "iDisplayLength": $('#pageSize').val() == -1 ? 25 : $('#pageSize').val(),
                "aLengthMenu": [[5, 7, 10, 25, 50, -1], [5, 7, 10, 25, 50, "All"]],
                //"dom": "<'headerbox list'<'row'<'col-md-1'l><'col-md-4'f><'#divrightckbox.col-md-5 pull-right text-center'>>><'table-responsive't><'bottom'ip><'clear'>",
                "dom": "<'table-responsive't><'bottom'ip><'clear'>",
                "aaSorting": [[0, "desc"]],
                "sAjaxSource": getCurrentUrl(),
                "sAjaxDataProp": "aadata",  // Internationalisation. For more info refer to http://datatables.net/manual/i18n
                "rowCallback": function (nRow, data) {

                },

                "aoColumns": [
                    {
                        "sName": "region",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return '<span>' + full.Region + '</span>';
                        }
                    },
                    {
                        "sName": "CustomerNo",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return '<span>' + full.CustomerNo + '</span>';

                        @*return "<a href='@Url.Action("Franchiseedetail", "Franchise", new { @area = "Portal" })?id=" + full.ID + "'  style='color:#0c9cff' id=" + full.ID + "><span style=padding-left:15px>" + full.Number + "</span></a>";*@
                        }
                    },
                    {
                        "sName": "Customer Name",
                        "bSortable": true,
                        "sClass": "cls-left",
                        "mRender": function (data, type, full) {
                            //return full.CustomerName;
                            return "<a href='javascript:void(0)' onclick='showDetailPopup(" + full.CustomerId + "," +@((int)JKApi.Business.Enumeration.CustomerStatusList.RegionOperation) +")'  style='color:#0c9cff' id=" + full.CustomerId + ">" + full.CustomerName + "</a>";
                        @*return "<a href='@Url.Action("CustomerDetail", "Customer", new { @area = "Portal" })?id=" + full.CustomerId + "'  style='color:#0c9cff' id=" + full.CustomerId + ">" + full.CustomerName + "</a>";*@
                        }
                    },
                    {
                        "sName": "AccountType",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return full.AccountType;
                        }
                    },
                    {
                        "sName": "ContractBillingAmount",
                        "bSortable": true,
                        "sClass": "cls-right",
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return '$' + parseFloat(full.ContractBillingAmount, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString();

                        }
                    },
                    {
                        "sName": "FranchiseeNo",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            //var phone = full.Phone;
                            //    var formatedPhone = '(' + phone.substr(0, 3) + ')' + ' ' + phone.substr(3, 3) + '-' + phone.substr(6, 4);
                            return full.FranchiseeNo;

                        }
                    },
                    {
                        "sName": "FranchiseeName",
                        "bSortable": true,
                        "sClass": "cls-left",
                        "mRender": function (data, type, full) {
                            return full.FranchiseeName;
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    },
                    {
                        "sName": "Distance",
                        "bSortable": true,
                        "sClass": "cls-right",
                        "mRender": function (data, type, full) {
                            return (parseFloat(full.Distance, 10).toFixed(2) != 'NaN' ? parseFloat(full.Distance, 10).toFixed(2) : "");
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    }
                    ,
                    {
                        "sName": "OfferedDate",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return (full.OfferedDate != null ? moment(new Date(parseInt(full.OfferedDate.substr(6)))).format("MM/DD/YYYY") : "");
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    }
                    ,
                    {
                        "sName": "Status",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return full.Status;
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    },
                    {
                        "sName": "StatusDate",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return (full.StatusDate != null ? moment(new Date(parseInt(full.StatusDate.substr(6)))).format("MM/DD/YYYY") : "");
                            //return "<a onclick='OpenFranchiseDistributionPopup(" + full.ID + ")' target='_blank' style='color:#0c9cff' id=" + full.ID + ">" + full.DistributionAmount + "</a>";

                        }
                    },
                    {
                        "sName": "Note",
                        "bSortable": true,
                        "sClass": "cls-center",
                        "mRender": function (data, type, full) {
                            return "<a href='javascript:void(0)' onclick='OpenNote(\"" + full.SpecialNote + "\",\"" + full.Note + "\")'  style='color:#0c9cff' id=" + full.CustomerId + "><i class='fa fa-eye'></i></a>";
                        }
                    },
                    {
                        "sName": "Action",
                        "bSortable": true,
                        "sClass": "personlink   ",
                        "mRender": function (data, type, full) {
                            var action = "<div class='btn-group dropdown'>";
                            action += "<a target='_blank'  dropdown-toggle' data-toggle='dropdown'>";
                            action += "<i class='fa fa-hand-o-right' aria-hidden='true'></i>";
                            action += "</a>";
                            action += "<ul class='dropdown-menu pull-right'>";
                            action += "<li><a href='#' onclick=''><i class='fa fa-plus'></i> Send to New Franchisee</a></li>";
                            action += "<li><a href='#' onclick='OpenManualEnterResponsePopup("+ full.OfferingId +")'><i class='fa fa-plus'></i>Manual Enter Response</a></li>";                            
                            action += "</ul></div>";
                            return action;
                        }
                    }
                ]
            });
        }

        function setPaging() {
            var z = $("#pageSize").val();
            var table = $("#tblOfferingList").DataTable();
            if (z > 0) {
                table.page.len(z).draw();
            }
            else if (z == -1) {
                table.page.len(table.rows().count()).draw();
            }
            else {
                table.page.page.len(25).draw();
            }
        }

        function OpenNote(snote, note) {
            var _note = note;
            var _snote = snote;
            $("#modal_Note").modal('show');
            $("#SpNote").val(_snote);
            $("#Note").val(_note);
        }

    </script>

    <script type="text/javascript">


        function OpenCustomerDistributionPopup(Id) {
            var sURL = '@Url.Action("RenderCustomerDistributionDetailPopup", "Customer", new { area = "Portal" })?id=' + Id + "&isCRM=true";
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerDistribution').html(data);
                    $("#ModalCustomerDistributionPopup").modal({ resizable: true, draggable: true });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }
        function clickonyes(Id)
        {
            var status = @((int)JKApi.Business.Enumeration.CustomerStatusList.RegionOperation);

            $(".PendingMessage").remove();
            var sURL = '@Url.Action("CustomerDetailPopup", "CRMCustomer", new { area = "CRM" })?id=' + Id + "&status=" + status + "&callfrom=RO";
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                async:false,
                success: function (data) {
                    $('#form_ModelCustomerDetailsPopup').html(data);
                    $.ajax({
                        type: "GET",
                        url: '@Url.Action("GetAllFranchisees", "Franchise", new { area = "Portal" })',
                        data: {},
                        async:false,
                        success: function (data) {
                            c_typeaheadSource = [];
                            $.each(data, function (key, value) {
                                c_typeaheadSource.push({ id: value.FranchiseeId, name: value.FranchiseeNo + ' ' + value.Name })
                            });
                            ShowCustomerSuggetionBox();
                            $("#ModalCustomerDistributionPopup").modal("hide");
                        }
                    });
                    $("#ModelCustomerDetailsPopup").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }
    </script>

    <script type="text/javascript">
        var c_typeaheadSource = [];
        function showDetailPopup(Id, status) {
            $(".PendingMessage").remove();
            var sURL = '@Url.Action("CustomerDetailPopup", "CRMCustomer", new { area = "CRM" })?id=' + Id + "&status=" + status;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_ModelCustomerDetailsPopup').html(data);
                    $.ajax({
                        type: "GET",
                        url: '@Url.Action("GetAllFranchisees", "Franchise", new { area = "Portal" })',
                        data: {},
                        success: function (data) {
                            c_typeaheadSource = [];
                            $.each(data, function (key, value) {
                                c_typeaheadSource.push({ id: value.FranchiseeId, name: value.FranchiseeNo + ' ' + value.Name })
                            });
                        }
                    });
                    $("#ModelCustomerDetailsPopup").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }
        function showEditCustomerInfo(Id) {

            var sURL = '@Url.Action("PendingApprovalListEditCustomerPopup", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#form_Billingsetting').html(data);
                    $("#ModalEditCustomerInfo").modal({ backdrop: 'static' });
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $(".date-picker").datepicker();
                    $(".edit").attr("disabled", "disabled");
                    $(".edit").attr("readonly", "readonly");

                    $("#btnSave").prop("disabled", "false");
                    $("#btnSave").prop("readonly", "true");
                    $("#btnCancel").prop("disabled", "false");
                    $("#btnCancel").prop("readonly", "true");
                    $("#btnSave").hide();
                    $("#btnCancel").hide();

                    $(".editmain1").attr("disabled", "disabled");
                    $(".editmain1").attr("readonly", "readonly");
                    $(".editmain").attr("disabled", "disabled");
                    $(".editmain").attr("readonly", "readonly");

                    $(".editbill1").attr("disabled", "disabled");
                    $(".editbill1").attr("readonly", "readonly");
                    $(".editbill").attr("disabled", "disabled");
                    $(".editbill").attr("readonly", "readonly");

                    $(".EditBtn").show();
                    $(".SaveBtn").hide();
                    $(".CancelBtn").hide();

                },
                error: function () {
                    alert("Content load failed.");
                }
            });

        }

        //Customer Contract Popup
        function OpenCustomerContractPopup(Id) {

            var sURL = '@Url.Action("RenderCustomerContractDetails", "Customer", new { area = "Portal" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderCustomerContractDetails').html(data);
                    //$('#Contract_StartDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_StartDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_SignDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_StatusDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_ExpirationDate').inputmask("mm/dd/yyyy", {});
                    //$('#Contract_ResumeDate').inputmask("mm/dd/yyyy", {});
                    $(".date-picker").datepicker();
                    $(".input-group-btn").click(function () {
                        $(this).prev().trigger("focus");
                        $(this).prev().trigger("focus");
                    });
                    $("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
                },
                error: function () {
                    alert("Content load failed.");
                }
            });

            //$("#modal_CustomerContractPopup").modal({ backdrop: 'static' });
        }

        function AccountOffringModel(Id) {

            var sURL = '@Url.Action("CustomerAccountOffringPopup", "CRMCustomer", new { area = "CRM" })?id=' + Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#RenderAccountOffringDetails').html(data);
                    $("#modal_AccountOffringPopup").modal({ backdrop: 'static' });
                    settimedurationAccountOffering_select(3);
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
            //$("#modal_AccountOffringPopup").modal("show");
            OnlyNumber('#txtAccountOfferingDistance');
        }
        function settimedurationAccountOffering_select(id) {
            $('#select_timedurationAccountOffering').val(id)
            $("#sDateAccountOffering").prop("disabled", true);
            $("#eDateAccountOffering").prop("disabled", true);
            switch (parseInt(id)) {
                case 1:
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = moment().endOf('isoWeek').toString();
                    break;
                case 2:
                    //code block
                    firstDay = moment().startOf('isoWeek').toString();
                    lastDay = new Date().toString();
                    break;
                case 3:
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = moment().subtract(0, 'month').endOf('month').toString();
                    break;
                case 4:
                    //code block
                    firstDay = moment().subtract(0, 'month').startOf('month').toString();
                    lastDay = new Date().toString();
                    break;
                case 5:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = moment().endOf('quarter').toString();
                    break;
                case 6:
                    //code block
                    firstDay = moment().startOf('quarter').toString();
                    lastDay = new Date().toString();
                    break;
                case 7:
                    //code block
                    firstDay = moment().startOf('year').toString();;
                    lastDay = moment().endOf('year').toString();
                    break;
                case 8:
                    //code block
                    firstDay = moment().startOf('year').toString();
                    lastDay = new Date().toString();
                    break;
                case 9:
                    //code block
                    firstDay = moment().add(-1, 'days').toString();
                    lastDay = moment().add(-1, 'days').toString();
                    break;
                case 10:
                    //code block
                    firstDay = moment().subtract(1, 'week').startOf('week').toString();
                    lastDay = moment().subtract(1, 'week').endOf('week').toString();
                    break;
                case 11:
                    //code block
                    firstDay = moment().subtract(1, 'month').startOf('month').toString();
                    lastDay = moment().subtract(1, 'month').endOf('month').toString();
                    break;
                case 12:
                    //code block
                    firstDay = moment().subtract(1, 'quarter').startOf('quarter').toString();
                    lastDay = moment().subtract(1, 'quarter').endOf('quarter').toString();
                    break;
                case 13:
                    //code block
                    firstDay = moment().subtract(1, 'year').startOf('year').toString();
                    lastDay = moment().subtract(1, 'year').endOf('year').toString();
                    break;
                case 14:
                    //code block
                    $("#sDateAccountOffering").prop("disabled", false);
                    $("#eDateAccountOffering").prop("disabled", false);
                    break;
                default:
                //code block
            }
            $('#sDateAccountOffering').val(moment(firstDay).format('L'));
            $('#eDateAccountOffering').val(moment(lastDay).format('L'));
        }
        function OnlyNumber(id) {
            $(id).keydown(function (event) {
                if (event.shiftKey == true) { event.preventDefault(); }
                if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105) || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 46) { }
                else { event.preventDefault(); }
            });
        }

        function OpenManualEnterResponsePopup(Id)
        {
            
            var sURL = '@Url.Action("ManualOffringStatusChangePopup", "CRMRegionOperation", new { area = "CRM" })'+"?Id="+Id;
            $.ajax({
                type: "GET",
                url: sURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $("#RenderManualEnterOffringStatusPopup").html(data)
                    $("#modal_ManualEnterOffringStatusPopup").modal({ backdrop: 'static' });
                    $(".date-picker").datepicker();
                    $(".timepicker").timepicker();
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        }
    </script>

}